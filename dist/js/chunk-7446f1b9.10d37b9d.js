(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7446f1b9"],{"4c28":function(t,e,a){},5660:function(t,e,a){"use strict";a("7df0")},"7df0":function(t,e,a){},8992:function(t,e,a){"use strict";a("4c28")},aa44:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"contaniner"},[a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"活动列表",name:"list"}},[a("el-row",{staticClass:"header"},[a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:t.changeMallList}})],1),a("ul",{staticStyle:{"margin-left":"20px"}},[a("li",[a("span",[t._v("活动状态：")]),a("el-select",{staticStyle:{width:"100px"},attrs:{disabled:t.isDisabled,size:"mini",filterable:""},model:{value:t.discountType,callback:function(e){t.discountType=e},expression:"discountType"}},[a("el-option",{attrs:{value:"all",label:"全部"}}),t._l(t.discountTypeList,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})}))],2)],1),a("li",[a("el-input",{staticStyle:{width:"242px"},attrs:{disabled:t.isDisabled,size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.searchType,callback:function(e){t.searchType=e},expression:"searchType"}},t._l(t.searchTypeList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1)],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.queryData}},[t._v("搜 索")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.createNewActive}},[t._v("创建新的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.batchStopActive}},[t._v("批量结束活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.restartActivityDia}},[t._v("重新启动已过期的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.exportData}},[t._v("数据导出")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.clearLog}},[t._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"20px"},attrs:{disabled:t.isDisabled},model:{value:t.hideEnded,callback:function(e){t.hideEnded=e},expression:"hideEnded"}},[t._v("不显示过期活动")]),a("el-checkbox",{model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}},[t._v("隐藏日志")])],1)])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{ref:"plTable",attrs:{data:t.tableData,"use-virtual":"",height:640,"row-height":45,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":t.handleSelectionChange1}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺","min-width":"150",prop:"mallName"}}),a("u-table-column",{attrs:{align:"center",label:"活动ID","min-width":"150",prop:"discount_id"}}),a("u-table-column",{attrs:{align:"center",label:"活动名称","min-width":"150",prop:"title"}}),a("u-table-column",{attrs:{align:"center",label:"活动状态","min-width":"100",prop:"statusName"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{style:t.statusNameColor[i.statusName]&&"color:"+t.statusNameColor[i.statusName]},[t._v(" "+t._s(i.statusName)+" ")])]}}])}),a("u-table-column",{attrs:{align:"center",label:"商品数量","min-width":"100",prop:"total_product"}}),a("u-table-column",{attrs:{align:"center",label:"活动时间","min-width":"270"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$dayjs(a.start_time).format("MM/DD/YYYY HH:mm:ss")+" - "+t.$dayjs(a.end_time).format("MM/DD/YYYY HH:mm:ss"))+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"240"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,n=e.$index;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.searchDiscountDetail(i)}}},[t._v("查看详情")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.copyAndOpen(i.platform_mall_id,i.discount_id)}}},[t._v("复制")]),"进行中"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.stopActiveSingle(i,n,"stop")}}},[t._v("结束")]):t._e(),"即将开始"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.stopActiveSingle(i,n,"delete")}}},[t._v("删除")]):t._e()]}}])})],1),t.timeVisible?a("el-dialog",{staticClass:"time-dialog",attrs:{title:"选择时间",visible:t.timeVisible,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.timeVisible=e}}},[a("div",{staticClass:"content"},[a("span",[t._v("折扣促销时间：")]),a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"mini"},model:{value:t.promotionTime,callback:function(e){t.promotionTime=e},expression:"promotionTime"}})],1),a("div",{staticClass:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{size:"mini"},on:{click:function(e){t.timeVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.determineRestart}},[t._v("确 定")])],1)]):t._e()],1)],1),a("el-tab-pane",{attrs:{label:"活动编辑",name:"edit"}},[a("el-row",{staticClass:"header edit"},[t.activeRow.discount_id?t._e():a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:t.changeMallListEdit}})],1),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",[a("span",[t._v("活动名称：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeDicountName,callback:function(e){t.activeDicountName=e},expression:"activeDicountName"}})],1),a("li",[a("span",[t._v("活动时间：")]),a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",size:"mini",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.activeDate,callback:function(e){t.activeDate=e},expression:"activeDate"}})],1),a("li",[a("span",[t._v("商品编号：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeProductId,callback:function(e){t.activeProductId=e},expression:"activeProductId"}}),a("el-button",{staticStyle:{"margin-left":"21px"},attrs:{type:"primary",size:"mini"},on:{click:t.searchDetail}},[t._v("搜 索")])],1)]),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",{staticStyle:{"margin-right":"19px"}},[a("span",[t._v("活动折扣：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeDiscount,callback:function(e){t.activeDiscount=e},expression:"activeDiscount"}}),t._v("% ")],1),a("li",[a("span",[t._v("限购数量：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.limitNum,callback:function(e){t.limitNum=e},expression:"limitNum"}})],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.batchUpdateDiscount}},[t._v("批量修改折扣和限购")]),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.changeDiscountInfo}},[t._v("修改活动信息")]):t._e(),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.addGoods}},[t._v("添加商品")]),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.addActiveTo}},[t._v("添加商品到已有活动")]):t._e(),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.searchDiscountDetail(t.activeRow)}}},[t._v("获取活动已有物品")]):t._e(),t.activeRow.discount_id?t._e():a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.createActive}},[t._v("创建活动")]),a("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}},[t._v("隐藏日志")])],1)]),a("ul",{staticStyle:{margin:"0 0 0 20px"}},[a("span",{staticStyle:{color:"red"}},[t._v("折扣公式为：折扣价格=商品原价*折扣%。如原价100元的商品，输入80，最后的折扣价格为80元")])])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"editPlTable",attrs:{data:t.editTableData,"use-virtual":"",height:580,"row-height":68,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":t.handleSelectionChange2}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺名称","min-width":"150",prop:"platform_mall_name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.mall_alias_name||e.row.platform_mall_name)+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"主图","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticStyle:{width:"32px",height:"32px",display:"inline-block"},attrs:{effect:"light",placement:"right-end","visible-arrow":!1,enterable:!1}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("el-image",{staticStyle:{width:"400px",height:"400px"},attrs:{src:t._f("imageRender")([e.row.image])}})],1),a("el-image",{staticStyle:{width:"32px",height:"32px"},attrs:{src:t._f("imageRender")([e.row.image,!0])}})],1)]}}])}),a("u-table-column",{attrs:{align:"center",label:"商品名称","min-width":"150",prop:"name","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"商品编号","min-width":"150",prop:"itemid"}}),a("u-table-column",{attrs:{align:"center",label:"商品规格","min-width":"150",prop:"skuName","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"原价",width:"120",prop:"normal_price"}}),a("u-table-column",{attrs:{align:"center",label:"售价",width:"120",prop:"promotion_price"}}),a("u-table-column",{attrs:{align:"center",label:"折扣",width:"120",prop:"discount"}}),a("u-table-column",{attrs:{align:"center",label:"购买限制","min-width":"150",prop:"user_item_limit"}}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.editStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.deleteEditGoods(e.row,e.$index)}}},[t._v("删 除")]):t._e(),e.row.deleteStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.deleteActiveGoods(e.row,e.$index)}}},[t._v("删除活动商品")]):t._e()]}}])})],1)],1)],1)],1),a("div",{staticClass:"logging"},[a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}})],1),a("el-dialog",{attrs:{visible:t.goodsItemSelectorVisible,top:"7vh",title:"商品选择","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1280px"},on:{"update:visible":function(e){t.goodsItemSelectorVisible=e}}},[t.goodsItemSelectorVisible?a("goodsItemSelector",{attrs:{mall:t.selectMallListEdit},on:{changeGoodsItem:t.changeGoodsItem}}):t._e()],1)],1)},n=[],r=a("1da1"),s=(a("96cf"),a("4de4"),a("a434"),a("c740"),a("159b"),a("99af"),a("b0c0"),a("a9e3"),a("b680"),a("ac1f"),a("1276"),a("3ca3"),a("ddb0"),a("7db0"),a("a15b"),a("d3b7"),a("25f0"),a("01cd")),o=a("0e0b"),c=a("feb6"),l=a("d4ec"),u=a("bee2"),d=function(){function t(e){Object(l["a"])(this,t),this._this=e}return Object(u["a"])(t,[{key:"getDiscountNominate",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.item,t.prev=1,i={},i["limit"]=100,i["offset"]=a.offset,i["mallId"]=a.platform_mall_id,i["discount_id"]=a.discount_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/nominate/?",i);case 9:if(n=t.sent,r=this.isJsonString(this.isJsonString(n).data),!r||0!==r.code){t.next=15;break}return t.abrupt("return",{code:200,data:r.data});case 15:if(2!==r.code&&2!==r.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"查询折扣活动详情失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"查询折扣活动详情异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getByDiscountids",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.promotionid,n=e.limit,r=e.discountType,t.prev=1,s={},s["discount_id_list"]=i,s["discount_type"]=r,s["limit"]=n,s["offset"]=a.offset,s["mallId"]=a.platform_mall_id,t.next=10,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/get_by_discountids/?",s);case 10:if(o=t.sent,c=this.isJsonString(this.isJsonString(o).data),!c||0!==c.code){t.next=16;break}return t.abrupt("return",{code:200,data:c.data});case 16:if(2!==c.code&&2!==c.errcode){t.next=20;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 20:return t.abrupt("return",{code:-2,data:"获取列表数据失败"});case 21:t.next=26;break;case 23:return t.prev=23,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取列表数据异常： ".concat(t.t0)});case 26:case"end":return t.stop()}}),t,this,[[1,23]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getDiscountStandardSearch",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.keyword,n=e.searchType,r=e.discountType,t.prev=1,s={},s["keyword"]=i,s["search_type"]=n,"all"!==r&&(s["promotion_status"]=r),s["mallId"]=a.platform_mall_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/standard_search/?",s);case 9:if(o=t.sent,c=this.isJsonString(this.isJsonString(o).data),!c||0!==c.code){t.next=15;break}return t.abrupt("return",{code:200,data:c.data});case 15:if(2!==c.code&&2!==c.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"获取失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取promotionid数据异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getDiscountList",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.limit,n=e.discountType,t.prev=1,r={},r["limit"]=i,r["offset"]=a.offset,r["discount_type"]=n,r["mallId"]=a.platform_mall_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/list/?",r);case 9:if(s=t.sent,o=this.isJsonString(this.isJsonString(s).data),!o||0!==o.code){t.next=15;break}return t.abrupt("return",{code:200,data:o.data});case 15:if(2!==o.code&&2!==o.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"获取失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取折扣列表数据异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"isJsonString",value:function(t){if("string"!==typeof t)return t;try{return JSON.parse(t),JSON.parse(t)}catch(e){return t}}},{key:"stopActive",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,i={},i["discount_id"]=e.discount_id.toString(),i["action"]=a,i["mallId"]=e.platform_mall_id,t.next=7,this._this.$shopeemanService.mixChinese(e.country,"/api/marketing/v3/discount/?",i,{Headers:{"Content-Type":" application/json"}},"delete");case 7:if(n=t.sent,r=n&&JSON.parse(n),!r||200!==r.status){t.next=18;break}if(s=JSON.parse(r.data),!s||0!==s.code){t.next=15;break}return t.abrupt("return",{code:200,data:s.data||[]});case 15:return t.abrupt("return",{code:50001,data:s.message||r.statusText||""});case 16:t.next=21;break;case 18:if(403!==r.status){t.next=20;break}return t.abrupt("return",{code:r.status,data:"操作失败，店铺未登录！"});case 20:return t.abrupt("return",{code:r.status,data:"操作失败".concat(r.statusText)});case 21:t.next=26;break;case 23:return t.prev=23,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 26:case"end":return t.stop()}}),t,this,[[0,23]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"createActive",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.postChinese(e,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}});case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"putActive",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.mixChinese(e,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"putModelActive",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.mixChinese(e,"/api/marketing/v3/discount/nominate/",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()}]),t}(),m={components:{StoreChoose:c["a"],goodsItemSelector:s["a"]},data:function(){return{activeName:"list",GoodsDiscount:new d(this),showConsole:!0,promotionTime:[],timeVisible:!1,hideEnded:!0,limit:100,isDisabled:!1,keyword:"",searchType:"promotion_name",discountType:"all",selectMallList:[],selectMallListEdit:[],tableData:[],multipleSelection:[],endedActivityData:[],discountTypeList:[{value:"ongoing",label:"进行中"},{value:"upcoming",label:"即将开始"},{value:"ended",label:"已过期"}],searchTypeList:[{value:"promotion_name",label:"活动名称"},{value:"item_name",label:"商品名称"},{value:"item_id",label:"商品ID"}],statusNameColor:{"进行中":"green","即将开始":"orangered"},editTableData:[],editTableDataCopy:[],editMultipleSelection:[],activeDicountName:"",activeProductId:"",activeDate:"",activeRow:{},loading:!1,activeDiscount:"",limitNum:"",goodsItemSelectorVisible:!1,selectGoods:[],btnLoading:!1}},methods:{deleteActiveGoods:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i={discount_id:a.activeRow.discount_id,itemid:t.itemid,mallId:a.activeRow.platform_mall_id},e.next=3,a.$shopeemanService.deleteChinese(a.activeRow.country,"/api/marketing/v3/discount/nominate/",i,{headers:{"Content-Type":"application/json"}});case 3:if(n=e.sent,r=JSON.parse(n),200!==r.status){e.next=15;break}if(s=JSON.parse(r.data),!s||0!==s.code){e.next=12;break}a.$message.success("删除成功"),a.editTableData=a.editTableData.filter((function(e){return e.itemid!==t.itemid})),e.next=13;break;case 12:return e.abrupt("return",a.$message.warning("删除商品失败,".concat(s.message)));case 13:e.next=20;break;case 15:if(403!==r.status){e.next=19;break}return e.abrupt("return",a.$message.warning("删除商品失败，店铺未登录！"));case 19:return e.abrupt("return",a.$message.warning("删除商品失败！"));case 20:case"end":return e.stop()}}),e)})))()},deleteEditGoods:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:a.editTableData.splice(e,1),n=a.editTableDataCopy.findIndex((function(e){return e.itemid===t.itemid})),a.editTableDataCopy.splice(n,1);case 3:case"end":return i.stop()}}),i)})))()},addActiveTo:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.editTableData.filter((function(t){return 1===t.editStatus})),a.length){e.next=3;break}return e.abrupt("return",t.$message.warning("没有可添加的商品！"));case 3:t.showConsole=!1,i=t.activeRow.discount_id,t.loading=!0,a.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.searchProductDetail(a.itemid,a.platform_mall_id,a.country);case 2:if(n=e.sent,!n.length){e.next=8;break}return e.next=6,t.setModelActive(n,a.platform_mall_id,a.country,a.itemid,i,a.platform_mall_name);case 6:r=e.sent,r&&(s=t.editTableData.findIndex((function(t){return t.itemid==a.itemid})),o=t.editTableDataCopy.findIndex((function(t){return t.itemid==a.itemid})),t.$set(t.editTableData[s],"editStatus",2),t.$set(t.editTableDataCopy[o],"editStatus",2),t.$nextTick((function(){t.$refs.editPlTable.toggleRowSelection([{row:t.editTableData[s],selected:!1}])})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.loading=!1;case 8:case"end":return e.stop()}}),e)})))()},copyAndOpen:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:n={type:"route",shopId:t,route:"https://seller.th.shopee.cn/portal/marketing/discount/create?from=".concat(e)},a.$BaseUtilService.getOrderDetailInfo(t,JSON.stringify(n));case 2:case"end":return i.stop()}}),i)})))()},addGoods:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs.editPlTable.clearSelection(),t.activeDiscount&&t.limitNum){e.next=3;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 3:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=5;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 5:if(t.activeDicountName){e.next=7;break}return e.abrupt("return",t.$message.warning("活动名称不能为空"));case 7:if(t.activeDate&&t.activeDate.length){e.next=9;break}return e.abrupt("return",t.$message.warning("请选择活动时间"));case 9:t.goodsItemSelectorVisible=!0;case 10:case"end":return e.stop()}}),e)})))()},createActive:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.activeDiscount&&t.limitNum){e.next=2;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=4;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 4:if(t.selectGoods.length){e.next=6;break}return e.abrupt("return",t.$message.warning("请先选择商品！"));case 6:if(t.activeDate&&t.activeDate.length){e.next=8;break}return e.abrupt("return",t.$message.warning("请先选择活动时间！"));case 8:t.showConsole=!1,t.btnLoading=!0,t.$refs.Logs.writeLog("开始创建活动",!0),t.selectMallListEdit.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a,i){var n,s,o,c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Math.round(new Date(t.activeDate[0]).getTime()/1e3),s=Math.round(new Date(t.activeDate[1]).getTime()/1e3),e.prev=2,o={fe_status:"upcoming",highlight:"",title:t.activeDicountName,start_time:n,end_time:s,status:1,mallId:a.platform_mall_id},e.next=6,t.GoodsDiscount.createActive(a.country,o);case 6:c=e.sent,200===c.code?(t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】,创建活动【").concat(t.activeDicountName,"】成功"),!0),l=c.data.discount_id,u=t.selectGoods.filter((function(t){return t.platform_mall_id==a.platform_mall_id})),u.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(i){var n,r,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.searchProductDetail(i.itemid,i.platform_mall_id,i.country);case 2:n=e.sent,n.length&&(r=t.setModelActive(n,a.platform_mall_id,a.country,i.itemid,l,a.platform_mall_name),r&&(s=t.editTableData.findIndex((function(t){return t.itemid==i.itemid})),o=t.editTableDataCopy.findIndex((function(t){return t.itemid==i.itemid})),t.$set(t.editTableData[s],"editStatus",2),t.$set(t.editTableDataCopy[o],"editStatus",2),t.$nextTick((function(){t.$refs.editPlTable.toggleRowSelection([{row:t.editTableData[s],selected:!1}])}))));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):403===c.code?t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】创建活动失败,店铺未登录"),!1):t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】创建活动失败,").concat(c.data),!1),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),t.btnLoading=!1;case 13:i===t.selectMallListEdit.length-1&&(t.btnLoading=!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,a){return e.apply(this,arguments)}}());case 12:case"end":return e.stop()}}),e)})))()},setModelActive:function(t,e,a,i,n,s){var o=this;return Object(r["a"])(regeneratorRuntime.mark((function r(){var c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return c=[],t.forEach((function(t){var a={discount:100-o.activeDiscount,itemid:i,model_name:t.name,modelid:t.id,price_before_discount:Number(t.price),promotion_price:Number((t.price*o.activeDiscount/100).toFixed(16)),promotionid:n,selected:!0,shopid:Number(e),status:1,total_item_limit:0,user_item_limit:o.limitNum};c.push(a)})),l={discount_id:n,discount_model_list:c,mallId:e},r.next=5,o.GoodsDiscount.putModelActive(a,l);case 5:if(u=r.sent,200!==u.code){r.next=15;break}return d=o.editTableData.findIndex((function(t){return t.itemid==i})),o.$set(o.editTableData[d],"discount",1-o.activeDiscount/100),o.$set(o.editTableData[d],"promotion_price_after_tax",Number((o.activeDiscount/100*o.editTableData[d].price).toFixed(1))),o.$set(o.editTableData[d],"user_item_limit",o.limitNum),o.$refs.Logs.writeLog("店铺【".concat(s,"】,商品【").concat(i,"】创建活动成功"),!0),r.abrupt("return",!0);case 15:return o.$refs.Logs.writeLog("店铺【".concat(s,"】,商品【").concat(i,"】创建活动失败"),!1),r.abrupt("return",!1);case 17:case"end":return r.stop()}}),r)})))()},searchProductDetail:function(t,e,a){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={product_id:t,version:"3.2.0",shop_id:e},n.next=3,i.$shopeemanService.searchProductDetail(a,r);case 3:if(s=n.sent,200!==s.code){n.next=8;break}return n.abrupt("return",s.data.model_list);case 8:return n.abrupt("return",[]);case 9:case"end":return n.stop()}}),n)})))()},changeGoodsItem:function(t){var e=this;this.selectGoods=t.goodsList,t.goodsList.forEach((function(t){t.promotion_price=(t.price*(e.activeDiscount/100)).toFixed(2),t.discount=(1-e.activeDiscount/100).toFixed(2),t.image=t.images.split(",")[0],t.editStatus=1,t.normal_price=t.price})),this.editTableData=t.goodsList.concat(this.editTableData),Object(o["v"])(1e3),t.goodsList.forEach((function(t){e.$nextTick((function(){e.$refs.editPlTable.toggleRowSelection([{row:t,selected:!0}])}))})),this.editMultipleSelection=t.goodsList,this.editTableDataCopy=JSON.parse(JSON.stringify(this.editTableData)),this.goodsItemSelectorVisible=!1},batchUpdateDiscount:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.activeDiscount&&t.limitNum){e.next=2;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=4;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 4:if(t.editMultipleSelection.length){e.next=6;break}return e.abrupt("return",t.$message.warning("请先勾选数据！"));case 6:t.editMultipleSelection.forEach((function(e){t.$set(e,"discount",(1-t.activeDiscount/100).toFixed(2)),t.$set(e,"promotion_price",Number((t.activeDiscount/100*e.price).toFixed(1))),t.$set(e,"user_item_limit",t.limitNum);var a=t.editTableData.findIndex((function(t){return t.modelid==e.modelid})),i=t.editTableDataCopy.findIndex((function(t){return t.modelid==e.modelid}));a>-1&&(t.$set(t.editTableData[a],"discount",(1-t.activeDiscount/100).toFixed(2)),t.$set(t.editTableData[a],"promotion_price",Number((t.activeDiscount/100*e.price).toFixed(1))),t.$set(t.editTableData[a],"user_item_limit",t.limitNum)),i>-1&&(t.editTableDataCopy[i].discount=(1-t.activeDiscount/100).toFixed(2),t.editTableDataCopy[i].promotion_price=Number((t.activeDiscount/100*e.price).toFixed(1)),t.editTableDataCopy[i].user_item_limit=t.limitNum)}));case 7:case"end":return e.stop()}}),e)})))()},updateDiscount:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.editMultipleSelection.length){e.next=3;break}return t.$refs.Logs.writeLog("没有要修改的折扣信息",!0),e.abrupt("return");case 3:return a=[],t.editMultipleSelection.forEach((function(e){var i={itemid:e.itemid,modelid:e.modelid,promotion_price:Number((t.activeDiscount/100*e.price).toFixed(1)),user_item_limit:Number(t.limitNum),status:e.status};a.push(i)})),i={discount_id:t.activeRow.discount_id,discount_model_list:a,mallId:t.activeRow.platform_mall_id},t.showConsole=!1,e.next=9,t.GoodsDiscount.putModelActive(t.activeRow.country,i);case 9:n=e.sent,200===n.code?(t.$refs.Logs.writeLog("修改折扣信息成功",!0),t.$refs.editPlTable.clearSelection()):t.$refs.Logs.writeLog("修改折扣信息失败：".concat(n.data),!1);case 11:case"end":return e.stop()}}),e)})))()},changeDiscountInfo:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new Date(t.activeDate[0]).getTime(),i=new Date(t.activeDate[1]).getTime(),(a<t.activeRow.start_time||a>t.activeRow.end_time)&&t.$alert("开始时间要晚于".concat(t.$dayjs(t.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss"),"，早于").concat(t.$dayjs(t.activeRow.end_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i<t.activeRow.start_time||i>t.activeRow.end_time)&&t.$alert("结束时间要早于".concat(t.$dayjs(t.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i-a)/1e3/60/60<1&&t.$alert("活动时间不得小于1小时","提示",{confirmButtonText:"确定"}),n={status:t.activeRow.status,title:t.activeDicountName,start_time:Math.round(a/1e3),discount_id:t.activeRow.discount_id,source:t.activeRow.source,end_time:Math.round(i/1e3),mallId:t.activeRow.platform_mall_id},e.next=8,t.GoodsDiscount.putActive(t.activeRow.country,n);case 8:r=e.sent,200===r.code?t.$refs.Logs.writeLog("修改活动信息成功",!0):t.$refs.Logs.writeLog("修改活动信息失败：".concat(r.data),!1),t.updateDiscount();case 11:case"end":return e.stop()}}),e)})))()},createNewActive:function(){var t=(new Date).getTime()+6e5,e=t+72e5;this.activeName="edit",this.activeRow={},this.editTableData=[],this.editTableDataCopy=[],this.activeDicountName="",this.selectGoods=[],this.activeDate=[this.$dayjs(t).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(e).format("YYYY-MM-DD HH:mm:ss")]},searchDetail:function(){var t=this;this.activeProductId?this.editTableData=this.editTableDataCopy.filter((function(e){return e.itemid==t.activeProductId})):this.editTableData=this.editTableDataCopy},searchDiscountDetail:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.activeName="edit",e.activeRow=t,e.activeDicountName=t.title,e.activeDate=[e.$dayjs(t.start_time).format("YYYY-MM-DD HH:mm:ss"),e.$dayjs(t.end_time).format("YYYY-MM-DD HH:mm:ss")],e.activeDiscount="",e.limitNum="",e.editTableData=[],e.selectMallListEdit=[{country:t.country,platform_mall_name:t.platform_mall_name,platform_mall_id:t.platform_mall_id,id:t.mallId,mall_alias_name:t.mall_alias_name,group_id:0,group_name:"",mall_type:1}],e.getDiscountDetail(t);case 9:case"end":return a.stop()}}),a)})))()},getDiscountDetail:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.delegateYield(regeneratorRuntime.mark((function a(){var i,n,r,s,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=100,n={limit:i,offset:0,discount_id:t.discount_id,platform_mall_id:t.platform_mall_id,country:t.country},a.next=4,e.GoodsDiscount.getDiscountNominate({item:n});case 4:r=a.sent,s=200===r.code&&r.data.item_info||[];case 6:if(!s.length){a.next=19;break}if(s.forEach((function(a){r.data.model_info[a.itemid]&&r.data.model_info[a.itemid].length&&r.data.model_info[a.itemid].forEach((function(i){var n=JSON.parse(JSON.stringify(a)),s=r.data.discount_item_list.find((function(t){return t.itemid===a.itemid})),o=r.data.price_stock_info.find((function(t){return t.item_id===a.itemid})),c=o.sku_stock_price_list.find((function(t){return t.model_id===i.modelid})),l=Object.assign(n,i,s,c.price_info);l.price=i.price,l.name=a.name,l.skuName=i.name,l.image=a.images.split(",")[0],l.platform_mall_name=t.mallName,l.country=t.country,l.platform_mall_id=t.platform_mall_id,l.promotion_price=s.promotion_price,l.discount=c&&c.price_info?(1-l.promotion_price/l.normal_price).toFixed(2):"";var u=e.editTableData.findIndex((function(t){return t.deleteStatus&&l.itemid===t.itemid}));u<0&&(l.deleteStatus=!0),e.editTableData.push(l)}))})),!(s.length<100)){a.next=12;break}s=[],a.next=17;break;case 12:return n.offset+=i,a.next=15,e.GoodsDiscount.getDiscountNominate({item:n});case 15:o=a.sent,s=200===o.code&&o.data.item_info||[];case 17:a.next=6;break;case 19:e.editTableDataCopy=JSON.parse(JSON.stringify(e.editTableData)),e.$refs.Logs.writeLog("获取详情结束",!0),e.loading=!1;case 22:case"end":return a.stop()}}),a)}))(),"t0",3);case 3:a.next=8;break;case 5:a.prev=5,a.t1=a["catch"](1),e.loading=!1;case 8:case"end":return a.stop()}}),a,null,[[1,5]])})))()},batchStopActive:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.multipleSelection.length){e.next=2;break}return e.abrupt("return",t.$message.warning("请先选择数据！"));case 2:t.showConsole=!1,t.$refs.Logs.consoleMsg="",t.$refs.Logs.writeLog("请在执行操作，请稍等",!0),t.multipleSelection.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!((new Date).getTime()-a.start_time<36e5)){e.next=4;break}t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：折扣活动开始一小时后才能结束！"),!1),e.next=8;break;case 4:return e.next=6,t.GoodsDiscount.stopActive(a,"stop");case 6:i=e.sent,200===i.code?(n=t.tableData.findIndex((function(t){return t.discount_id==a.discount_id})),t.$set(t.tableData[n],"statusName","已过期"),t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动成功"),!0)):t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：").concat(i.data),!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})))()},stopActiveSingle:function(t,e,a){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("stop"!==a){n.next=3;break}if(!((new Date).getTime()-t.start_time<36e5)){n.next=3;break}return n.abrupt("return",i.$message.warning("折扣活动开始一小时后才能结束！"));case 3:return i.showConsole=!1,i.$refs.Logs.writeLog("请在执行操作，请稍等",!0),n.next=7,i.GoodsDiscount.stopActive(t,a);case 7:r=n.sent,200===r.code?("delete"===a?i.tableData.splice(e,1):i.$set(i.tableData[e],"statusName","已过期"),i.$refs.Logs.writeLog("活动【".concat(t.title,"-").concat(t.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动成功"),!0)):i.$refs.Logs.writeLog("活动【".concat(t.title,"-").concat(t.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动失败：").concat(r.data),!1);case 9:case"end":return n.stop()}}),n)})))()},exportData:function(){var t=this;if(!this.multipleSelection.length)return this.$message.warning("请选择要导出的数据！");var e=1,a="<tr>\n            <td>编号</td>\n            <td>店铺</td>\n            <td>活动ID</td>\n            <td>活动名称</td>\n            <td>活动状态</td>\n            <td>商品数量</td>\n            <td>活动时间</td>\n            </tr>";this.multipleSelection.forEach((function(i){a+="<tr><td>".concat(e++,"</td>\n        <td>").concat(i.mallName?"".concat(i.country,"-").concat(i.mallName):"\t","</td>\n        <td>").concat(i.discount_id?i.discount_id:"\t","</td>\n        <td>").concat(i.title?i.title:"\t","</td>\n        <td>").concat(i.statusName?i.statusName:"\t","</td>\n        <td>").concat(i.total_product?i.total_product:"\t","</td>\n        <td>").concat(i.start_time&&i.end_time?"".concat(t.$dayjs(i.start_time).format("MM/DD/YYYY HH:mm:ss")," - ").concat(t.$dayjs(i.end_time).format("MM/DD/YYYY HH:mm:ss")):"\t","</td>\n        </tr>\n        ")})),Object(o["i"])("商品折扣活动数据",a)},clearLog:function(){this.$refs.Logs.consoleMsg=""},restartActivityDia:function(){this.endedActivityData=[];for(var t=0;t<(null===(e=this.multipleSelection)||void 0===e?void 0:e.length);t++){var e,a=this.multipleSelection[t];"已过期"===a.statusName&&this.endedActivityData.push(a)}if(!this.endedActivityData.length)return this.$message("请选择已过期活动执行此操作");this.timeVisible=!0,this.promotionTime=[new Date,(new Date).getTime()+36e5]},determineRestart:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==(a=t.promotionTime)&&void 0!==a&&a.length){e.next=2;break}return e.abrupt("return",t.$message.warning("请选择折扣促销时间"));case 2:return t.timeVisible=!1,t.isDisabled=!0,t.$refs.Logs.writeLog("开始重启已过期的活动",!0),t.endedActivityData.forEach((function(t){t.offset=0,t.mList=[]})),t.showConsole=!1,e.next=9,Object(o["c"])(t.endedActivityData,t.restartActivity);case 9:t.isDisabled=!1;case 10:case"end":return e.stop()}}),e)})))()},restartActivity:function(t){var e=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,s,o,c,l,u,d,m,p,f,h,g,b,v,_,w,x,y;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e.length>1&&void 0!==e[1]?e[1]:{count:1},r=Math.round(new Date(a.promotionTime[0]).getTime()/1e3),s=Math.round(new Date(a.promotionTime[1]).getTime()/1e3),o=null,i.prev=4,c={discount_id:null,end_time:s,start_time:r,source:0,status:1,title:t.title,mallId:t.platform_mall_id},i.next=8,a.GoodsDiscount.createActive(t.country,c);case 8:return l=i.sent,200===l.code?(o=l.data.discount_id,a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】成功，开始获取活动详情"),!0)):a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】失败,").concat(l.data),!0),u={},u["item"]=t,i.next=14,a.GoodsDiscount.getDiscountNominate(u);case 14:if(d=i.sent,200===d.code){i.next=17;break}return i.abrupt("return",a.$refs.Logs.writeLog("获取【".concat(t.title,"】【").concat(t.discount_id,"】错误：").concat(d.data),!1));case 17:return a.$refs.Logs.writeLog("获取【".concat(t.title,"】【").concat(t.discount_id,"】详情结束，共").concat(d.data.item_info.length,"件商品"),!0),m=d.data.item_info.filter((function(t){return 1===t.status})),p=[],m.forEach((function(t){p.push(t.itemid)})),f={end_time:s,item_id_list:p,start_time:r,mallId:t.platform_mall_id},i.next=24,a.$shopeemanService.overlapDiscount(t.country,f);case 24:if(h=i.sent,200!==h.code){i.next=40;break}if(h.data.fail_main_items.length&&(g=[],h.data.fail_main_items.forEach((function(t){g.push(t.item_id)})),a.$refs.Logs.writeLog("活动【".concat(t.title,"】,商品【").concat(g.join(","),"】已经参加了活动，不能再重复参加"),!0)),!h.data.succ_main_items.length){i.next=37;break}return b=[],h.data.succ_main_items.forEach((function(t){for(var e=d.data.model_info[t.item_id],a=function(a){var i=e[a],n=d.data.discount_item_list.find((function(e){return e.itemid===t.item_id&&e.modelid===i.modelid}));if(!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:t.item_id.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};b.push(r)},i=0;i<e.length;i++)a(i)})),v={discount_id:o,discount_model_list:b,mallId:t.platform_mall_id},i.next=33,a.GoodsDiscount.putModelActive(t.country,v);case 33:_=i.sent,200===_.code?a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启添加商品失败").concat(_.data),!0),i.next=38;break;case 37:a.$refs.Logs.writeLog("活动【".concat(t.title,"】,无可重启商品"),!0);case 38:i.next=47;break;case 40:return w=[],d.data.item_info.forEach((function(t){for(var e=d.data.model_info[t.itemid],a=function(a){var i=e[a],n=d.data.discount_item_list.find((function(e){return e.itemid===t.itemid&&e.modelid===i.modelid}));if(!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:t.itemid.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};w.push(r)},i=0;i<e.length;i++)a(i)})),x={discount_id:o,discount_model_list:w,mallId:t.platform_mall_id},i.next=45,a.GoodsDiscount.putModelActive(t.country,x);case 45:y=i.sent,200===y.code?a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启添加商品失败").concat(y.data),!0);case 47:i.next=51;break;case 49:i.prev=49,i.t0=i["catch"](4);case 51:return i.prev=51,--n.count,i.finish(51);case 54:case"end":return i.stop()}}),i,null,[[4,49,51,54]])})))()},queryData:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectMallList.length){e.next=2;break}return e.abrupt("return",t.$message("请选择店铺"));case 2:return t.isDisabled=!0,t.showConsole=!1,t.tableData=[],t.$refs.Logs.consoleMsg="",t.$refs.Logs.writeLog("开始查询",!0),t.selectMallList.forEach((function(t){t.offset=0,t.mList=[]})),e.next=10,Object(o["c"])(t.selectMallList,t.getDiscountList);case 10:t.$refs.Logs.writeLog("查询结束",!0),t.isDisabled=!1;case 12:case"end":return e.stop()}}),e)})))()},getDiscountList:function(t){var e=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,s,o,c,l,u,d,m,p,f,h,g,b;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>1&&void 0!==e[1]?e[1]:{count:1},r="",s=0,o="",r=t.mall_alias_name||t.platform_mall_name,c={},c["mItem"]=t,c["discountType"]=a.discountType,c["limit"]=a.limit,i.prev=9,l=[],!a.keyword){i.next=22;break}return c["keyword"]=a.keyword,c["searchType"]=a.searchType,i.next=16,a.GoodsDiscount.getDiscountStandardSearch(c);case 16:if(p=i.sent,200===p.code){i.next=19;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(p.data),!1));case 19:if(null!==(u=p.data)&&void 0!==u&&u.hits&&!((null===(d=p.data)||void 0===d||null===(m=d.hits)||void 0===m?void 0:m.length)<=0)){i.next=21;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】共查询到【0】条数据"),!0));case 21:p.data.hits.forEach((function(t){l.push(t.promotionid)}));case 22:if(!(a.keyword&&(null===l||void 0===l?void 0:l.length)>0)){i.next=29;break}return c["promotionid"]=l,i.next=26,a.GoodsDiscount.getByDiscountids(c);case 26:o=i.sent,i.next=32;break;case 29:return i.next=31,a.GoodsDiscount.getDiscountList(c);case 31:o=i.sent;case 32:if(200===o.code){for(s=o.data.total_count,f=0;f<o.data.discount_list.length;f++)h=o.data.discount_list[f],h.mallName=r,h.start_time=1e3*h.start_time,h.end_time=1e3*h.end_time,h.country=t.country,h.platform_mall_id=t.platform_mall_id,h.mall_alias_name=t.mall_alias_name,h.platform_mall_name=t.platform_mall_name,h.mallId=t.id,g=(new Date).getTime(),h.start_time>g?h.statusName="即将开始":h.end_time<g?h.statusName="已过期":h.statusName="进行中";t.mList=t.mList.concat(o.data.discount_list),b=o.data.discount_list,a.hideEnded&&(b=o.data.discount_list.filter((function(t){return"已过期"!==t.statusName}))),a.tableData=a.tableData.concat(b)}else a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(o.data),!1);t.offset+=a.limit;case 34:if(t.mList.length<s&&0!==s){i.next=22;break}case 35:a.$refs.Logs.writeLog("查询店铺【".concat(r,"】活动数据结束"),!0),i.next=41;break;case 38:i.prev=38,i.t0=i["catch"](9),a.$refs.Logs.writeLog("店铺【".concat(r,"】异常：").concat(i.t0),!1);case 41:return i.prev=41,--n.count,i.finish(41);case 44:case"end":return i.stop()}}),i,null,[[9,38,41,44]])})))()},filterData:function(t){for(var e=[],a=0;a<t.length;a++){var i=t[a];this.hideEnded&&"已过期"===i.statusName||e.push(i)}return e},handleClick:function(t,e){if("edit"===this.activeName){var a=(new Date).getTime()+6e5,i=a+72e5;this.activeDate=[this.$dayjs(a).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(i).format("YYYY-MM-DD HH:mm:ss")]}},handleSelectionChange1:function(t){this.multipleSelection=t},handleSelectionChange2:function(t){this.editMultipleSelection=t},changeMallListEdit:function(t){this.selectMallListEdit=t,this.country=t.country},changeMallList:function(t){this.selectMallList=t,this.country=t.country}}},p=m,f=(a("5660"),a("2877")),h=Object(f["a"])(p,i,n,!1,null,"a16f6a72",null);e["default"]=h.exports},feb6:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("ul",{staticClass:"storeChooseUL"},[t.isMall?a("li",[t._v(t._s(t._f("chineseSite")(t.countryVal)))]):a("li",{style:t.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:t.spanWidth}},[t._v("所属站点：")]),a("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:""},model:{value:t.countryVal,callback:function(e){t.countryVal=e},expression:"countryVal"}},[t.isAll?a("el-option",{attrs:{label:"全部",value:""}}):t._e(),t._l(t.countries,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],2)],1),a("li",{style:t.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:t.spanWidth}},[t._v("店铺分组：")]),a("el-select",{staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"",size:"mini",filterable:""},model:{value:t.groupId,callback:function(e){t.groupId=e},expression:"groupId"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._l(t.groupIdList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.group_name,value:t.id}})}))],2)],1),a("li",{style:t.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:t.spanWidth}},[t._v("店铺名称：")]),a("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:t.loadmoreMall,expression:"loadmoreMall"}],staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"","filter-method":t.filterMall,size:"mini",filterable:""},on:{"visible-change":function(e){return t.filterMall("")}},model:{value:t.site,callback:function(e){t.site=e},expression:"site"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._l(t.siteShowList,(function(e,i){return t.showMall(e,i)?a("el-option",{key:i,attrs:{label:e.mall_alias_name||e.platform_mall_name,value:e.platform_mall_id}}):t._e()}))],2)],1),t.isReset?a("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[a("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary"},on:{click:t.reset}},[t._v("　刷　　新　")])],1):t._e()])])},n=[],r=a("1da1"),s=a("b85c"),o=a("2909"),c=(a("96cf"),a("99af"),a("d81d"),a("fb6a"),a("caad"),a("2532"),a("d3b7"),a("25f0"),a("6062"),a("3ca3"),a("ddb0"),a("4de4"),a("159b"),a("c740"),a("7db0"),a("7646")),l=a("2b0e");l["default"].directive("loadmore",{bind:function(t,e){var a=this,i=t.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){this.scrollHeight-this.scrollTop<=this.clientHeight+50?e.value(!0,this):this.scrollTop<30&&e.value(!1,this)})),i.addEventListener("blur",(function(){a.scrollTop=0}))}});var u={name:"StoreChoose",props:{spanWidth:{type:String,default:"80px"},parentCountry:{type:String,default:"TH"},isMall:{type:Boolean,default:function(){return!1}},isAll:{type:Boolean,default:function(){return!1}},isReset:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],siteShowList:[],countries:this.$filters.countries_option,mallListAPIInstance:new c["a"](this),isShowName:"",isShowNameAll:!1,showMallNumber:100,mallShowIndex:0,jsonMallData:[],filterMallTime:null}},watch:{siteList:function(t){this.siteShowList=t},countryVal:{handler:function(t,e){this.isShowName="",this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(t,e){var a=this;if(this.isAllowSet2){this.isShowName="",this.isAllowSet2=!1;var i=e.indexOf("")>-1,n=t.indexOf("")>-1;i!==n?this.groupId=n?[""].concat(Object(o["a"])(this.groupIdList.map((function(t){return t.id})))):[]:n?this.groupId=t.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length&&this.groupId.unshift(""),setTimeout((function(){a.isAllowSet2=!0,a.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(t,e){var a=this;if(this.isAllowSet1){this.isAllowSet1=!1;var i=this.isShowName,n=e.includes(""),r=t.includes("");if(n!==r||e.toString()===t.toString()&&this.isShowNameAll)if(r&&(!i||i&&!this.isShowNameAll)){var c=i&&Object(o["a"])(this.siteShowList.map((function(t){return t.platform_mall_id})))||[""].concat(Object(o["a"])(this.siteList.map((function(t){return t.platform_mall_id})))),l=new Set([].concat(Object(o["a"])(c),Object(o["a"])(e)));this.site=Object(o["a"])(l),this.isShowNameAll=!0,i&&this.siteList.length===this.site.length&&this.site.unshift("")}else{this.isShowNameAll=!1;var u=[];if(i){var d=i&&Object(o["a"])(this.siteShowList.map((function(t){return t.platform_mall_id}))),m=d.length>this.site.length&&this.site||d,p=d.length>this.site.length&&d||this.site;u=new Set(this.site);var f,h=Object(s["a"])(p);try{for(h.s();!(f=h.n()).done;){var g=f.value;m.includes(g)&&u.delete(g)}}catch(b){h.e(b)}finally{h.f()}u.delete("")}this.site=Object(o["a"])(u)}else r?this.site=t.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length?this.site.unshift(""):this.isShowNameAll=!1;setTimeout((function(){a.changeMallList(),a.filterMall(i),a.isAllowSet1=!0}),10)}},deep:!0}},mounted:function(){this.countryVal=this.isMall?this.parentCountry:this.isAll?"":"TH"},methods:{reset:function(){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},ddMallGoodsGetMallList:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s,o,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.site=[],i=e.countryVal,n=[],!(e.jsonMallData.length>0)){a.next=7;break}n=e.jsonMallData,a.next=12;break;case 7:return a.next=9,e.$appConfig.temporaryCacheInfo("get","mallAllData","");case 9:r=a.sent,n=JSON.parse(r)||[],e.jsonMallData=JSON.parse(r)||[];case 12:if(!(n.length>0)){a.next=17;break}1===t&&(e.siteList=""===i?n:n.filter((function(t){return t.country===i}))),2===t&&(0===e.groupId.length?e.siteList=[]:(e.siteList=[],e.groupId.forEach((function(t){n.forEach((function(a){i?t===a.group_id&&i===a.country&&e.siteList.push(a):t===a.group_id&&e.siteList.push(a)}))})))),a.next=22;break;case 17:return s={country:"",mallGroupIds:""},a.next=20,e.mallListAPIInstance.ddMallGoodsGetMallList(s);case 20:o=a.sent,200===o.code?(e.$appConfig.temporaryCacheInfo("save","mallAllData",o.data),c=o.data||[],e.siteList=c,e.jsonMallData=c,e.siteList=""===i?c:c.filter((function(t){return t.country===i}))):e.$message.error("获取分组、店铺列表失败");case 22:0===e.groupIdList.length&&(e.groupId=[""],e.siteList.forEach((function(t){var a=e.groupIdList.findIndex((function(e){return e.id===t.group_id}));t.group_name&&a<0&&(e.groupIdList.push({group_name:t.group_name,id:t.group_id}),e.groupId.push(t.group_id))}))),setTimeout((function(){e.isAllowSet2=!0,e.isAllowSet1=!0,e.site=[""]}),10);case 24:case"end":return a.stop()}}),a)})))()},changeMallList:function(){var t=this,e=[],a="";this.site.forEach((function(i){if(i){var n=t.siteList.find((function(t){return t.platform_mall_id===i}));e.push(n),a+=i+","}})),!this.countryVal&&this.groupId.indexOf("")>-1&&(a=e.length!==this.siteList.length&&a||""),this.source?this.$emit("changeMallList",{mallList:e,source:this.source,searchAll:a,country:this.countryVal.toLocaleUpperCase()}):(e["country"]=this.countryVal,this.$emit("changeMallList",e))},filterMall:function(t){var e=this,a=t&&this.isShowName!==t?1e3:100;this.filterMallTime&&(clearTimeout(this.filterMallTime),this.filterMallTime=null),this.filterMallTime=setTimeout((function(){e.isShowName=t||"";var a=e.siteList;t&&(a=e.siteList.filter((function(e){var a=e.mall_alias_name||e.platform_mall_name;return a.includes(t)}))),e.mallShowIndex=0,e.siteShowList=a}),a)},showMall:function(t,e){var a=t.mall_alias_name||t.platform_mall_name,i=this.site[0]===t.platform_mall_id;return i||this.mallShowIndex<=e&&e<=this.mallShowIndex+this.showMallNumber&&(!this.isShowName||a.includes(this.isShowName))},loadmoreMall:function(t,e){if(this.siteShowList.length>this.showMallNumber){var a=0;t?(a=this.mallShowIndex+10,a=a<this.siteShowList.length-this.showMallNumber&&a||this.siteShowList.length-this.showMallNumber):(a=this.mallShowIndex-10,a=a>0&&a||0),a!==this.mallShowIndex&&(e.scrollTop=t?e.scrollTop-100:30),this.mallShowIndex=a}}}},d=u,m=(a("8992"),a("2877")),p=Object(m["a"])(d,i,n,!1,null,null,null);e["a"]=p.exports}}]);