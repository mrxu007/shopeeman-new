(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ba36f0dc"],{"0b64":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a("1da1"),n=a("d4ec"),o=a("bee2"),s=(a("d81d"),a("4de4"),a("96cf"),function(){function e(t){Object(n["a"])(this,e),this._this=t}return Object(o["a"])(e,[{key:"putModelActive",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.mixChinese(t,"/api/marketing/v3/discount/nominate/",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(r=e.sent,n=r&&JSON.parse(r),console.log(n),!n||200!==n.status){e.next=15;break}if(o=JSON.parse(n.data),!o||0!==o.code){e.next=12;break}return e.abrupt("return",{code:200,data:o.data||[]});case 12:return e.abrupt("return",{code:50001,data:o.message||n.statusText||""});case 13:e.next=18;break;case 15:if(403!==n.status){e.next=17;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 17:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"deleteCollectGoodsInfo",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$commodityService.deleteCollectGoodsInfo(t);case 3:if(a=e.sent,r=this.isJsonString(a),200!==r.code){e.next=7;break}return e.abrupt("return",{code:200});case 7:return e.abrupt("return",{code:201,data:r.msg});case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"删除云商品库数据异常 ".concat(e.t0)});case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dismissInvalidProducts",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a={},a["ids"]=[t.id],a["mallId"]=t.platform_mall_id,e.next=6,this._this.$shopeemanService.postChinese(t.country,"/api/v3/product/dismiss_invalid_products?",a);case 6:if(r=e.sent,n=this.isJsonString(r),200!==n.status){e.next=12;break}if(o=this.isJsonString(n.data),0!==o.code){e.next=12;break}return e.abrupt("return",{code:200});case 12:return e.abrupt("return",{code:201,data:n.statusText});case 15:return e.prev=15,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"确认虾皮禁卖异常： ".concat(e.t0)});case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteAddOnDealSubItemList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a,r){var n,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n={},n["add_on_deal_id"]=a,n["create_type"]=0,n["sub_item_list"]=r,n["mallId"]=t.platform_mall_id,e.next=8,this._this.$shopeemanService.postChinese(t.country,"/api/marketing/v3/add_on_deal/sub_item_list/?",n);case 8:if(o=e.sent,s=this.isJsonString(this.isJsonString(o).data),console.log("删除子加购商品",s),"success"!==s.message){e.next=13;break}return e.abrupt("return",{code:200});case 13:return e.abrupt("return",{code:201,data:s.message});case 16:return e.prev=16,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"删除加购子商品异常： ".concat(e.t0)});case 19:case"end":return e.stop()}}),e,this,[[0,16]])})));function t(t,a,r){return e.apply(this,arguments)}return t}()},{key:"getAdd0nDealAggrSubItemList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["add_on_deal_id"]=a,r["mallId"]=t.platform_mall_id,r["promotion_status"]="ongoing",e.prev=4,e.next=7,this._this.$shopeemanService.getChinese(t.country,"/api/marketing/v3/add_on_deal/aggr_sub_item_list/?",r);case 7:if(n=e.sent,o=this.isJsonString(this.isJsonString(n).data),console.log("获取子商品加购活动",o),"success"!==o.message){e.next=12;break}return e.abrupt("return",{code:200,data:o.data});case 12:return e.abrupt("return",{code:201,data:o.message});case 15:return e.prev=15,e.t0=e["catch"](4),e.abrupt("return",{code:-2,data:"子商品加购活动列表异常： ".concat(e.t0)});case 18:case"end":return e.stop()}}),e,this,[[4,15]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"deleteAddOnDealMainItemList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a,r){var n,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n={},n["add_on_deal_id"]=r,n["main_item_list"]=[{item_id:t.id,status:a}],n["mallId"]=t.platform_mall_id,e.next=7,this._this.$shopeemanService.postChinese(t.country,"/api/marketing/v3/add_on_deal/main_item_list/?",n);case 7:if(o=e.sent,s=this.isJsonString(this.isJsonString(o).data),console.log("删除主加购商品",s),"success"!==s.message){e.next=12;break}return e.abrupt("return",{code:200});case 12:return e.abrupt("return",{code:201,data:s.message});case 15:return e.prev=15,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"删除加购主商品异常： ".concat(e.t0)});case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,a,r){return e.apply(this,arguments)}return t}()},{key:"getAdd0nDealAggrMainItemList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["add_on_deal_id"]=a,r["mallId"]=t.platform_mall_id,e.prev=3,e.next=6,this._this.$shopeemanService.getChinese(t.country,"/api/marketing/v3/add_on_deal/aggr_main_item_list/?",r);case 6:if(n=e.sent,o=this.isJsonString(n),200!==o.status){e.next=11;break}return s=this.isJsonString(o.data),e.abrupt("return",{code:200,data:s.data});case 11:return e.abrupt("return",{code:201,data:o.statusText});case 14:return e.prev=14,e.t0=e["catch"](3),e.abrupt("return",{code:-2,data:"主商品加购活动列表异常： ".concat(e.t0)});case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"getAddOnDealStandardSearch",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={},a["search_type"]="item_id",a["keyword"]=t.id,a["mallId"]=t.platform_mall_id,a["promotion_status"]="ongoing",e.prev=5,e.next=8,this._this.$shopeemanService.getChinese(t.country,"/api/marketing/v3/add_on_deal/standard_search/?",a);case 8:if(r=e.sent,n=this.isJsonString(r),200!==n.status){e.next=13;break}return o=this.isJsonString(n.data),e.abrupt("return",{code:200,data:o.data});case 13:return e.abrupt("return",{code:201,data:n.statusText});case 16:return e.prev=16,e.t0=e["catch"](5),e.abrupt("return",{code:-2,data:"加购活动异常： ".concat(e.t0)});case 19:case"end":return e.stop()}}),e,this,[[5,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteBundleGoods",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r={},r["bundle_deal_id"]=a,r["items"]=[{item_id:t.id}],r["mallId"]=t.platform_mall_id,e.next=7,this._this.$shopeemanService.deleteChinese(t.country,"/api/marketing/v3/bundle_deal/item/",r,{headers:{"Content-Type":"application/json",referer:"portal/marketing/bundle/".concat(a)}});case 7:if(n=e.sent,o=this.isJsonString(this.isJsonString(n).data),console.log("删除套装商品",o),"success"!==o.message){e.next=12;break}return e.abrupt("return",{code:200});case 12:return e.abrupt("return",{code:201,data:o.message});case 15:return e.prev=15,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"删除套装商品异常： ".concat(e.t0)});case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"getBundleDeal",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={},a["keyword"]=t.id,a["search_type"]="item_id",a["mallId"]=t.platform_mall_id,a["promotion_status"]="ongoing",e.prev=5,e.next=8,this._this.$shopeemanService.getChineseReferer(t.country,"/api/marketing/v3/bundle_deal/standard_search/?",a);case 8:if(r=e.sent,n=this.isJsonString(r),200!==n.status){e.next=13;break}return o=this.isJsonString(n.data),e.abrupt("return",{code:200,data:o.data});case 13:return e.abrupt("return",{code:201,data:n.statusText});case 16:return e.prev=16,e.t0=e["catch"](5),e.abrupt("return",{code:-2,data:"套装活动异常： ".concat(e.t0)});case 19:case"end":return e.stop()}}),e,this,[[5,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteDiscountCampainDetail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r={},r["discount_id"]=a,r["itemid_list"]=[t.id],r["mallId"]=t.platform_mall_id,e.next=7,this._this.$shopeemanService.deleteChinese(t.country,"/api/marketing/v3/discount/nominate/abnormal/",r,{headers:{"Content-Type":"application/json",referer:"/portal/marketing/discount/".concat(a,"/")}});case 7:if(n=e.sent,o=this.isJsonString(this.isJsonString(n).data),console.log("删除折扣商品",o),"success"!==o.message){e.next=12;break}return e.abrupt("return",{code:200});case 12:return e.abrupt("return",{code:201,data:o.message});case 15:return e.prev=15,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"删除折扣商品异常： ".concat(e.t0)});case 18:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"getMallDiscountsIdByKeyword",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o,s,i,l,c,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={},a["search_type"]="item_id",a["keyword"]=t.id,a["mallId"]=t.platform_mall_id,e.prev=4,e.next=7,this._this.$shopeemanService.getChinese(t.country,"/api/marketing/v3/discount/standard_search/?",a);case 7:if(r=e.sent,n=this.isJsonString(r),200!==n.status){e.next=29;break}return o=this.isJsonString(n.data),s={},s["mallId"]=t.platform_mall_id,s["discount_id_list"]=o.data.hits.map((function(e){return e.promotionid})),s["offset"]=0,s["limit"]=2,s["discount_type"]="all",e.next=19,this._this.$shopeemanService.getChinese(t.country,"/api/marketing/v3/discount/get_by_discountids/?",s);case 19:if(i=e.sent,l=this.isJsonString(i),200!==l.status){e.next=28;break}return c=this.isJsonString(l.data).data,u=(new Date).getTime(),d=c.discount_list.filter((function(e){if(1e3*e.start_time<u&&1e3*e.end_time>u)return e})),e.abrupt("return",{code:200,data:d});case 28:return e.abrupt("return",{code:201,data:n.statusText});case 29:return e.abrupt("return",{code:201,data:n.statusText});case 32:return e.prev=32,e.t0=e["catch"](4),e.abrupt("return",{code:-2,data:"折扣活动异常： ".concat(e.t0)});case 35:case"end":return e.stop()}}),e,this,[[4,32]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCategoryName",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a,r,n){var o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$commodityService.getCategoryTbInfo(t,a+"",r,n);case 3:if(o=e.sent,s=this.isJsonString(o),200!==s.code){e.next=7;break}return e.abrupt("return",{code:200,data:s.data});case 7:return e.abrupt("return",{code:201,data:s.msg});case 10:return e.prev=10,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"获取类目名异常： ".concat(e.t0)});case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t,a,r,n){return e.apply(this,arguments)}return t}()},{key:"searchProductList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o,s,i,l,c,u,d,m,p,g,_,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,r=t.pageSize,n=t.searchType,o=t.keyword,s=t.goodsMin,i=t.goodsMax,l=t.soldMin,c=t.soldMax,u=t.listType,d=t.categoryId,m=t.cursor,e.prev=1,p={page_number:a.pageNumber,page_size:r,mallId:a.platform_mall_id,search_type:"originId"!==n&&n||"",keyword:"originId"!==n&&o||"",category_id:d||"",stock_min:s,stock_max:i,sold_min:l,sold_max:c,list_type:u,count_list_types:"sold_out,banned,deboosted,deleted,unlisted",source:"seller_center",cursor:m,version:"4.0.0"},console.log(p),e.next=6,this._this.$shopeemanService.getChinese(a.country,"/api/v3/product/search_product_list/?",p,{headers:{accept:"application/json, text/plain, */*"}});case 6:if(g=e.sent,_=this.isJsonString(g),200!==_.status){e.next=13;break}if(f=this.isJsonString(_.data),"success"!==f.message){e.next=12;break}return e.abrupt("return",{code:200,data:f.data});case 12:return e.abrupt("return",{code:201,data:"数据获取失败：".concat(f.message)});case 13:if(403!==_.status){e.next=15;break}return e.abrupt("return",{code:403,data:"未登录，请登录后再查询"});case 15:if(0!==_.status){e.next=17;break}return e.abrupt("return",{code:0,data:"异常，请检查代理"});case 17:return e.abrupt("return",{code:_.status,data:"".concat(_.statusText)});case 20:return e.prev=20,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取数据异常： ".concat(e.t0)});case 23:case"end":return e.stop()}}),e,this,[[1,20]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getMpskuList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,o,s,i,l,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("11111"),a=t.mItem,r=t.pageSize,n=t.listType,o=t.listOrderType,s=t.cursor,e.prev=2,i={page_number:a.pageNumber,page_size:r,mallId:a.platform_mall_id,list_type:n,source:"seller_center",version:"1.0.0"},o&&(i["list_order_type"]=o),s&&(i["cursor"]=s),console.log("get_mpsku_list",i),e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/v3/mpsku/get_mpsku_list/?",i,{headers:{accept:"application/json, text/plain, */*"}});case 9:if(l=e.sent,c=this.isJsonString(l),console.log(c),200!==c.status){e.next=17;break}if(u=this.isJsonString(c.data),"success"!==u.message){e.next=16;break}return e.abrupt("return",{code:200,data:u.data});case 16:return e.abrupt("return",{code:201,data:"数据获取失败：".concat(u.message)});case 17:if(403!==c.status){e.next=19;break}return e.abrupt("return",{code:403,data:"未登录，请登录后再查询"});case 19:if(0!==c.status){e.next=21;break}return e.abrupt("return",{code:0,data:"异常，请检查代理"});case 21:return e.abrupt("return",{code:c.status,data:"".concat(c.statusText)});case 24:return e.prev=24,e.t0=e["catch"](2),e.abrupt("return",{code:-2,data:"获取数据异常： ".concat(e.t0)});case 27:case"end":return e.stop()}}),e,this,[[2,24]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isJsonString",value:function(e){if("string"!==typeof e)return e;try{return JSON.parse(e),JSON.parse(e)}catch(t){return e}}}]),e}())},58660:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var r=a("53ca"),n=a("b85c"),o=a("1da1"),s=a("d4ec"),i=a("bee2"),l=a("ade3"),c=(a("99af"),a("3ca3"),a("ddb0"),a("c740"),a("a9e3"),a("96cf"),a("f68b")),u=a("a254"),d=a("2b0e"),m=a("0e0b"),p=null,g=function(){function e(){Object(s["a"])(this,e),Object(l["a"])(this,"MallAPIInstance",new c["a"](new d["default"])),Object(l["a"])(this,"MarketManagerAPIInstance",new u["a"](new d["default"]))}return Object(i["a"])(e,[{key:"add0",value:function(e){return e<10?"0"+e:e}},{key:"formatTime",value:function(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),o=t.getHours(),s=t.getMinutes(),i=t.getSeconds();return a+"-"+p.add0(r)+"-"+p.add0(n)+" "+p.add0(o)+":"+p.add0(s)+":"+p.add0(i)}},{key:"isLogin",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.MallAPIInstance.isLogin(t);case 2:if(a=e.sent,200!==a.code||!a.data){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"topAction",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={country:t.country,mallId:t.sys_mall_id,goodsID:t.id},console.log("置顶",t),e.next=4,p.MarketManagerAPIInstance.topGoods(a);case 4:if(r=e.sent,0!==r.ecode){e.next=12;break}return e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.sys_mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品置顶成功"});case 8:return console.log("topAction-商品置顶suc"),e.abrupt("return",!0);case 12:return e.next=14,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.sys_mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品【".concat(t.id,"】置顶失败").concat(r.message)});case 14:return console.log("topAction-商品置顶fail"),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,window.BaseUtilBridgeService.getTopGoodsTask("all");case 2:if(t=e.sent,console.log(t),t.length){e.next=7;break}return console.log("暂无任务"),e.abrupt("return");case 7:return p=this,e.next=10,Object(m["d"])(t,this.runtesk);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"runtesk",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a,o,s,i,l,c,u,d,m,g=this,_=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=_.length>1&&void 0!==_[1]?_[1]:{count:1},e.prev=1,e.next=4,window.BaseUtilBridgeService.getTopGoods(t.mall_id,"0");case 4:if(o=e.sent,o.length){e.next=10;break}return e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"已置顶完所有商品"});case 8:return console.log("已置顶完所有商品"),e.abrupt("return");case 10:return e.next=12,p.isLogin({platform_mall_id:t.mall_id,country:t.country});case 12:if(s=e.sent,s){e.next=19;break}return e.next=16,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"店铺未登录"});case 16:return console.log("登录未登录"),setTimeout((function(){console.log("104-----s")}),1e3),e.abrupt("return");case 19:if(i=new Date(t.next_top_time).getTime(),!(i>(new Date).getTime())){e.next=26;break}return console.log(t.country+"未到执行时间"),e.next=24,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"未到置顶时间"});case 24:return setTimeout(this.runtesk(t,a={count:1}),162e5),e.abrupt("return");case 26:return e.next=28,window.BaseUtilBridgeService.getTopGoods(t.mall_id,"0");case 28:if(l=e.sent,console.log("查询未置顶的商品",l),l.length){e.next=35;break}return console.log("已置顶完所有商品"),e.next=34,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"已置顶完所有商品"});case 34:return e.abrupt("return");case 35:c=Object(n["a"])(l),e.prev=36,d=regeneratorRuntime.mark((function e(){var r,n,o,s,i,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=u.value,e.next=3,p.MarketManagerAPIInstance.topedGoods({country:t.country,mallId:t.mall_id});case 3:if(n=e.sent,0===n.ecode){e.next=11;break}return console.log("店铺【".concat(t.mall_name,"】商品置顶数据获取失败")),e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"店铺【".concat(t.mall_name,"】商品置顶数据获取失败")});case 8:return console.log("414-商品数据获取失败"),setTimeout(g.runtesk(t,a={count:1}),162e5),e.abrupt("return",{v:void 0});case 11:if(o=n.data,!(o.findIndex((function(e){return e===Number(r.goods_id)}))>=0)){e.next=21;break}return e.next=15,window.BaseUtilBridgeService.saveTopGoods({mall_id:t.mall_id,goods_id:r.goods_id,is_top:"1"});case 15:return s=e.sent,console.log("商品表状态更新",s),e.next=19,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"".concat(r.goods_id,"商品正在置顶")});case 19:return console.log("426-该商品正在置顶"),e.abrupt("return","continue");case 21:if(!(o.length>=5)){e.next=27;break}return e.next=24,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品置顶已达上限"});case 24:return console.log("商品置顶已达上限",o),setTimeout(g.runtesk(t,a={count:1}),162e5),e.abrupt("return",{v:void 0});case 27:return console.log("置顶",r),i={country:r.country,mallId:r.sys_mall_id,goodsID:r.id},e.next=31,g.MarketManagerAPIInstance.topGoods(i);case 31:if(l=e.sent,0!==l.ecode){e.next=40;break}return e.next=35,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品置顶成功"});case 35:return console.log("置顶成功"),e.next=38,window.BaseUtilBridgeService.saveTopGoods({mall_id:t.mall_name,goods_id:r.goods_id,is_top:"1"});case 38:e.next=43;break;case 40:return e.next=42,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品【".concat(r.id,"】置顶失败").concat(l.message)});case 42:console.log("置顶失败");case 43:case"end":return e.stop()}}),e)})),c.s();case 39:if((u=c.n()).done){e.next=48;break}return e.delegateYield(d(),"t0",41);case 41:if(m=e.t0,"continue"!==m){e.next=44;break}return e.abrupt("continue",46);case 44:if("object"!==Object(r["a"])(m)){e.next=46;break}return e.abrupt("return",m.v);case 46:e.next=39;break;case 48:e.next=53;break;case 50:e.prev=50,e.t1=e["catch"](36),c.e(e.t1);case 53:return e.prev=53,c.f(),e.finish(53);case 56:setTimeout(this.runtesk(t,a={count:1}),162e5),e.next=64;break;case 59:return e.prev=59,e.t2=e["catch"](1),console.log("try-catch",e.t2),e.next=64,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:p.formatTime((new Date).getTime()),log_message:"商品置顶失败".concat(e.t2)});case 64:return e.prev=64,--a.count,e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[1,59,64,67],[36,50,53,56]])})));function t(t){return e.apply(this,arguments)}return t}()}]),e}()},"5daf":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail"},[a("div",{staticClass:"row",staticStyle:{display:"flex","margin-top":"25px","background-color":"white",padding:"15px 4px",overflow:"auto"}},[a("div",{staticClass:"row2_left",staticStyle:{border:"1px solid rgb(220, 228, 218)","border-radius":"5px",width:"748px"}},[a("span",{staticStyle:{"margin-top":"-7px",display:"block","margin-left":"14px","background-color":"white","text-align":"center",width:"85px"}},[e._v("基础数据配置")]),a("ul",[a("li",[a("storeChoose",{staticStyle:{"margin-left":"-20px",width:"730px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}})],1),a("li",{staticStyle:{"margin-top":"20px","align-items":"center"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.getTopTestTable}},[e._v("搜索任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delTeskFun("")}}},[e._v("批量删除任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.stopdTesk}},[e._v("停止创建任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")])],1),e._m(0)])]),a("div",{staticClass:"row2_right",staticStyle:{border:"1px solid rgb(220, 228, 218)","border-radius":"5px","margin-left":"20px",width:"507px"}},[a("span",{staticStyle:{"margin-top":"-7px",display:"block","margin-left":"14px","background-color":"white","text-align":"center",width:"85px"}},[e._v("置顶任务操作")]),a("ul",{staticStyle:{width:"505px"}},[a("li",[a("div",[e._v(" 置顶时间设置： "),a("el-radio-group",{model:{value:e.set_time,callback:function(t){e.set_time=t},expression:"set_time"}},[a("el-radio",{attrs:{label:"1"}},[e._v("当前时间")]),a("el-radio",{staticStyle:{"margin-left":"11px"},attrs:{label:"2"}},[a("el-date-picker",{staticStyle:{width:"180px"},attrs:{size:"mini",type:"datetime","value-format":"timestamp","picker-options":e.pickerOptions,placeholder:"选择日期时间"},model:{value:e.cloumn_date,callback:function(t){e.cloumn_date=t},expression:"cloumn_date"}})],1)],1)],1)]),a("li",[a("div",[e._v(" 置顶维度设置： "),a("el-radio-group",{model:{value:e.otherConditon,callback:function(t){e.otherConditon=t},expression:"otherConditon"}},[a("el-radio",{attrs:{label:"1"}},[e._v("自定义商品")]),a("el-radio",{attrs:{label:"2"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.saleType,callback:function(t){e.saleType=t},expression:"saleType"}},[a("el-option",{attrs:{label:"默认排序",value:"2"}}),a("el-option",{attrs:{label:"销量从低往高",value:"3"}}),a("el-option",{attrs:{label:"销量从高往低",value:"4"}}),a("el-option",{attrs:{label:"价格从低往高",value:"5"}}),a("el-option",{attrs:{label:"价格从高往低",value:"6"}})],1)],1)],1),"1"===e.otherConditon?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addGoods}},[e._v("添加商品")]):e._e()],1)]),a("li",{staticStyle:{"align-items":"baseline"}},[a("div",[e._v("循环置顶商品个数： "),a("el-input",{staticStyle:{width:"60px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.loopGoodsNum,callback:function(t){e.loopGoodsNum=t},expression:"loopGoodsNum"}}),a("el-button",{staticStyle:{"margin-left":"32px"},attrs:{size:"mini",type:"primary"},on:{click:e.createTeskFun}},[e._v("创建任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.refreshTopGoods}},[e._v("重新获取置顶商品")])],1)])])])]),a("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableList,height:"calc(100vh - 232px)","header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),a("el-table-column",{attrs:{type:"index",fixed:"",label:"序号"}}),a("el-table-column",{attrs:{prop:"country",label:"站点",align:"center","min-width":"150px",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e._f("chineseSite")(a.country)))]}}])}),a("el-table-column",{attrs:{prop:"mall_name",label:"店铺名称",align:"center","min-width":"150px"}}),a("el-table-column",{attrs:{prop:"sort_type",label:"置顶维度",align:"center","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.top_typeList[r.sort_type+""]))])]}}])}),a("el-table-column",{attrs:{prop:"top_total_count",label:"置顶商品总数",align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"toped_count",label:"已置顶商品数",align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"created_at",label:"任务创建时间",align:"center","min-width":"150px"}}),a("el-table-column",{attrs:{prop:"next_top_time",label:"下次置顶时间",align:"center","min-width":"150px"}}),a("el-table-column",{attrs:{prop:"topping_goods_ids",label:"置顶商品",align:"center","min-width":"180px","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"msg",label:"操作结果",align:"center","min-width":"180px","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"",label:"历史记录",align:"center","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.checkRecord(r)}}},[e._v("查看置顶记录")])]}}])}),a("el-table-column",{attrs:{prop:"",label:"操作",align:"center","min-width":"100px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delTeskFun(r)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination",staticStyle:{display:"flex","justify-content":"flex-end"}},[a("el-pagination",{attrs:{background:"","current-page":e.page,"page-sizes":[15,50,100,200],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"置顶记录",top:"3vh",visible:e.dialogRecord,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"600px"},on:{"update:visible":function(t){e.dialogRecord=t}}},[a("div",[a("el-table",{attrs:{data:e.recordList,"header-cell-style":{background:"#f7fafa"},"row-style":{color:"black",height:"50px"},"max-height":"400px"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"55"}}),a("el-table-column",{attrs:{prop:"log_time",label:"记录时间","min-width":"150",sortable:""}}),a("el-table-column",{attrs:{prop:"log_message",label:"历史信息","min-width":"280","show-overflow-tooltip":""}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.dialogRecord=!1}}},[e._v("关 闭")])],1)]),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),a("div",{staticClass:"on_new_dialog"},[a("el-dialog",{attrs:{visible:e.goodsItemSelectorVisible,top:"7vh",title:"商品选择","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1280px"},on:{"update:visible":function(t){e.goodsItemSelectorVisible=t}}},[e.goodsItemSelectorVisible?a("goodsItemSelector",{attrs:{"is-need-filter-act":!0,mall:e.selectMalllist},on:{changeGoodsItem:e.changeGoodsItem}}):e._e()],1)],1)],1)},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",[a("span",{staticStyle:{color:"red",display:"block","margin-top":"5px"}},[e._v("提示：每个店铺可置顶商品数量大为5个，置顶时间为4小时")])])}],o=a("b85c"),s=a("1da1"),i=(a("d81d"),a("c740"),a("a9e3"),a("d3b7"),a("25f0"),a("99af"),a("96cf"),a("0b64")),l=a("feb6"),c=a("01cd"),u=a("0e0b"),d=a("a254"),m=a("f68b"),p=a("58660"),g={components:{storeChoose:l["a"],goodsItemSelector:c["a"]},data:function(){return{topGoodsInstance:new p["a"],MallAPIInstance:new m["a"](this),goodsItemSelectorVisible:!1,dialogRecord:!1,stoptoping:!1,createDel:!1,MarketManagerAPIInstance:new d["a"](this),loading:!1,GoodsList:new i["a"](this),top_typeList:{0:"自定义商品",1:"商品ID",2:"默认排序",3:"销量从低往高",4:"销量从高往低",5:"价格从低往高",6:"价格从高往低"},page:1,pageSize:15,total:0,showlog:!0,pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},cloumn_date:"",set_time:"1",otherConditon:"2",saleType:"2",loopGoodsNum:"",tableList:[],selectMalllist:[],selectTable:[],topHistoryMsg:[],recordList:[],currentDate:"",createTag:!1,couponGoodslist:[],topok:0}},mounted:function(){return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},methods:{addGoods:function(){this.selectMalllist.length>1?this.$message.warning("选择自定义商品时,只能选择一个店铺"):this.goodsItemSelectorVisible=!0},changeGoodsItem:function(e){e&&(this.loopGoodsNum=e.goodsList.length,console.log(e),this.couponGoodslist=e.goodsList.map((function(e){return e.itemid}))),console.log(this.couponGoodslist),this.goodsItemSelectorVisible=!1},clearLog:function(){this.$refs.Logs.consoleMsg=""},refreshTopGoods:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showlog=!1,e.selectTable.length){t.next=4;break}return e.$message.warning("请选择需要操作的数据!"),t.abrupt("return");case 4:if("2"!==e.set_time||e.cloumn_date){t.next=10;break}if(!(e.cloumn_date<(new Date).getTime())){t.next=8;break}return e.$message.warning("置顶时间不能晚于当前时间"),t.abrupt("return");case 8:return e.$message.warning("请设置任务执行时间"),t.abrupt("return");case 10:if("1"!==e.otherConditon||e.couponGoodslist.length){t.next=13;break}return e.$message.warning("请选择自定义商品"),t.abrupt("return");case 13:if("2"!==e.otherConditon||e.loopGoodsNum){t.next=16;break}return e.$message.warning("请设置任务执行的商品个数"),t.abrupt("return");case 16:console.log("this.selectMalllist",e.selectMalllist),console.log("this.selectTable",e.selectTable),a=[],r=Object(o["a"])(e.selectTable);try{for(s=function(){var t=n.value,r=e.selectMalllist.findIndex((function(e){return e.platform_mall_id===Number(t.mall_id)}));r>=0&&a.push(e.selectMalllist[r])},r.s();!(n=r.n()).done;)s()}catch(i){r.e(i)}finally{r.f()}return e.$refs.Logs.writeLog("正在重新获取任务",!0),t.next=24,Object(u["d"])(a,e.createTesk);case 24:e.$refs.Logs.writeLog("任务获取完成",!0),e.getTopTestTable();case 26:case"end":return t.stop()}}),t)})))()},checkRecord:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.dialogRecord=!0,a.next=3,window.BaseUtilBridgeService.getTopGoodsHistory(e.mall_id);case 3:r=a.sent,t.recordList=r,r||t.$message.warning("置顶历史数据获取失败");case 6:case"end":return a.stop()}}),a)})))()},getTopTestTable:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s,i,l,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("----------"),e.tableList=[],e.showlog=!1,e.$refs.Logs.writeLog("正在获取列表信息......",!0),a=e.selectMalllist.map((function(e){return e["platform_mall_id"]})).toString(),t.next=7,window.BaseUtilBridgeService.getTopGoodsTask(a);case 7:r=t.sent,console.log("任务列表",r),r.length||e.$refs.Logs.writeLog("当前暂无置顶任务",!0),n=Object(o["a"])(r),t.prev=11,n.s();case 13:if((s=n.n()).done){t.next=27;break}return i=s.value,t.next=17,window.BaseUtilBridgeService.getTopGoods(i.mall_id,"1");case 17:return l=t.sent,i.toped_count=l.length,i.topping_goods_ids=l.map((function(e){return e.goods_id})).toString(),t.next=22,window.BaseUtilBridgeService.getTopGoodsHistory(i.mall_id);case 22:c=t.sent,i.msg=c[c.length-1].log_message,e.tableList.push(i);case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t0=t["catch"](11),n.e(t.t0);case 32:return t.prev=32,n.f(),t.finish(32);case 35:console.log(e.tableList),e.$refs.Logs.writeLog("列表信息获取结束",!0);case 37:case"end":return t.stop()}}),t,null,[[11,29,32,35]])})))()},getMallTopGoods:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s,i,l,c,u,d,m,p,g,_,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n={country:e.country,pageNumber:0,platform_mall_id:e.platform_mall_id},s={mItem:n,pageSize:48,listType:"all"},"3"===e.top_type&&(s.listOrderType="sales_asc"),"4"===e.top_type&&(s.listOrderType="sales_dsc"),"5"===e.top_type&&(s.listOrderType="price_asc"),"6"===e.top_type&&(s.listOrderType="price_dsc"),i=!0,l=[];case 8:if(!i){r.next=53;break}return n["pageNumber"]++,r.next=12,a.GoodsList.getMpskuList(s);case 12:if(c=r.sent,200!==c.code){r.next=50;break}if(null!==(u=c.data.list)&&void 0!==u&&u.length){r.next=17;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无商品数据")),r.abrupt("return",[]);case 17:d=c.data.list,m=Object(o["a"])(d),r.prev=19,m.s();case 21:if((p=m.n()).done){r.next=40;break}return g=p.value,_={},_["mall_id"]=e.platform_mall_id.toString(),_["goods_id"]=g.id.toString(),_["is_top"]="0",r.next=29,window.BaseUtilBridgeService.saveTopGoods(_);case 29:if(f=r.sent,console.log("---",f),"200"===f.code){r.next=35;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(g.id,"上报失败"),!1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】任务创建失败"),!1),r.abrupt("return",[]);case 35:if(l.push({id:g.id}),!(l.length>=t)){r.next=38;break}return r.abrupt("return",l);case 38:r.next=21;break;case 40:r.next=45;break;case 42:r.prev=42,r.t0=r["catch"](19),m.e(r.t0);case 45:return r.prev=45,m.f(),r.finish(45);case 48:r.next=51;break;case 50:return r.abrupt("return",[]);case 51:r.next=8;break;case 53:return r.abrupt("return",l);case 54:case"end":return r.stop()}}),r,null,[[19,42,45,48]])})))()},topAction:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,o,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.MarketManagerAPIInstance.topedGoods({country:e.country,mallId:e.sys_mall_id});case 2:if(r=a.sent,0===r.ecode){a.next=9;break}return t.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】商品置顶数据获取失败"),!1),a.next=7,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mallName,mall_id:e.sys_mall_id.toString(),log_time:t.formatTime((new Date).getTime()),log_message:"店铺【".concat(e.mallName,"】商品置顶数据获取失败")});case 7:return console.log("414-商品数据获取失败"),a.abrupt("return","top_data_fail");case 9:if(n=r.data,!(n.findIndex((function(t){return t===Number(e.id)}))>=0)){a.next=19;break}return a.next=13,window.BaseUtilBridgeService.saveTopGoods({mall_id:e.sys_mall_id.toString(),goods_id:e.id.toString(),is_top:"1"});case 13:return o=a.sent,console.log("商品表状态更新",o),a.next=17,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mallName,mall_id:e.sys_mall_id.toString(),log_time:t.formatTime((new Date).getTime()),log_message:"".concat(e.id.toString(),"该商品正在置顶")});case 17:return console.log("426-该商品正在置顶"),a.abrupt("return","toped");case 19:if(!(n.length>=5)){a.next=24;break}return a.next=22,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mallName,mall_id:e.sys_mall_id.toString(),log_time:t.formatTime((new Date).getTime()),log_message:"商品置顶已达上限"});case 22:return console.log("商品置顶已达上限"),a.abrupt("return","full");case 24:return console.log("置顶",e),s={country:e.country,mallId:e.sys_mall_id,goodsID:e.id},a.next=28,t.MarketManagerAPIInstance.topGoods(s);case 28:if(i=a.sent,0!==i.ecode){a.next=37;break}return a.next=32,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mallName,mall_id:e.sys_mall_id.toString(),log_time:t.formatTime((new Date).getTime()),log_message:"商品置顶成功"});case 32:return t.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】商品【").concat(e.id,"】置顶成功"),!0),console.log("置顶成功"),a.abrupt("return","suc");case 37:return a.next=39,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mallName,mall_id:e.sys_mall_id.toString(),log_time:t.formatTime((new Date).getTime()),log_message:"商品【".concat(e.id,"】置顶失败").concat(i.message)});case 39:return t.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】商品【").concat(e.id,"】置顶失败").concat(i.message),!1),console.log("置顶失败"),a.abrupt("return","fails");case 42:case"end":return a.stop()}}),a)})))()},stopdTesk:function(){Object(u["A"])(),this.stoptoping=!0,this.$refs.Logs.writeLog("正在停止创建任务")},handleSelectionChange:function(e){this.selectTable=e},delTeskFun:function(e){var t=this;e||this.selectTable.length?this.$confirm("确定删除这些任务吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e){a.next=6;break}return a.next=3,t.delTesk(e);case 3:t.getTopTestTable(),a.next=14;break;case 6:r=0;case 7:if(!(r<t.selectTable.length)){a.next=13;break}return a.next=10,t.delTesk(t.selectTable[r]);case 10:r++,a.next=7;break;case 13:t.getTopTestTable();case 14:case"end":return a.stop()}}),a)})))):this.$message.warning("请选择要操作的数据！")},delTesk:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,window.BaseUtilBridgeService.deleteTopGoodsTask(e.mall_id.toString());case 2:return r=a.sent,a.next=5,window.BaseUtilBridgeService.deleteTopGoods(e.mall_id.toString());case 5:return n=a.sent,a.next=8,window.BaseUtilBridgeService.deleteTopGoodsHistory(e.mall_id.toString());case 8:o=a.sent,console.log(r,n,o),"200"===r.code&&"200"===n.code&&"200"===o.code?t.$refs.Logs.writeLog("".concat(e.mall_name,"删除成功"),!0):t.$refs.Logs.writeLog("删除失败:".concat(r.msg||n.msg||o.msg),!1);case 11:case"end":return a.stop()}}),a)})))()},isLogin:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.MallAPIInstance.isLogin(e);case 2:if(r=a.sent,200!==r.code||!r.data){a.next=7;break}return a.abrupt("return",!0);case 7:return t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】店铺未登录"),!1),a.abrupt("return",!1);case 9:case"end":return a.stop()}}),a)})))()},handleSizeChange:function(e){this.pageSize=e,this.getTopTestTable()},handleCurrentChange:function(e){this.page=e,this.getTopTestTable()},changeMallList:function(e){this.selectMalllist=e},createTeskFun:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.selectMalllist.length){t.next=3;break}return e.$message.warning("请选择要执行的任务的店铺"),t.abrupt("return");case 3:if("2"!==e.set_time||e.cloumn_date){t.next=9;break}if(!(e.cloumn_date<(new Date).getTime())){t.next=7;break}return e.$message.warning("置顶时间不能晚于当前时间"),t.abrupt("return");case 7:return e.$message.warning("请设置任务执行时间"),t.abrupt("return");case 9:if("1"!==e.otherConditon||e.couponGoodslist.length){t.next=12;break}return e.$message.warning("请选择自定义商品"),t.abrupt("return");case 12:if("2"!==e.otherConditon||e.loopGoodsNum){t.next=15;break}return e.$message.warning("请设置任务执行的商品个数"),t.abrupt("return");case 15:return e.showlog=!1,e.$refs.Logs.writeLog("正在创建任务",!0),t.next=19,Object(u["d"])(e.selectMalllist,e.createTesk);case 19:e.$refs.Logs.writeLog("任务创建结束",!0),e.getTopTestTable();case 21:case"end":return t.stop()}}),t)})))()},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),o=t.getHours(),s=t.getMinutes(),i=t.getSeconds();return a+"-"+this.add0(r)+"-"+this.add0(n)+" "+this.add0(o)+":"+this.add0(s)+":"+this.add0(i)},aaa:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.topGoodsInstance.init();case 1:case"end":return t.stop()}}),t)})))()},createTesk:function(e){var t=arguments,a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,s,i,l,c,u,d,m,p,g,_,f,h,b,v,w,x;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r.prev=1,r.next=4,a.isLogin(e);case 4:if(s=r.sent,s){r.next=7;break}return r.abrupt("return");case 7:return r.next=9,window.BaseUtilBridgeService.getTopGoodsTask(e.platform_mall_id);case 9:if(i=r.sent,!i.length){r.next=14;break}return a.$refs.Logs.writeLog("任务更新",!0),r.next=14,a.delTesk({mall_id:e.platform_mall_id,mall_name:e.mall_alias_name||e.platform_mall_name});case 14:return l=(new Date).getTime(),c="1"===a.set_time?l:a.cloumn_date,u={country:e.country,mall_name:e.mall_alias_name||e.platform_mall_name,mall_id:e.platform_mall_id.toString(),top_task_type:i?2:1,top_total_count:"1"===a.otherConditon?a.couponGoodslist.length:a.loopGoodsNum,toped_count:0,sort_type:"1"===a.otherConditon?"0":a.saleType,next_top_time:a.formatTime(c+144e5),topping_goods_ids:"",message:"",created_at:a.formatTime(l),updated_at:a.formatTime(c)},r.next=19,window.BaseUtilBridgeService.saveTopGoodsTask(u);case 19:if(d=r.sent,console.log("创建置顶任务",d),"200"===d.code){r.next=27;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】任务创建失败"),!1),a.$set(e,""),r.abrupt("return");case 27:return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】任务创建成功"),!0),r.next=30,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mall_alias_name||e.platform_mall_name,mall_id:e.platform_mall_id,log_time:a.formatTime((new Date).getTime()),log_message:"任务创建成功"});case 30:if(m=[],"1"!==a.otherConditon){r.next=63;break}p=Object(o["a"])(a.couponGoodslist),r.prev=33,p.s();case 35:if((g=p.n()).done){r.next=53;break}if(_=g.value,!a.stoptoping){r.next=39;break}return r.abrupt("return");case 39:return f={},f["mall_id"]=e.platform_mall_id.toString(),f["goods_id"]=_.toString(),f["is_top"]="0",r.next=45,window.BaseUtilBridgeService.saveTopGoods(f);case 45:if(h=r.sent,"200"===h.code){r.next=50;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(_.id,"上报置顶商品表失败:").concat(h.message),!1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】任务创建失败"),!1),r.abrupt("return");case 50:m.push({id:_});case 51:r.next=35;break;case 53:r.next=58;break;case 55:r.prev=55,r.t0=r["catch"](33),p.e(r.t0);case 58:return r.prev=58,p.f(),r.finish(58);case 61:r.next=68;break;case 63:return r.next=65,a.getMallTopGoods(e,a.loopGoodsNum);case 65:if(m=r.sent,m){r.next=68;break}return r.abrupt("return");case 68:return console.log("置顶商品表",m),r.next=71,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mall_alias_name||e.platform_mall_name,mall_id:e.platform_mall_id,log_time:a.formatTime((new Date).getTime()),log_message:"获取置顶商品表:【".concat(m.length,"】个")});case 71:if("1"!==a.set_time){r.next=103;break}b=0;case 73:if(!(b<m.length)){r.next=101;break}if(!a.stoptoping){r.next=76;break}return r.abrupt("return");case 76:return v={},v.country=e.country,v.sys_mall_id=e.platform_mall_id,v.mallName=e.mall_alias_name||e.platform_mall_name,v.id=m[b].id,r.next=83,a.topAction(v);case 83:if(w=r.sent,"full"!==w&&"top_data_fail"!==w){r.next=88;break}return r.abrupt("break",101);case 88:if("toped"!==w){r.next=90;break}return r.abrupt("continue",98);case 90:return console.log("置顶商品更新",e.platform_mall_id.toString(),m[b].id.toString()),r.next=93,window.BaseUtilBridgeService.saveTopGoods({mall_id:e.platform_mall_id,goods_id:m[b].id.toString(),is_top:"1"});case 93:if(x=r.sent,"200"===x.code){r.next=98;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】更新置顶商品表失败:").concat(x.message),!1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】任务创建失败"),!1),r.abrupt("return");case 98:b++,r.next=73;break;case 101:r.next=105;break;case 103:return r.next=105,window.BaseUtilBridgeService.saveTopGoodsHistory({country:e.country,mall_name:e.mall_alias_name||e.platform_mall_name,mall_id:e.platform_mall_id,log_time:a.formatTime((new Date).getTime()),log_message:"未到执行时间"});case 105:r.next=110;break;case 107:r.prev=107,r.t1=r["catch"](1),a.$refs.Logs.writeLog("【".concat(r.t1,"】"),!1);case 110:return r.prev=110,--n.count,r.finish(110);case 113:case"end":return r.stop()}}),r,null,[[1,107,110,113],[33,55,58,61]])})))()}}},_=g,f=(a("a249"),a("2877")),h=Object(f["a"])(_,r,n,!1,null,"4a704fe8",null);t["default"]=h.exports},a249:function(e,t,a){"use strict";a("f66b")},f66b:function(e,t,a){}}]);