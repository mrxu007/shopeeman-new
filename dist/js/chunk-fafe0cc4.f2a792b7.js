(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fafe0cc4"],{"4c28":function(e,t,a){},"5a71":function(e,t,a){},"62c5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail"},[a("div",{staticClass:"condetion",staticStyle:{"background-color":"white",padding:"8px"}},[a("div",{staticClass:"row1"},[a("storeChoose",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}}),a("div",[a("label",[e._v("关注礼类型：")]),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.saleType,callback:function(t){e.saleType=t},expression:"saleType"}},[a("el-option",{attrs:{label:"全部",value:"0"}}),a("el-option",{attrs:{label:"即将进行",value:"1"}}),a("el-option",{attrs:{label:"进行中",value:"2"}}),a("el-option",{attrs:{label:"已结束",value:"3"}})],1)],1),a("el-button",{staticStyle:{"margin-left":"8px"},attrs:{size:"mini",type:"primary"},on:{click:e.getTableList}},[e._v("查询")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.stopSearch}},[e._v("取消查询")])],1),a("div",{staticClass:"row2",staticStyle:{"margin-top":"8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.mallCoupon}},[e._v("创建关注礼")]),a("el-button",{attrs:{size:"mini"},on:{click:e.stopCreate}},[e._v("停止创建关注礼活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallvoucherStopMul}},[e._v("批量停止关注礼活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallvoucherDelMul}},[e._v("批量删除关注礼活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"8px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")])],1)]),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),a("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableList,height:"800px","use-virtual":"",border:!1,"header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[a("u-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),a("u-table-column",{attrs:{type:"index",fixed:"",label:"序号","min-width":"50px"}}),a("u-table-column",{attrs:{prop:"",label:"站点",align:"center","min-width":"50px",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e._f("chineseSite")(a.country)))]}}])}),a("u-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"follow_prize_name",label:"关注礼",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"quota",label:"可领取总数",align:"center","min-width":"180px"}}),a("u-table-column",{attrs:{prop:"claimed",label:"新粉丝/领取数",align:"center","min-width":"100px"}}),a("u-table-column",{attrs:{prop:"discountInfo",label:"折扣金额（折）",align:"center","min-width":"180px"}}),a("u-table-column",{attrs:{prop:"topNum",label:"最高上限数额",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"min_spend",label:"最低消费金额",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"",label:"期间",align:"center","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[e._v(e._s(i.formStartime)+"-")]),a("div",[e._v(e._s(i.formEndtime))])]}}])}),a("u-table-column",{attrs:{prop:"voucher_status",label:"状态",align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["进行中"===i.voucher_status?a("span",{staticStyle:{color:"#0ad10a"}},[e._v(e._s(i.voucher_status))]):e._e(),"即将开始"===i.voucher_status?a("span",{staticStyle:{color:"orange"}},[e._v(e._s(i.voucher_status))]):e._e(),"已过期"===i.voucher_status?a("span",[e._v(e._s(i.voucher_status))]):e._e()]}}])}),a("u-table-column",{attrs:{prop:"",label:"操作",align:"center","min-width":"100px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",["即将开始"===i.voucher_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.MallvoucherDelFun(i),e.singerStop=!0}}},[e._v("删除")]):e._e()],1),a("span",["进行中"===i.voucher_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.MallvoucherStop(i),e.singerStop=!0}}},[e._v("停止")]):e._e()],1)]}}])})],1)],1),a("el-dialog",{staticClass:"edit-group-dialog",attrs:{visible:e.CouponVisible,width:"620px",top:"5vh",title:"创建关注礼活动","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.CouponVisible=t}}},[a("el-form",{attrs:{"label-position":"right","label-width":"160px"}},[a("el-form-item",{attrs:{label:"当前站点"}},[e._v(" "+e._s(e._f("chineseSite")(this.country))+" ")]),a("el-form-item",{staticStyle:{color:"red"},attrs:{label:"币种"}},[e._v(" "+e._s(e._f("siteCoin")(this.country))+"(优惠劵活动使用的是当地币种) ")]),a("el-form-item",{attrs:{label:"关注礼名称"}},[a("el-input",{staticStyle:{width:"260px","margin-right":"5px"},attrs:{size:"mini"},model:{value:e.couponName,callback:function(t){e.couponName=t},expression:"couponName"}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"关注礼名称不能超过20个字符",placement:"right-start"}},[a("i",{staticClass:"el-icon-question"})])],1),a("el-form-item",{attrs:{label:"关注礼类型"}},[a("span",[e._v("优惠券")]),e._v(" "),a("span",{staticStyle:{color:"red"}},[e._v("优惠券代码将自动生成")])]),a("el-form-item",{attrs:{label:"奖励类型"}},[a("el-radio-group",{on:{change:function(t){e.discountNum=""}},model:{value:e.rewardType,callback:function(t){e.rewardType=t},expression:"rewardType"}},[a("el-radio",{attrs:{label:"0"}},[e._v("折扣")]),a("el-radio",{attrs:{label:"1"}},[e._v("Shoppe币折扣 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"买家使用Shoppee币回扣优惠劵并获得Shoppee币作为回报。Shoppee币成本将由您吸收",placement:"right-start"}},[a("i",{staticClass:"el-icon-question"})])],1)],1)],1),a("el-form-item",{staticClass:"discountitem",attrs:{label:"折扣类型/金额"}},["0"===e.rewardType?a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"mini"},on:{change:function(t){e.discountNum=""}},model:{value:e.discountType,callback:function(t){e.discountType=t},expression:"discountType"}},[a("el-option",{attrs:{label:"折扣",value:"0"}}),a("el-option",{attrs:{label:"折扣金额",value:"1"}})],1):e._e(),"1"===e.rewardType?a("span",[e._v("折扣 ：")]):e._e(),a("div",{staticStyle:{display:"flex","flex-flow":"column"}},[a("div",["0"===e.rewardType&&"0"===e.discountType||"1"===e.rewardType?a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",maxlength:"2",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.discountNum,callback:function(t){e.discountNum=t},expression:"discountNum"}}):e._e(),"0"===e.rewardType&&"1"===e.discountType?a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.discountNum,callback:function(t){e.discountNum=t},expression:"discountNum"}}):e._e(),"0"===e.rewardType&&"0"===e.discountType?a("span",[e._v("%折扣")]):e._e(),"1"===e.rewardType?a("span",[e._v("%Shopee币折扣")]):e._e()],1),"0"===e.rewardType&&"0"===e.discountType?a("span",{staticStyle:{"margin-left":"-100px",color:"red","line-height":"10px","margin-bottom":"10px"}},[e._v(" 付款金额中的"+e._s(e.discountNum)+"%将退还给买家。 ")]):e._e(),"1"===e.rewardType?a("span",{staticStyle:{"margin-left":"-40px",color:"red","line-height":"10px","margin-bottom":"10px"}},[e._v(" 付款金额中的"+e._s(e.discountNum)+"%将以Shopee币退还给买家。 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.contentDes,placement:"right-start"}},[a("i",{staticClass:"el-icon-question"})])],1):e._e()])],1),"0"===e.rewardType&&"0"===e.discountType||"1"===e.rewardType?a("el-form-item",{attrs:{label:"最高折扣金额"}},[a("el-radio-group",{model:{value:e.limitPrice,callback:function(t){e.limitPrice=t},expression:"limitPrice"}},[a("el-radio",{attrs:{label:"0"}},[e._v("无限制")]),a("el-radio",{attrs:{label:"1"}},[e._v("设置金额："),a("el-input",{staticStyle:{width:"80px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.maxPrice,callback:function(t){e.maxPrice=t},expression:"maxPrice"}})],1)],1)],1):e._e(),a("el-form-item",{attrs:{label:"最低消费金额"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.minPrice,callback:function(t){e.minPrice=t},expression:"minPrice"}})],1),a("el-form-item",{attrs:{label:"关注礼时限"}},[a("el-date-picker",{staticStyle:{width:"330px"},attrs:{size:"mini","value-format":"timestamp",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}}),a("div",{staticStyle:{color:"red","line-height":"20px"}},[e._v("* 结束时间必须大于开始时间，且活动时间必须大于一天！")]),a("div",{staticStyle:{color:"red","line-height":"20px"}},[e._v("* 所选时间段内不可存在其他后续奖券")])],1),a("el-form-item",{attrs:{label:"折扣劵可使用数量(必填)"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.useQuantity,callback:function(t){e.useQuantity=t},expression:"useQuantity"}})],1),a("el-form-item",{attrs:{label:"使用期限"}},[a("div",[e._v("从收到折扣券+7天")])]),a("el-form-item",{attrs:{label:"说明"}},[a("div",[e._v("通过提供吸引人的折扣优惠券以让用户关注您的商店")])]),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.mallCouponFun}},[e._v("创建关注礼活动")])],1)],1)],1)],1)},n=[],l=a("2909"),r=a("1da1"),s=(a("96cf"),a("a9e3"),a("99af"),a("159b"),a("feb6")),o=a("a254"),c=a("0e0b"),u={components:{storeChoose:s["a"]},data:function(){return{siteLimitCost:{MY:1,TW:1,VN:1e3,ID:100,PH:5,TH:1,SG:1,BR:1,MX:1,CO:1,CL:1,PL:1,FR:1,ES:1},tableLoading:!1,singerStop:!1,MarketManagerAPIInstance:new o["a"](this),showlog:!0,saleType:"0",tableList:[],CouponVisible:!1,dialogtitle:"",coupontype:"2",couponName:"",rewardType:"0",discountType:"1",discountNum:"",limitPrice:"0",maxPrice:null,minPrice:"",dateTime:[],pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},useQuantity:"",couponhide:"0",couponGoodslist:[],selectMallList:[],stoptoping:!1,mallTableSelect:[],getTable:[],country:"TH"}},computed:{contentDes:function(){var e=this.$filters.siteCoin(this.country);return"Shopee币交换规则，".concat(e,"100=100 Shopee币")}},created:function(){},methods:{clearLog:function(){this.$refs.Logs.consoleMsg=""},handleSelectionChange:function(e){this.mallTableSelect=e},MallvoucherStopMul:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.mallTableSelect.length){t.next=3;break}return e.$message.warning("请选择要操作的数据"),t.abrupt("return");case 3:a=0;case 4:if(!(a<e.mallTableSelect.length)){t.next=11;break}if(2!==Number(e.mallTableSelect[a].promotion_type)){t.next=8;break}return t.next=8,e.MallvoucherStop(e.mallTableSelect[a]);case 8:a++,t.next=4;break;case 11:e.getTableList();case 12:case"end":return t.stop()}}),t)})))()},MallvoucherStop:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={country:e.country,mallId:e.platform_mall_id,campaign_id:Number(e.campaign_id),action:"stop"},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.MallPrizeDel(i);case 5:n=a.sent,0===n.ecode?t.$refs.Logs.writeLog("------已停止【".concat(e.follow_prize_name,"】优惠活动------"),!0):t.$refs.Logs.writeLog("停止【".concat(e.follow_prize_name,"】优惠活动,").concat(n.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("停止【".concat(e.follow_prize_name,"】--catch,").concat(a.t0),!1);case 12:t.singerStop&&t.getTableList(),t.singerStop=!1;case 14:case"end":return a.stop()}}),a,null,[[1,9]])})))()},MallvoucherDelMul:function(){var e=this;this.mallTableSelect.length?this.$confirm("确定要删除这些优惠券吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.MallvoucherDelMulFun()})).catch((function(){})):this.$message.warning("请选择要操作的数据")},MallvoucherDelMulFun:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.mallTableSelect.length)){t.next=8;break}if(1!==Number(e.mallTableSelect[a].promotion_type)){t.next=5;break}return t.next=5,e.MallvoucherDel(e.mallTableSelect[a]);case 5:a++,t.next=1;break;case 8:e.getTableList();case 9:case"end":return t.stop()}}),t)})))()},MallvoucherDelFun:function(e){var t=this;this.$confirm("确定该优惠券吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MallvoucherDel(e)})).catch((function(){}))},MallvoucherDel:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={country:e.country,mallId:e.platform_mall_id,campaign_id:Number(e.campaign_id),action:"delete"},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.MallPrizeDel(i);case 5:n=a.sent,0===n.ecode?t.$refs.Logs.writeLog("------成功删除【".concat(e.follow_prize_name,"】优惠活动------"),!0):(l="","no edit permission for the voucher"===n.message&&(l="您没有编辑权限"),t.$refs.Logs.writeLog("删除【".concat(e.follow_prize_name,"】优惠活动,").concat(n.message,":").concat(l),!1)),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("删除【".concat(e.follow_prize_name,"】--catch,").concat(a.t0),!1);case 12:t.singerStop&&t.getTableList(),t.singerStop=!1;case 14:case"end":return a.stop()}}),a,null,[[1,9]])})))()},stopSearch:function(){Object(c["B"])(),this.stoptoping=!0,this.$refs.Logs.writeLog("正在停止查询")},stopCreate:function(){Object(c["B"])(),this.$refs.Logs.writeLog("已停止创建")},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),l=t.getHours(),r=t.getMinutes(),s=t.getSeconds();return a+"-"+this.add0(i)+"-"+this.add0(n)+" "+this.add0(l)+":"+this.add0(r)+":"+this.add0(s)},changeMallList:function(e){this.country=e.country,this.selectMallList=e},getInfo:function(e){var t=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,s,o,u,p,m,d,h,f,g,_,b,v,w,y,x;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},i.prev=1,r={country:a.country,mallId:e.platform_mall_id,offset:e.offset,limit:20},i.next=5,a.MarketManagerAPIInstance.FollowPrize(r);case 5:if(s=i.sent,0!==s.data.code){i.next=35;break}if(u=s.data.data.follow_prize_list,u.forEach((function(t){t.platform_mall_id=e.platform_mall_id,t.country=e.country,t.mallName=e.mall_alias_name||e.platform_mall_name,t.formStartime=a.formatTime(1e3*t.start_time),t.formEndtime=a.formatTime(1e3*t.end_time)})),(o=e.prizeList).push.apply(o,Object(l["a"])(u)),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】总数据：").concat(s.data.data.total_count,"条,正在请求第【").concat(r.offset/r.limit+1,"】页"),!0),!((null===u||void 0===u?void 0:u.length)>=r.limit)){i.next=16;break}e.offset=e.offset+r.limit,a.getInfo(e,{count:1}),i.next=33;break;case 16:for(p=[],m=[],d=[],h=[],f=[],g=0;g<e.prizeList.length;g++)_=e.prizeList[g],_.discountInfo="",_.topNum="",_.min_spend="",b=(new Date).getTime(),b<1e3*_.start_time?(_.voucher_status="即将开始",_.promotion_type=1,p.push(_)):b>1e3*_.start_time&&b<1e3*_.end_time?(_.voucher_status="进行中",_.promotion_type=2,p.push(_)):(_.voucher_status="已过期",_.promotion_type=3),"1"===a.saleType&&b<1e3*_.start_time&&d.push(_),"2"===a.saleType&&b>1e3*_.start_time&&b<1e3*_.end_time&&h.push(_),"3"===a.saleType&&b>1e3*_.end_time&&f.push(_),m.push(_);if("1"===a.saleType&&(v=a.getTable).push.apply(v,d),"2"===a.saleType&&(w=a.getTable).push.apply(w,h),"3"===a.saleType&&(y=a.getTable).push.apply(y,f),"0"===a.saleType&&(x=a.getTable).push.apply(x,m),p.length){i.next=28;break}return i.abrupt("return");case 28:return a.$refs.Logs.writeLog("正在查看店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】优惠卡券详情"),!0),i.next=31,Object(c["d"])(p,a.getPrizeDetail);case 31:i.sent,a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】查找完毕"),!0);case 33:i.next=36;break;case 35:"token not found"===s.message?a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(s.data.message,":【店铺未登录】"),!1):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(s.data.message||"店铺异常"),!1);case 36:i.next=41;break;case 38:i.prev=38,i.t0=i["catch"](1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】--catch，").concat(i.t0),!1);case 41:return i.prev=41,n.count--,i.finish(41);case 44:case"end":return i.stop()}}),i,null,[[1,38,41,44]])})))()},getPrizeDetail:function(e){var t=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,l,r,s,o,c,u;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},i.prev=1,l={country:e.country,mallId:e.platform_mall_id,campaign_id:e.campaign_id},i.next=5,a.MarketManagerAPIInstance.FollowPrizeDetail(l);case 5:r=i.sent,0===r.data.code?(s=r.data.data,o=null,c=null,u=s.min_spend,0===Number(s.reward_type)&&(s.discount.value?(o=s.discount.value,c=""):(o="".concat((100-Number(s.discount.percentage))/10,"折"),c="0.00"===s.discount.cap?"无限制":s.discount.cap)),1===Number(s.reward_type)&&(o="".concat(s.coin_cash_back.percentage,"%折扣,(Shopee币回扣)"),c="0.00"===s.coin_cash_back.cap?"无限制":s.coin_cash_back.cap+"(Shopee币)"),a.$set(e,"discountInfo",o),a.$set(e,"topNum",c),a.$set(e,"min_spend",u)):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】,").concat(r.message),!1),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](1),a.$refs.Logs.writeLog("Detailcatch，".concat(i.t0),!1);case 12:return i.prev=12,n.count--,i.finish(12);case 15:case"end":return i.stop()}}),i,null,[[1,9,12,15]])})))()},getTableList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.multipleTable.clearSelection(),e.selectMallList.forEach((function(e){e.offset=0,e.prizeList=[]})),e.getTable=[],e.showlog=!1,e.tableLoading=!0,e.$refs.Logs.writeLog("正在请求数据......",!0),t.next=8,Object(c["d"])(e.selectMallList,e.getInfo);case 8:t.sent,e.$refs.Logs.writeLog("请求数据结束"),e.tableLoading=!1,e.tableList=e.getTable;case 12:case"end":return t.stop()}}),t)})))()},mallCoupon:function(){this.showlog=!0,this.selectMallList.length?this.CouponVisible=!0:this.$message.warning("请选择店铺")},mallCouponFun:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.couponName){t.next=3;break}return e.$message.warning("优惠券名称不能为空"),t.abrupt("return");case 3:if(e.discountNum){t.next=6;break}return e.$message.warning("请输入有效折扣信息"),t.abrupt("return");case 6:if(!(e.couponName.length>20)){t.next=9;break}return e.$message.warning("关注礼名称不能超过20个字符"),t.abrupt("return");case 9:if(!("0"===e.rewardType&&"1"===e.discountType&&Number(e.discountNum)>Number(e.minPrice))){t.next=12;break}return e.$message.warning("折扣金额不能大于最低消费金额"),t.abrupt("return");case 12:if(!(Number(e.minPrice)<e.siteLimitCost[e.country.toLocaleUpperCase()])){t.next=15;break}return e.$message.warning("当前站点最低消费金额为".concat(e.siteLimitCost[e.country.toLocaleUpperCase()])),t.abrupt("return");case 15:if(e.dateTime.length){t.next=18;break}return e.$message.warning("请输入有效活动时间"),t.abrupt("return");case 18:if(!(e.dateTime[1]-e.dateTime[0]<=864e5)){t.next=21;break}return e.$message.warning("活动期间不能少于一天"),t.abrupt("return");case 21:if(e.useQuantity){t.next=24;break}return e.$message.warning("请输入有效优惠券"),t.abrupt("return");case 24:return e.CouponVisible=!1,e.showlog=!1,e.$refs.Logs.writeLog("正在创建任务......"),t.next=29,Object(c["d"])(e.selectMallList,e.createCoupon);case 29:t.sent,e.$refs.Logs.writeLog("创建任务结束"),e.getTableList();case 32:case"end":return t.stop()}}),t)})))()},createCoupon:function(e){var t=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,l,r,s,o,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},i.prev=1,l=null,r=null,"0"===a.rewardType?l="0"===a.discountType?{percentage:Number(a.discountNum),cap:"0"===a.limitPrice?null:a.maxPrice}:{value:Number(a.discountNum)}:r={percentage:Number(a.discountNum),cap:"0"===a.limitPrice?0:Number(a.maxPrice)},s={country:e.country,mallId:e.platform_mall_id,discount:l,end_time:a.dateTime[1]/1e3,follow_prize_name:a.couponName,min_spend:a.minPrice,quota:a.useQuantity,reward_type:a.rewardType,start_time:a.dateTime[0]/1e3},"1"===a.rewardType&&(s.coin_cash_back=r),i.next=9,a.MarketManagerAPIInstance.followPrizeCreate(s);case 9:o=i.sent,0!==o.ecode?(c="","param err"===o.message&&(c="输入参数有误"),"quota error:"===o.message&&(c="所选时间有误"),"campaign overlap"===o.message&&(c="活动重叠;此时间段内已存在其他后续奖券，请选择其他时间段。"),"token not found"===o.message&&(c="店铺未登录"),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(o.message,":").concat(c),!1)):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建成功"),!0),i.next=16;break;case 13:i.prev=13,i.t0=i["catch"](1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(i.t0,"};"),!1);case 16:return i.prev=16,n.count--,i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[1,13,16,19]])})))()}}},p=u,m=(a("9f85"),a("2877")),d=Object(m["a"])(p,i,n,!1,null,"394c8606",null);t["default"]=d.exports},8992:function(e,t,a){"use strict";a("4c28")},9534:function(e,t,a){},"9f85":function(e,t,a){"use strict";a("9534")},f4e2:function(e,t,a){"use strict";a("5a71")},feb6:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ul",{staticClass:"storeChooseUL"},[e.isMall?a("li",[e._v(e._s(e._f("chineseSite")(e.countryVal)))]):a("li",{style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("所属站点：")]),a("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:"",disabled:e.isBanPerform},model:{value:e.countryVal,callback:function(t){e.countryVal=t},expression:"countryVal"}},[e.isAll?a("el-option",{attrs:{label:"全部",value:""}}):e._e(),e._l(e.countries,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),a("li",{style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("店铺分组：")]),a("el-select",{staticClass:"selectBox",style:{width:e.inputWidth},attrs:{disabled:e.isBanPerform,multiple:"","collapse-tags":"",filterable:"",size:"mini"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},[a("el-option",{attrs:{label:"全部",value:""},nativeOn:{click:function(t){return e.changeGroupSelect(e.groupId,!0)}}}),e._l(e.groupIdList,(function(t,i){return a("el-option",{key:i,attrs:{label:t.group_name,value:t.id},nativeOn:{click:function(t){return e.changeGroupSelect(e.groupId)}}})}))],2)],1),a("li",{directives:[{name:"show",rawName:"v-show",value:e.showGrade<2,expression:"showGrade < 2"}],style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("店铺名称：")]),a("el-popover",{attrs:{placement:"top",width:"180",trigger:"click"}},[e.tableShow?a("u-table",{ref:"zz_mall_select_all",staticClass:"zz_mall_select_all",attrs:{"tooltip-effect":"dark","show-header":!1,"row-height":34,border:!1,"big-data-checkbox":"","use-virtual":"","show-body-overflow":"","data-changes-scroll-top":!1,data:e.siteShowList,"max-height":"250","cell-style":{padding:"0px!important"}}},[a("u-table-column",{attrs:{align:"left","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"zz_mall_select_item",class:e.siteId.includes(t.row.platform_mall_id)&&"zz_mall_select_active",on:{click:function(a){return e.changeSiteSelect(t.row.platform_mall_id,!t.row.platform_mall_id)}}},[e._v(" "+e._s(t.row.mall_alias_name||t.row.platform_mall_name)+" ")])]}}],null,!1,749083916)})],1):e._e(),a("div",{staticClass:"zz_mall_select_input",style:{width:e.inputWidth},attrs:{slot:"reference"},on:{click:e.goTableShowTop},slot:"reference"},[e.site.length?a("el-tag",{attrs:{type:"info",size:"mini"}},[e._v(" "+e._s(e.site[0].mall_alias_name||e.site[0].platform_mall_name)+" ")]):e._e(),e.site.length>1?a("el-tag",{attrs:{type:"info",size:"mini"}},[e._v("+"+e._s(e.site.length-1))]):e._e(),a("el-input",{attrs:{size:"mini",clearable:""},on:{input:e.searchInput},model:{value:e.searchSite,callback:function(t){e.searchSite=t},expression:"searchSite"}})],1)],1)],1),e.isReset?a("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[a("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary",disabled:e.isBanPerform},on:{click:e.reset}},[e._v(" 　刷　　新　 ")])],1):e._e()])])},n=[],l=a("1da1"),r=a("2909"),s=(a("96cf"),a("a9e3"),a("caad"),a("2532"),a("99af"),a("d81d"),a("fb6a"),a("4de4"),a("d3b7"),a("6062"),a("3ca3"),a("ddb0"),a("c740"),a("a434"),a("25f0"),a("7db0"),a("7646")),o={name:"StoreChoose",props:{spanWidth:{type:String,default:"80px"},inputWidth:{type:String,default:"180px"},parentCountry:{type:String,default:"TH"},isMall:{type:Boolean,default:function(){return!1}},isBanPerform:{type:Boolean,default:function(){return!1}},isAll:{type:Boolean,default:function(){return!1}},isReset:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}},isAShop:{type:Boolean,default:function(){return!1}},showGrade:{type:Number,default:function(){return 0}}},data:function(){return{countryVal:null,groupId:[],groupIdList:[],allSiteList:[],site:[],siteId:[],siteList:[],siteShowList:[],tableShow:!0,searchSite:"",countries:this.$filters.countries_option,mallListAPIInstance:new s["a"](this),showMallNumber:100,mallShowIndex:0}},watch:{siteList:function(e){this.siteShowList=e},countryVal:{handler:function(e){this.groupId=[],this.groupIdList=[],this.getMallGoodsGetMallList(1)},deep:!0}},mounted:function(){this.countryVal=!this.isAll&&this.parentCountry||""},methods:{reset:function(){this.groupId=[],this.groupIdList=[],this.getMallGoodsGetMallList(1)},changeGroupSelect:function(e,t){t?e.includes("")?this.groupId=[""].concat(Object(r["a"])(this.groupIdList.map((function(e){return e.id})))):this.groupId=[]:e.includes("")||e.length!==this.groupIdList.length?e.includes("")&&e.length===this.groupIdList.length&&(this.groupId=e.slice(1)):this.groupId.unshift(""),this.getMallGoodsGetMallList(2)},getMallGoodsGetMallList:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,n,l,s,o,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.searchSite="",1!==e){a.next=10;break}return i=t.countryVal,a.next=5,t.mallListAPIInstance.ddMallGoodsGetMallList();case 5:n=a.sent,200===n.code?(l=n.data||[],t.isAShop||l.unshift({platform_mall_name:"全部",platform_mall_id:""}),t.allSiteList=""===i?l:l.filter((function(e){return(null===e||void 0===e?void 0:e.country)===i||!e.platform_mall_id})),t.siteList=t.allSiteList):t.$message.error("获取分组、店铺列表失败"),0===t.groupIdList.length&&(s=new Set(t.siteList.map((function(e){if(e.group_id)return JSON.stringify({group_name:e.group_name,id:e.group_id})}))),s.delete(void 0),o=Object(r["a"])(s),c=o.map((function(e){return JSON.parse(e)})),c.zzSort("id"),t.groupIdList=Object(r["a"])(c),t.groupId=[""].concat(Object(r["a"])(c.map((function(e){return e.id}))))),a.next=13;break;case 10:u=[],u=""===t.groupId[0]?t.allSiteList:t.allSiteList.filter((function(e){if(t.groupId.includes(e.group_id)||!e.platform_mall_id)return e})),t.siteList=u;case 13:t.siteId=[],t.changeSiteSelect("",!0);case 15:case"end":return a.stop()}}),a)})))()},changeSiteSelect:function(e,t){var a=this.searchSite,i=this.siteId;if(this.isAShop)this.siteId=[e];else{if(t)if(a){var n=this.siteShowList.map((function(e){return e.platform_mall_id}));if(i.includes(e))i=i.filter((function(e){return!n.includes(e)}));else{var l=new Set([""].concat(Object(r["a"])(i),Object(r["a"])(n)));i=Object(r["a"])(l)}}else i=i.includes(e)?[]:this.siteList.map((function(e){return e.platform_mall_id}));else{var s=i.findIndex((function(t){return t===e}));if(s>-1)i.splice(s,1),i.includes("")&&i.splice(0,1);else if(i.push(e),a){var o,c=this.siteShowList.filter((function(e){return i.includes(e.platform_mall_id)}));i.includes("")||(null===(o=this.siteShowList)||void 0===o?void 0:o.length)!==c.length+1||i.unshift("")}else{var u;i.includes("")||(null===(u=this.siteList)||void 0===u?void 0:u.length)!==i.length+1||i.unshift("")}}this.siteId=i}this.changeMallList()},changeMallList:function(){var e=[],t="",a=this.siteId;if(this.isAShop){a=a[0];var i=this.siteList.find((function(e){return e.platform_mall_id===a}));t=a,e.push(i)}else this.site=this.siteList.filter((function(e){return a.includes(e.platform_mall_id)})),a.length&&""===a[0]?(a=a.slice(1),e=this.site.slice(1)):e=this.site,t=this.groupId.includes("")&&a.length===this.siteList.length-1?"":a.toString();this.source?this.$emit("changeMallList",{mallList:e,groupIdList:this.groupId,source:this.source,searchAll:t,country:this.countryVal.toLocaleUpperCase()}):(e["country"]=this.countryVal,this.$emit("changeMallList",e))},searchInput:function(){var e=this;this.searchSetTime&&clearTimeout(this.searchSetTime),this.searchSetTime=null,this.searchSetTime=setTimeout((function(){var t=e.siteList.filter((function(t){var a=!0;if(e.searchSite&&t.platform_mall_id){var i=t.mall_alias_name||t.platform_mall_name;a=i.includes(e.searchSite)}return a}));e.siteShowList=t,e.tableShow=!1,e.$nextTick((function(){e.tableShow=!0}))}),500)},goTableShowTop:function(){var e=this;this.tableShow=!1,this.$nextTick((function(){e.tableShow=!0}))}}},c=o,u=(a("8992"),a("f4e2"),a("2877")),p=Object(u["a"])(c,i,n,!1,null,"7cb8233b",null);t["a"]=p.exports}}]);