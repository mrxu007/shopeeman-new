(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71c3cc3e"],{9811:function(e,t,a){},add3:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail"},[a("div",{staticClass:"condetion",staticStyle:{"background-color":"white",padding:"8px"}},[a("div",{staticClass:"row1"},[a("storeChoose",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}}),a("div",{staticStyle:{"margin-left":"20px"}},[a("label",[e._v("活动：")]),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.activeType,callback:function(t){e.activeType=t},expression:"activeType"}},[a("el-option",{attrs:{label:"全部",value:"0"}}),a("el-option",{attrs:{label:"进行中",value:"1"}}),a("el-option",{attrs:{label:"接下来有活动",value:"2"}}),a("el-option",{attrs:{label:"活动已过期",value:"3"}})],1)],1),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary"},on:{click:e.getTableList}},[e._v("搜索")])],1),a("div",{staticClass:"row2",staticStyle:{"margin-top":"8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTest}},[e._v("创建运费促销活动")]),a("el-button",{attrs:{size:"mini"},on:{click:e.stopCreate}},[e._v("停止活动创建")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallstopTestMul}},[e._v("批量结束勾选活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"8px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")]),a("el-checkbox",{model:{value:e.isShowPast,callback:function(t){e.isShowPast=t},expression:"isShowPast"}},[e._v("不显示过期活动")])],1)]),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),a("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableList,height:"800px","use-virtual":"",border:!1,"header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[a("u-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),a("u-table-column",{attrs:{type:"index",fixed:"",label:"序号","min-width":"50px"}}),a("u-table-column",{attrs:{prop:"",label:"站点",align:"center","min-width":"50px",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e._f("chineseSite")(a.country)))]}}])}),a("u-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"100px"}}),a("u-table-column",{attrs:{prop:"promotion_name",label:"促销名称",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"voucher_status",label:"活动状态",align:"center","min-width":"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["进行中"===n.voucher_status?a("span",{staticStyle:{color:"#0ad10a"}},[e._v(e._s(n.voucher_status))]):e._e(),"即将开始"===n.voucher_status?a("span",{staticStyle:{color:"orange"}},[e._v(e._s(n.voucher_status))]):e._e(),"已过期"===n.voucher_status?a("span",[e._v(e._s(n.voucher_status))]):e._e()]}}])}),a("u-table-column",{attrs:{prop:"",label:"促销期间",align:"center","min-width":"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("div",[3220050630===n.end_time?a("div",[e._v(" 无限制 ")]):a("div",{staticStyle:{display:"flex","flex-flow":"column"}},[a("span",[e._v(e._s(n.formStartime)+"-")]),a("span",[e._v(e._s(n.formEndtime))])])])]}}])}),a("u-table-column",{attrs:{prop:"deliverWay",label:"运送渠道",align:"center","min-width":"180px"}}),a("u-table-column",{attrs:{prop:"topNum",label:"运费",align:"center","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return e._l(n.tiers,(function(t,r){return a("div",{key:r,staticStyle:{display:"flex"}},[a("span",[e._v("购买满"+e._s(e._f("siteCoin")(n.country))+e._s(t.min_order_total)+",")]),0===Number(t.discount_delta)?a("span",[e._v("免运费")]):a("span",[e._v("运费减免"+e._s(e._f("siteCoin")(n.country))+e._s(t.discount_delta))])])}))}}])}),a("u-table-column",{attrs:{prop:"min_spend",label:"操作",align:"center","min-width":"80px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return["进行中"===n.voucher_status?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MallstopTest(n)}}},[e._v("停止")]):e._e(),"即将开始"===n.voucher_status?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MalldelTest(n)}}},[e._v("删除 ")]):e._e()]}}])})],1)],1),a("el-dialog",{staticClass:"edit-group-dialog",attrs:{visible:e.proVisible,width:"860px",top:"5vh",title:"运费促销","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.proVisible=t}}},[a("el-form",{attrs:{"label-position":"right","label-width":"160px"}},[a("el-form-item",{attrs:{label:"促销名称"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"字符长度需小于20",size:"mini"},model:{value:e.proName,callback:function(t){e.proName=t},expression:"proName"}})],1),a("el-form-item",{staticStyle:{color:"red"},attrs:{label:"促销时间"}},[a("el-radio-group",{model:{value:e.proTimeType,callback:function(t){e.proTimeType=t},expression:"proTimeType"}},[a("el-radio",{attrs:{label:"0"}},[e._v("无限制")]),a("el-radio",{attrs:{label:"1"}},[e._v("所选的促销期间 "),a("el-date-picker",{staticStyle:{width:"330px"},attrs:{size:"mini","value-format":"timestamp",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{focus:function(t){e.proTimeType="1"}},model:{value:e.proTime,callback:function(t){e.proTime=t},expression:"proTime"}})],1)],1)],1),a("el-form-item",{attrs:{label:"运输渠道"}},[a("el-checkbox-group",{model:{value:e.deliverWay,callback:function(t){e.deliverWay=t},expression:"deliverWay"}},e._l(e.deliverWayList,(function(t){return a("el-checkbox",{key:t.channelid,attrs:{disabled:e.isDeliverWay,label:t.channelid}},[e._v(e._s(t.name))])})),1),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){e.getdeliverWay(),e.showlog=!1}}},[e._v("刷新物流渠道")])],1),a("el-form-item",{attrs:{label:"运费",align:"center"}},[a("el-table",{attrs:{data:e.freightlist,"header-cell-style":{background:"#f7fafa"},"row-style":{height:"60px"}}},[a("el-table-column",{attrs:{type:"index",label:"阶层","max-width":"60px"}}),a("el-table-column",{attrs:{prop:"minCost",label:"最低消费金额",width:"190px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+" | "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content1,placement:"top-start"}},[a("span",[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d]/g,0)"},on:{focus:function(a){return e.checkMinCost(t.row,t.$index)},blur:function(a){return e.clearCost(t.row)}},model:{value:t.row.minCost,callback:function(a){e.$set(t.row,"minCost",a)},expression:"scope.row.minCost"}}),a("br")],1)]),a("span",{staticStyle:{color:"red","margin-top":"-4px"}},[e._v(" "+e._s(t.row.minCostLimit)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"freight",label:"运费",width:"340px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{staticClass:"freightType",on:{change:function(a){return e.changeFreightType(t.row)}},model:{value:t.row.freightType,callback:function(a){e.$set(t.row,"freightType",a)},expression:"scope.row.freightType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("免运费")]),a("el-radio",{attrs:{label:"0"}},[e._v(" 补贴"+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+"| "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content2,placement:"top-start"}},[a("span",[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},on:{focus:function(a){return e.checkFreightCost(t.row,t.$index)},blur:function(a){return e.clearFreight(t.row)}},model:{value:t.row.freight,callback:function(a){e.$set(t.row,"freight",a)},expression:"scope.row.freight"}}),a("br")],1)]),"0"===t.row.freightType?a("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(t.row.freightLimit)+" ")]):e._e()],1)],1)]}}])}),a("el-table-column",{attrs:{prop:"",label:"操作",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e.freightlist.length>1?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delrule(n)}}},[e._v("删除")]):e._e()]}}])})],1),e.freightlist.length>1?a("span",{staticStyle:{color:"red","margin-left":"-330px"}},[e._v(" 较高的最低消费将享有较高的运费折扣。免运费只能使用一层 ")]):e._e()],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.freightlist.length>=3},on:{click:e.addRule}},[e._v("新增促销规则")])],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTestFun}},[e._v("保存")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.proVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)},r=[],i=a("1da1"),o=(a("96cf"),a("99af"),a("159b"),a("c740"),a("a434"),a("a9e3"),a("b0c0"),a("c4e3"),a("feb6")),s=a("a254"),l=a("0e0b"),c=(a("660a"),{components:{storeChoose:o["a"]},data:function(){return{runload:!1,freightArrange:{MY:{MaxMinAmmount:1e4,MinAmmount:0,MaxFreeAmmount:1e4,FreeAmmount:.5},VN:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999e3,MaxMinAmmount:2e7},PH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999,MaxMinAmmount:5e3},ID:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:5e5,MaxMinAmmount:5e6},TW:{MinAmmount:0,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:999999999},TH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:1500,MaxMinAmmount:3e4},BR:{MinAmmount:999999999,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:0},SG:{MinAmmount:0,FreeAmmount:.5,MaxFreeAmmount:999999,MaxMinAmmount:5e3}},arrList:[],willList:[],doingList:[],pastList:[],isDeliverWay:!1,deliverWayList:[],freightlist:[{minCost:"",freightType:"0",freight:"",minCostLimit:"",freightLimit:""}],deliverWay:[],proTimeType:"0",proTime:[],proName:"",isShowPast:!0,tableLoading:!1,singerStop:!1,MarketManagerAPIInstance:new s["a"](this),showlog:!0,activeType:"0",tableList:[],proVisible:!1,dialogtitle:"",coupontype:"2",couponName:"",rewardType:"0",discountType:"1",discountNum:"",limitPrice:"0",maxPrice:"",minPrice:"",pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},useQuantity:"",couponhide:"0",couponGoodslist:[],selectMallList:[],stoptoping:!1,mallTableSelect:[],getTable:[],minCostLimit:"",freightLimit:""}},computed:{content1:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MinAmmount;return"当前站点最低消费金额取值范围".concat(t,"-").concat(e)},content2:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount;return"当前站点运费折扣取值范围".concat(t,"-").concat(e)}},created:function(){},methods:{getProDelivery:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={country:e.country,mallId:e.platform_mall_id},a.prev=1,t.$refs.Logs.writeLog("正在获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流信息")),a.next=5,t.MarketManagerAPIInstance.ProDelivery(n);case 5:if(r=a.sent,0!==r.ecode){a.next=15;break}if(t.$refs.Logs.writeLog("获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流成功"),!0),i=r.data.data.enabled||[],i.length){a.next=12;break}return t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无物流选项"),!1),a.abrupt("return");case 12:t.deliverWayList.length?i.forEach((function(e){var a=t.deliverWayList.findIndex((function(t){return e.channelid===t.channelid}));a<0&&t.deliverWayList.push(e)})):t.deliverWayList=i,a.next=18;break;case 15:o="","token not found"===r.message&&(o="店铺未登录"),t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】物流：").concat(o||r.message),!1);case 18:a.next=23;break;case 20:a.prev=20,a.t0=a["catch"](1),t.$message.warning("".concat(a.t0));case 23:case"end":return a.stop()}}),a,null,[[1,20]])})))()},delrule:function(e){var t=this.couponGoodslist.findIndex((function(t){return t===e}));this.freightlist.splice(t,1)},save:function(){},addRule:function(){var e={minCost:"",freightType:"0",freight:""};this.freightlist.push(e)},clearLog:function(){this.$refs.Logs.consoleMsg=""},handleSelectionChange:function(e){this.mallTableSelect=e},MallstopTestMul:function(){var e=this;this.mallTableSelect.length?this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.mallTableSelect.length)){t.next=7;break}return t.next=4,e.MallstopTestFun(e.mallTableSelect[a]);case 4:a++,t.next=1;break;case 7:e.getTableList();case 8:case"end":return t.stop()}}),t)})))).catch((function(){})):this.$message.warning("请选择要操作的数据")},MallstopTest:function(e){var t=this;this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MallstopTestFun(e)})).catch((function(){}))},MallstopTestFun:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={country:e.country,mallId:e.platform_mall_id,datainfo:e},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.stopPromotion(n);case 5:r=a.sent,0===r.ecode?(t.$refs.Logs.writeLog("------已停止【".concat(e.promotion_name,"】优惠活动------"),!0),t.$set(e,"voucher_status","已过期"),t.$set(e,"formEndtime",t.formatTime((new Date).getTime())),t.$set(e,"end_time",(new Date).getTime()/1e3)):t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】优惠活动,").concat(r.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},MalldelTest:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$confirm("您确定要删除此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MalldelTestFun(e)})).catch((function(){}));case 1:case"end":return a.stop()}}),a)})))()},MalldelTestFun:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n={country:e.country,mallId:e.platform_mall_id,datainfo:e},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.stopPromotion(n);case 5:r=a.sent,0===r.ecode?(t.$refs.Logs.writeLog("------已删除【".concat(e.promotion_name,"】优惠活动------"),!0),i=t.tableList.findIndex((function(t){return t===e})),t.tableList.splice(i,1)):t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】优惠活动,").concat(r.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},stopCreate:function(){Object(l["z"])(),this.$refs.Logs.writeLog("已停止创建")},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),i=t.getHours(),o=t.getMinutes(),s=t.getSeconds();return a+"-"+this.add0(n)+"-"+this.add0(r)+" "+this.add0(i)+":"+this.add0(o)+":"+this.add0(s)},changeMallList:function(e){this.selectMallList=e},getInfo:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,i,o,s,l,c,u,m,p;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{count:1},n.prev=1,i={country:e.country,mallId:e.platform_mall_id,offset:e.offset,limit:10},n.next=5,a.MarketManagerAPIInstance.logisticsPromotion(i);case 5:if(o=n.sent,0===o.ecode){n.next=12;break}return s="","token not found"===o.message&&(s="店铺未登录"),"marketing module no permission"===o.message&&(s="营销无权限模块"),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】数据请求失败,").concat(s||o.message),!1),n.abrupt("return");case 12:if(l=0===o.ecode?o.data.data.promotions:[],c=0===o.ecode?o.data.data.channels_info:[],l.length){n.next=17;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无数据")),n.abrupt("return");case 17:if(!l.length){n.next=33;break}for(u=function(t){var n=l[t];n.platform_mall_id=e.platform_mall_id,n.country=e.country,n.mallName=e.mall_alias_name||e.platform_mall_name,n.formStartime=a.formatTime(1e3*n.start_time),n.formEndtime=a.formatTime(1e3*n.end_time);var r=(new Date).getTime();r<1e3*n.start_time?(n.voucher_status="即将开始",a.willList.push(n)):r>1e3*n.start_time&&r<1e3*n.end_time?(n.voucher_status="进行中",a.doingList.push(n)):(n.voucher_status="已过期",a.pastList.push(n));var i=c.findIndex((function(e){return Number(n.channel_ids[0])===Number(e.channel_id)}));n.deliverWay=c[i].name,n.channalData=c[i],a.arrList.push(n)},m=0;m<l.length;m++)u(m);if(a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】总数据：").concat(o.data.data.total_num,"条,正在请求第【").concat(i.offset/i.limit+1,"】页"),!0),!(l.length<i.limit)){n.next=25;break}l.length=[],n.next=31;break;case 25:return i.offset=i.offset+i.limit,n.next=28,a.MarketManagerAPIInstance.logisticsPromotion(i);case 28:p=n.sent,l=0===p.data.code?p.data.data.promotions:[],c=0===p.data.code?p.data.data.channels_info:[];case 31:n.next=17;break;case 33:a.isShowPast?"0"===a.activeType?a.getTable=a.willList.concat(a.doingList):"1"===a.activeType?a.getTable=a.doingList:"2"===a.activeType?a.getTable=a.willList:a.getTable=[]:("1"===a.activeType&&(a.getTable=a.doingList),"2"===a.activeType&&(a.getTable=a.willList),"3"===a.activeType&&(a.getTable=a.pastList),"0"===a.activeType&&(a.getTable=a.arrList)),n.next=39;break;case 36:n.prev=36,n.t0=n["catch"](1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】--catch，").concat(n.t0),!1);case 39:return n.prev=39,r.count--,n.finish(39);case 42:case"end":return n.stop()}}),n,null,[[1,36,39,42]])})))()},getTableList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.multipleTable.clearSelection(),e.selectMallList.forEach((function(e){e.offset=0,e.prizeList=[]})),e.getTable=[],e.arrList=[],e.willList=[],e.doingList=[],e.pastList=[],e.showlog=!1,e.tableLoading=!0,e.$refs.Logs.writeLog("正在请求数据......",!0),t.next=12,Object(l["c"])(e.selectMallList,e.getInfo);case 12:t.sent,e.$refs.Logs.writeLog("请求数据结束"),e.tableLoading=!1,e.tableList=e.getTable;case 16:case"end":return t.stop()}}),t)})))()},checkMinCost:function(e,t){if(this.freightlist.length>1)for(var a=0;a<this.freightlist.length;a++)if(t!==a){var n=this.freightlist[a];"1"===n.freightType&&this.$set(e,"minCostLimit","少过".concat(n.minCost))}},clearCost:function(e){this.$set(e,"minCostLimit","")},clearFreight:function(e){this.$set(e,"freightLimit","")},changeFreightType:function(e){this.$set(e,"freight","")},checkFreightCost:function(e,t){var a=[];if(this.freightlist.length>1)for(var n=0;n<this.freightlist.length;n++)if(t!==n){var r=this.freightlist[n];"1"===r.freightType?this.$set(e,"freightLimit","多于".concat(a[0]||"0")):(a.push(Number(r.freight)),Number(r.minCost)>Number(e.minCost)?this.$set(e,"freightLimit","少过".concat(Math.min.apply(Math,a))):this.$set(e,"freightLimit","多过".concat(Math.max.apply(Math,a))))}},addProTest:function(){this.showlog=!0,this.selectMallList.length?(this.proVisible=!0,this.deliverWayList=[],this.getdeliverWay()):this.$message.warning("请选择需要创建的店铺")},getdeliverWay:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.selectMallList.length)){t.next=7;break}return t.next=4,e.getProDelivery(e.selectMallList[a]);case 4:a++,t.next=1;break;case 7:e.$refs.Logs.writeLog("物流请求结束");case 8:case"end":return t.stop()}}),t)})))()},addProTestFun:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,o,s,c,u,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.proName&&!(e.proName.length>20)){t.next=3;break}return e.$message.warning("促销名称不能为空，且不能大于20个字符"),t.abrupt("return");case 3:if(e.proTime.length&&e.proTimeType,"1"!==e.proTimeType){t.next=15;break}if(e.proTime.length){t.next=8;break}return e.$message.warning("请选择活动有效时间"),t.abrupt("return");case 8:if(a=(new Date).getTime(),!(a>Number(e.proTime[0]))){t.next=12;break}return e.$message.warning("请输入比当前较晚的开始时间"),t.abrupt("return");case 12:if(!Number(e.proTime[1]-Number(e.proTime[0])<36e5)){t.next=15;break}return e.$message.warning("结束时间至少比开始时间晚一个小时"),t.abrupt("return");case 15:if(e.deliverWay.length){t.next=18;break}return e.$message.warning("运输渠道不能为空"),t.abrupt("return");case 18:n=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,r=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MinAmmount,i=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,o=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount,s=0;case 23:if(!(s<e.freightlist.length)){t.next=54;break}if(c=e.freightlist[s],c.minCost&&("0"!==c.freightType||c.freight)){t.next=28;break}return e.$message.warning("请设置运费规则"),t.abrupt("return");case 28:if(!(Number(c.minCost)>n||Number(c.minCost)<r)){t.next=31;break}return e.$message.warning("当前站点最低消费金额取值范围".concat(r,"-").concat(n)),t.abrupt("return");case 31:if("1"===c.freightType||!(Number(c.freight)>i||Number(c.freight)<o)){t.next=34;break}return e.$message.warning("当前站点运费折扣取值范围".concat(o,"-").concat(i)),t.abrupt("return");case 34:u=0;case 35:if(!(u<e.freightlist.length)){t.next=51;break}if(s!==u){t.next=38;break}return t.abrupt("continue",48);case 38:if(m=e.freightlist[u],"1"!==c.freightType||"1"!==m.freightType){t.next=42;break}return e.$message.warning("免运费只能使用在一层，且在最低消费金额最大层"),t.abrupt("return");case 42:if(!("1"===c.freightType&&Number(c.minCost)<Number(m.minCost))){t.next=45;break}return e.$message.warning("免运费只能使用在最低消费金额最大层"),t.abrupt("return");case 45:if(!("1"!==c.freightType&&"1"!==m.freightType&&Number(c.minCost)<Number(m.minCost)&&Number(c.freight)>Number(m.freight))){t.next=48;break}return e.$message.warning("更高的最低消费金额应有更高的运费折扣金额"),t.abrupt("return");case 48:u++,t.next=35;break;case 51:s++,t.next=23;break;case 54:return e.proVisible=!1,e.showlog=!1,e.$refs.Logs.writeLog("正在创建任务......"),t.next=59,Object(l["c"])(e.selectMallList,e.createPromiton);case 59:t.sent,e.$refs.Logs.writeLog("创建任务结束"),e.getTableList();case 62:case"end":return t.stop()}}),t)})))()},createPromiton:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,i,o,s,l,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{count:1},i="",o="","0"===a.proTimeType?(i=Math.floor((new Date).getTime()/1e3),o=3220050630):(i=Math.floor(Number(a.proTime[0])/1e3),o=Math.floor(Number(a.proTime[1])/1e3)),s=[],a.freightlist.forEach((function(e,t){var a={discount_flag:"0"===e.freightType?4:2,placeholder:e.freightLimit,index:t,min_order_total:Number(e.minCost),discount_delta:"0"===e.freightType?Number(e.freight):0};s.push(a)})),n.prev=6,l={country:e.country,mallId:e.platform_mall_id,start_time:i,end_time:o,tiers:s,channel_ids:a.deliverWay,promotion_name:a.proName},n.next=10,a.MarketManagerAPIInstance.checkPromotionTest(l);case 10:c=n.sent,0!==c.ecode?(u="",1400109500===c.data.code&&(u="所选期间与该店铺的其他活动期间重叠"),1400101105===c.data.code&&(u="运输渠道未知,或者时间勾选错误"),"token not found"===c.message&&(u="店铺未登录"),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(u||c.message),!1)):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建成功"),!0),n.next=17;break;case 14:n.prev=14,n.t0=n["catch"](6),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(n.t0,"};"),!1);case 17:return n.prev=17,r.count--,n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[6,14,17,20]])})))()}}}),u=c,m=(a("f49c"),a("2877")),p=Object(m["a"])(u,n,r,!1,null,"5a903044",null);t["default"]=p.exports},f49c:function(e,t,a){"use strict";a("9811")}}]);