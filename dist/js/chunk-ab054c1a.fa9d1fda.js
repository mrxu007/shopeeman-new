(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ab054c1a"],{"3e57":function(e,t,i){"use strict";i("c52f")},"4c28":function(e,t,i){},8992:function(e,t,i){"use strict";i("4c28")},add3:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"detail"},[i("div",{staticClass:"condetion",staticStyle:{"background-color":"white",padding:"8px"}},[i("div",{staticClass:"row1"},[i("storeChoose",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}}),i("div",{staticStyle:{"margin-left":"20px"}},[i("label",[e._v("活动：")]),i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.activeType,callback:function(t){e.activeType=t},expression:"activeType"}},[i("el-option",{attrs:{label:"全部",value:"0"}}),i("el-option",{attrs:{label:"进行中",value:"1"}}),i("el-option",{attrs:{label:"接下来有活动",value:"2"}}),i("el-option",{attrs:{label:"活动已过期",value:"3"}})],1)],1),i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary"},on:{click:e.getTableList}},[e._v("搜索")])],1),i("div",{staticClass:"row2",staticStyle:{"margin-top":"8px"}},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTest}},[e._v("创建运费促销活动")]),i("el-button",{attrs:{size:"mini"},on:{click:e.stopCreate}},[e._v("停止活动创建")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallstopTestMul}},[e._v("批量结束勾选活动")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),i("el-checkbox",{staticStyle:{"margin-left":"8px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")]),i("el-checkbox",{model:{value:e.isShowPast,callback:function(t){e.isShowPast=t},expression:"isShowPast"}},[e._v("不显示过期活动")])],1)]),i("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),i("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[i("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableList,height:"800px","use-virtual":"",border:!1,"header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[i("u-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),i("u-table-column",{attrs:{type:"index",fixed:"",label:"序号","min-width":"50px"}}),i("u-table-column",{attrs:{prop:"",label:"站点",align:"center","min-width":"50px",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(e._s(e._f("chineseSite")(i.country)))]}}])}),i("u-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"100px"}}),i("u-table-column",{attrs:{prop:"promotion_name",label:"促销名称",align:"center","min-width":"150px"}}),i("u-table-column",{attrs:{prop:"voucher_status",label:"活动状态",align:"center","min-width":"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["进行中"===a.voucher_status?i("span",{staticStyle:{color:"#0ad10a"}},[e._v(e._s(a.voucher_status))]):e._e(),"即将开始"===a.voucher_status?i("span",{staticStyle:{color:"orange"}},[e._v(e._s(a.voucher_status))]):e._e(),"已过期"===a.voucher_status?i("span",[e._v(e._s(a.voucher_status))]):e._e()]}}])}),i("u-table-column",{attrs:{prop:"",label:"促销期间",align:"center","min-width":"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("div",[3220050630===a.end_time?i("div",[e._v(" 无限制 ")]):i("div",{staticStyle:{display:"flex","flex-flow":"column"}},[i("span",[e._v(e._s(a.formStartime)+"-")]),i("span",[e._v(e._s(a.formEndtime))])])])]}}])}),i("u-table-column",{attrs:{prop:"deliverWay",label:"运送渠道",align:"center","min-width":"180px"}}),i("u-table-column",{attrs:{prop:"topNum",label:"运费",align:"center","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return e._l(a.tiers,(function(t,n){return i("div",{key:n,staticStyle:{display:"flex"}},[i("span",[e._v("购买满"+e._s(e._f("siteCoin")(a.country))+e._s(t.min_order_total)+",")]),0===Number(t.discount_delta)?i("span",[e._v("免运费")]):i("span",[e._v("运费减免"+e._s(e._f("siteCoin")(a.country))+e._s(t.discount_delta))])])}))}}])}),i("u-table-column",{attrs:{prop:"min_spend",label:"操作",align:"center","min-width":"80px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["进行中"===a.voucher_status?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MallstopTest(a)}}},[e._v("停止")]):e._e(),"即将开始"===a.voucher_status?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MalldelTest(a)}}},[e._v("删除 ")]):e._e()]}}])})],1)],1),i("el-dialog",{staticClass:"edit-group-dialog",attrs:{visible:e.proVisible,width:"860px",top:"5vh",title:"运费促销","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.proVisible=t}}},[i("el-form",{attrs:{"label-position":"right","label-width":"160px"}},[i("el-form-item",{attrs:{label:"促销名称"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"字符长度需小于20",size:"mini"},model:{value:e.proName,callback:function(t){e.proName=t},expression:"proName"}})],1),i("el-form-item",{staticStyle:{color:"red"},attrs:{label:"促销时间"}},[i("el-radio-group",{model:{value:e.proTimeType,callback:function(t){e.proTimeType=t},expression:"proTimeType"}},[i("el-radio",{attrs:{label:"0"}},[e._v("无限制")]),i("el-radio",{attrs:{label:"1"}},[e._v("所选的促销期间 "),i("el-date-picker",{staticStyle:{width:"330px"},attrs:{size:"mini","value-format":"timestamp",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{focus:function(t){e.proTimeType="1"}},model:{value:e.proTime,callback:function(t){e.proTime=t},expression:"proTime"}})],1)],1)],1),i("el-form-item",{attrs:{label:"运输渠道"}},[i("el-checkbox-group",{model:{value:e.deliverWay,callback:function(t){e.deliverWay=t},expression:"deliverWay"}},e._l(e.deliverWayList,(function(t){return i("el-checkbox",{key:t.channelid,attrs:{disabled:e.isDeliverWay,label:t.channelid}},[e._v(e._s(t.name))])})),1),i("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){e.getdeliverWay(),e.showlog=!1}}},[e._v("刷新物流渠道")])],1),i("el-form-item",{attrs:{label:"运费",align:"center"}},[i("el-table",{attrs:{data:e.freightlist,"header-cell-style":{background:"#f7fafa"},"row-style":{height:"60px"}}},[i("el-table-column",{attrs:{type:"index",label:"阶层","max-width":"60px"}}),i("el-table-column",{attrs:{prop:"minCost",label:"最低消费金额",width:"190px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+" | "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content1,placement:"top-start"}},[i("span",[i("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},on:{focus:function(i){return e.checkMinCost(t.row,t.$index)},blur:function(i){return e.clearCost(t.row)}},model:{value:t.row.minCost,callback:function(i){e.$set(t.row,"minCost",i)},expression:"scope.row.minCost"}}),i("br")],1)]),i("span",{staticStyle:{color:"red","margin-top":"-4px"}},[e._v(" "+e._s(t.row.minCostLimit)+" ")])]}}])}),i("el-table-column",{attrs:{prop:"freight",label:"运费",width:"340px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-radio-group",{staticClass:"freightType",on:{change:function(i){return e.changeFreightType(t.row)}},model:{value:t.row.freightType,callback:function(i){e.$set(t.row,"freightType",i)},expression:"scope.row.freightType"}},[i("el-radio",{attrs:{label:"1"}},[e._v("免运费")]),i("el-radio",{attrs:{label:"0"}},[e._v(" 补贴"+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+"| "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content2,placement:"top-start"}},[i("span",[i("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},on:{focus:function(i){return e.checkFreightCost(t.row,t.$index)},blur:function(i){return e.clearFreight(t.row)}},model:{value:t.row.freight,callback:function(i){e.$set(t.row,"freight",i)},expression:"scope.row.freight"}}),i("br")],1)]),"0"===t.row.freightType?i("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(t.row.freightLimit)+" ")]):e._e()],1)],1)]}}])}),i("el-table-column",{attrs:{prop:"",label:"操作",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e.freightlist.length>1?i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delrule(a)}}},[e._v("删除")]):e._e()]}}])})],1),e.freightlist.length>1?i("span",{staticStyle:{color:"red","margin-left":"-330px"}},[e._v(" 较高的最低消费将享有较高的运费折扣。免运费只能使用一层 ")]):e._e()],1),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary",disabled:e.freightlist.length>=3},on:{click:e.addRule}},[e._v("新增促销规则")])],1),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTestFun}},[e._v("保存")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.proVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)},n=[],r=i("1da1"),s=(i("96cf"),i("99af"),i("159b"),i("c740"),i("a434"),i("a9e3"),i("b0c0"),i("c4e3"),i("feb6")),l=i("a254"),o=i("0e0b"),c=(i("660a"),{components:{storeChoose:s["a"]},data:function(){return{runload:!1,freightArrange:{MY:{MaxMinAmmount:1e4,MinAmmount:0,MaxFreeAmmount:1e4,FreeAmmount:.5},VN:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999e3,MaxMinAmmount:2e7},PH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999,MaxMinAmmount:5e3},ID:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:5e5,MaxMinAmmount:5e6},TW:{MinAmmount:0,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:999999999},TH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:1500,MaxMinAmmount:3e4},BR:{MinAmmount:999999999,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:0},SG:{MinAmmount:0,FreeAmmount:.5,MaxFreeAmmount:999999,MaxMinAmmount:5e3}},arrList:[],willList:[],doingList:[],pastList:[],isDeliverWay:!1,deliverWayList:[],freightlist:[{minCost:"",freightType:"0",freight:"",minCostLimit:"",freightLimit:""}],deliverWay:[],proTimeType:"0",proTime:[],proName:"",isShowPast:!0,tableLoading:!1,singerStop:!1,MarketManagerAPIInstance:new l["a"](this),showlog:!0,activeType:"0",tableList:[],proVisible:!1,dialogtitle:"",coupontype:"2",couponName:"",rewardType:"0",discountType:"1",discountNum:"",limitPrice:"0",maxPrice:"",minPrice:"",pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},useQuantity:"",couponhide:"0",couponGoodslist:[],selectMallList:[],stoptoping:!1,mallTableSelect:[],getTable:[],minCostLimit:"",freightLimit:""}},computed:{content1:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MinAmmount;return"当前站点最低消费金额取值范围".concat(t,"-").concat(e)},content2:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount;return"当前站点运费折扣取值范围".concat(t,"-").concat(e)}},created:function(){},methods:{getProDelivery:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,n,r,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a={country:e.country,mallId:e.platform_mall_id},i.prev=1,t.$refs.Logs.writeLog("正在获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流信息")),i.next=5,t.MarketManagerAPIInstance.ProDelivery(a);case 5:if(n=i.sent,0!==n.ecode){i.next=15;break}if(t.$refs.Logs.writeLog("获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流成功"),!0),r=n.data.data.enabled||[],r.length){i.next=12;break}return t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无物流选项"),!1),i.abrupt("return");case 12:t.deliverWayList.length?r.forEach((function(e){var i=t.deliverWayList.findIndex((function(t){return e.channelid===t.channelid}));i<0&&t.deliverWayList.push(e)})):t.deliverWayList=r,i.next=18;break;case 15:s="","token not found"===n.message&&(s="店铺未登录"),t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】物流：").concat(s||n.message),!1);case 18:i.next=23;break;case 20:i.prev=20,i.t0=i["catch"](1),t.$message.warning("".concat(i.t0));case 23:case"end":return i.stop()}}),i,null,[[1,20]])})))()},delrule:function(e){var t=this.couponGoodslist.findIndex((function(t){return t===e}));this.freightlist.splice(t,1)},save:function(){},addRule:function(){var e={minCost:"",freightType:"0",freight:""};this.freightlist.push(e)},clearLog:function(){this.$refs.Logs.consoleMsg=""},handleSelectionChange:function(e){this.mallTableSelect=e},MallstopTestMul:function(){var e=this;this.mallTableSelect.length?this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=0;case 1:if(!(i<e.mallTableSelect.length)){t.next=7;break}return t.next=4,e.MallstopTestFun(e.mallTableSelect[i]);case 4:i++,t.next=1;break;case 7:e.getTableList();case 8:case"end":return t.stop()}}),t)})))).catch((function(){})):this.$message.warning("请选择要操作的数据")},MallstopTest:function(e){var t=this;this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MallstopTestFun(e)})).catch((function(){}))},MallstopTestFun:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a={country:e.country,mallId:e.platform_mall_id,datainfo:e},i.prev=1,t.showlog=!1,i.next=5,t.MarketManagerAPIInstance.stopPromotion(a);case 5:n=i.sent,0===n.ecode?(t.$refs.Logs.writeLog("------已停止【".concat(e.promotion_name,"】优惠活动------"),!0),t.$set(e,"voucher_status","已过期"),t.$set(e,"formEndtime",t.formatTime((new Date).getTime())),t.$set(e,"end_time",(new Date).getTime()/1e3)):t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】优惠活动,").concat(n.message),!1),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](1),t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】--catch,").concat(i.t0),!1);case 12:case"end":return i.stop()}}),i,null,[[1,9]])})))()},MalldelTest:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.$confirm("您确定要删除此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MalldelTestFun(e)})).catch((function(){}));case 1:case"end":return i.stop()}}),i)})))()},MalldelTestFun:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,n,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a={country:e.country,mallId:e.platform_mall_id,datainfo:e},i.prev=1,t.showlog=!1,i.next=5,t.MarketManagerAPIInstance.stopPromotion(a);case 5:n=i.sent,0===n.ecode?(t.$refs.Logs.writeLog("------已删除【".concat(e.promotion_name,"】优惠活动------"),!0),r=t.tableList.findIndex((function(t){return t===e})),t.tableList.splice(r,1)):t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】优惠活动,").concat(n.message),!1),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](1),t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】--catch,").concat(i.t0),!1);case 12:case"end":return i.stop()}}),i,null,[[1,9]])})))()},stopCreate:function(){Object(o["z"])(),this.$refs.Logs.writeLog("已停止创建")},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),i=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),r=t.getHours(),s=t.getMinutes(),l=t.getSeconds();return i+"-"+this.add0(a)+"-"+this.add0(n)+" "+this.add0(r)+":"+this.add0(s)+":"+this.add0(l)},changeMallList:function(e){this.selectMallList=e},getInfo:function(e){var t=arguments,i=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n,r,s,l,o,c,u,m,h;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},a.prev=1,r={country:e.country,mallId:e.platform_mall_id,offset:e.offset,limit:10},a.next=5,i.MarketManagerAPIInstance.logisticsPromotion(r);case 5:if(s=a.sent,0===s.ecode){a.next=12;break}return l="","token not found"===s.message&&(l="店铺未登录"),"marketing module no permission"===s.message&&(l="营销无权限模块"),i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】数据请求失败,").concat(l||s.message),!1),a.abrupt("return");case 12:if(o=0===s.ecode?s.data.data.promotions:[],c=0===s.ecode?s.data.data.channels_info:[],o.length){a.next=17;break}return i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无数据")),a.abrupt("return");case 17:if(!o.length){a.next=33;break}for(u=function(t){var a=o[t];a.platform_mall_id=e.platform_mall_id,a.country=e.country,a.mallName=e.mall_alias_name||e.platform_mall_name,a.formStartime=i.formatTime(1e3*a.start_time),a.formEndtime=i.formatTime(1e3*a.end_time);var n=(new Date).getTime();n<1e3*a.start_time?(a.voucher_status="即将开始",i.willList.push(a)):n>1e3*a.start_time&&n<1e3*a.end_time?(a.voucher_status="进行中",i.doingList.push(a)):(a.voucher_status="已过期",i.pastList.push(a));var r=c.findIndex((function(e){return Number(a.channel_ids[0])===Number(e.channel_id)}));a.deliverWay=c[r].name,a.channalData=c[r],i.arrList.push(a)},m=0;m<o.length;m++)u(m);if(i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】总数据：").concat(s.data.data.total_num,"条,正在请求第【").concat(r.offset/r.limit+1,"】页"),!0),!(o.length<r.limit)){a.next=25;break}o.length=[],a.next=31;break;case 25:return r.offset=r.offset+r.limit,a.next=28,i.MarketManagerAPIInstance.logisticsPromotion(r);case 28:h=a.sent,o=0===h.data.code?h.data.data.promotions:[],c=0===h.data.code?h.data.data.channels_info:[];case 31:a.next=17;break;case 33:i.isShowPast?"0"===i.activeType?i.getTable=i.willList.concat(i.doingList):"1"===i.activeType?i.getTable=i.doingList:"2"===i.activeType?i.getTable=i.willList:i.getTable=[]:("1"===i.activeType&&(i.getTable=i.doingList),"2"===i.activeType&&(i.getTable=i.willList),"3"===i.activeType&&(i.getTable=i.pastList),"0"===i.activeType&&(i.getTable=i.arrList)),a.next=39;break;case 36:a.prev=36,a.t0=a["catch"](1),i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】--catch，").concat(a.t0),!1);case 39:return a.prev=39,n.count--,a.finish(39);case 42:case"end":return a.stop()}}),a,null,[[1,36,39,42]])})))()},getTableList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.multipleTable.clearSelection(),e.selectMallList.forEach((function(e){e.offset=0,e.prizeList=[]})),e.getTable=[],e.arrList=[],e.willList=[],e.doingList=[],e.pastList=[],e.showlog=!1,e.tableLoading=!0,e.$refs.Logs.writeLog("正在请求数据......",!0),t.next=12,Object(o["c"])(e.selectMallList,e.getInfo);case 12:t.sent,e.$refs.Logs.writeLog("请求数据结束"),e.tableLoading=!1,e.tableList=e.getTable;case 16:case"end":return t.stop()}}),t)})))()},checkMinCost:function(e,t){if(this.freightlist.length>1)for(var i=0;i<this.freightlist.length;i++)if(t!==i){var a=this.freightlist[i];"1"===a.freightType&&this.$set(e,"minCostLimit","少过".concat(a.minCost))}},clearCost:function(e){this.$set(e,"minCostLimit","")},clearFreight:function(e){this.$set(e,"freightLimit","")},changeFreightType:function(e){this.$set(e,"freight","")},checkFreightCost:function(e,t){var i=[];if(this.freightlist.length>1)for(var a=0;a<this.freightlist.length;a++)if(t!==a){var n=this.freightlist[a];"1"===n.freightType?this.$set(e,"freightLimit","多于".concat(i[0]||"0")):(i.push(Number(n.freight)),Number(n.minCost)>Number(e.minCost)?this.$set(e,"freightLimit","少过".concat(Math.min.apply(Math,i))):this.$set(e,"freightLimit","多过".concat(Math.max.apply(Math,i))))}},addProTest:function(){this.showlog=!0,this.selectMallList.length?(this.proVisible=!0,this.deliverWayList=[],this.getdeliverWay()):this.$message.warning("请选择需要创建的店铺")},getdeliverWay:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=0;case 1:if(!(i<e.selectMallList.length)){t.next=7;break}return t.next=4,e.getProDelivery(e.selectMallList[i]);case 4:i++,t.next=1;break;case 7:e.$refs.Logs.writeLog("物流请求结束");case 8:case"end":return t.stop()}}),t)})))()},addProTestFun:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i,a,n,r,s,l,c,u,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.proName&&!(e.proName.length>20)){t.next=3;break}return e.$message.warning("促销名称不能为空，且不能大于20个字符"),t.abrupt("return");case 3:if(e.proTime.length&&e.proTimeType,"1"!==e.proTimeType){t.next=15;break}if(e.proTime.length){t.next=8;break}return e.$message.warning("请选择活动有效时间"),t.abrupt("return");case 8:if(i=(new Date).getTime(),!(i>Number(e.proTime[0]))){t.next=12;break}return e.$message.warning("请输入比当前较晚的开始时间"),t.abrupt("return");case 12:if(!Number(e.proTime[1]-Number(e.proTime[0])<36e5)){t.next=15;break}return e.$message.warning("结束时间至少比开始时间晚一个小时"),t.abrupt("return");case 15:if(e.deliverWay.length){t.next=18;break}return e.$message.warning("运输渠道不能为空"),t.abrupt("return");case 18:a=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,n=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MinAmmount,r=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,s=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount,l=0;case 23:if(!(l<e.freightlist.length)){t.next=54;break}if(c=e.freightlist[l],c.minCost&&("0"!==c.freightType||c.freight)){t.next=28;break}return e.$message.warning("请设置运费规则"),t.abrupt("return");case 28:if(!(Number(c.minCost)>a||Number(c.minCost)<n)){t.next=31;break}return e.$message.warning("当前站点最低消费金额取值范围".concat(n,"-").concat(a)),t.abrupt("return");case 31:if("1"===c.freightType||!(Number(c.freight)>r||Number(c.freight)<s)){t.next=34;break}return e.$message.warning("当前站点运费折扣取值范围".concat(s,"-").concat(r)),t.abrupt("return");case 34:u=0;case 35:if(!(u<e.freightlist.length)){t.next=51;break}if(l!==u){t.next=38;break}return t.abrupt("continue",48);case 38:if(m=e.freightlist[u],"1"!==c.freightType||"1"!==m.freightType){t.next=42;break}return e.$message.warning("免运费只能使用在一层，且在最低消费金额最大层"),t.abrupt("return");case 42:if(!("1"===c.freightType&&Number(c.minCost)<Number(m.minCost))){t.next=45;break}return e.$message.warning("免运费只能使用在最低消费金额最大层"),t.abrupt("return");case 45:if(!("1"!==c.freightType&&"1"!==m.freightType&&Number(c.minCost)<Number(m.minCost)&&Number(c.freight)>Number(m.freight))){t.next=48;break}return e.$message.warning("更高的最低消费金额应有更高的运费折扣金额"),t.abrupt("return");case 48:u++,t.next=35;break;case 51:l++,t.next=23;break;case 54:return e.proVisible=!1,e.showlog=!1,e.$refs.Logs.writeLog("正在创建任务......"),t.next=59,Object(o["c"])(e.selectMallList,e.createPromiton);case 59:t.sent,e.$refs.Logs.writeLog("创建任务结束"),e.getTableList();case 62:case"end":return t.stop()}}),t)})))()},createPromiton:function(e){var t=arguments,i=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n,r,s,l,o,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r="",s="","0"===i.proTimeType?(r=Math.floor((new Date).getTime()/1e3),s=3220050630):(r=Math.floor(Number(i.proTime[0])/1e3),s=Math.floor(Number(i.proTime[1])/1e3)),l=[],i.freightlist.forEach((function(e,t){var i={discount_flag:"0"===e.freightType?4:2,placeholder:e.freightLimit,index:t,min_order_total:Number(e.minCost),discount_delta:"0"===e.freightType?Number(e.freight):0};l.push(i)})),a.prev=6,o={country:e.country,mallId:e.platform_mall_id,start_time:r,end_time:s,tiers:l,channel_ids:i.deliverWay,promotion_name:i.proName},a.next=10,i.MarketManagerAPIInstance.checkPromotionTest(o);case 10:c=a.sent,0!==c.ecode?(u="",1400109500===c.data.code&&(u="所选期间与该店铺的其他活动期间重叠"),1400101105===c.data.code&&(u="运输渠道未知,或者时间勾选错误"),"token not found"===c.message&&(u="店铺未登录"),i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(u||c.message),!1)):i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建成功"),!0),a.next=17;break;case 14:a.prev=14,a.t0=a["catch"](6),i.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(a.t0,"};"),!1);case 17:return a.prev=17,n.count--,a.finish(17);case 20:case"end":return a.stop()}}),a,null,[[6,14,17,20]])})))()}}}),u=c,m=(i("3e57"),i("2877")),h=Object(m["a"])(u,a,n,!1,null,"b4cd3acc",null);t["default"]=h.exports},c52f:function(e,t,i){},feb6:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("ul",{staticClass:"storeChooseUL"},[e.isMall?i("li",[e._v(e._s(e._f("chineseSite")(e.countryVal)))]):i("li",{style:e.isReset&&"margin-bottom: 5px"},[i("span",{style:{width:e.spanWidth}},[e._v("所属站点：")]),i("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:"",disabled:e.isBanPerform},model:{value:e.countryVal,callback:function(t){e.countryVal=t},expression:"countryVal"}},[e.isAll?i("el-option",{attrs:{label:"全部",value:""}}):e._e(),e._l(e.countries,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),i("li",{style:e.isReset&&"margin-bottom: 5px"},[i("span",{style:{width:e.spanWidth}},[e._v("店铺分组：")]),i("el-select",{staticClass:"selectBox",attrs:{disabled:e.isBanPerform,multiple:"","collapse-tags":"",filterable:"",size:"mini"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupIdList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.group_name,value:e.id}})})),1)],1),i("li",{style:e.isReset&&"margin-bottom: 5px"},[i("span",{style:{width:e.spanWidth}},[e._v("店铺名称：")]),i("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.loadmoreMall,expression:"loadmoreMall"}],staticClass:"selectBox",attrs:{disabled:e.isBanPerform,placeholder:"",multiple:!e.isAShop,"collapse-tags":"","filter-method":e.filterMall,size:"mini",filterable:"",clearable:""},on:{"visible-change":function(t){return e.filterMall("")}},model:{value:e.site,callback:function(t){e.site=t},expression:"site"}},[e.isAShop?e._e():i("el-option",{attrs:{label:"全部",value:""}}),e._l(e.siteShowList,(function(t,a){return e.showMall(t,a)?i("el-option",{key:a,attrs:{label:t.mall_alias_name||t.platform_mall_name,value:t.platform_mall_id}}):e._e()}))],2)],1),e.isReset?i("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[i("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary",disabled:e.isBanPerform},on:{click:e.reset}},[e._v("　刷　　新　")])],1):e._e()])])},n=[],r=i("1da1"),s=i("b85c"),l=i("2909"),o=(i("96cf"),i("d81d"),i("fb6a"),i("caad"),i("2532"),i("d3b7"),i("25f0"),i("99af"),i("6062"),i("3ca3"),i("ddb0"),i("4de4"),i("159b"),i("c740"),i("7db0"),i("7646")),c=i("2b0e");c["default"].directive("loadmore",{bind:function(e,t){var i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){this.scrollHeight-this.scrollTop<=this.clientHeight+50?t.value(!0,this):this.scrollTop<30&&t.value(!1,this)}))}});var u={name:"StoreChoose",props:{spanWidth:{type:String,default:"80px"},parentCountry:{type:String,default:"TH"},isMall:{type:Boolean,default:function(){return!1}},isBanPerform:{type:Boolean,default:function(){return!1}},isAll:{type:Boolean,default:function(){return!1}},isReset:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}},isAShop:{type:Boolean,default:function(){return!1}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],siteShowList:[],countries:this.$filters.countries_option,mallListAPIInstance:new o["a"](this),isShowName:"",isShowNameAll:!1,showMallNumber:100,mallShowIndex:0,jsonMallData:[],filterMallTime:null}},watch:{siteList:function(e){this.siteShowList=e},countryVal:{handler:function(e,t){this.isShowName="",this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(e,t){var i=this;if(this.isAllowSet2){this.isShowName="",this.isAllowSet2=!1;var a=t.indexOf("")>-1,n=e.indexOf("")>-1;a!==n?this.groupId=n?Object(l["a"])(this.groupIdList.map((function(e){return e.id}))):[]:n?this.groupId=e.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length-1&&this.groupId.unshift(""),setTimeout((function(){i.isAllowSet2=!0,i.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(e,t){var i=this;if(this.isAllowSet1){this.isAllowSet1=!1;var a=this.isShowName;if(!this.isAShop){var n=t.includes(""),r=e.includes("");if(n!==r||t.toString()===e.toString()&&this.isShowNameAll)if(r&&(!a||a&&!this.isShowNameAll)){var o=a&&Object(l["a"])(this.siteShowList.map((function(e){return e.platform_mall_id})))||[""].concat(Object(l["a"])(this.siteList.map((function(e){return e.platform_mall_id})))),c=new Set([].concat(Object(l["a"])(o),Object(l["a"])(t)));this.site=Object(l["a"])(c),this.isShowNameAll=!0,a&&this.siteList.length===this.site.length&&this.site.unshift("")}else{this.isShowNameAll=!1;var u=[];if(a){var m=a&&Object(l["a"])(this.siteShowList.map((function(e){return e.platform_mall_id}))),h=m.length>this.site.length&&this.site||m,p=m.length>this.site.length&&m||this.site;u=new Set(this.site);var f,d=Object(s["a"])(p);try{for(d.s();!(f=d.n()).done;){var g=f.value;h.includes(g)&&u.delete(g)}}catch(b){d.e(b)}finally{d.f()}u.delete("")}this.site=Object(l["a"])(u)}else r?this.site=e.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length?this.site.unshift(""):this.isShowNameAll=!1}setTimeout((function(){i.changeMallList(),i.filterMall(a),i.isAllowSet1=!0}),10)}},deep:!0}},mounted:function(){this.countryVal=this.isMall?this.parentCountry:this.isAll?"":"TH"},methods:{reset:function(){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},ddMallGoodsGetMallList:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,n,r,s,o,c,u;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.site=[],a=t.countryVal,n=[],!(t.jsonMallData.length>0)){i.next=7;break}n=t.jsonMallData,i.next=12;break;case 7:return i.next=9,t.$appConfig.temporaryCacheInfo("get","mallAllData","");case 9:r=i.sent,n=JSON.parse(r)||[],t.jsonMallData=JSON.parse(r)||[];case 12:if(!(n.length>0)){i.next=17;break}1===e&&(t.siteList=""===a?n:n.filter((function(e){return e.country===a}))),2===e&&(0===t.groupId.length?t.siteList=[]:(t.siteList=[],t.groupId.forEach((function(e){n.forEach((function(i){a?e===i.group_id&&a===i.country&&t.siteList.push(i):e===i.group_id&&t.siteList.push(i)}))})))),i.next=22;break;case 17:return s={country:"",mallGroupIds:""},i.next=20,t.mallListAPIInstance.ddMallGoodsGetMallList(s);case 20:o=i.sent,200===o.code?(t.$appConfig.temporaryCacheInfo("save","mallAllData",o.data),c=o.data||[],t.siteList=c,t.jsonMallData=c,t.siteList=""===a?c:c.filter((function(e){return e.country===a}))):t.$message.error("获取分组、店铺列表失败");case 22:u=[],0===t.groupIdList.length&&(t.groupIdList=[{group_name:"全部",id:""}],t.siteList.forEach((function(e){var t=u.findIndex((function(t){return t&&t.id===e.group_id}));e.group_name&&t<0&&u.push({group_name:e.group_name,id:e.group_id})})),u.zzSort("id"),t.groupIdList=[].concat(Object(l["a"])(t.groupIdList),u),t.groupId=[""].concat(Object(l["a"])(u.map((function(e){return e.id}))))),setTimeout((function(){t.isAllowSet2=!0,t.isAllowSet1=!0,t.site=!t.isAShop&&[""]||""}),10);case 25:case"end":return i.stop()}}),i)})))()},changeMallList:function(){var e=this,t=[],i="";if(this.isAShop){var a=this.siteList.find((function(t){return t.platform_mall_id===e.site}));i=this.site,t.push(a)}else this.site.forEach((function(a){if(a){var n=e.siteList.find((function(e){return e.platform_mall_id===a}));t.push(n),i+=a+","}}));!this.countryVal&&this.groupId.indexOf("")>-1&&(i=t.length!==this.siteList.length&&i||""),this.source?this.$emit("changeMallList",{mallList:t,source:this.source,searchAll:i,country:this.countryVal.toLocaleUpperCase()}):(t["country"]=this.countryVal,this.$emit("changeMallList",t))},filterMall:function(e){var t=this,i=e&&this.isShowName!==e?1e3:100;this.filterMallTime&&(clearTimeout(this.filterMallTime),this.filterMallTime=null),this.filterMallTime=setTimeout((function(){t.isShowName!==e&&(t.mallShowIndex=0),t.isShowName=e||"";var i=t.siteList;e&&(i=t.siteList.filter((function(t){var i=t.mall_alias_name||t.platform_mall_name;return i.includes(e)}))),t.siteShowList=i}),i)},showMall:function(e,t){var i=e.mall_alias_name||e.platform_mall_name,a=this.site[0]===e.platform_mall_id;return a||this.mallShowIndex<=t&&t<=this.mallShowIndex+this.showMallNumber&&(!this.isShowName||i.includes(this.isShowName))},loadmoreMall:function(e,t){if(this.siteShowList.length>this.showMallNumber){var i=0;e?(i=this.mallShowIndex+10,i=i<this.siteShowList.length-this.showMallNumber&&i||this.siteShowList.length-this.showMallNumber):(i=this.mallShowIndex-10,i=i>0&&i||0),i!==this.mallShowIndex&&(t.scrollTop=e?t.scrollTop-100:30),this.mallShowIndex=i}}}},m=u,h=(i("8992"),i("2877")),p=Object(h["a"])(m,a,n,!1,null,null,null);t["a"]=p.exports}}]);