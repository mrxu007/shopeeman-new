(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e7fab34"],{5551:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("1da1"),n=a("d4ec"),s=a("bee2"),i=(a("d3b7"),a("25f0"),a("96cf"),function(){function e(t){Object(n["a"])(this,e),this._this=t}return Object(s["a"])(e,[{key:"getDiscountNominate",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.item,e.prev=1,r={},r["limit"]=100,r["offset"]=a.offset,r["mallId"]=a.platform_mall_id,r["discount_id"]=a.discount_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/nominate/?",r);case 9:if(n=e.sent,s=this.isJsonString(this.isJsonString(n).data),!s||0!==s.code){e.next=15;break}return e.abrupt("return",{code:200,data:s.data});case 15:if(2!==s.code&&2!==s.errcode){e.next=19;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 19:return e.abrupt("return",{code:-2,data:"查询折扣活动详情失败"});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"查询折扣活动详情异常： ".concat(e.t0)});case 25:case"end":return e.stop()}}),e,this,[[1,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getByDiscountids",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,s,i,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,r=t.promotionid,n=t.limit,s=t.discountType,e.prev=1,i={},i["discount_id_list"]=r,i["discount_type"]=s,i["limit"]=n,i["offset"]=a.offset,i["mallId"]=a.platform_mall_id,e.next=10,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/get_by_discountids/?",i);case 10:if(c=e.sent,u=this.isJsonString(this.isJsonString(c).data),!u||0!==u.code){e.next=16;break}return e.abrupt("return",{code:200,data:u.data});case 16:if(2!==u.code&&2!==u.errcode){e.next=20;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 20:return e.abrupt("return",{code:-2,data:"获取列表数据失败"});case 21:e.next=26;break;case 23:return e.prev=23,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取列表数据异常： ".concat(e.t0)});case 26:case"end":return e.stop()}}),e,this,[[1,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDiscountStandardSearch",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,s,i,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,r=t.keyword,n=t.searchType,s=t.discountType,e.prev=1,i={},i["keyword"]=r,i["search_type"]=n,"all"!==s&&(i["promotion_status"]=s),i["mallId"]=a.platform_mall_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/standard_search/?",i);case 9:if(c=e.sent,u=this.isJsonString(this.isJsonString(c).data),!u||0!==u.code){e.next=15;break}return e.abrupt("return",{code:200,data:u.data});case 15:if(2!==u.code&&2!==u.errcode){e.next=19;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 19:return e.abrupt("return",{code:-2,data:"获取失败"});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取promotionid数据异常： ".concat(e.t0)});case 25:case"end":return e.stop()}}),e,this,[[1,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDiscountList",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,s,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,r=t.limit,n=t.discountType,e.prev=1,s={},s["limit"]=r,s["offset"]=a.offset,s["discount_type"]=n,s["mallId"]=a.platform_mall_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/list/?",s);case 9:if(i=e.sent,c=this.isJsonString(this.isJsonString(i).data),!c||0!==c.code){e.next=15;break}return e.abrupt("return",{code:200,data:c.data});case 15:if(2!==c.code&&2!==c.errcode){e.next=19;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 19:return e.abrupt("return",{code:-2,data:"获取失败"});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取折扣列表数据异常： ".concat(e.t0)});case 25:case"end":return e.stop()}}),e,this,[[1,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isJsonString",value:function(e){if("string"!==typeof e)return e;try{return JSON.parse(e),JSON.parse(e)}catch(t){return e}}},{key:"stopActive",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r={},r["discount_id"]=t.discount_id.toString(),r["action"]=a,r["mallId"]=t.platform_mall_id,e.next=7,this._this.$shopeemanService.mixChinese(t.country,"/api/marketing/v3/discount/?",r,{Headers:{"Content-Type":" application/json"}},"delete");case 7:if(n=e.sent,s=n&&JSON.parse(n),!s||200!==s.status){e.next=18;break}if(i=JSON.parse(s.data),!i||0!==i.code){e.next=15;break}return e.abrupt("return",{code:200,data:i.data||[]});case 15:return e.abrupt("return",{code:50001,data:i.message||s.statusText||""});case 16:e.next=21;break;case 18:if(403!==s.status){e.next=20;break}return e.abrupt("return",{code:s.status,data:"操作失败，店铺未登录！"});case 20:return e.abrupt("return",{code:s.status,data:"操作失败".concat(s.statusText)});case 21:e.next=26;break;case 23:return e.prev=23,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"createActive",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.postChinese(t,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}});case 3:if(r=e.sent,n=r&&JSON.parse(r),!n||200!==n.status){e.next=14;break}if(s=JSON.parse(n.data),!s||0!==s.code){e.next=11;break}return e.abrupt("return",{code:200,data:s.data||[]});case 11:return e.abrupt("return",{code:50001,data:s.message||n.statusText||""});case 12:e.next=17;break;case 14:if(403!==n.status){e.next=16;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 22:case"end":return e.stop()}}),e,this,[[0,19]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"putActive",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.mixChinese(t,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(r=e.sent,n=r&&JSON.parse(r),!n||200!==n.status){e.next=14;break}if(s=JSON.parse(n.data),!s||0!==s.code){e.next=11;break}return e.abrupt("return",{code:200,data:s.data||[]});case 11:return e.abrupt("return",{code:50001,data:s.message||n.statusText||""});case 12:e.next=17;break;case 14:if(403!==n.status){e.next=16;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 22:case"end":return e.stop()}}),e,this,[[0,19]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"putModelActive",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.mixChinese(t,"/api/marketing/v3/discount/nominate/",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(r=e.sent,n=r&&JSON.parse(r),!n||200!==n.status){e.next=14;break}if(s=JSON.parse(n.data),!s||0!==s.code){e.next=11;break}return e.abrupt("return",{code:200,data:s.data||[]});case 11:return e.abrupt("return",{code:50001,data:s.message||n.statusText||""});case 12:e.next=17;break;case 14:if(403!==n.status){e.next=16;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 22:case"end":return e.stop()}}),e,this,[[0,19]])})));function t(t,a){return e.apply(this,arguments)}return t}()}]),e}())},"9cda":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"contaniner"},[a("el-row",{staticClass:"header"},[a("div",{staticClass:"on_new_dialog_box",staticStyle:{"margin-bottom":"10px"}},[a("div",[e._v("店铺站点：")]),a("el-select",{staticStyle:{width:"140px"},attrs:{size:"mini",filterable:""},model:{value:e.countryOption,callback:function(t){e.countryOption=t},expression:"countryOption"}},e._l(e.countriesOption,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),a("div",{staticStyle:{"margin-left":"20px"}},[e._v("任务名称：")]),a("el-input",{staticStyle:{width:"140px"},attrs:{size:"mini"},model:{value:e.taskName,callback:function(t){e.taskName=t},expression:"taskName"}}),a("div",{staticStyle:{"margin-left":"20px"}},[e._v("任务状态：")]),a("el-select",{attrs:{value:"",size:"mini"},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.statusList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1),a("div",{staticStyle:{"margin-left":"20px"}},[e._v("任务日期：")]),a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",size:"mini",placeholder:"选择开始日期"},model:{value:e.taskTimeStart,callback:function(t){e.taskTimeStart=t},expression:"taskTimeStart"}}),a("div",{staticStyle:{width:"6px",height:"1px",background:"#1a1a1a",margin:"0 7px"}}),a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",size:"mini",placeholder:"选择结束日期"},model:{value:e.taskTimeEnd,callback:function(t){e.taskTimeEnd=t},expression:"taskTimeEnd"}})],1),a("div",{staticClass:"on_new_dialog_box",staticStyle:{"margin-bottom":"10px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.searchTask}},[e._v("搜索任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.startTask}},[e._v("启动任务")]),a("el-button",{attrs:{size:"mini"},on:{click:e.cancelTask}},[e._v("取消任务")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.deleteTask}},[e._v("删除任务")])],1)]),a("u-table",{attrs:{data:e.taskTable,"use-virtual":"","data-changes-scroll-top":!1,"header-cell-style":{backgroundColor:"#f5f7fa",height:"50px"},"row-key":"id",border:!1,"big-data-checkbox":!0,height:"680"},on:{"selection-change":e.handleSelectionChange}},[a("u-table-column",{attrs:{align:"left",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"left",label:"序列号",type:"index",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"任务名称",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.task_name)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"店铺名称","min-width":"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",{staticClass:"goodsTableLine"},[e._v(" "+e._s(r.mall_names)+" ")])]}}])}),a("u-table-column",{attrs:{align:"left",label:"店铺站点",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){t.row;return[e._v(" "+e._s(e._f("chineseSite")(e.countryOption))+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"店铺分组",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){t.row;return[e._v("全部 ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"执行时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.exec_time)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"商品总数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.goods_count)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"上新成功数",width:"120",prop:"category_name"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.success_count)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"上新失败数",width:"120",prop:"categoryName","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.fail_count)+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"执行状态",width:"120",prop:"price"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.statusShow[Number(a.status)])+" ")]}}])}),a("u-table-column",{attrs:{align:"left",label:"任务详情",width:"120",prop:"sys_label_name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.viewTask(t)}}},[e._v("查看")])]}}])}),a("u-table-column",{attrs:{align:"left",label:"启动任务",width:"120",prop:"sourceName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.startTask(t)}}},[e._v("启动")])]}}])})],1)],1)},n=[],s=a("1da1"),i=(a("d81d"),a("3ca3"),a("ddb0"),a("c740"),a("a434"),a("96cf"),a("7646")),c=a("e1e4"),u=a("5551"),o={data:function(){return{mallListAPIInstance:new i["a"](this),GoodsManagerAPIInstance:new c["a"](this),GoodsDiscount:new u["a"](this),countriesOption:this.$filters.countries_option,countryOption:"TH",taskName:"",taskTimeStart:new Date((new Date).getTime()-1728e5),taskTimeEnd:new Date((new Date).getTime()+864e5),taskTable:[],taskSelectTable:[],statusList:[{value:"",label:"全部"},{value:1,label:"已执行"},{value:2,label:"部分失败"},{value:3,label:"待执行"},{value:4,label:"待启动"}],statusShow:{1:"已执行",2:"部分失败",3:"待执行",4:"待启动"},status:""}},methods:{searchTask:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.taskTable=[],a=e.countryOption,r=e.status,n=e.taskName,s=Math.floor(e.taskTimeStart.getTime()/1e3),i=Math.floor(e.taskTimeEnd.getTime()/1e3),t.next=8,e.$collectService.getCronPublishTask(a,r+"",n,s,i);case 8:c=t.sent,e.taskTable=c;case 10:case"end":return t.stop()}}),t)})))()},startTask:function(e){0!==this.taskSelectTable.length||this.$message.error("请选择一个定时任务")},cancelTask:function(){0!==this.taskSelectTable.length||this.$message.error("请选择一个定时任务")},deleteTask:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.taskSelectTable.length){t.next=3;break}return e.$message.error("请选择一个定时任务"),t.abrupt("return");case 3:return a=e.taskSelectTable.map((function(e){return e.id})),t.next=6,e.$collectService.deleteCronPublishTask(a);case 6:if(r=t.sent,200!=r.code){t.next=20;break}return e.$message.success("删除成功"),t.next=11,e.$collectService.deleteCronPublishConfig(a);case 11:n=regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$collectService.deleteCronPublishGoods(a[r]+"");case 2:n=e.taskTable.findIndex((function(e){return e.id===a[r]})),e.taskTable.splice(n,1);case 4:case"end":return t.stop()}}),t)})),s=0;case 13:if(!(s<a.length)){t.next=18;break}return t.delegateYield(n(s),"t0",15);case 15:s++,t.next=13;break;case 18:t.next=21;break;case 20:e.$message.error("删除失败");case 21:case"end":return t.stop()}}),t)})))()},viewTask:function(e){},handleSelectionChange:function(e){this.taskSelectTable=e}}},l=o,d=a("2877"),p=Object(d["a"])(l,r,n,!1,null,null,null);t["default"]=p.exports}}]);