(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8f34f766"],{"4c28":function(e,t,r){},8992:function(e,t,r){"use strict";r("4c28")},aabc:function(e,t,r){},ba9a:function(e,t,r){"use strict";r("aabc")},ef52:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"delivery-manager"},[r("div",{staticClass:"selectBox"},[r("div",{staticClass:"left-box mar-right"},[r("div",{staticClass:"base-box"},[r("span",{staticClass:"base-title"},[e._v("基础操作")]),r("div",{staticClass:"base-item base-left"},[r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.syncSurface}},[e._v("批量同步面单信息")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.batnchDownLoad("down")}}},[e._v("批量下载平台面单")])],1),r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.batnchDownLoad("view")}}},[e._v("批量预览打印平台面单")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.getExportData}},[e._v("导出数据")])],1),r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"}},[e._v("批量打印台湾虚拟面单")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.downLoadPickList}},[e._v("批量下载拣货单")])],1)],1)])]),r("div",{staticClass:"right-box"},[r("div",{staticClass:"base-box"},[r("span",{staticClass:"base-title"},[e._v("列表筛选操作")]),r("div",{staticClass:"base-item"},[r("el-row",{staticClass:"row-style"},[r("storeChoose",{attrs:{"is-all":!0,spanWidth:"90px",selectWidth:"180px",source:"orderCenter"},on:{changeMallList:e.changeMallList}}),r("div",{staticClass:"tool-item"},[r("span",[e._v("创建时间：")]),r("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:function(t){return e.changeTime(t,"createTime")}},model:{value:e.createTime,callback:function(t){e.createTime=t},expression:"createTime"}})],1)],1),r("el-row",{staticClass:"row-style"},[r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("发货状态：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.orderStatus,callback:function(t){e.$set(e.selectForm,"orderStatus",t)},expression:"selectForm.orderStatus"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.orderStatusList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("物流单号：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.hasTrackingNo,callback:function(t){e.$set(e.selectForm,"hasTrackingNo",t)},expression:"selectForm.hasTrackingNo"}},[r("el-option",{attrs:{label:"全部",value:""}}),r("el-option",{attrs:{label:"已申请",value:"1"}}),r("el-option",{attrs:{label:"未申请",value:"2"}})],1)],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("面单下载状态：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.isPrint,callback:function(t){e.$set(e.selectForm,"isPrint",t)},expression:"selectForm.isPrint"}},[r("el-option",{attrs:{label:"全部",value:""}}),r("el-option",{attrs:{label:"已下载",value:"1"}}),r("el-option",{attrs:{label:"未下载",value:"2"}})],1)],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("截止时间：")]),r("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:function(t){return e.changeTime(t,"createTime")}},model:{value:e.createTime,callback:function(t){e.createTime=t},expression:"createTime"}})],1)]),r("el-row",{staticClass:"row-style"},[r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("订单编号：")]),r("el-input",{staticClass:"inputBox",attrs:{size:"mini",clearable:""},model:{value:e.selectForm.orderSn,callback:function(t){e.$set(e.selectForm,"orderSn",t)},expression:"selectForm.orderSn"}})],1),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getOrderList(1)}}},[e._v("搜索")]),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:function(t){e.goodsSearchVisible=!0}}},[e._v("订单号批量查询")]),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:e.openBefore}},[e._v("批量添加本地备注")]),r("el-checkbox",{staticClass:"mar-right",model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}},[e._v("隐藏日志")]),r("p",{staticClass:"tableActive"},[e._v("同步和打印台湾站的面单信息（除711外），请走代理")])],1)],1)])])]),r("div",{staticClass:"content"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableData,"tooltip-effect":"dark",height:"calc(100vh - 257px)"},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),r("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s((e.currentPage-1)*e.pageSize+t.$index+1))]}}])}),r("el-table-column",{attrs:{"min-width":"80px",label:"站点",prop:"country",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.mall_info?[e._v(e._s(e._f("chineseSite")(t.row.mall_info.country)))]:void 0}}],null,!0)}),r("el-table-column",{attrs:{label:"店铺名称",prop:"mall_info.platform_mall_name","min-width":"120px",align:"center"}}),r("el-table-column",{attrs:{prop:"order_sn",label:"订单编号",align:"center","min-width":"170px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticClass:"tableActive",on:{click:function(r){return e.viewDetails("orderDetail",t.row.order_id,t.row.mall_info.platform_mall_id)}}},[e._v(e._s(t.row.order_sn))]),r("i",{staticClass:"el-icon-document-copy",staticStyle:{"margin-left":"8px",cursor:"pointer"},on:{click:function(r){return e.copyItem(t.row.order_sn)}}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"商品数量","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_count))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"123456",label:"商品详情","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.openGoodsDetail(t.row)}}},[e._v("商品详情")])]}}])}),r("el-table-column",{attrs:{align:"center",prop:"created_time",label:"订单创建时间","min-width":"140"}}),r("el-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"截止发货时间","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.ship_by_date))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"是否已申请物流单号","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.trackStatus[t.row.is_apply_tracking_no]))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"是否同步面单信息","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.hasLogistics?"否":"是"))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"order_status",label:"发货状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.changeOrderStatus(t.row.order_status)))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"logistics_name",label:"虾皮物流","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.logistics_name))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"tracking_no",label:"虾皮物流单号","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.tracking_no))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"remark",label:"本地备注","min-width":"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{directives:[{name:"show",rawName:"v-show",value:!(t.row.id===e.activeRemarkID),expression:"!(scope.row.id === activeRemarkID ? true : false)"}],staticStyle:{cursor:"pointer"},on:{click:function(r){return e.editRemark(t.$index,t.row.id)}}},[r("el-input",{attrs:{disabled:"",size:"mini"},model:{value:t.row.remark,callback:function(r){e.$set(t.row,"remark",r)},expression:"scope.row.remark"}})],1),t.row.id===e.activeRemarkID?r("el-input",{attrs:{size:"mini"},on:{blur:function(r){return e.changeRemark(t.row.id,t.$index)}},model:{value:e.orderRemark,callback:function(t){e.orderRemark=t},expression:"orderRemark"}}):e._e()]}}])}),r("el-table-column",{attrs:{align:"center",prop:"note",label:"shopee备注","min-width":"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.note))]}}])}),r("el-table-column",{attrs:{align:"center",prop:"note",label:"是否已下载面单","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.logisticsStatusList[t.row.is_print]))]}}])}),r("el-table-column",{attrs:{label:"操作",prop:"","min-width":"150px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){}}])})],1),r("div",{staticClass:"pagination"},[r("el-pagination",{attrs:{background:"","page-sizes":[20,50,100],"page-size":e.pageSize,"current-page":e.currentPage,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1),r("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}}),r("el-dialog",{attrs:{title:"商品详情",visible:e.goodsListVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.goodsListVisible=t},close:e.closeDialog}},[r("el-table",{ref:"goodsTable",attrs:{data:e.goodsList,"tooltip-effect":"dark",height:"400px"}},[r("el-table-column",{attrs:{align:"center",prop:"order_sn",label:"订单编号","min-width":"120"}}),r("el-table-column",{attrs:{align:"center",label:"商品图片","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{staticStyle:{width:"56px",height:"56px"},attrs:{src:e._f("imageRender")([e.clickRow.country,e.clickRow.mall_info?e.clickRow.mall_info.platform_mall_id:"",t.row.goods_img])}})]}}])}),r("el-table-column",{attrs:{align:"center",prop:"goods_id",label:"商品ID","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.openUrl(e.clickRow,t.row.goods_id,"product")}}},[e._v("查看商品详情")])]}}])}),r("el-table-column",{attrs:{align:"center",prop:"goods_count",label:"商品数量","min-width":"120"}}),r("el-table-column",{attrs:{align:"center",prop:"variation_name",label:"商品规格","min-width":"120"}})],1)],1),r("el-dialog",{attrs:{title:"订单号批量查询",visible:e.goodsSearchVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.goodsSearchVisible=t},close:e.closeDialog}},[r("p",[e._v("请输入订单号，一行一个，最多五十个")]),r("el-input",{attrs:{type:"textarea",rows:10},model:{value:e.goodsOrderSnStr,callback:function(t){e.goodsOrderSnStr=t},expression:"goodsOrderSnStr"}}),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.getOrderList(1,e.goodsOrderSnStr)}}},[e._v("批量查询")])],1)],1),r("el-dialog",{attrs:{title:"批量添加本地备注",visible:e.localRamarkVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.localRamarkVisible=t}}},[r("div",{staticClass:"remark-style"},[r("span",[e._v("本地备注")]),r("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:e.localRamark,callback:function(t){e.localRamark=t},expression:"localRamark"}})],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.batchSetRemark}},[e._v("批量添加")])],1)])],1)},a=[],i=r("1da1"),s=(r("96cf"),r("159b"),r("b64b"),r("7db0"),r("b0c0"),r("ac1f"),r("5319"),r("caad"),r("2532"),r("99af"),r("a434"),r("4de4"),r("d81d"),r("1276"),r("a15b"),r("bcd0")),o=r("feb6"),c=r("0e0b"),l=r("d4ec"),u=r("bee2"),d=r("ade3"),p=(r("a9e3"),r("d3b7"),r("25f0"),r("3ca3"),r("ddb0"),r("fb6a"),r("bda5")),h=r("5f91"),m=r("a91f"),f=function(){function e(t,r){Object(l["a"])(this,e),Object(d["a"])(this,"$api",p["a"]),Object(d["a"])(this,"$shopeemanService",new h["a"]),Object(d["a"])(this,"$appConfig",new m["a"]),Object(d["a"])(this,"isStop",!1),Object(d["a"])(this,"_this",null),Object(d["a"])(this,"pageSize",40),Object(d["a"])(this,"writeLog",void 0),Object(d["a"])(this,"orders",[]),Object(d["a"])(this,"schemaType",""),Object(d["a"])(this,"isApplyForceFaceInfo",!1),this._this=t,this.writeLog=r}return Object(u["a"])(e,[{key:"start",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.orders=t,t.forEach((function(e){r.mainFlow(e)}));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"mainFlow",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,r=null,0!=t.order_id&&t.order_id){e.next=10;break}return n={keyword:t.order_sn,shop_id:t.mall_info.platform_mall_id},e.next=6,this.$shopeemanService.getOrderHint(t.country,n);case 6:a=e.sent,r=200===a.code&&a.data&&a.data.orders&&a.data.orders.length&&a.data.orders[0]||null,e.next=15;break;case 10:return i={order_id:t.order_id,shop_id:t.mall_info.platform_mall_id},e.next=13,this.$shopeemanService.getDetailsSinger(t.country,i);case 13:s=e.sent,r=200===s.code&&s.data||null;case 15:if(r){e.next=18;break}return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败[506]"),!1),e.abrupt("return");case 18:if(o=this.checkTrackInfo(r),!o.trackingNo){e.next=29;break}if("TW"!==t.country){e.next=25;break}return e.next=23,this.getPrintTWinfoFlow(t.id,r,t.country,o.trackingNo);case 23:e.next=27;break;case 25:return e.next=27,this.getPrintInfoFlow(t.id,r,t.country,o.trackingNo);case 27:e.next=44;break;case 29:return e.next=31,this.applyOrderTrackingNo(r,t.country);case 31:if(c=e.sent,200!==c.code){e.next=42;break}if("TW"!==t.country){e.next=38;break}return e.next=36,this.getPrintTWinfoFlow(t.id,r,t.country,c.data);case 36:e.next=40;break;case 38:return e.next=40,this.getPrintInfoFlow(t.id,r,t.country,c.data);case 40:e.next=44;break;case 42:return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败[507]-[").concat(c.code,"],").concat(c.data),!1),e.abrupt("return");case 44:e.next=48;break;case 46:e.prev=46,e.t0=e["catch"](0);case 48:case"end":return e.stop()}}),e,this,[[0,46]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkTrackInfo",value:function(e){var t={};t["orderId"]=e.order_id;var r=e.shipping_traceno;if(!r){var n=JSON.parse(e.logistics_extra_data);n&&n.sls_info&&n.sls_info.last_mile_tracking_number&&(r=n.sls_info.last_mile_tracking_number)}return t["trackingNo"]=r,t["logistics_channel"]=e.logistics_channel||"",t}},{key:"applyOrderTrackingNo",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,c,l,u,d,p,h,m,f,g,_,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$appConfig.getUserConfig();case 2:if(n=e.sent,a=n&&JSON.parse(n),"TW"===r||a&&a.is_apply_shopee_logistics){e.next=7;break}if(this.isApplyForceFaceInfo){e.next=7;break}return e.abrupt("return",this.getShopeeShipNumber(t.order_id,t.shop_id,r));case 7:if(i=s["u"].find((function(e){return e.ShipId==t.logistics_channel})),!i||i.IsDeafult){e.next=10;break}return e.abrupt("return",this.getShopeeShipNumber(t.order_id,t.shop_id,r));case 10:if(e.prev=10,"TW"!==r){e.next=45;break}return o={shop_id:t.shop_id},e.next=15,this.$shopeemanService.getShopSellerRealName(r,o);case 15:if(c=e.sent,l=""!=c&&c?c:null,l||(l="nick"),"30001"!=t.logistics_channel){e.next=39;break}return u={shop_id:t.shop_id},e.next=22,this.$shopeemanService.getShop(r,u);case 22:if(d=e.sent,p=200===d.code&&d.data.pickup_address_id||null,p){e.next=26;break}return e.abrupt("return",{code:50002,data:"no_address"});case 26:return h={order_id:t.order_id,address_id:p,channel_id:t.logistics_channel,shop_id:t.shop_id},e.next=29,this.$shopeemanService.getPickupTimeSlots(r,h);case 29:if(m=e.sent,f=200===m.code&&m.data.time_slots&&m.data.time_slots[0].value||null,f){e.next=33;break}return e.abrupt("return",{code:50003,data:"no_pickup_time"});case 33:return g={order_id:t.order_id,channel_id:t.logistics_channel,forder_id:t.order_id,seller_real_name:l,pickup_time:f,seller_address_id:p,shop_id:t.shop_id},e.next=36,this.$shopeemanService.handleOutOrder(r,g);case 36:e.sent,e.next=43;break;case 39:return _={order_id:t.order_id,channel_id:t.logistics_channel,forder_id:t.order_id,seller_real_name:l,shop_id:t.shop_id},e.next=42,this.$shopeemanService.handleOutOrder(r,_);case 42:e.sent;case 43:e.next=49;break;case 45:return b={order_id:t.order_id,channel_id:t.logistics_channel,forder_id:t.order_id,shop_id:t.shop_id},e.next=48,this.$shopeemanService.handleOutOrder(r,b);case 48:e.sent;case 49:return e.abrupt("return",this.getShopeeShipNumber(t.order_id,t.shop_id,r));case 52:return e.prev=52,e.t0=e["catch"](10),e.abrupt("return",{code:50004,data:"error"});case 55:case"end":return e.stop()}}),e,this,[[10,52]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getShopeeShipNumber",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,a="",i={order_id:t,shop_id:r},s=0;case 4:if(!(s<3)){e.next=21;break}return e.next=7,this.$shopeemanService.getDropOff(n,i);case 7:if(o=e.sent,o&&200!==!o.code&&o.data){e.next=10;break}return e.abrupt("continue",18);case 10:if(c=o.data&&o.data.list&&o.data.list[0]&&o.data.list[0].forders[0].third_party_tn||"",null!=c&&""!=c||(c=o.data.consignment_no||""),a=c||"",""!==a){e.next=17;break}return e.abrupt("continue",18);case 17:return e.abrupt("break",21);case 18:s++,e.next=4;break;case 21:if(""!==a){e.next=25;break}return e.abrupt("return",{code:50005,data:"未获取到物流单号"});case 25:return e.abrupt("return",{code:200,data:a});case 26:e.next=31;break;case 28:return e.prev=28,e.t0=e["catch"](0),e.abrupt("return",{code:50006,data:"error"});case 31:case"end":return e.stop()}}),e,this,[[0,28]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getPrintInfoFlow",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,o,c,l,u,d,p,h,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getPrintWaybillType(r.shop_id,n);case 3:if(i=e.sent,200===i.code&&i.data){e.next=7;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败[501]"),!1),e.abrupt("return");case 7:return s=i.data.waybill_type,o=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=11,this.checkPackagePrintWaybillMultiShop(o,r.shop_id,n);case 11:if(c=e.sent,200===c.code&&c.data.list&&c.data.list.length&&c.data.list[0].package_number){e.next=15;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 15:return l=c.data.list[0].package_number,e.next=18,this.getSdConfig(r.shop_id,n);case 18:if(u=e.sent,u){e.next=22;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 22:return"VN"===n&&"NORMAL"===s&&(u=2),d=[{order_id:Number(r.order_id),package_number:l,region_id:n,shop_id:Number(r.shop_id),channel_id:Number(r.logistics_channel)}],e.next=26,this.createSdJobsMultiShop(d,r.shop_id,n,s+"_PDF","Air Waybill."+r.actual_carrier,u);case 26:if(p=e.sent,200===p.code&&p.data.list&&p.data.list.length&&p.data.list[0].job_id){e.next=30;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败[504]"),!1),e.abrupt("return");case 30:return h=p.data.list[0].job_id,e.next=33,this.downloadSdJob(r.shop_id,h,n);case 33:if(m=e.sent,m){e.next=37;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 37:return e.next=39,this.checkFaceInfo(m,r.order_sn,a,r.actual_carrier,n,u,t,r.shop_id);case 39:e.sent,e.next=45;break;case 42:e.prev=42,e.t0=e["catch"](0),this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[000]"),!1);case 45:case"end":return e.stop()}}),e,this,[[0,42]])})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"uploadFaceInfo",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._this.$commodityService.saveFaceSheetInfo(t.toString(),r.toString(),[{url:a,orderSn:n.toString()}]);case 2:return i=e.sent,s=JSON.parse(i),e.abrupt("return",s);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"getPrintTWinfoFlow",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,o,c,l,u,d,p,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("30010"!=r.logistics_channel){e.next=3;break}e.next=5;break;case 3:if("30001"!=r.logistics_channel){e.next=5;break}return e.abrupt("return",null);case 5:return i="30012"==r.logistics_channel?"THERMAL_PDF":"C2C_SHIPPING_LABEL_HTML",s=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=9,this.checkPackagePrintWaybillMultiShop(s,r.shop_id,n);case 9:if(o=e.sent,200===o.code&&o.data.list&&o.data.list.length&&o.data.list[0].package_number){e.next=13;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 13:if(c=o.data.list[0].package_number,l=null,"30012"!=r.logistics_channel){e.next=19;break}l=3,e.next=22;break;case 19:return e.next=21,this.getSdConfig(r.shop_id,n);case 21:l=e.sent;case 22:if(l){e.next=25;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 25:return u=[{order_id:Number(r.order_id),package_number:c,region_id:n,shop_id:Number(r.shop_id)}],e.next=28,this.createSdJobsMultiShop(u,r.shop_id,n,i,"寄件单"+r.actual_carrier,l);case 28:if(d=e.sent,200===d.code&&d.data.list&&d.data.list.length&&d.data.list[0].job_id){e.next=32;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败[504]"),!1),e.abrupt("return");case 32:if(p=d.data.list[0].job_id,"30005"!=r.logistics_channel){e.next=41;break}return e.next=36,this.downloadSdJob(r.shop_id,p,n);case 36:if(h=e.sent,h){e.next=40;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 40:this.get711FaceInfo(a,h);case 41:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"getLaiErFuFace",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"get711FaceInfo",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getPrintWaybillType",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getPrintWaybillType(r,n);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkPackagePrintWaybillMultiShop",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_info_list:t,shop_id:r},e.next=3,this.$shopeemanService.checkPackagePrintWaybillMultiShop(n,a);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getSdConfig",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getSdConfig(r,n);case 3:if(a=e.sent,i=null,!(200===a.code&&a.data&&a.data.suggest_schema&&a.data.suggest_schema.last_normal_selected_schema)){e.next=14;break}return s=!1,o=a.data.suggest_schema.last_normal_selected_schema,c=a.data.suggest_schema.suggest_default_schema,(o.length<1&&c.length>1||o.length>1)&&(s=!0),i=s||"VN"===r?"TW"===r?6:"MY"===r||"PH"===r||"VN"===r?3:"TH"===r||"ID"===r?2:Number(c[1]):o.length<1?Number(c[0]):Number(o[0]),e.abrupt("return",i);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSdJobsMultiShop",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,s){var o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={record_generate_schema:!1,package_list:t,generate_file_details:[{file_type:a,file_name:i,file_contents:[s]}],shop_id:r},e.next=3,this.$shopeemanService.createSdJobsMultiShop(n,o);case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i,s){return e.apply(this,arguments)}return t}()},{key:"downloadSdJob",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={job_id:r,shop_id:t},e.next=3,this.$shopeemanService.downloadSdJob(n,a);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkFaceInfo",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a,s,o,l,u){var d,p=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(null===t||t.length<500)&&r&&n){e.next=4;break}return e.abrupt("return",{code:50001,data:"面单大小或平台物流获取异常，请重新同步！"});case 4:d=new Blob([t],{type:"application/pdf"}),this.blobToDataURL(d,function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var i,d,h,m,f,g,_;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.replace("data:application/pdf;base64,",""),d=null,e.next=4,p.cutFaseSize(i,r,!0,300,420,-420);case 4:if(d=e.sent,"VN"!=s||"J&T Exoress"!=a||2!=o){e.next=11;break}return e.next=8,p.cutFaseSize(i,r,!0,300,420,-420);case 8:d=e.sent,e.next=21;break;case 11:if("VN"!=s||"VNPost Nhanh"!=a){e.next=17;break}return e.next=14,p.cutFaseSize(i,r,!0,300,425,-420);case 14:d=e.sent,e.next=21;break;case 17:if("ID"!=s){e.next=21;break}return e.next=20,p.cutFaseSize(i,r,!0,425,595,0);case 20:d=e.sent;case 21:if(200==d.code){e.next=23;break}return e.abrupt("return",p.writeLog("订单【".concat(r,"】获取面单异常, ").concat(d.msg,"！"),!1));case 23:return e.next=25,window["BaseUtilBridgeService"].checkFaceInfo(i,r,n);case 25:if(h=e.sent,m=JSON.parse(h),200!==m.code){e.next=42;break}return f=Object(c["o"])(!1,32)+"_"+(new Date).getTime()+".PDF",e.next=31,p._this.$ossService.uploadFile(i,f);case 31:if(g=e.sent,!g){e.next=39;break}return _={sysMallId:l.toString(),mallId:u,logisticsInfos:{url:g,orderSn:r.toString()}},e.next=36,p.$api.uploadOrderFaceSheetInfo(_);case 36:e.sent,e.next=40;break;case 39:return e.abrupt("return",p.writeLog("订单【".concat(r,"】获取面单异常！"),!1));case 40:e.next=43;break;case 42:return e.abrupt("return",p.writeLog("订单【".concat(r,"】获取面单异常, 面单大小或平台物流获取异常，请重新同步！"),!1));case 43:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i,s,o,c){return e.apply(this,arguments)}return t}()},{key:"cutFaseSize",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,s){var o,c,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={OrderNo:r,IsUseA4Size:n,PdfWidth:a,PdfHeight:i,LocationY:s},e.next=3,window["BaseUtilBridgeService"].getFaceData(t,!0,o);case 3:return c=e.sent,l=c&&JSON.parse(c),e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));function t(t,r,n,a,i,s){return e.apply(this,arguments)}return t}()},{key:"blobToDataURL",value:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)}},{key:"getPickListData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this.dealWithMallOrderGroup(t),n="NORMAL",a=regeneratorRuntime.mark((function e(t){var a,i,o,c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r[t],i=a[0].country,o=t,c=regeneratorRuntime.mark((function e(t){var r,c,l,u,d,p,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.slice(t,t+50),c=[],r.forEach((function(e){if(0!=e.order_id){var t={order_id:Number(e.order_id),shop_id:Number(o),region_id:i};c.push(t)}})),e.next=5,s.checkPackagePrintWaybillMultiShop(c,o,i);case 5:if(l=e.sent,200!==l.code){e.next=26;break}if(l.data.list.length){e.next=12;break}return s.writeLog("店铺【".concat(o,"】当前数据没有可下载的拣货单"),!1),e.abrupt("return","continue");case 12:return u=l.data.list,d=[],u.forEach((function(e){var t={order_id:Number(e.order_id),package_number:e.package_number,region_id:i,shop_id:Number(o)};d.push(t)})),e.next=17,s.createSdJobsMultiShop(d,o,i,n+"_PDF","PickList",0);case 17:if(p=e.sent,200===p.code&&p.data.list&&p.data.list.length&&p.data.list[0].job_id){e.next=22;break}s.writeLog("创建拣货单失败，".concat(p.data),!1),e.next=26;break;case 22:return h=p.data.list[0].job_id,e.next=25,s.downloadSdJob(o,h,i);case 25:e.sent;case 26:case"end":return e.stop()}}),e)})),l=0;case 5:if(!(l<a.length)){e.next=13;break}return e.delegateYield(c(l),"t0",7);case 7:if(u=e.t0,"continue"!==u){e.next=10;break}return e.abrupt("continue",10);case 10:l+=50,e.next=5;break;case 13:case"end":return e.stop()}}),e)})),e.t0=regeneratorRuntime.keys(r);case 4:if((e.t1=e.t0()).done){e.next=9;break}return i=e.t1.value,e.delegateYield(a(i),"t2",7);case 7:e.next=4;break;case 9:this.writeLog("下载拣货单完成",!0);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dealWithMallOrderGroup",value:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.mall_info.platform_mall_id]||(t[n.mall_info.platform_mall_id]=[]),t[n.mall_info.platform_mall_id].push(n)}return t}}]),e}(),g={components:{storeChoose:o["a"]},data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},selectMallList:[],createTime:[],selectForm:{orderStatus:"",orderSn:"",isPrint:"",hasTrackingNo:""},orderStatusList:s["n"],trackStatus:["","已申请","未申请"],logisticsStatusList:["","已下载","未下载"],total:0,pageSize:20,currentPage:1,multipleSelection:[],tableLoading:!1,tableData:[],showConsole:!0,goodsList:[],goodsListVisible:!1,goodsSearchVisible:!1,goodsOrderSnStr:"",localRamarkVisible:!1,localRamark:"",activeRemarkID:"",orderRemark:""}},mounted:function(){var e=this;this.createTime=Object(c["e"])(30),setTimeout((function(){e.getOrderList()}),2e3)},methods:{changeTime:function(e,t,r){var n=Object(c["k"])(new Date(e[0]).getTime(),new Date(e[1]).getTime());if(n>93)return r?this[t][r]=Object(c["e"])(30):this[t]=Object(c["e"])(30),this.$message.warning("只支持查询或导出93天内的数据,请重新选择时间！")},batnchDownLoad:function(e){var t=this;if(!this.multipleSelection.length)return this.$message.warning("请选择要操作的数据！");"down"==e?this.$confirm("pdf文件后缀是否小写?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){t.batchPrintOrderSurface(!0,!0,!1,!1)})).catch((function(){t.batchPrintOrderSurface(!1,!0,!1,!1)})):"view"==e&&this.$confirm("是否需要打印虚拟面单?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){t.batchPrintOrderSurface(!1,!1,!0,!0)})).catch((function(){t.batchPrintOrderSurface(!1,!1,!0,!1)}))},batchPrintOrderSurface:function(e,t,r,n){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){var s,o,c,l,u,d,p,h,m,f,g,_,b,k,w,v,x,y,S,L;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s="",o={},c="",a.multipleSelection.forEach((function(e,t){o[e.country]=e.country,s=e.country,c=0===t?e.main_order_sn:c+","+e.main_order_sn})),!(Object.keys(o).length>1)){i.next=6;break}return i.abrupt("return",a.$message.warning("由于每个站点面单不一致，请分站点批量预览和打印！"));case 6:return l={mainOrderSns:c},u=[],i.prev=8,i.next=11,a.$api.getLogisticsInformationBatch(l);case 11:if(d=i.sent,200!==d.data.code){i.next=16;break}u=d.data.data,i.next=17;break;case 16:return i.abrupt("return",a.$message.warning("面单获取失败！"));case 17:if(u=[{id:4,order_sn:"2112169WHRH236",status:1,data:{name:"Sirirat chawalarat",phone:"66805869386",inCode:"",country:"TH",orderSn:"2112169WHRH236",lane_code:"L-TH22",productDes:"สีชมพูสเตอริโอแบบส * 1||สีชมพู5,1-อายุ5ปี * 1",tracking_no:"TH204258844180Y",full_address:"283/15 moobaan phakdee rama 3 bangkholeam เขตบางคอแหลม จังหวัดกรุงเทพมหานคร 10120",last_mile_name:"TH-JNT",first_mile_name:"",goods_to_declare:"P"},xzy_status:1,url:"http://pkg.ppxias.com/ppxiasProductImages/produce/2021/12/14799e9763db4d68.PDF",created_at:"2020-03-10 20:10:19",updated_at:"2020-03-10 20:27:59"}],u.length){i.next=20;break}return i.abrupt("return",a.$message.warning("暂无面单信息"));case 20:p=[],h=function(e){var t=u[e];if(!t.data||!t.url)return a.$refs.Logs.writeLog("订单".concat(t.order_sn,"未获取到面单信息"),!1),"continue";var r=a.multipleSelection.find((function(e){return e.order_sn==t.order_sn})),n={PDFUrl:t.url,OrderNo:t.order_sn,MainOrderNo:t.order_sn,PlatformLogisticsId:t.data.tracking_no,PlatformLogisticsName:"",CreateTime:t.created_at,BuyerName:t.data.name,BuyerPhone:t.data.phone,BuyerAddress:t.data.full_address,BuyerNote:"",BarInfo:{BarCode:t.order_sn,BarCodeWidth:200,BarCodeHeight:50},SkuList:[r.goodsInfo[0].variation_sku.replace("=|=",""),r.goodsInfo[0].goods_count],IsNeedCut:30008==r.logistics_id||30007==r.logistics_id,IsUseA4Size:!1,PdfWidth:320,PdfHeight:425,LocationY:-420,PrintStatus:"0",MallId:r.mall_info.platform_mall_id,MallName:r.mall_info.platform_mall_name};p.push(n)},m=0;case 23:if(!(m<u.length)){i.next=30;break}if(f=h(m),"continue"!==f){i.next=27;break}return i.abrupt("continue",27);case 27:m++,i.next=23;break;case 30:return g={IsDownload:t,PdfExtendName:e?".pdf":".PDF",PdfExtendNameIsLower:e,IsPrintVirtualFaceSheet:n,Site:s,IsShowWindow:r,VirtualPdfPath:{},ConvertFaceInfoList:[]},i.next=33,window["BaseUtilBridgeService"].getOrderPdfInfo(g);case 33:if(i.sent,_=null,b={},!n){i.next=43;break}return i.next=39,window["BaseUtilBridgeService"].getVirtualFace(p,!0);case 39:if(_=i.sent,b=_&&JSON.parse(_),b&&"200"==b.code){i.next=43;break}return i.abrupt("return",a.$message.warning("获取虚拟面单失败"));case 43:k=[],w=function(e){var t=u[e];if(!t.data||!t.url)return a.$refs.Logs.writeLog("订单".concat(t.order_sn,"未获取到面单信息"),!1),"continue";var r=a.multipleSelection.find((function(e){return e.order_sn==t.order_sn})),i={HtmlFilePath:t.url.includes(".html")?t.url:"",PDFFilePath:t.url.includes(".PDF")||t.url.includes(".pdf")?t.url:"",LogisticsId:t.data.tracking_no,OrderSn:r.order_sn,MallId:r.mall_info.platform_mall_id,VirtualFilePath:n?b.data[r.order_sn]:""};k.push(i)},v=0;case 46:if(!(v<u.length)){i.next=53;break}if(x=w(v),"continue"!==x){i.next=50;break}return i.abrupt("continue",50);case 50:v++,i.next=46;break;case 53:return i.next=55,window["BaseUtilBridgeService"].htmlToPdf(k,!1);case 55:if(y=i.sent,S=y&&JSON.parse(y),S&&200!=!S.code){i.next=59;break}return i.abrupt("return",a.$message.error("打印面单失败"));case 59:return L={IsDownload:t,PdfExtendName:e?".pdf":".PDF",PdfExtendNameIsLower:e,IsPrintVirtualFaceSheet:n,Site:s,IsShowWindow:r,PdfInfoList:p,VirtualPdfPath:n?b.data:{},ConvertFaceInfoList:S.data},a.tableLoading=!0,i.next=63,window["BaseUtilBridgeService"].downloadPdf(L);case 63:a.tableLoading=!1,i.next=68;break;case 66:i.prev=66,i.t0=i["catch"](8);case 68:case"end":return i.stop()}}),i,null,[[8,66]])})))()},syncSurface:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择数据！"));case 2:e.showConsole=!1,e.$refs.Logs.writeLog("同步面单信息开始，请耐心等待！",!0),r=new f(e,e.$refs.Logs.writeLog),r.start(e.multipleSelection);case 6:case"end":return t.stop()}}),t)})))()},downLoadPickList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择数据！"));case 2:e.showConsole=!1,e.$refs.Logs.writeLog("下载拣货单开始，请耐心等待！",!0),r=new f(e,e.$refs.Logs.writeLog),r.getPickListData(e.multipleSelection);case 6:case"end":return t.stop()}}),t)})))()},getExportData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,a,s,o,c,l,u,d,p,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="",e.selectMallList.forEach((function(e,t){r=0===t?e.id:r+","+e.id})),n=JSON.parse(JSON.stringify(e.selectForm)),n["page"]=1,n["pageSize"]=200,n["sysMallId"]=r,n["createTime"]=e.createTime.length?e.createTime[0]+" 00:00:00/"+e.createTime[1]+" 23:59:59":"",e.tableLoading=!0,t.next=10,e.$api.getDeliveryList(n);case 10:a=t.sent,s=a.data,o=[],c=s&&200===s.code&&s.data.data&&s.data.data||[];case 14:if(!c||!c.length){t.next=25;break}return c.forEach(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.joinLink(r,r.goodsInfo[0].goods_id);case 2:r.goodsLink=t.sent;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o=o.concat(c),n.page++,t.next=20,e.$api.getDeliveryList(n);case 20:l=t.sent,u=l.data,c=u&&200===u.code&&u.data.data&&u.data.data||[],t.next=14;break;case 25:if(e.tableLoading=!1,o.length){t.next=28;break}return t.abrupt("return",e.$message.warning("没有可导出的数据！"));case 28:if(d=[],p=JSON.parse(JSON.stringify(o)),p.length>7e3){h=0;while(p.length)d[h]=p.splice(0,7e3),h++}else d[0]=p;e.tableToExcel(d);case 32:case"end":return t.stop()}}),t)})))()},tableToExcel:function(e){for(var t=this,r=1,n="<tr>\n            <td>编号</td>\n            <td>站点</td>\n            <td>店铺名称</td>\n            <td>订单编号</td>\n            <td>商品数量</td>\n            <td>商品规格</td>\n            <td>商品链接</td>\n            <td>商品图片</td>\n            <td>订单创建时间</td>\n            <td>截止发货时间</td>\n            <td>是否已申请物流单号</td>\n            <td>是否同步面单信息</td>\n            <td>发货状态</td>\n            <td>虾皮物流</td>\n            <td>虾皮物流单号</td>\n            </tr>",a=0;a<e.length;a++){var i=e[a];i.forEach((function(e){n+="<tr><td>".concat(r++,"</td>\n                <td>").concat(e.mall_info&&e.mall_info.country?t.$filters.chineseSite(e.mall_info.country):"\t","</td>\n                <td>").concat(e.mall_info&&e.mall_info.platform_mall_name?e.mall_info.platform_mall_name:"\t","</td>\n                <td style=\"mso-number-format:'@';\">").concat(e.order_sn?e.order_sn:"\t","</td>\n                <td>").concat(e.goods_count?e.goods_count:"\t","</td>\n                <td>").concat(e.goodsInfo&&e.goodsInfo.length?e.goodsInfo[0].variation_name:"\t","</td>\n                <td>").concat(e.goodsLink?e.goodsLink:"\t","</td>\n                <td>").concat(e.goodsInfo&&e.goodsInfo.length?t.$filters.imageRender([e.country,e.mall_info?e.mall_info.platform_mall_id:"",e.goodsInfo[0].goods_img]):"\t","</td>\n                <td>").concat(e.created_time?e.created_time:"\t","</td>\n                <td>").concat(e.ship_by_date?e.ship_by_date:"\t","</td>\n                <td>").concat(e.is_apply_tracking_no?t.trackStatus[e.is_apply_tracking_no]:"\t","</td>\n                <td>").concat(0==e.hasLogistics?"否":"是\t","</td>\n                <td>").concat(e.order_status?Object(s["d"])(e.order_status):"\t","</td>\n                <td>").concat(e.logistics_name?e.logistics_name:"\t","</td>\n                <td>").concat(e.tracking_no?e.tracking_no:"\t","</td>\n                </tr>")}))}Object(c["h"])("发货管理订单数据",n)},changeRemark:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.$api.setLocalRemark({id:e,remark:r.orderRemark});case 2:if(a=n.sent,200!=a.data.code){n.next=8;break}return r.$message.success("设置备注成功"),r.tableData[t].remark=r.orderRemark,r.activeRemarkID="",n.abrupt("return");case 8:r.$message.error("设置备注失败"),r.activeRemarkID="";case 10:case"end":return n.stop()}}),n)})))()},editRemark:function(e,t){this.activeRemarkID=t,this.orderRemark=this.tableData[e].remark},openBefore:function(){if(!this.multipleSelection.length)return this.$message.warning("请先选择需要备注的商品！");this.localRamarkVisible=!0},batchSetRemark:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择需要标记的商品！"));case 2:e.showConsole=!1,e.multipleSelection.forEach(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={id:r.id,remark:e.localRamark},t.next=3,e.$api.setLocalRemark(n);case 3:a=t.sent,200===a.data.code?(e.$refs.multipleTable.toggleRowSelection(r,!1),e.$refs.Logs.writeLog("订单编号【".concat(r.order_sn,"】备注成功"),!0)):e.$refs.Logs.writeLog("订单编号【".concat(r.order_sn,"】备注失败-").concat(a.data.message),!1);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.closeDialog(),e.getOrderList();case 6:case"end":return t.stop()}}),t)})))()},handleKey:function(e){return e.split("\n").map((function(e){return e.replace(/(^\s*)|(\s*$)/g,"")})).filter((function(e){return""!=e}))},openGoodsDetail:function(e){this.clickRow=e,this.goodsList=e.goodsInfo,this.goodsListVisible=!0},closeDialog:function(){this.clickRow={},this.goodsList=[],this.goodsSearchVisible=!1,this.goodsOrderSnStr="",this.localRamark="",this.localRamarkVisible=!1},getOrderList:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,i,s,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a="",r.selectMallList.forEach((function(e,t){a=0===t?e.id:a+","+e.id})),i=JSON.parse(JSON.stringify(r.selectForm)),r.currentPage=e||r.currentPage,i["page"]=r.currentPage,i["pageSize"]=r.pageSize,i["sysMallId"]=a,i["createTime"]=r.createTime.length?r.createTime[0]+" 00:00:00/"+r.createTime[1]+" 23:59:59":"",t&&(s=r.handleKey(t),s=s.splice(0,50),i.orderSn=s.join(",")),r.tableLoading=!0,n.next=12,r.$api.getDeliveryList(i);case 12:o=n.sent,200===o.data.code?(r.tableData=o.data.data.data,r.total=o.data.data.total):r.$message.error("获取列表失败，".concat(o.data.message)),r.tableLoading=!1,r.closeDialog();case 16:case"end":return n.stop()}}),n)})))()},joinLink:function(e,t){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a="",!e.mall_info||!e.mall_info.platform_mall_id){n.next=7;break}return i={platform_mall_id:e.mall_info?e.mall_info.platform_mall_id:""},n.next=5,r.$shopeemanService.getWebUrl(e.country,i);case 5:s=n.sent,a=s+"/product/"+e.mall_info.platform_mall_id+"/"+t;case 7:return n.abrupt("return",a);case 8:case"end":return n.stop()}}),n)})))()},openUrl:function(e,t,r){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var i,s,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e,"product"!==r){a.next=7;break}return s={platform_mall_id:e.mall_info.platform_mall_id},a.next=5,n.$shopeemanService.getWebUrl(e.country,s);case 5:o=a.sent,i=o+"/product/"+e.mall_info.platform_mall_id+"/"+t;case 7:n.$BaseUtilService.openUrl(i);case 8:case"end":return a.stop()}}),a)})))()},viewDetails:function(e,t,r){var n={type:e,shopId:r,id:t};this.$BaseUtilService.getOrderDetailInfo(r,JSON.stringify(n))},changeMallList:function(e){this.selectMallList=e.mallList},handleCurrentChange:function(e){this.currentPage=e,this.getOrderList()},handleSizeChange:function(e){this.pageSize=e,this.getOrderList()},handleSelectionChange:function(e){this.multipleSelection=e},copyItem:function(e){var t=document.createElement("div");t.id="tempTarget",t.style.opacity="0",t.innerText=e,document.body.appendChild(t);try{var r=document.createRange();r.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(r),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.$message.success("复制成功")}catch(n){}t.parentElement.removeChild(t)},changeOrderStatus:s["d"]}},_=g,b=(r("ba9a"),r("2877")),k=Object(b["a"])(_,n,a,!1,null,"eb83dac0",null);t["default"]=k.exports},feb6:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ul",{staticClass:"storeChooseUL"},[r("li",[r("span",{style:{width:e.spanWidth}},[e._v("所属站点：")]),r("el-select",{staticClass:"siteSelectBox",style:{width:e.selectWidth},attrs:{size:"mini",filterable:""},model:{value:e.countryVal,callback:function(t){e.countryVal=t},expression:"countryVal"}},[e.isAll?r("el-option",{attrs:{label:"全部",value:""}}):e._e(),e._l(e.countries,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),r("li",[r("span",{style:{width:e.spanWidth}},[e._v("店铺分组：")]),r("el-select",{staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"",size:"mini",filterable:""},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.groupIdList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.group_name,value:e.id}})}))],2)],1),r("li",[r("span",{style:{width:e.spanWidth}},[e._v("店铺名称：")]),r("el-select",{staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"",size:"mini",filterable:""},model:{value:e.site,callback:function(t){e.site=t},expression:"site"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.siteList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.mall_alias_name||e.platform_mall_name,value:e.platform_mall_id}})}))],2)],1),e.isReset?r("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[r("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary"},on:{click:e.reset}},[e._v("　刷　　新　")])],1):e._e()])])},a=[],i=r("1da1"),s=(r("96cf"),r("159b"),r("fb6a"),r("d3b7"),r("25f0"),r("c740"),r("4de4"),r("7646")),o={name:"StoreChoose",props:{isReset:{type:Boolean,default:function(){return!1}},selectWidth:{type:String,default:"100px"},spanWidth:{type:String,default:"80px"},isAll:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],countries:this.$filters.countries_option,mallListAPIInstance:new s["a"](this)}},watch:{countryVal:{handler:function(e,t){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(e,t){var r=this;if(this.isAllowSet2){this.isAllowSet2=!1;var n=t.indexOf("")>-1,a=e.indexOf("")>-1;n!==a?a?(this.groupId=[""],this.groupIdList.forEach((function(e){r.groupId.push(e.id)}))):this.groupId=[]:a?this.groupId=e.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length&&this.groupId.unshift(""),setTimeout((function(){r.isAllowSet2=!0,r.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(e,t){var r=this;if(this.isAllowSet1){this.isAllowSet1=!1;var n=t.indexOf("")>-1,a=e.indexOf("")>-1;n!==a?a?(this.site=[""],this.siteList.forEach((function(e){r.site.push(e.platform_mall_id)}))):this.site=[]:a?this.site=e.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length&&this.site.unshift(""),setTimeout((function(){r.changeMallList(),r.isAllowSet1=!0}))}},deep:!0}},mounted:function(){this.countryVal=this.isAll?"":"TH"},methods:{reset:function(){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},changeSelect:function(e){return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},ddMallGoodsGetMallList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.site=[],r=t.countryVal,n=t.groupId.indexOf("")>-1&&t.groupId.slice(1).toString()||t.groupId.toString(),a={country:r,mallGroupIds:n},e.next=6,t.mallListAPIInstance.ddMallGoodsGetMallList(a);case 6:i=e.sent,200===i.code?(t.siteList=i.data,0===t.groupIdList.length&&(t.groupId=[""],t.siteList.forEach((function(e){var r=t.groupIdList.findIndex((function(t){return t.id===e.group_id}));e.group_name&&r<0&&(t.groupIdList.push({group_name:e.group_name,id:e.group_id}),t.groupId.push(e.group_id))}))),setTimeout((function(){t.isAllowSet2=!0,t.isAllowSet1=!0,t.site=[""]}),10)):t.$message.error("获取分组、店铺列表失败");case 8:case"end":return e.stop()}}),e)})))()},changeMallList:function(){var e=this,t=[];this.site.forEach((function(r){if(r){var n=e.siteList.filter((function(e){return e.platform_mall_id===r}));t.push(n[0])}})),t["country"]=this.countryVal,this.$emit("changeMallList",t),this.source?(t["country"]=this.countryVal,this.$emit("changeMallList",{mallList:t,source:this.source,country:this.countryVal})):(t["country"]=this.countryVal,this.$emit("changeMallList",t))}}},c=o,l=(r("8992"),r("2877")),u=Object(l["a"])(c,n,a,!1,null,null,null);t["a"]=u.exports}}]);