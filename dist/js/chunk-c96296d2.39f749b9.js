(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c96296d2"],{"3e66":function(t,e,a){"use strict";a("fd04")},7558:function(t,e,a){"use strict";var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("ul",{staticClass:"storeChooseUL"},[a("li",[a("span",{style:{width:t.spanWidth}},[t._v("所属站点：")]),a("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:""},on:{change:t.getsite},model:{value:t.countryVal,callback:function(e){t.countryVal=e},expression:"countryVal"}},[t.isAll?a("el-option",{attrs:{label:"全部",value:""}}):t._e(),t._l(t.countries,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],2)],1),a("li",[a("span",{style:{width:t.spanWidth}},[t._v("店铺分组：")]),a("el-select",{staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"",size:"mini",filterable:""},model:{value:t.groupId,callback:function(e){t.groupId=e},expression:"groupId"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._l(t.groupIdList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.group_name,value:t.id}})}))],2)],1),t.showMall?a("li",[a("span",{style:{width:t.spanWidth}},[t._v("店铺名称：")]),a("el-select",{staticClass:"selectBox",attrs:{placeholder:"",multiple:"","collapse-tags":"",size:"mini",filterable:""},model:{value:t.site,callback:function(e){t.site=e},expression:"site"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._l(t.siteList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.mall_alias_name||t.platform_mall_name,value:t.platform_mall_id}})}))],2)],1):t._e()])])},n=[],i=a("1da1"),s=(a("96cf"),a("159b"),a("fb6a"),a("d3b7"),a("25f0"),a("c740"),a("4de4"),a("7646")),r={name:"Storechoosemall",props:{showMall:{type:Boolean,default:!1},spanWidth:{type:String,default:"80px"},isAll:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],countries:this.$filters.countries_option,mallListAPIInstance:new s["a"](this)}},watch:{countryVal:{handler:function(t,e){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(t,e){var a=this;if(this.isAllowSet2){this.isAllowSet2=!1;var l=e.indexOf("")>-1,n=t.indexOf("")>-1;l!==n?n?(this.groupId=[""],this.groupIdList.forEach((function(t){a.groupId.push(t.id)}))):this.groupId=[]:n?this.groupId=t.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length&&this.groupId.unshift(""),setTimeout((function(){a.isAllowSet2=!0,a.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(t,e){var a=this;if(this.isAllowSet1){this.isAllowSet1=!1;var l=e.indexOf("")>-1,n=t.indexOf("")>-1;l!==n?n?(this.site=[""],this.siteList.forEach((function(t){a.site.push(t.platform_mall_id)}))):this.site=[]:n?this.site=t.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length&&this.site.unshift(""),setTimeout((function(){a.changeMallList(),a.isAllowSet1=!0}))}},deep:!0}},mounted:function(){this.countryVal=this.isAll?"":"TH"},methods:{getsite:function(t){var e=t;this.$emit("getSite",e)},changeSelect:function(t){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},ddMallGoodsGetMallList:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,l,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.site=[],a=e.countryVal,l=e.groupId.indexOf("")>-1&&e.groupId.slice(1).toString()||e.groupId.toString(),n={country:a,mallGroupIds:l},t.next=6,e.mallListAPIInstance.ddMallGoodsGetMallList(n);case 6:i=t.sent,200===i.code?(e.siteList=i.data,0===e.groupIdList.length&&(e.groupId=[""],e.siteList.forEach((function(t){var a=e.groupIdList.findIndex((function(e){return e.id===t.group_id}));t.group_name&&a<0&&(e.groupIdList.push({group_name:t.group_name,id:t.group_id}),e.groupId.push(t.group_id))}))),setTimeout((function(){e.isAllowSet2=!0,e.isAllowSet1=!0,e.site=[""]}),10)):e.$message.error("获取分组、店铺列表失败");case 8:case"end":return t.stop()}}),t)})))()},changeMallList:function(){var t=this,e=[];this.site.forEach((function(a){if(a){var l=t.siteList.filter((function(t){return t.platform_mall_id===a}));e.push(l[0])}})),this.source?(e["country"]=this.countryVal,this.$emit("changeMallList",{mallList:e,source:this.source})):(e["country"]=this.countryVal,this.$emit("changeMallList",e))}}},o=r,c=(a("3e66"),a("2877")),u=Object(c["a"])(o,l,n,!1,null,null,null);e["a"]=u.exports},efa0:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"detail",staticStyle:{padding:"10px"}},[a("div",{staticClass:"condition",staticStyle:{display:"flex"}},[a("Storechoosemall",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall":!0},on:{changeMallList:t.changeMallList,getSite:t.changeSite}}),a("el-button",{attrs:{type:"primary",size:"mini",loading:t.isStart},on:{click:t.startCompare}},[t._v("开始同步")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.cancerCompare}},[t._v("取消同步")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.closelogData}},[t._v("清空日志")]),a("el-checkbox",{staticStyle:{margin:"4px"},model:{value:t.showlog,callback:function(e){t.showlog=e},expression:"showlog"}},[t._v("隐藏日志")])],1),a("div",{staticStyle:{color:"red",margin:"10px 0px"}},[t._v("温馨提示：此功能为同步虾皮后台已删除商品至云端")]),a("div",{staticClass:"tableDes"},[a("el-table",{attrs:{height:"calc(100vh - 70px)",data:t.tableList,"header-cell-style":{background:"#f7fafa"}}},[a("el-table-column",{attrs:{label:"序号",type:"index",align:"center",fixed:""}}),a("el-table-column",{attrs:{prop:"country",label:"站点",align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(t._f("chineseSite")(a.country)))]}}])}),a("el-table-column",{attrs:{prop:"",label:"店铺名称",align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(t._s(a.mall_alias_name?a.mall_alias_name:a.platform_mall_name))]}}])}),a("el-table-column",{attrs:{prop:"totalGoods",label:"虾皮商品总数",align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"getGoods",label:"已获取虾皮商品数量",align:"center","min-width":"100px",fixed:"right"}})],1),a("Logs",{ref:"autoReplyLogs",attrs:{clear:""},model:{value:t.showlog,callback:function(e){t.showlog=e},expression:"showlog"}})],1)])},n=[],i=a("2909"),s=a("1da1"),r=(a("96cf"),a("99af"),a("d3b7"),a("25f0"),a("3ca3"),a("ddb0"),a("159b"),a("c740"),a("a9e3"),a("7558")),o=a("e1e4"),c={components:{Storechoosemall:r["a"]},data:function(){return{isStart:!1,dataRuning:!1,loading:!1,showlog:!0,tableList:[],query:{country:"TH",mallGroupIds:[]},GoodsManagerAPIInstance:new o["a"](this),plantDate:[]}},created:function(){},methods:{closelogData:function(){this.$refs.autoReplyLogs.consoleMsg=""},cancerCompare:function(){this.dataRuning=!0,this.$message.success("正在取消同步，大概需要几秒，请耐心等待......")},startCompare:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,l,n,s,r,o,c,u,p,d,g,m,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isStart=!0,t.showlog=!1,t.dataRuning=!1,e.next=5,t.getinfo();case 5:a=0;case 6:if(!(a<t.tableList.length)){e.next=72;break}if(!t.dataRuning){e.next=9;break}return e.abrupt("break",72);case 9:l={country:t.query.country,page_number:1,mallId:t.tableList[a].platform_mall_id,page_size:48},t.plantDate=[],n=2,s=1;case 13:if(!(s<=n)){e.next=69;break}return l.page_number=s,t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】正在获取虾皮商品数据..."),!0),e.next=18,t.GoodsManagerAPIInstance.getSkuList(l);case 18:if(r=e.sent,!t.dataRuning){e.next=22;break}return t.$refs.autoReplyLogs.writeLog("取消同步"),e.abrupt("break",69);case 22:if(0!==r.ecode){e.next=64;break}if(c=r.data.page_info.total,u=r.data.page_info.page_size,n=c/u===0?c/u:Math.floor(c/u)+1,t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】商品总数").concat(r.data.page_info.total,"个"),!0),t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】正获取第【").concat(s,"】页数据,一页").concat(l.page_size,"个"),!0),p=r.data.list,(o=t.plantDate).push.apply(o,Object(i["a"])(p)),t.tableList[a].totalGoods=c,t.tableList[a].getGoods=t.plantDate.length,t.$set(t.tableList,a,t.tableList[a]),!t.dataRuning){e.next=36;break}return t.$refs.autoReplyLogs.writeLog("取消同步"),e.abrupt("break",69);case 36:if(s!==n){e.next=62;break}if(t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】虾皮商品数据获取完毕，开始获取服务端商品数据"),!0),!t.dataRuning){e.next=41;break}return t.$refs.autoReplyLogs.writeLog("取消同步"),e.abrupt("break",69);case 41:return d=t.tableList[a].id,e.prev=42,e.next=45,t.$commodityService.getMallAllRecordList(d.toString());case 45:if(g=e.sent,m=JSON.parse(g),200!==m.code){e.next=54;break}return e.delegateYield(regeneratorRuntime.mark((function e(){var l,n,i,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(l=m.data.info,t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】虾皮商品数据获取完毕，服务端商品总数").concat(l.length),!0),t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】虾皮商品数据获取完毕，服务端商品数据获取完毕"),!0),n=[],l.forEach((function(e){var a=t.plantDate.findIndex((function(t){return Number(t.id)===Number(e.listing_id)}));a<0&&n.push(e.listing_id)})),t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】开始同步商品数据"),!0),!t.dataRuning){e.next=9;break}return t.$refs.autoReplyLogs.writeLog("取消同步"),e.abrupt("return","break");case 9:if(0!==n.length){e.next=12;break}return t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】同步结束"),!0),e.abrupt("return","break");case 12:if(alert("1"),i={sysmallId:n.toString()},!t.dataRuning){e.next=17;break}return t.$refs.autoReplyLogs.writeLog("取消同步"),e.abrupt("return","break");case 17:return e.next=19,t.$commodityService.delCloudItems(i);case 19:s=e.sent,r=JSON.parse(s),200===r.code?t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】同步完成"),!0):t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】同步失败，服务端异常"),!0);case 22:case"end":return e.stop()}}),e)}))(),"t0",49);case 49:if(f=e.t0,"break"!==f){e.next=52;break}return e.abrupt("break",69);case 52:e.next=56;break;case 54:return t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】虾皮商品数据获取完毕，服务端商品数据获取失败"),!1),e.abrupt("break",69);case 56:e.next=62;break;case 58:return e.prev=58,e.t1=e["catch"](42),t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】店铺,数据捕获异常，").concat(e.t1),!1),e.abrupt("continue",66);case 62:e.next=66;break;case 64:return t.$refs.autoReplyLogs.writeLog("店铺【".concat(t.tableList[a].mall_alias_name||t.tableList[a].platform_mall_name,"】同步失败，发生异常：店铺未登录,请重新登录"),!1),e.abrupt("break",69);case 66:s++,e.next=13;break;case 69:a++,e.next=6;break;case 72:t.isStart=!1;case 73:case"end":return e.stop()}}),e,null,[[42,58]])})))()},getinfo:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={country:t.query.country,mallGroupIds:t.query.mallGroupIds.toString()},t.loading=!0,e.next=4,t.$api.ddMallGoodsGetMallList(a);case 4:l=e.sent,t.loading=!1,t.tableList=[],200===l.data.code?l.data.data.forEach((function(e){e.totalGoods=0,e.getGoods=0,t.tableList.push(e)})):t.$message.warning("店铺列表获取失败！");case 8:case"end":return e.stop()}}),e)})))()},changeMallList:function(t){var e=this;this.query.mallGroupIds=[],(null===t||void 0===t?void 0:t.length)>0&&t.forEach((function(t){e.query.mallGroupIds.push(t.group_id)}))},changeSite:function(t){this.query.country=t}}},u=c,p=a("2877"),d=Object(p["a"])(u,l,n,!1,null,null,null);e["default"]=d.exports},fd04:function(t,e,a){}}]);