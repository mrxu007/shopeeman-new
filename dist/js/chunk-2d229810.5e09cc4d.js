(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d229810"],{de70:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var r=a("1da1"),i=a("d4ec"),n=a("bee2"),s=a("ade3"),o=(a("96cf"),a("99af"),a("fb6a"),a("4de4"),a("159b"),a("ac1f"),a("5319"),a("b0c0"),a("7db0"),a("d3b7"),a("25f0"),a("30d0")),c=a("bda5"),u=a("b5e1"),l=a("5f91"),_=a("bcd0"),h=function(){function e(t,a,r,n){Object(i["a"])(this,e),Object(s["a"])(this,"tbNetworkService",c["a"].tbRequest),Object(s["a"])(this,"$api",c["a"]),Object(s["a"])(this,"$commodityService",new u["a"]),Object(s["a"])(this,"$shopeemanService",new l["a"]),Object(s["a"])(this,"jdNetworkService",c["a"].jdRequest),Object(s["a"])(this,"jszNetworkService",c["a"].jxRequest),Object(s["a"])(this,"isStop",!1),Object(s["a"])(this,"mall",void 0),Object(s["a"])(this,"_this",null),Object(s["a"])(this,"pageSize",40),Object(s["a"])(this,"orderService",new o["a"]),Object(s["a"])(this,"skuImageCache",{}),Object(s["a"])(this,"syncStatus",void 0),Object(s["a"])(this,"mallNo",""),Object(s["a"])(this,"upLoadType",""),Object(s["a"])(this,"writeLog",void 0),Object(s["a"])(this,"timeRange",60),this.mall=t,this._this=r,this.syncStatus=a,this.writeLog=n}return Object(n["a"])(e,[{key:"startSingel",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,i,n,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.writeLog=a,this.mall=t.mall_info,7!==t.order_status){e.next=19;break}return r={return_sn:t.order_sn,shop_id:t.mall_info.platform_mall_id},e.next=6,this.$shopeemanService.getRefundOrderDetail(t.country,r);case 6:if(i=e.sent,200!==i.code){e.next=16;break}return n=[i.data],e.next=11,this.getOrderOtherInfoRefund(n);case 11:return e.next=13,this.afterUpLoadOrders(n);case 13:this.writeLog("【".concat(t.order_id,"】订单同步成功"),!0),e.next=17;break;case 16:this.writeLog("【".concat(t.order_id,"】订单同步失败").concat(i.data),!1);case 17:e.next=33;break;case 19:return s={order_id:t.order_id,shop_id:t.mall_info.platform_mall_id},e.next=22,this.$shopeemanService.getDetailsSinger(t.country,s);case 22:if(o=e.sent,200!==o.code){e.next=32;break}return c=[o.data],e.next=27,this.getOrderOtherInfo(c);case 27:return e.next=29,this.upLoadOrders(c);case 29:this.writeLog("【".concat(t.order_id,"】订单同步成功"),!0),e.next=33;break;case 32:this.writeLog("【".concat(t.order_id,"】订单同步失败").concat(o.data),!1);case 33:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"start",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.timeRange=r,"refund"!==this.syncStatus.value){e.next=6;break}return e.next=4,this.refund(t,a);case 4:e.next=13;break;case 6:if("toShip"!==this.syncStatus.value){e.next=11;break}return e.next=9,this.toShip(t,a);case 9:e.next=13;break;case 11:return e.next=13,this.otherStatus(t,a);case 13:case"end":return e.stop()}}),e,this)})));function t(t,a,r){return e.apply(this,arguments)}return t}()},{key:"toShip",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,i,n,s,o,c,u,l,_,h,d,m,p,g,y,f=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.mallNo=t,this.upLoadType=a,e.prev=2,r={page_size:this.pageSize,page_number:1,total:0,sort_by:"confirmed_date_desc",shop_id:this.mall.platform_mall_id},e.next=6,this.$shopeemanService.getToShipOrderIdList(this.mall.country,r);case 6:if(i=e.sent,200!==i.code){e.next=54;break}n=i.data,s=n.package_list,o=n.total,c=0,u=[];case 11:if(!s.length){e.next=51;break}l=0;case 13:if(!(l<orders.length)){e.next=37;break}return _=orders.slice(l,l+5),e.next=17,this.$shopeemanService.getDetailsByOrderIds(this.mall.country,{from_seller_data:!1,orders:this.changeParams(_),shop_id:this.mall.platform_mall_id});case 17:if(h=e.sent,200!==h.code){e.next=34;break}if(d=h.data&&h.data.orders||[],u=u.concat(h.data.orders),!d||!d.length){e.next=34;break}return m=d.filter((function(e){return(new Date).getTime()-1e3*e.create_time<24*f.timeRange*60*60*1e3})),c+=m.length,e.next=26,this.getOrderOtherInfo(m);case 26:return p=[],e.next=29,this.checkOrderSnStatus(m);case 29:if(p=e.sent,e.t0=p.length,!e.t0){e.next=34;break}return e.next=34,this.upLoadOrders(p);case 34:l+=5,e.next=13;break;case 37:if(g="",g=u[u.length-1].create_time,!(s.length<40||g&&(new Date).getTime()-1e3*g>24*this.timeRange*60*60*1e3)){e.next=43;break}s=[],e.next=49;break;case 43:return r.page_number++,r.total=o,e.next=47,this.$shopeemanService.getToShipOrderIdList(this.mall.country,r);case 47:y=e.sent,s=y&&y.data&&y.data.package_list||[];case 49:e.next=11;break;case 51:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(c,"】条"),!0),e.next=59;break;case 54:if(403!==i.code){e.next=58;break}return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 58:return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 59:e.next=64;break;case 61:return e.prev=61,e.t1=e["catch"](2),e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 64:case"end":return e.stop()}}),e,this,[[2,61]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"refund",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,i,n,s,o,c,u,l,_,h,d,m,p,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.mallNo=t,this.upLoadType=a,e.prev=2,r={page_size:this.pageSize,page_number:1,keyword:"",from_page_number:1,shop_id:this.mall.platform_mall_id},e.next=6,this.$shopeemanService.getRefundOrderIdList(this.mall.country,r);case 6:if(i=e.sent,200!==i.code){e.next=52;break}n=i.data,s=n.list,n.page_info,o=0;case 10:if(!s.length){e.next=49;break}c=[],u=0;case 13:if(!(u<s.length)){e.next=32;break}if(l=s[u],_={return_sn:l.return_sn,shop_id:this.mall.platform_mall_id},!((new Date).getTime()-1e3*l.create_time>24*this.timeRange*60*60*1e3)){e.next=18;break}return e.abrupt("continue",29);case 18:return e.next=20,this.$shopeemanService.getRefundOrderDetail(this.mall.country,_);case 20:if(h=e.sent,200!==h.code){e.next=29;break}return l.refundDetail=h.data,e.next=25,this.getOrderOtherInfoRefund(l);case 25:return e.next=27,this.checkAfterOrderSnStatus(l);case 27:d=e.sent,d&&c.push(l);case 29:u++,e.next=13;break;case 32:return e.next=34,this.afterUpLoadOrders(c);case 34:if(m=e.sent,m&&(o+=c.length),p="",p=s[s.length-1].create_time,!(s.length<40||p&&(new Date).getTime()-1e3*p>24*this.timeRange*60*60*1e3)){e.next=42;break}s=[],e.next=47;break;case 42:return r.page_number++,e.next=45,this.$shopeemanService.getRefundOrderIdList(this.mall.country,r);case 45:g=e.sent,s=g&&g.data&&g.data.list||[];case 47:e.next=10;break;case 49:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(o,"】条"),!0),e.next=57;break;case 52:if(403!==i.code){e.next=56;break}return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 56:return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 57:e.next=62;break;case 59:return e.prev=59,e.t0=e["catch"](2),e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 62:case"end":return e.stop()}}),e,this,[[2,59]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"otherStatus",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var r,i,n,s,o,c,u,l,_,h,d,m,p,g,y,f=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.mallNo=t,this.upLoadType=a,e.prev=2,r={from_page_number:1,source:this.syncStatus.value,page_size:this.pageSize,page_number:1,total:0,is_massship:!1,shop_id:this.mall.platform_mall_id},e.next=6,this.$shopeemanService.getOrderIdList(this.mall.country,r);case 6:if(i=e.sent,200!==i.code){e.next=54;break}n=i.data,s=n.orders,o=n.page_info,c=0,u=[];case 11:if(!s.length){e.next=51;break}l=0;case 13:if(!(l<s.length)){e.next=37;break}return _=s.slice(l,l+5),e.next=17,this.$shopeemanService.getDetailsByOrderIds(this.mall.country,{from_seller_data:!1,orders:_,shop_id:this.mall.platform_mall_id});case 17:if(h=e.sent,200!==h.code){e.next=34;break}if(d=h.data&&h.data.orders||[],u=u.concat(h.data.orders),!d||!d.length){e.next=34;break}return m=d.filter((function(e){return(new Date).getTime()-1e3*e.create_time<24*f.timeRange*60*60*1e3})),c+=m.length,e.next=26,this.getOrderOtherInfo(m);case 26:return p=[],e.next=29,this.checkOrderSnStatus(m);case 29:if(p=e.sent,e.t0=p.length,!e.t0){e.next=34;break}return e.next=34,this.upLoadOrders(p);case 34:l+=5,e.next=13;break;case 37:if(g="",g=u[u.length-1].create_time,!(s.length<40||g&&(new Date).getTime()-1e3*g>24*this.timeRange*60*60*1e3)){e.next=43;break}s=[],e.next=49;break;case 43:return r.page_number++,r.total=o.total,e.next=47,this.$shopeemanService.getOrderIdList(this.mall.country,r);case 47:y=e.sent,s=y&&y.data&&y.data.orders||[];case 49:e.next=11;break;case 51:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(c,"】条"),!0),e.next=59;break;case 54:if(403!==i.code){e.next=58;break}return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 58:return e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 59:e.next=64;break;case 61:return e.prev=61,e.t1=e["catch"](2),e.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 64:case"end":return e.stop()}}),e,this,[[2,61]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"changeParams",value:function(e){var t=[];return e.forEach((function(e){var a={order_id:e.order_id,region_id:e.region_id||e.region,shop_id:e.shop_id};t.push(a)})),t}},{key:"getOrderOtherInfo",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=0;case 1:if(!(a<t.length)){e.next=23;break}return r=t[a],i={order_id:r.order_id,shop_id:this.mall.platform_mall_id},e.next=6,this.$shopeemanService.getIncomeTransactionHistoryDetail(this.mall.country,i);case 6:return n=e.sent,200===n.code&&(r["transactionHistoryDetail"]=n.data),e.next=10,this.$shopeemanService.getOrdeTrackingHistory(this.mall.country,i);case 10:return s=e.sent,200===s.code&&(r["ordeTrackingHistory"]=s.data),e.next=14,this.$shopeemanService.getLogisticsTrackingHistory(this.mall.country,i);case 14:return o=e.sent,200===o.code&&(r["logisticsTrackingHistory"]=o.data),e.next=18,this.$shopeemanService.getForderLogistics(this.mall.country,i);case 18:c=e.sent,200===c.code&&(r["forderLogistics"]=c.data);case 20:a++,e.next=1;break;case 23:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getOrderOtherInfoRefund",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_id:t.order_id,shop_id:this.mall.platform_mall_id},e.next=3,this.$shopeemanService.getIncomeTransactionHistoryDetail(this.mall.country,a);case 3:return r=e.sent,200===r.code&&(t["transactionHistoryDetail"]=r.data),e.next=7,this.$shopeemanService.getOrdeTrackingHistory(this.mall.country,a);case 7:return i=e.sent,200===i.code&&(t["ordeTrackingHistory"]=i.data),n={order_id:t.order_id,shop_id:this.mall.platform_mall_id,log_id:1},e.next=12,this.$shopeemanService.getLogisticsTrackingHistoryRefund(this.mall.country,n);case 12:return s=e.sent,200===s.code&&(t["logisticsTrackingHistory"]=s.data),e.next=16,this.$shopeemanService.getForderLogistics(this.mall.country,a);case 16:o=e.sent,200===o.code&&(t["forderLogistics"]=o.data);case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkOrderSnStatus",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=[],r=0;case 2:if(!(r<t.length)){e.next=14;break}return i=t[r],n=i&&i.ordeTrackingHistory&&i.ordeTrackingHistory.history&&i.ordeTrackingHistory.history[0]&&i.ordeTrackingHistory.history[0].new_status||"",s=i&&i.transactionHistoryDetail&&i.transactionHistoryDetail.payment_info&&i.transactionHistoryDetail.payment_info.shipping_subtotal&&i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf||0,o=i.order_sn+"_"+i.status+"_"+i.status_ext+"_"+i.logistics_status+"_"+n+"_"+s,e.next=9,this.$api.checkOrderSnStatus({orderKey:o});case 9:c=e.sent,c.data.orderKey||a.push(i);case 11:r++,e.next=2;break;case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkAfterOrderSnStatus",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=!1,r="".concat(t.return_id,"_").concat(t.status,"_").concat(t.mtime?t.mtime:0),e.next=4,this.$api.checkOrderSnStatus({orderKey:r});case 4:return i=e.sent,i.data.orderKey||(a=!0),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"upLoadOrders",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(e.prev=0,a=[],r=0;r<t.length;r++)i=t[r],n={order_id:i.order_id,ordersn:i.order_sn,currency:i.order_items[0].product.currency,shipping_carrier:i.actual_carrier,days_to_ship:i.days_to_ship||7,auto_cancel_date:i.auto_cancel_3pl_ack_date,note:i.note,note_update_time:i.note_mtime,payment_method:i.payment_method,create_time:i.create_time,update_time:i.ordeTrackingHistory&&i.ordeTrackingHistory.history&&i.ordeTrackingHistory.history[0]&&i.ordeTrackingHistory.history[0].ctime||0,pay_time:i.shipping_confirm_time,ship_by_date:i.ship_by_date,delivery_time:this.getDeliveryTime(i),tracking_no:i.shipping_traceno||this.getTrackingNo(i),buyer_cancel_reason:i.buyer_cancel_reason,message_to_seller:i.remark,goods_to_declare:0,recipient_address:{phone:i.buyer_address_phone,name:i.buyer_address_name,full_address:i.shipping_address},logistics_status:i.logistics_status,status:i.status,status_ext:i.status_ext,return_id:i.return_id,order_status:"",sip_shop_id:"",country_ext:"",income_detail:JSON.stringify(i.transactionHistoryDetail),total_amount:this.getTotalAmount(i),goods_price:Math.abs(i.transactionHistoryDetail.payment_info.merchant_subtotal.product_price),actual_shipping_cost:Math.abs(i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf),shipping_fee:Math.abs(i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_buyer),estimated_shipping_fee:Math.abs(i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_buyer),shipping_rebate:Math.abs(i.transactionHistoryDetail.buyer_payment_info.shopee_coins_redeemed),voucher_price:Math.abs(i.transactionHistoryDetail.buyer_payment_info.seller_voucher),card_txn_fee:Math.abs(i.transactionHistoryDetail.payment_info.fees_and_charges.transaction_fee),comm_fee:Math.abs(i.transactionHistoryDetail.payment_info.fees_and_charges.transaction_fee),tax_amount:Math.abs(i.transactionHistoryDetail.buyer_payment_info.tax_amount)||0,seller_service_fee:Math.abs(i.transactionHistoryDetail.payment_info.fees_and_charges.service_fee),shopee_rebate:Math.abs(i.transactionHistoryDetail.payment_info.rebate_and_voucher.product_discount_rebate_from_shopee),escrow_amount:Math.abs(i.transactionHistoryDetail.amount),needCheckactualShippingCost:Math.abs(i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf),items:this.getItems(i),apply_time:this.getApplyTime(i),log_current_status:i.ordeTrackingHistory.history[0].new_status,order_logistics_info:"",ckeckOrderSnKey:this.getCheckKey(i),checkOrderSnKeyNew:this.getCheckKeyNew(i)},a.push(n);return e.next=5,this.$api.uploadOrderSaveTest({orderData:a,sysMallId:this.mall.id,mallId:this.mall.platform_mall_id});case 5:if(s=e.sent,200!==s.data.code){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e["catch"](0);case 15:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"afterUpLoadOrders",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,r,i,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(e.prev=0,a=[],r=0;r<t.length;r++)i=t[r],n={return_detail_info:{buyer_images:i.refundDetail.buyer_images,return_pickup_address:i.refundDetail.return_pickup_address?i.refundDetail.return_pickup_address:"",return_address:i.refundDetail.return_address.address.replace("\n","")||"",requested_time:"",tracking_number:i.refundDetail.tracking_number||"",buyer:{portrait:i.buyer.portrait||"",shop_id:i.buyer.shop_id||"",followed:!0,id:i.buyer.id||"",name:i.buyer.name||""},return_delivery_time:""},return_id:i.return_id,return_sn:i.return_sn,order_id:i.order_id,return_channel_id:i.return_channel_id?i.return_channel_id:0,text_reason:i.refundDetail.text_reason,reason_id:i.refundDetail.reason,ctime:this.dealWithCtime(i),mtime:0,refund_amount:i.refund_amount,refund_total_price:i.amount_before_discount,status:i.status,closed_time:i.refundDetail.closed_time,return_item:this.dealWithReturnTime(i),ckeckAfterOrderSnKey:this.getCheckRefundKey(i)},a.push(n);return e.next=5,this.$api.uploadOrderAfterSale({afterOrderData:a,sysMallId:this.mall.id,mallId:this.mall.platform_mall_id});case 5:if(s=e.sent,200!==s.data.code){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:e.next=15;break;case 13:e.prev=13,e.t0=e["catch"](0);case 15:case"end":return e.stop()}}),e,this,[[0,13]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dealWithCtime",value:function(e){var t=0;if(e.return_header&&e.return_header.attribute_list&&e.return_header.attribute_list.return_attributes){var a=e.return_header.attribute_list.return_attributes.find((function(e){return"heimao_contact_by"===e.key}));t=a&&a.value||0}return t}},{key:"getCheckRefundKey",value:function(e){var t="";return t="".concat(e.return_id,"_").concat(e.status,"_").concat(e.mtime?e.mtime:0),t}},{key:"dealWithReturnTime",value:function(e){var t=[];return e.order_product_list.forEach((function(e){var a={price:e.model.price,modelid:e.model.id,sku:e.model.sku,itemid:e.product.id,id:e.product.id,price_before_discount:e.product.price};t.push(a)})),t}},{key:"getDeliveryTime",value:function(e){var t=0,a=_["u"].find((function(t){return t.ShipId==e.logistics_channel}));return a?(e.logistics_status>1&&(t=a.IsDeafult?e.logisticsTrackingHistory&&e.logisticsTrackingHistory.list[0]&&e.logisticsTrackingHistory.list[0].tracking_info&&e.logisticsTrackingHistory.list[0].tracking_info.length&&e.logisticsTrackingHistory.list[0].tracking_info[e.logisticsTrackingHistory.list[0].tracking_info.length-1].ctime||0:e.logisticsTrackingHistory&&e.logisticsTrackingHistory.list[0]&&e.logisticsTrackingHistory.list[0].tracking_info&&e.logisticsTrackingHistory.list[0].tracking_info.length>1&&e.logisticsTrackingHistory.list[0].tracking_info[e.logisticsTrackingHistory.list[0].tracking_info.length-1-1].ctime||0),t):t}},{key:"getTrackingNo",value:function(e){var t="",a=e.forderLogistics&&e.forderLogistics.list&&e.forderLogistics.list[0]&&e.forderLogistics.list[0].forders&&e.forderLogistics.list[0].forders[0].third_party_tn||"";return t=a||e.forderLogistics.list[0].consignment_no,t}},{key:"getTotalAmount",value:function(e){var t=0,a=e.transactionHistoryDetail.buyer_payment_info.merchant_subtotal||0,r=e.transactionHistoryDetail.buyer_payment_info.shipping_fee||0,i=e.transactionHistoryDetail.buyer_payment_info.import_tax||0,n=e.transactionHistoryDetail.buyer_payment_info.seller_voucher||0,s=e.transactionHistoryDetail.buyer_payment_info.shopee_coins_redeemed||0,o=e.transactionHistoryDetail.buyer_payment_info.shopee_voucher||0,c=e.transactionHistoryDetail.buyer_payment_info.credit_card_promotion||0;return t=Math.abs(a+r+i+n+s+o+c)||0,t}},{key:"getCheckKey",value:function(e){var t="",a=e.ordeTrackingHistory&&e.ordeTrackingHistory.history&&e.ordeTrackingHistory.history[0]&&e.ordeTrackingHistory.history[0].ctime||0,r=e.shipping_traceno||this.getTrackingNo(e),i=Math.abs(e.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf)||0,n=e&&e.ordeTrackingHistory&&e.ordeTrackingHistory.history&&e.ordeTrackingHistory.history[0]&&e.ordeTrackingHistory.history[0].new_status||"";return t=e.order_sn+"_"+e.status+"_"+e.status_ext+"_"+e.logistics_status+"_"+n+"_"+a+"_"+r+"_"+i,t}},{key:"getCheckKeyNew",value:function(e){var t="",a=e&&e.ordeTrackingHistory&&e.ordeTrackingHistory.history&&e.ordeTrackingHistory.history[0]&&e.ordeTrackingHistory.history[0].new_status||"",r=e&&e.transactionHistoryDetail&&e.transactionHistoryDetail.payment_info&&e.transactionHistoryDetail.payment_info.shipping_subtotal&&e.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf||0;return t=e.order_sn+"_"+e.status+"_"+e.status_ext+"_"+e.logistics_status+"_"+a+"_"+r,t}},{key:"getApplyTime",value:function(e){var t="";return 16===e.ordeTrackingHistory.history[0].new_status&&2===e.ordeTrackingHistory.history[0].old_status&&(t=e.ordeTrackingHistory.history[0].ctime),t}},{key:"getItems",value:function(e){var t=[];return e.order_items.forEach((function(e){var a=e.product,r=e.item_model,i=e.bundle_deal_product,n=e.bundle_deal_model,s=!0===e.is_wholesale?"1":"0",o=e.status,c=e.item_list||[],u=[],l=0,_=0;if(c.length)c.forEach((function(e){l+=e.item_price})),_=e.order_price/l,c.forEach((function(e){var t={actual_item_price:e.item_price*_,amount:e.amount,snapshotid:e.snapshot_id,modelid:e.model_id};u.push(t)}));else{var h={actual_item_price:e.order_price,amount:e.amount,snapshotid:e.snapshot_id,modelid:e.model_id};u.push(h)}u.forEach((function(e,c){var u=e["actual_item_price"],l=e["amount"],_=(e["snapshotid"],e["modelid"],""),h="",d="",m=[],p="0",g="0",y="0",f="",b="",k="";i.length>0?(_=i[c]["sku"],h=i[c]["name"],d=i[c]["cat_id"],m=i[c]["images"],p=i[c]["price_before_discount"],g=i[c]["item_id"],u=i[c]["price"],y=n[c]&&n[c]["model_id"]||"",f=n[c]&&n[c]["name"]||"",b=n[c]&&n[c]["sku"]||"",k=n[c]&&n[c]["ctime"]||""):(_=a["sku"],h=a["name"],d=a["cat_id"],m=a["images"],p=a["price_before_discount"],g=a["item_id"],y=r["model_id"],f=r["name"],b=r["sku"],k=r["ctime"]);var v={};v["is_wholesale"]=s.toString(),v["variation_quantity_purchased"]=l.toString(),v["item_sku"]=_.toString(),v["item_name"]=h.toString(),v["variation_id"]=y.toString(),v["variation_name"]=f.toString(),v["variation_sku"]=b.toString(),v["variation_discounted_price"]=u.toString(),v["variation_original_price"]=p.toString(),v["item_id"]=g.toString(),v["item_cat_id"]=d.toString(),v["item_images"]=m,v["weight"]=0,v["item_status"]=o.toString(),v["item_ctime"]=k.toString(),t.push(v)}))})),t}},{key:"delay",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var a=setTimeout((function(){clearTimeout(a),e(!0)}),t)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}()}}]);