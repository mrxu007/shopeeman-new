(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-accb4180"],{5551:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var i=a("1da1"),n=a("d4ec"),r=a("bee2"),o=(a("d3b7"),a("25f0"),a("96cf"),function(){function t(e){Object(n["a"])(this,t),this._this=e}return Object(r["a"])(t,[{key:"getDiscountNominate",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.item,t.prev=1,i={},i["limit"]=100,i["offset"]=a.offset,i["mallId"]=a.platform_mall_id,i["discount_id"]=a.discount_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/nominate/?",i);case 9:if(n=t.sent,r=this.isJsonString(this.isJsonString(n).data),!r||0!==r.code){t.next=15;break}return t.abrupt("return",{code:200,data:r.data});case 15:if(2!==r.code&&2!==r.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"查询折扣活动详情失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"查询折扣活动详情异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getByDiscountids",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,o,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.promotionid,n=e.limit,r=e.discountType,t.prev=1,o={},o["discount_id_list"]=i,o["discount_type"]=r,o["limit"]=n,o["offset"]=a.offset,o["mallId"]=a.platform_mall_id,t.next=10,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/get_by_discountids/?",o);case 10:if(s=t.sent,c=this.isJsonString(this.isJsonString(s).data),!c||0!==c.code){t.next=16;break}return t.abrupt("return",{code:200,data:c.data});case 16:if(2!==c.code&&2!==c.errcode){t.next=20;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 20:return t.abrupt("return",{code:-2,data:"获取列表数据失败"});case 21:t.next=26;break;case 23:return t.prev=23,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取列表数据异常： ".concat(t.t0)});case 26:case"end":return t.stop()}}),t,this,[[1,23]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getDiscountStandardSearch",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,o,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.keyword,n=e.searchType,r=e.discountType,t.prev=1,o={},o["keyword"]=i,o["search_type"]=n,"all"!==r&&(o["promotion_status"]=r),o["mallId"]=a.platform_mall_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/standard_search/?",o);case 9:if(s=t.sent,c=this.isJsonString(this.isJsonString(s).data),!c||0!==c.code){t.next=15;break}return t.abrupt("return",{code:200,data:c.data});case 15:if(2!==c.code&&2!==c.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"获取失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取promotionid数据异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getDiscountList",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,i,n,r,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.mItem,i=e.limit,n=e.discountType,t.prev=1,r={},r["limit"]=i,r["offset"]=a.offset,r["discount_type"]=n,r["mallId"]=a.platform_mall_id,t.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/list/?",r);case 9:if(o=t.sent,s=this.isJsonString(this.isJsonString(o).data),!s||0!==s.code){t.next=15;break}return t.abrupt("return",{code:200,data:s.data});case 15:if(2!==s.code&&2!==s.errcode){t.next=19;break}return t.abrupt("return",{code:201,data:"店铺未登录"});case 19:return t.abrupt("return",{code:-2,data:"获取失败"});case 20:t.next=25;break;case 22:return t.prev=22,t.t0=t["catch"](1),t.abrupt("return",{code:-2,data:"获取折扣列表数据异常： ".concat(t.t0)});case 25:case"end":return t.stop()}}),t,this,[[1,22]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"isJsonString",value:function(t){if("string"!==typeof t)return t;try{return JSON.parse(t),JSON.parse(t)}catch(e){return t}}},{key:"stopActive",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,i={},i["discount_id"]=e.discount_id.toString(),i["action"]=a,i["mallId"]=e.platform_mall_id,t.next=7,this._this.$shopeemanService.mixChinese(e.country,"/api/marketing/v3/discount/?",i,{Headers:{"Content-Type":" application/json"}},"delete");case 7:if(n=t.sent,r=n&&JSON.parse(n),!r||200!==r.status){t.next=18;break}if(o=JSON.parse(r.data),!o||0!==o.code){t.next=15;break}return t.abrupt("return",{code:200,data:o.data||[]});case 15:return t.abrupt("return",{code:50001,data:o.message||r.statusText||""});case 16:t.next=21;break;case 18:if(403!==r.status){t.next=20;break}return t.abrupt("return",{code:r.status,data:"操作失败，店铺未登录！"});case 20:return t.abrupt("return",{code:r.status,data:"操作失败".concat(r.statusText)});case 21:t.next=26;break;case 23:return t.prev=23,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 26:case"end":return t.stop()}}),t,this,[[0,23]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"createActive",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.postChinese(e,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}});case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"putActive",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.mixChinese(e,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"putModelActive",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){var i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._this.$shopeemanService.mixChinese(e,"/api/marketing/v3/discount/nominate/",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=t.sent,n=i&&JSON.parse(i),!n||200!==n.status){t.next=14;break}if(r=JSON.parse(n.data),!r||0!==r.code){t.next=11;break}return t.abrupt("return",{code:200,data:r.data||[]});case 11:return t.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 12:t.next=17;break;case 14:if(403!==n.status){t.next=16;break}return t.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 16:return t.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 17:t.next=22;break;case 19:return t.prev=19,t.t0=t["catch"](0),t.abrupt("return",{code:-2,data:"操作异常： ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[0,19]])})));function e(e,a){return t.apply(this,arguments)}return e}()}]),t}())},6185:function(t,e,a){"use strict";a("7566")},7566:function(t,e,a){},aa44:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"contaniner"},[a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"活动列表",name:"list"}},[a("el-row",{staticClass:"header"},[a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:t.changeMallList}})],1),a("ul",{staticStyle:{"margin-left":"20px"}},[a("li",[a("span",[t._v("活动状态：")]),a("el-select",{staticStyle:{width:"100px"},attrs:{disabled:t.isDisabled,size:"mini",filterable:""},model:{value:t.discountType,callback:function(e){t.discountType=e},expression:"discountType"}},[a("el-option",{attrs:{value:"all",label:"全部"}}),t._l(t.discountTypeList,(function(t,e){return a("el-option",{key:e,attrs:{value:t.value,label:t.label}})}))],2)],1),a("li",[a("el-input",{staticStyle:{width:"242px"},attrs:{disabled:t.isDisabled,size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.searchType,callback:function(e){t.searchType=e},expression:"searchType"}},t._l(t.searchTypeList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1)],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.queryData}},[t._v("搜 索")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.createNewActive}},[t._v("创建新的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.batchStopActive}},[t._v("批量结束活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.restartActivityDia}},[t._v("重新启动已过期的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isDisabled},on:{click:t.exportData}},[t._v("数据导出")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.clearLog}},[t._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"20px"},attrs:{disabled:t.isDisabled},model:{value:t.hideEnded,callback:function(e){t.hideEnded=e},expression:"hideEnded"}},[t._v("不显示过期活动")]),a("el-checkbox",{model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}},[t._v("隐藏日志")])],1)])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{ref:"plTable",attrs:{data:t.tableData,"use-virtual":"",height:660,"row-height":45,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":t.handleSelectionChange1}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺","min-width":"150",prop:"mallName"}}),a("u-table-column",{attrs:{align:"center",label:"活动ID","min-width":"150",prop:"discount_id"}}),a("u-table-column",{attrs:{align:"center",label:"活动名称","min-width":"150",prop:"title"}}),a("u-table-column",{attrs:{align:"center",label:"活动状态","min-width":"100",prop:"statusName"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{style:t.statusNameColor[i.statusName]&&"color:"+t.statusNameColor[i.statusName]},[t._v(" "+t._s(i.statusName)+" ")])]}}])}),a("u-table-column",{attrs:{sortable:"",align:"center",label:"商品数量","min-width":"100",prop:"total_product"}}),a("u-table-column",{attrs:{align:"center",label:"活动时间","min-width":"270"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t.$dayjs(a.start_time).format("MM/DD/YYYY HH:mm:ss")+" - "+t.$dayjs(a.end_time).format("MM/DD/YYYY HH:mm:ss"))+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"240"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,n=e.$index;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.searchDiscountDetail(i)}}},[t._v("查看详情")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.copyAndOpen(i.platform_mall_id,i.discount_id)}}},[t._v("复制")]),"进行中"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.stopActiveSingle(i,n,"stop")}}},[t._v("结束")]):t._e(),"即将开始"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.stopActiveSingle(i,n,"delete")}}},[t._v("删除")]):t._e()]}}])})],1),t.timeVisible?a("el-dialog",{staticClass:"time-dialog",attrs:{title:"选择时间",visible:t.timeVisible,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.timeVisible=e}}},[a("div",{staticClass:"content"},[a("span",[t._v("折扣促销时间：")]),a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"mini"},model:{value:t.promotionTime,callback:function(e){t.promotionTime=e},expression:"promotionTime"}})],1),a("div",{staticClass:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{size:"mini"},on:{click:function(e){t.timeVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.determineRestart}},[t._v("确 定")])],1)]):t._e()],1)],1),a("el-tab-pane",{attrs:{label:"活动编辑",name:"edit"}},[a("el-row",{staticClass:"header edit"},[t.activeRow.discount_id?t._e():a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:t.changeMallListEdit}})],1),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",[a("span",[t._v("活动名称：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeDicountName,callback:function(e){t.activeDicountName=e},expression:"activeDicountName"}})],1),a("li",[a("span",[t._v("活动时间：")]),a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",size:"mini",type:"datetimerange","unlink-panels":"","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.activeDate,callback:function(e){t.activeDate=e},expression:"activeDate"}})],1),a("li",[a("span",[t._v("商品编号：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeProductId,callback:function(e){t.activeProductId=e},expression:"activeProductId"}}),a("el-button",{staticStyle:{"margin-left":"21px"},attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.searchDetail}},[t._v("搜 索")])],1)]),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",{staticStyle:{"margin-right":"19px"}},[a("span",[t._v("活动折扣：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.activeDiscount,callback:function(e){t.activeDiscount=e},expression:"activeDiscount"}}),t._v("% ")],1),a("li",[a("span",[t._v("限购数量：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:t.limitNum,callback:function(e){t.limitNum=e},expression:"limitNum"}})],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.batchUpdateDiscount}},[t._v("批量修改折扣和限购")]),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.changeDiscountInfo}},[t._v("修改活动信息")]):t._e(),a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.addGoods}},[t._v("添加商品")]),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.addActiveTo}},[t._v("添加商品到已有活动")]):t._e(),t.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:function(e){return t.searchDiscountDetail(t.activeRow)}}},[t._v("获取活动已有物品")]):t._e(),t.activeRow.discount_id?t._e():a("el-button",{attrs:{type:"primary",size:"mini",disabled:t.btnLoading},on:{click:t.createActive}},[t._v("创建活动")]),a("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}},[t._v("隐藏日志")])],1)]),a("ul",{staticStyle:{margin:"0 0 0 20px"}},[a("span",{staticStyle:{color:"red"}},[t._v("折扣公式为：折扣价格=商品原价*折扣%。如原价100元的商品，输入80，最后的折扣价格为80元")])])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"editPlTable",attrs:{data:t.editTableData,"use-virtual":"",height:620,"row-height":68,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":t.handleSelectionChange2}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺名称","min-width":"150",prop:"platform_mall_name"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.mall_alias_name||e.row.platform_mall_name)+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"主图","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticStyle:{width:"32px",height:"32px",display:"inline-block"},attrs:{effect:"light",placement:"right-end","visible-arrow":!1,enterable:!1}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("el-image",{staticStyle:{width:"400px",height:"400px"},attrs:{src:t._f("imageRender")([e.row.image])}})],1),a("el-image",{staticStyle:{width:"32px",height:"32px"},attrs:{src:t._f("imageRender")([e.row.image,!0])}})],1)]}}])}),a("u-table-column",{attrs:{align:"center",label:"商品名称","min-width":"150",prop:"name","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"商品编号","min-width":"150",prop:"itemid"}}),a("u-table-column",{attrs:{align:"center",label:"商品规格","min-width":"150",prop:"skuName","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"原价",width:"120",prop:"normal_price"}}),a("u-table-column",{attrs:{align:"center",label:"售价",width:"120",prop:"promotion_price"}}),a("u-table-column",{attrs:{align:"center",label:"折扣",width:"120",prop:"discount"}}),a("u-table-column",{attrs:{align:"center",label:"购买限制","min-width":"150",prop:"user_item_limit"}}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.editStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.deleteEditGoods(e.row,e.$index)}}},[t._v("删 除")]):t._e(),e.row.deleteStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.deleteActiveGoods(e.row,e.$index)}}},[t._v("删除活动商品")]):t._e()]}}])})],1)],1)],1)],1),a("div",{staticClass:"logging"},[a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:t.showConsole,callback:function(e){t.showConsole=e},expression:"showConsole"}})],1),a("el-dialog",{attrs:{visible:t.goodsItemSelectorVisible,top:"7vh",title:"商品选择","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1280px"},on:{"update:visible":function(e){t.goodsItemSelectorVisible=e}}},[t.goodsItemSelectorVisible?a("goodsItemSelector",{attrs:{"is-need-filter-act":!0,mall:t.selectMallListEdit},on:{changeGoodsItem:t.changeGoodsItem}}):t._e()],1)],1)},n=[],r=a("1da1"),o=(a("96cf"),a("4de4"),a("a434"),a("c740"),a("159b"),a("99af"),a("b0c0"),a("a9e3"),a("b680"),a("ac1f"),a("1276"),a("3ca3"),a("ddb0"),a("7db0"),a("a15b"),a("d3b7"),a("25f0"),a("01cd")),s=a("0e0b"),c=a("feb6"),l=a("5551"),u={components:{StoreChoose:c["a"],goodsItemSelector:o["a"]},data:function(){return{activeName:"list",GoodsDiscount:new l["a"](this),showConsole:!0,promotionTime:[],timeVisible:!1,hideEnded:!0,limit:100,isDisabled:!1,keyword:"",searchType:"promotion_name",discountType:"all",selectMallList:[],selectMallListEdit:[],tableData:[],multipleSelection:[],endedActivityData:[],discountTypeList:[{value:"ongoing",label:"进行中"},{value:"upcoming",label:"即将开始"},{value:"ended",label:"已过期"}],searchTypeList:[{value:"promotion_name",label:"活动名称"},{value:"item_name",label:"商品名称"},{value:"item_id",label:"商品ID"}],statusNameColor:{"进行中":"green","即将开始":"orangered"},editTableData:[],editTableDataCopy:[],editMultipleSelection:[],activeDicountName:"",activeProductId:"",activeDate:"",activeRow:{},loading:!1,activeDiscount:"",limitNum:"",goodsItemSelectorVisible:!1,selectGoods:[],btnLoading:!1}},methods:{deleteActiveGoods:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i={discount_id:a.activeRow.discount_id,itemid:t.itemid,mallId:a.activeRow.platform_mall_id},e.next=3,a.$shopeemanService.deleteChinese(a.activeRow.country,"/api/marketing/v3/discount/nominate/",i,{headers:{"Content-Type":"application/json"}});case 3:if(n=e.sent,r=JSON.parse(n),200!==r.status){e.next=15;break}if(o=JSON.parse(r.data),!o||0!==o.code){e.next=12;break}a.$message.success("删除成功"),a.editTableData=a.editTableData.filter((function(e){return e.itemid!==t.itemid})),e.next=13;break;case 12:return e.abrupt("return",a.$message.warning("删除商品失败,".concat(o.message)));case 13:e.next=20;break;case 15:if(403!==r.status){e.next=19;break}return e.abrupt("return",a.$message.warning("删除商品失败，店铺未登录！"));case 19:return e.abrupt("return",a.$message.warning("删除商品失败！"));case 20:case"end":return e.stop()}}),e)})))()},deleteEditGoods:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:a.editTableData.splice(e,1),n=a.editTableDataCopy.findIndex((function(e){return e.itemid===t.itemid})),a.editTableDataCopy.splice(n,1);case 3:case"end":return i.stop()}}),i)})))()},addActiveTo:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.editTableData.filter((function(t){return 1===t.editStatus})),a.length){e.next=3;break}return e.abrupt("return",t.$message.warning("没有可添加的商品！"));case 3:t.showConsole=!1,i=t.activeRow.discount_id,t.loading=!0,a.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.searchProductDetail(a.itemid,a.platform_mall_id,a.country);case 2:if(n=e.sent,!n.length){e.next=8;break}return e.next=6,t.setModelActive(n,a.platform_mall_id,a.country,a.itemid,i,a.platform_mall_name);case 6:r=e.sent,r&&(o=t.editTableData.findIndex((function(t){return t.itemid==a.itemid})),s=t.editTableDataCopy.findIndex((function(t){return t.itemid==a.itemid})),t.$set(t.editTableData[o],"editStatus",2),t.$set(t.editTableDataCopy[s],"editStatus",2),t.$nextTick((function(){t.$refs.editPlTable.toggleRowSelection([{row:t.editTableData[o],selected:!1}])})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.loading=!1;case 8:case"end":return e.stop()}}),e)})))()},copyAndOpen:function(t,e){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:n={type:"route",shopId:t,route:"https://seller.th.shopee.cn/portal/marketing/discount/create?from=".concat(e)},a.$BaseUtilService.getOrderDetailInfo(t,JSON.stringify(n));case 2:case"end":return i.stop()}}),i)})))()},addGoods:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs.editPlTable.clearSelection(),t.activeDiscount&&t.limitNum){e.next=3;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 3:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=5;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 5:if(t.activeDicountName){e.next=7;break}return e.abrupt("return",t.$message.warning("活动名称不能为空"));case 7:if(t.activeDate&&t.activeDate.length){e.next=9;break}return e.abrupt("return",t.$message.warning("请选择活动时间"));case 9:t.goodsItemSelectorVisible=!0;case 10:case"end":return e.stop()}}),e)})))()},createActive:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.activeDiscount&&t.limitNum){e.next=2;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=4;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 4:if(t.selectGoods.length){e.next=6;break}return e.abrupt("return",t.$message.warning("请先选择商品！"));case 6:if(t.activeDate&&t.activeDate.length){e.next=8;break}return e.abrupt("return",t.$message.warning("请先选择活动时间！"));case 8:t.showConsole=!1,t.btnLoading=!0,t.$refs.Logs.writeLog("开始创建活动",!0),t.selectMallListEdit.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a,i){var n,o,s,c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Math.round(new Date(t.activeDate[0]).getTime()/1e3),o=Math.round(new Date(t.activeDate[1]).getTime()/1e3),e.prev=2,s={fe_status:"upcoming",highlight:"",title:t.activeDicountName,start_time:n,end_time:o,status:1,mallId:a.platform_mall_id},e.next=6,t.GoodsDiscount.createActive(a.country,s);case 6:c=e.sent,200===c.code?(t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】,创建活动【").concat(t.activeDicountName,"】成功"),!0),l=c.data.discount_id,u=t.selectGoods.filter((function(t){return t.platform_mall_id==a.platform_mall_id})),u.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(i){var n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.searchProductDetail(i.itemid,i.platform_mall_id,i.country);case 2:n=e.sent,n.length&&(r=t.setModelActive(n,a.platform_mall_id,a.country,i.itemid,l,a.platform_mall_name),r&&(o=t.editTableData.findIndex((function(t){return t.itemid==i.itemid})),s=t.editTableDataCopy.findIndex((function(t){return t.itemid==i.itemid})),t.$set(t.editTableData[o],"editStatus",2),t.$set(t.editTableDataCopy[s],"editStatus",2),t.$nextTick((function(){t.$refs.editPlTable.toggleRowSelection([{row:t.editTableData[o],selected:!1}])}))));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())):403===c.code?t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】创建活动失败,店铺未登录"),!1):t.$refs.Logs.writeLog("店铺【".concat(a.mall_alias_name||a.platform_mall_name,"】创建活动失败,").concat(c.data),!1),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),t.btnLoading=!1;case 13:i===t.selectMallListEdit.length-1&&(t.btnLoading=!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,a){return e.apply(this,arguments)}}());case 12:case"end":return e.stop()}}),e)})))()},setModelActive:function(t,e,a,i,n,o){var s=this;return Object(r["a"])(regeneratorRuntime.mark((function r(){var c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return c=[],t.forEach((function(t){var a={discount:100-s.activeDiscount,itemid:i,model_name:t.name,modelid:t.id,price_before_discount:Number(t.price),promotion_price:Number((t.price*s.activeDiscount/100).toFixed(16)),promotionid:n,selected:!0,shopid:Number(e),status:1,total_item_limit:0,user_item_limit:s.limitNum};c.push(a)})),l={discount_id:n,discount_model_list:c,mallId:e},r.next=5,s.GoodsDiscount.putModelActive(a,l);case 5:if(u=r.sent,200!==u.code){r.next=15;break}return d=s.editTableData.findIndex((function(t){return t.itemid==i})),s.$set(s.editTableData[d],"discount",1-s.activeDiscount/100),s.$set(s.editTableData[d],"promotion_price_after_tax",Number((s.activeDiscount/100*s.editTableData[d].price).toFixed(1))),s.$set(s.editTableData[d],"user_item_limit",s.limitNum),s.$refs.Logs.writeLog("店铺【".concat(o,"】,商品【").concat(i,"】创建活动成功"),!0),r.abrupt("return",!0);case 15:return u.data.indexOf("some item has participated in promotion")>-1?s.$refs.Logs.writeLog("店铺【".concat(o,"】,添加商品【").concat(i,"】至活动失败,商品已参加活动不能再此参加"),!0):s.$refs.Logs.writeLog("店铺【".concat(o,"】,添加商品【").concat(i,"】至活动失败,").concat(u.data?u.data:""),!1),r.abrupt("return",!1);case 17:case"end":return r.stop()}}),r)})))()},searchProductDetail:function(t,e,a){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={product_id:t,version:"3.2.0",shop_id:e},n.next=3,i.$shopeemanService.searchProductDetail(a,r);case 3:if(o=n.sent,200!==o.code){n.next=8;break}return n.abrupt("return",o.data.model_list);case 8:return n.abrupt("return",[]);case 9:case"end":return n.stop()}}),n)})))()},changeGoodsItem:function(t){var e=this;this.selectGoods=t.goodsList,t.goodsList.forEach((function(t){t.promotion_price=(t.price*(e.activeDiscount/100)).toFixed(2),t.discount=(1-e.activeDiscount/100).toFixed(2),t.image=t.images.split(",")[0],t.editStatus=1,t.normal_price=t.price})),this.editTableData=t.goodsList.concat(this.editTableData),Object(s["y"])(1e3),t.goodsList.forEach((function(t){e.$nextTick((function(){e.$refs.editPlTable.toggleRowSelection([{row:t,selected:!0}])}))})),this.editMultipleSelection=t.goodsList,this.editTableDataCopy=JSON.parse(JSON.stringify(this.editTableData)),this.goodsItemSelectorVisible=!1},batchUpdateDiscount:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.activeDiscount&&t.limitNum){e.next=2;break}return e.abrupt("return",t.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(t.activeDiscount<0||t.activeDiscount>100||t.limitNum<0||t.activeDiscount%1!==0)){e.next=4;break}return e.abrupt("return",t.$message.warning("折扣信息或限购数量有误！"));case 4:if(t.editMultipleSelection.length){e.next=6;break}return e.abrupt("return",t.$message.warning("请先勾选数据！"));case 6:t.editMultipleSelection.forEach((function(e){t.$set(e,"discount",(1-t.activeDiscount/100).toFixed(2)),t.$set(e,"promotion_price",Number((t.activeDiscount/100*e.normal_price).toFixed(1))),t.$set(e,"user_item_limit",t.limitNum);var a=t.editTableData.findIndex((function(t){return t.modelid==e.modelid})),i=t.editTableDataCopy.findIndex((function(t){return t.modelid==e.modelid}));a>-1&&(t.$set(t.editTableData[a],"discount",(1-t.activeDiscount/100).toFixed(2)),t.$set(t.editTableData[a],"promotion_price",Number((t.activeDiscount/100*e.normal_price).toFixed(1))),t.$set(t.editTableData[a],"user_item_limit",t.limitNum)),i>-1&&(t.editTableDataCopy[i].discount=(1-t.activeDiscount/100).toFixed(2),t.editTableDataCopy[i].promotion_price=Number((t.activeDiscount/100*e.normal_price).toFixed(1)),t.editTableDataCopy[i].user_item_limit=t.limitNum)}));case 7:case"end":return e.stop()}}),e)})))()},updateDiscount:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.editMultipleSelection.length){e.next=3;break}return t.$refs.Logs.writeLog("没有要修改的折扣信息",!0),e.abrupt("return");case 3:return a=[],t.editMultipleSelection.forEach((function(e){var i={itemid:e.itemid,modelid:e.modelid,promotion_price:Number((t.activeDiscount/100*e.normal_price).toFixed(1)),user_item_limit:Number(t.limitNum),status:e.status};a.push(i)})),i={discount_id:t.activeRow.discount_id,discount_model_list:a,mallId:t.activeRow.platform_mall_id},t.showConsole=!1,e.next=9,t.GoodsDiscount.putModelActive(t.activeRow.country,i);case 9:n=e.sent,200===n.code?(t.$refs.Logs.writeLog("修改折扣信息成功",!0),t.$refs.editPlTable.clearSelection()):t.$refs.Logs.writeLog("修改折扣信息失败：".concat(n.data),!1);case 11:case"end":return e.stop()}}),e)})))()},changeDiscountInfo:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new Date(t.activeDate[0]).getTime(),i=new Date(t.activeDate[1]).getTime(),(a<t.activeRow.start_time||a>t.activeRow.end_time)&&t.$alert("开始时间要晚于".concat(t.$dayjs(t.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss"),"，早于").concat(t.$dayjs(t.activeRow.end_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i<t.activeRow.start_time||i>t.activeRow.end_time)&&t.$alert("结束时间要早于".concat(t.$dayjs(t.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i-a)/1e3/60/60<1&&t.$alert("活动时间不得小于1小时","提示",{confirmButtonText:"确定"}),n={status:t.activeRow.status,title:t.activeDicountName,start_time:Math.round(a/1e3),discount_id:t.activeRow.discount_id,source:t.activeRow.source,end_time:Math.round(i/1e3),mallId:t.activeRow.platform_mall_id},e.next=8,t.GoodsDiscount.putActive(t.activeRow.country,n);case 8:r=e.sent,200===r.code?t.$refs.Logs.writeLog("修改活动信息成功",!0):t.$refs.Logs.writeLog("修改活动信息失败：".concat(r.data),!1),t.updateDiscount();case 11:case"end":return e.stop()}}),e)})))()},createNewActive:function(){var t=(new Date).getTime()+6e5,e=t+72e5;this.activeName="edit",this.activeRow={},this.editTableData=[],this.editTableDataCopy=[],this.activeDicountName="",this.selectGoods=[],this.activeDate=[this.$dayjs(t).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(e).format("YYYY-MM-DD HH:mm:ss")]},searchDetail:function(){var t=this;this.activeProductId?this.editTableData=this.editTableDataCopy.filter((function(e){return e.itemid==t.activeProductId})):this.editTableData=this.editTableDataCopy},searchDiscountDetail:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.activeName="edit",e.activeRow=t,e.activeDicountName=t.title,e.activeDate=[e.$dayjs(t.start_time).format("YYYY-MM-DD HH:mm:ss"),e.$dayjs(t.end_time).format("YYYY-MM-DD HH:mm:ss")],e.activeDiscount="",e.limitNum="",e.editTableData=[],e.selectMallListEdit=[{country:t.country,platform_mall_name:t.platform_mall_name,platform_mall_id:t.platform_mall_id,id:t.mallId,mall_alias_name:t.mall_alias_name,group_id:0,group_name:"",mall_type:1}],e.btnLoading=!0,a.next=11,e.getDiscountDetail(t);case 11:e.btnLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},getDiscountDetail:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.loading=!0,a.prev=1,a.delegateYield(regeneratorRuntime.mark((function a(){var i,n,r,o,s,c,l,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=100,n={limit:i,offset:0,discount_id:t.discount_id,platform_mall_id:t.platform_mall_id,country:t.country},a.next=4,e.GoodsDiscount.getDiscountNominate({item:n});case 4:r=a.sent,o=200===r.code&&r.data.item_info||[],s=r.data.model_info||{},c=r.data.discount_item_list||[],l=r.data.price_stock_info||[];case 9:if(!o.length){a.next=25;break}if(o.forEach((function(a){s[a.itemid]&&s[a.itemid].length&&s[a.itemid].forEach((function(i){var n=JSON.parse(JSON.stringify(a)),r=c.find((function(t){return t.itemid===a.itemid&&t.modelid===i.modelid})),o=l.find((function(t){return t.item_id===a.itemid})),s=o.sku_stock_price_list.find((function(t){return t.model_id===i.modelid})),u=Object.assign(n,i,r,s.price_info);u.price=i.price,u.name=a.name,u.skuName=i.name,u.image=a.images.split(",")[0],u.platform_mall_name=t.mallName,u.country=t.country,u.platform_mall_id=t.platform_mall_id,u.promotion_price=r?r.promotion_price:0,u.discount=s&&s.price_info?(1-u.promotion_price/u.normal_price).toFixed(2):"";var d=e.editTableData.findIndex((function(t){return t.deleteStatus&&u.itemid===t.itemid}));d<0&&(u.deleteStatus=!0),e.editTableData.push(u)}))})),!(o.length<100)){a.next=15;break}o=[],a.next=23;break;case 15:return n.offset+=i,a.next=18,e.GoodsDiscount.getDiscountNominate({item:n});case 18:u=a.sent,o=200===u.code&&u.data.item_info||[],s=200===u.code&&u.data.model_info||{},c=200===u.code&&u.data.discount_item_list||[],l=200===u.code&&u.data.price_stock_info||[];case 23:a.next=9;break;case 25:e.editTableDataCopy=JSON.parse(JSON.stringify(e.editTableData)),e.$refs.Logs.writeLog("获取详情结束,".concat(e.editTableData.length,"条"),!0),e.loading=!1;case 28:case"end":return a.stop()}}),a)}))(),"t0",3);case 3:a.next=8;break;case 5:a.prev=5,a.t1=a["catch"](1),e.loading=!1;case 8:case"end":return a.stop()}}),a,null,[[1,5]])})))()},batchStopActive:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.multipleSelection.length){e.next=2;break}return e.abrupt("return",t.$message.warning("请先选择数据！"));case 2:t.showConsole=!1,t.$refs.Logs.consoleMsg="",t.$refs.Logs.writeLog("请在执行操作，请稍等",!0),t.multipleSelection.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(a){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!((new Date).getTime()-a.start_time<36e5)){e.next=4;break}t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：折扣活动开始一小时后才能结束！"),!1),e.next=8;break;case 4:return e.next=6,t.GoodsDiscount.stopActive(a,"stop");case 6:i=e.sent,200===i.code?(n=t.tableData.findIndex((function(t){return t.discount_id==a.discount_id})),t.$set(t.tableData[n],"statusName","已过期"),t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动成功"),!0)):t.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：").concat(i.data),!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})))()},stopActiveSingle:function(t,e,a){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("stop"!==a){n.next=3;break}if(!((new Date).getTime()-t.start_time<36e5)){n.next=3;break}return n.abrupt("return",i.$message.warning("折扣活动开始一小时后才能结束！"));case 3:return i.showConsole=!1,i.$refs.Logs.writeLog("请在执行操作，请稍等",!0),n.next=7,i.GoodsDiscount.stopActive(t,a);case 7:r=n.sent,200===r.code?("delete"===a?i.tableData.splice(e,1):i.$set(i.tableData[e],"statusName","已过期"),i.$refs.Logs.writeLog("活动【".concat(t.title,"-").concat(t.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动成功"),!0)):i.$refs.Logs.writeLog("活动【".concat(t.title,"-").concat(t.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动失败：").concat(r.data),!1);case 9:case"end":return n.stop()}}),n)})))()},exportData:function(){var t=this;if(!this.multipleSelection.length)return this.$message.warning("请选择要导出的数据！");var e=1,a="<tr>\n            <td>编号</td>\n            <td>店铺</td>\n            <td>活动ID</td>\n            <td>活动名称</td>\n            <td>活动状态</td>\n            <td>商品数量</td>\n            <td>活动时间</td>\n            </tr>";this.multipleSelection.forEach((function(i){a+="<tr><td>".concat(e++,"</td>\n        <td>").concat(i.mallName?"".concat(i.country,"-").concat(i.mallName):"\t","</td>\n        <td>").concat(i.discount_id?i.discount_id:"\t","</td>\n        <td>").concat(i.title?i.title:"\t","</td>\n        <td>").concat(i.statusName?i.statusName:"\t","</td>\n        <td>").concat(i.total_product?i.total_product:"\t","</td>\n        <td>").concat(i.start_time&&i.end_time?"".concat(t.$dayjs(i.start_time).format("MM/DD/YYYY HH:mm:ss")," - ").concat(t.$dayjs(i.end_time).format("MM/DD/YYYY HH:mm:ss")):"\t","</td>\n        </tr>\n        ")})),Object(s["j"])("商品折扣活动数据",a)},clearLog:function(){this.$refs.Logs.consoleMsg=""},restartActivityDia:function(){this.endedActivityData=[];for(var t=0;t<(null===(e=this.multipleSelection)||void 0===e?void 0:e.length);t++){var e,a=this.multipleSelection[t];"已过期"===a.statusName&&this.endedActivityData.push(a)}if(!this.endedActivityData.length)return this.$message("请选择已过期活动执行此操作");this.timeVisible=!0,this.promotionTime=[(new Date).getTime()+18e5,(new Date).getTime()+54e5]},determineRestart:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==(a=t.promotionTime)&&void 0!==a&&a.length){e.next=2;break}return e.abrupt("return",t.$message.warning("请选择折扣促销时间"));case 2:return t.timeVisible=!1,t.isDisabled=!0,t.$refs.Logs.writeLog("开始重启已过期的活动，请耐心等待！",!0),t.endedActivityData.forEach((function(t){t.offset=0,t.mList=[]})),t.showConsole=!1,e.next=9,Object(s["c"])(t.endedActivityData,t.restartActivity);case 9:t.isDisabled=!1;case 10:case"end":return e.stop()}}),e)})))()},restartActivity:function(t){var e=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,o,s,c,l,u,d,m,p,f,b,g,h,v,_,w,x,D,y,k,L,S,$,T,N,R,M;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e.length>1&&void 0!==e[1]?e[1]:{count:1},r=Math.round(new Date(a.promotionTime[0]).getTime()/1e3),o=Math.round(new Date(a.promotionTime[1]).getTime()/1e3),s=null,i.prev=4,c={},c["item"]=t,i.next=9,a.GoodsDiscount.getDiscountNominate(c);case 9:if(l=i.sent,200===l.code){i.next=12;break}return i.abrupt("return",a.$refs.Logs.writeLog("获取【".concat(t.title,"】【").concat(t.discount_id,"】错误：").concat(l.data),!1));case 12:u=l.data.item_info,d=l.data.discount_item_list,m=l.data.model_info,p=[],f=[],b={};case 18:if(!u.length){i.next=35;break}if(f=f.concat(u),p=p.concat(d),b=Object.assign(b,m),!(u.length<100)){i.next=26;break}u=[],i.next=33;break;case 26:return c.item.offset+=100,i.next=29,a.GoodsDiscount.getDiscountNominate(c);case 29:g=i.sent,u=200===g.code?g.data.item_info:[],d=200===g.code?g.data.discount_item_list:[],m=200===g.code?g.data.model_info:{};case 33:i.next=18;break;case 35:return a.$refs.Logs.writeLog("获取【".concat(t.title,"】【").concat(t.discount_id,"】详情结束，共").concat(f.length,"件商品"),!0),h=f.filter((function(t){return 1===t.status})),v=[],h.forEach((function(t){v.push(t.itemid)})),_={end_time:o,item_id_list:v,start_time:r,mallId:t.platform_mall_id},i.next=42,a.$shopeemanService.overlapDiscount(t.country,_);case 42:if(w=i.sent,200!==w.code){i.next=68;break}if(w.data.fail_main_items.length&&(x=[],w.data.fail_main_items.forEach((function(t){x.push(t.item_id)})),a.$refs.Logs.writeLog("活动【".concat(t.title,"】,商品【").concat(x.join(","),"】已经参加了活动，不能再重复参加"),!0)),!w.data.succ_main_items.length){i.next=65;break}return D={discount_id:null,end_time:o,start_time:r,source:0,status:1,title:t.title,mallId:t.platform_mall_id},i.next=49,a.GoodsDiscount.createActive(t.country,D);case 49:if(y=i.sent,200!==y.code){i.next=55;break}s=y.data.discount_id,a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】成功，开始添加活动商品"),!0),i.next=56;break;case 55:return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】失败,").concat(y.data),!0));case 56:return k=[],w.data.succ_main_items.forEach((function(t){for(var e=b[t.item_id],a=function(a){var i=e[a],n=p.find((function(e){return e.itemid===t.item_id&&e.modelid===i.modelid}));if(!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:t.item_id.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};k.push(r)},i=0;i<e.length;i++)a(i)})),L={discount_id:s,discount_model_list:k,mallId:t.platform_mall_id},i.next=61,a.GoodsDiscount.putModelActive(t.country,L);case 61:S=i.sent,200===S.code?a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(t.title,"】重启失败,重启添加商品失败").concat(S.data),!0),i.next=66;break;case 65:a.$refs.Logs.writeLog("活动【".concat(t.title,"】重启失败,无可重启商品"),!0);case 66:i.next=85;break;case 68:return $={discount_id:null,end_time:o,start_time:r,source:0,status:1,title:t.title,mallId:t.platform_mall_id},i.next=71,a.GoodsDiscount.createActive(t.country,$);case 71:if(T=i.sent,200!==T.code){i.next=77;break}s=T.data.discount_id,a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】成功，开始添加活动商品"),!0),i.next=78;break;case 77:return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(t.mallName,"】,创建活动【").concat(t.title,"】失败,").concat(T.data),!0));case 78:return N=[],f.forEach((function(t){for(var e=b[t.itemid],a=function(a){var i=e[a],n=p.find((function(e){return e.itemid===t.itemid&&e.modelid===i.modelid}));if(!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:t.itemid.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};N.push(r)},i=0;i<e.length;i++)a(i)})),R={discount_id:s,discount_model_list:N,mallId:t.platform_mall_id},i.next=83,a.GoodsDiscount.putModelActive(t.country,R);case 83:M=i.sent,200===M.code?a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(t.title,"】,重启添加商品失败").concat(M.data),!0);case 85:i.next=89;break;case 87:i.prev=87,i.t0=i["catch"](4);case 89:return i.prev=89,--n.count,i.finish(89);case 92:case"end":return i.stop()}}),i,null,[[4,87,89,92]])})))()},queryData:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.selectMallList.length){e.next=2;break}return e.abrupt("return",t.$message("请选择店铺"));case 2:return t.isDisabled=!0,t.showConsole=!1,t.tableData=[],t.$refs.Logs.consoleMsg="",t.$refs.Logs.writeLog("开始查询",!0),t.selectMallList.forEach((function(t){t.offset=0,t.mList=[]})),e.next=10,Object(s["c"])(t.selectMallList,t.getDiscountList);case 10:t.$refs.Logs.writeLog("查询结束",!0),t.isDisabled=!1;case 12:case"end":return e.stop()}}),e)})))()},getDiscountList:function(t){var e=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,o,s,c,l,u,d,m,p,f,b,g,h;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>1&&void 0!==e[1]?e[1]:{count:1},r="",o=0,s="",r=t.mall_alias_name||t.platform_mall_name,c={},c["mItem"]=t,c["discountType"]=a.discountType,c["limit"]=a.limit,i.prev=9,l=[],!a.keyword){i.next=22;break}return c["keyword"]=a.keyword,c["searchType"]=a.searchType,i.next=16,a.GoodsDiscount.getDiscountStandardSearch(c);case 16:if(p=i.sent,200===p.code){i.next=19;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(p.data),!1));case 19:if(null!==(u=p.data)&&void 0!==u&&u.hits&&!((null===(d=p.data)||void 0===d||null===(m=d.hits)||void 0===m?void 0:m.length)<=0)){i.next=21;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】共查询到【0】条数据"),!0));case 21:p.data.hits.forEach((function(t){l.push(t.promotionid)}));case 22:if(!(a.keyword&&(null===l||void 0===l?void 0:l.length)>0)){i.next=29;break}return c["promotionid"]=l,i.next=26,a.GoodsDiscount.getByDiscountids(c);case 26:s=i.sent,i.next=32;break;case 29:return i.next=31,a.GoodsDiscount.getDiscountList(c);case 31:s=i.sent;case 32:if(200===s.code){for(o=s.data.total_count,f=0;f<s.data.discount_list.length;f++)b=s.data.discount_list[f],b.mallName=r,b.start_time=1e3*b.start_time,b.end_time=1e3*b.end_time,b.country=t.country,b.platform_mall_id=t.platform_mall_id,b.mall_alias_name=t.mall_alias_name,b.platform_mall_name=t.platform_mall_name,b.mallId=t.id,g=(new Date).getTime(),b.start_time>g?b.statusName="即将开始":b.end_time<g?b.statusName="已过期":b.statusName="进行中";t.mList=t.mList.concat(s.data.discount_list),h=s.data.discount_list,a.hideEnded&&(h=s.data.discount_list.filter((function(t){return"已过期"!==t.statusName}))),a.tableData=a.tableData.concat(h)}else a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(s.data),!1);t.offset+=a.limit;case 34:if(t.mList.length<o&&0!==o){i.next=22;break}case 35:a.$refs.Logs.writeLog("查询店铺【".concat(r,"】活动数据结束"),!0),i.next=41;break;case 38:i.prev=38,i.t0=i["catch"](9),a.$refs.Logs.writeLog("店铺【".concat(r,"】异常：").concat(i.t0),!1);case 41:return i.prev=41,--n.count,i.finish(41);case 44:case"end":return i.stop()}}),i,null,[[9,38,41,44]])})))()},filterData:function(t){for(var e=[],a=0;a<t.length;a++){var i=t[a];this.hideEnded&&"已过期"===i.statusName||e.push(i)}return e},handleClick:function(t,e){if("edit"===this.activeName){var a=(new Date).getTime()+6e5,i=a+72e5;this.activeDate=[this.$dayjs(a).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(i).format("YYYY-MM-DD HH:mm:ss")]}},handleSelectionChange1:function(t){this.multipleSelection=t},handleSelectionChange2:function(t){this.editMultipleSelection=t},changeMallListEdit:function(t){this.selectMallListEdit=t,this.country=t.country},changeMallList:function(t){this.selectMallList=t,this.country=t.country}}},d=u,m=(a("6185"),a("2877")),p=Object(m["a"])(d,i,n,!1,null,"0621a660",null);e["default"]=p.exports}}]);