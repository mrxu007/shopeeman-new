(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d10678e"],{"0098":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r("1da1"),a=r("d4ec"),i=r("bee2"),o=r("ade3"),s=(r("96cf"),r("4de4"),r("159b"),r("99af"),r("c740"),r("7db0"),r("a9e3"),r("d3b7"),r("25f0"),r("caad"),r("2532"),r("5b81"),r("ac1f"),r("1276"),r("466d"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a9"),r("72f7"),r("5319"),r("3ca3"),r("ddb0"),r("fb6a"),r("bda5")),c=r("5f91"),l=r("b5e1"),u=r("a91f"),d=r("1431"),h=r.n(d),p=r("0e0b"),g=r("bcd0"),f=function(){function e(t,r){Object(a["a"])(this,e),Object(o["a"])(this,"$api",s["a"]),Object(o["a"])(this,"$shopeemanService",new c["a"]),Object(o["a"])(this,"$commodityService",new l["a"]),Object(o["a"])(this,"$appConfig",new u["a"]),Object(o["a"])(this,"isStop",!1),Object(o["a"])(this,"_this",null),Object(o["a"])(this,"pageSize",40),Object(o["a"])(this,"writeLog",void 0),Object(o["a"])(this,"orders",[]),Object(o["a"])(this,"schemaType",""),Object(o["a"])(this,"activeType","handle"),Object(o["a"])(this,"isAuto",!1),Object(o["a"])(this,"isApplyForceFaceInfo",!1),this._this=t,this.writeLog=r}return Object(i["a"])(e,[{key:"autoStart",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getEmptyTrackingNoOrder();case 6:if(t=e.sent,200!==t.data.code){e.next=24;break}if(r=t.data.data||[],n=r.filter((function(e){return"TW"!=e.country})),n.length){e.next=12;break}return e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-目前没有要同步的订单！",!1));case 12:this.writeLog("一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 14:if(!(a<n.length)){e.next=21;break}return i=n[a],e.next=18,this.autoMainFlow(i);case 18:a++,e.next=14;break;case 21:this.writeLog("自动同步物流-面单完成",!0),e.next=25;break;case 24:this.writeLog("【自动同步物流-面单】，终止-获取待同步物流订单数据失败",!1);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-".concat(e.t0),!1));case 31:case"end":return e.stop()}}),e,this,[[2,27]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoStartStore",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getNotHaveLogisticsInformations();case 6:if(t=e.sent,console.log(t,"0000000"),200!==t.data.code){e.next=26;break}if(r=t.data.data||[],n=[],r.forEach((function(e){e.orders.forEach((function(t){t.platform_mall_id=e.platform_mall_id,n.push(t)}))})),n.length){e.next=14;break}return e.abrupt("return",this.writeLog("【自动同步仓库中没有面单-面单】，终止-目前没有要同步的订单！",!1));case 14:this.writeLog("【仓库中没有面单】一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 16:if(!(a<n.length)){e.next=23;break}return i=n[a],e.next=20,this.autoMainFlow(i);case 20:a++,e.next=16;break;case 23:this.writeLog("自动仓库中没有面单完成",!0),e.next=27;break;case 26:this.writeLog("【自动仓库中没有面单】，终止获取数据失败",!1);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动仓库中没有面单】，终止-".concat(e.t0),!1));case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoStartNoLogi",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getNoLogisticsOrders();case 6:if(t=e.sent,console.log(t,"0000000"),200!==t.data.code){e.next=26;break}if(r=t.data.data||[],n=[],r.forEach((function(e){e.orders.forEach((function(t){t.platform_mall_id=e.platform_mall_id,n.push(t)}))})),n.length){e.next=14;break}return e.abrupt("return",this.writeLog("【自动同步订单中没有面单-面单】，终止-目前没有要同步的订单！",!1));case 14:this.writeLog("【订单中没有面单】一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 16:if(!(a<n.length)){e.next=23;break}return i=n[a],e.next=20,this.autoMainFlow(i);case 20:a++,e.next=16;break;case 23:this.writeLog("自动同步物流-面单完成",!0),e.next=27;break;case 26:this.writeLog("【自动同步物流-面单】，终止-获取待同步物流订单数据失败",!1);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-".concat(e.t0),!1));case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoMainFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,s,c,l,u,d,h,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("TW"!==t.country){e.next=2;break}return e.abrupt("return",this.writeLog("自动流程不同步台湾站面单",!1));case 2:if(console.log(t,"4244242425432"),r=t.platform_mall_id||(t.mall_info?t.mall_info.platform_mall_id:""),n=t.sys_mall_id||(t.mall_info?t.mall_info.id:"")||"",a=t.order_id||t.platform_order_id,i=t.country||"",o=t.order_sn||t.main_order_sn||t.platform_order_sn,e.prev=8,s=null,0!=a&&a){e.next=19;break}return c={keyword:o,shop_id:r},e.next=14,this.$shopeemanService.getOrderHint(i,c);case 14:l=e.sent,console.log(l,"getOrderHint"),s=200===l.code&&l.data&&l.data.orders&&l.data.orders.length&&l.data.orders[0]||null,e.next=24;break;case 19:return u={order_id:a,shop_id:r},e.next=22,this.$shopeemanService.getDetailsSinger(i,u);case 22:d=e.sent,s=200===d.code&&d.data||null;case 24:if(console.log(s,"orderInfo",t),s){e.next=28;break}return this.writeLog("订单【".concat(o,"】同步面单失败,获取订单详情失败,请检查店铺登录状态！"),!1),e.abrupt("return");case 28:return e.next=30,this.checkTrackInfo(s,i);case 30:if(h=e.sent,console.log(h,"trackInfo"),!h.trackingNo){e.next=39;break}return e.next=35,this.uploadTrackingNo(n,r,o,h.trackingNo,h.logistics_channel);case 35:return e.next=37,this.getPrintInfoFlow(n,s,i,h.trackingNo);case 37:e.next=50;break;case 39:return e.next=41,this.applyOrderTrackingNo(a,r,s.logistics_channel,i,n,o);case 41:if(p=e.sent,console.log("applyInfo",p),200!==p.code){e.next=48;break}return e.next=46,this.getPrintInfoFlow(n,s,i,p.data);case 46:e.next=50;break;case 48:return this.writeLog("订单【".concat(o,"】同步面单失败,获取运单号失败,").concat(p.data),!1),e.abrupt("return");case 50:e.next=55;break;case 52:e.prev=52,e.t0=e["catch"](8),console.log(e.t0);case 55:case"end":return e.stop()}}),e,this,[[8,52]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleStart",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.isAuto=!1,this.activeType="handle",this.isApplyForceFaceInfo=r||!1,this.orders=t,n=0;case 5:if(!(n<t.length)){e.next=13;break}return a=t[n],console.log(a),e.next=10,this.handleMainFlow(a);case 10:n++,e.next=5;break;case 13:this.writeLog("面单同步已完成",!0);case 14:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"handleMainFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,o,s,c,l,u,d,h,p,g,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.platform_mall_id||(t.mall_info?t.mall_info.platform_mall_id:""),n=t.sys_mall_id||(t.mall_info?t.mall_info.id:""),a=t.order_id,i=t.country,o=t.order_sn||t.main_order_sn,e.prev=5,s=null,0!=a&&a){e.next=16;break}return c={keyword:o,shop_id:r},e.next=11,this.$shopeemanService.getOrderHint(i,c);case 11:l=e.sent,console.log(l,"getOrderHint"),s=200===l.code&&l.data&&l.data.orders&&l.data.orders.length&&l.data.orders[0]||null,e.next=21;break;case 16:return u={order_id:a,shop_id:r},e.next=19,this.$shopeemanService.getDetailsSinger(i,u);case 19:d=e.sent,s=200===d.code&&d.data||null;case 21:if(console.log(s,"orderInfo",t),s){e.next=25;break}return this.writeLog("订单【".concat(o,"】同步面单失败,获取订单详情失败,请检查店铺登录状态！"),!1),e.abrupt("return");case 25:if(h=this.checkTrackInfo(s,i),console.log(h,"trackInfo"),!h.trackingNo){e.next=41;break}return e.next=30,this.uploadTrackingNo(n,r,o,h.trackingNo,h.logistics_channel);case 30:if(p=this._this.tableData.findIndex((function(e){return e.order_sn===t.order_sn})),p>-1&&this._this.$set(this._this.tableData[p],"tracking_no",h.trackingNo),"TW"!==t.country){e.next=37;break}return e.next=35,this.getPrintTWinfoFlow(n,s,i,h.trackingNo);case 35:e.next=39;break;case 37:return e.next=39,this.getPrintInfoFlow(n,s,i,h.trackingNo);case 39:e.next=59;break;case 41:return e.next=43,this.applyOrderTrackingNo(a,r,s.logistics_channel,i,n,o);case 43:if(g=e.sent,console.log("applyInfo",g),200!==g.code){e.next=57;break}if(f=this._this.tableData.findIndex((function(e){return e.order_sn===t.order_sn})),f>-1&&this._this.$set(this._this.tableData[f],"tracking_no",g.data),"TW"!==t.country){e.next=53;break}return e.next=51,this.getPrintTWinfoFlow(n,s,i,g.data);case 51:e.next=55;break;case 53:return e.next=55,this.getPrintInfoFlow(n,s,i,g.data);case 55:e.next=59;break;case 57:return this.writeLog("订单【".concat(o,"】同步面单失败，获取运单号失败,").concat(g.data),!1),e.abrupt("return");case 59:e.next=64;break;case 61:e.prev=61,e.t0=e["catch"](5),console.log(e.t0);case 64:case"end":return e.stop()}}),e,this,[[5,61]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getForderLogistics",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_id:t,shop_id:r},e.next=3,this.$shopeemanService.getForderLogistics(n,a);case 3:if(i=e.sent,!(i&&200===i.code&&i.data&&i.data.list&&i.data.list.length)){e.next=8;break}return e.abrupt("return",i.data.list[0].thirdparty_tracking_number);case 8:return e.abrupt("return","");case 9:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getDropOff",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_id:t,shop_id:r},e.next=3,this.$shopeemanService.getDropOff(n,a);case 3:return i=e.sent,console.log(i,"000000"),o=i.data&&i.data.list&&i.data.list[0]&&i.data.list[0].forders&&i.data.list[0].forders[0]&&i.data.list[0].forders[0].third_party_tn||null,o||(o=i.data&&i.data.consignment_no||""),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkTrackInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={},n["orderId"]=t.order_id,n["logistics_channel"]=t.logistics_channel||"",e.next=5,this.getDropOff(t.order_id,t.shop_id,r);case 5:return n["trackingNo"]=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkIsAutoApplyTrackingNumber",value:function(e){var t=g["x"].find((function(t){return t.ShipId==e}));return!(!t||1!=t.IsDeafult)}},{key:"applyOrderTrackingNo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,o){var s,c,l,u,d,h,g,f,m,b,_,w,v,k,x,S,y,L,O,C;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("TW"!==a||this.isApplyForceFaceInfo){e.next=2;break}return e.abrupt("return",{code:50001,data:"台湾站不强制申请物流单号"});case 2:return e.next=4,this.$appConfig.getUserConfig();case 4:if(s=e.sent,c=s&&JSON.parse(s),console.log(),"TW"===a||c&&c.is_apply_shopee_logistics){e.next=10;break}if(this.isApplyForceFaceInfo){e.next=10;break}return e.abrupt("return",this.getShopeeShipNumber(t,r,a,i,o));case 10:if(l=this.checkIsAutoApplyTrackingNumber(n),l){e.next=13;break}return e.abrupt("return",this.getShopeeShipNumber(t,r,a,i,o,"不支持自动申请虾皮运输单号功能"));case 13:if(e.prev=13,"TW"!==a){e.next=60;break}return u={shop_id:r},e.next=18,this.$shopeemanService.getShopSellerRealName(a,u);case 18:if(d=e.sent,h=""!=d&&d?d:null,h||(h="nick"),"30001"!=n){e.next=45;break}return g={shop_id:r},e.next=25,this.$shopeemanService.getShop(a,g);case 25:if(f=e.sent,m=200===f.code&&f.data.pickup_address_id||null,m){e.next=29;break}return e.abrupt("return",{code:50002,data:"no_address"});case 29:return b={order_id:t,address_id:m,channel_id:n,shop_id:r},e.next=32,this.$shopeemanService.getPickupTimeSlots(a,b);case 32:if(_=e.sent,w=200===_.code&&_.data.time_slots&&_.data.time_slots[0].value||null,console.log(_,w,"pickTimeResult"),console.log("ShopInfoResult",f),w){e.next=38;break}return e.abrupt("return",{code:50003,data:"no_pickup_time"});case 38:return v={order_id:t,channel_id:n,forder_id:t,seller_real_name:h,pickup_time:w,seller_address_id:m,shop_id:r},e.next=41,this.$shopeemanService.handleOutOrder(a,v);case 41:k=e.sent,console.log("applyResult11",k),e.next=58;break;case 45:if("30014"!=n&&"30015"!=n){e.next=53;break}return x={order_id:t,seller_real_name:h,slug:"30014"==n?"SLTW003":"SLTW001",shipping_mode:"dropoff",shop_id:r},e.next=49,this.$shopeemanService.handleOutOrder(a,x);case 49:S=e.sent,console.log("applyResult55",S),e.next=58;break;case 53:return y={order_id:t,channel_id:n,forder_id:t,seller_real_name:h,shop_id:r},e.next=56,this.$shopeemanService.handleOutOrder(a,y);case 56:L=e.sent,console.log("applyResult22",L);case 58:e.next=65;break;case 60:return O={order_id:t,channel_id:n,forder_id:t,shop_id:r},e.next=63,this.$shopeemanService.handleOutOrder(a,O);case 63:C=e.sent,console.log("applyResult33",C);case 65:return e.next=67,Object(p["z"])(2e3);case 67:return e.abrupt("return",this.getShopeeShipNumber(t,r,a,i,o,"",n));case 70:return e.prev=70,e.t0=e["catch"](13),console.log(e.t0),e.abrupt("return",{code:50004,data:"catch - error"});case 74:case"end":return e.stop()}}),e,this,[[13,70]])})));function t(t,r,n,a,i,o){return e.apply(this,arguments)}return t}()},{key:"uploadTrackingNo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i){var o,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=[{orderSn:n,trackingNo:a,logisticsId:i}],e.next=3,this.$commodityService.saveLogisticsInfo(t,r,o);case 3:s=e.sent,c=JSON.parse(s),200===c.code?this.writeLog("订单【".concat(n,"】同步物流成功，上报成功"),!0):this.writeLog("订单【".concat(n,"】同步物流失败，上报失败"),!1);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i){return e.apply(this,arguments)}return t}()},{key:"getShopeeShipNumber",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,o,s){var c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,c="",l=s,u=0;case 4:if(!(u<3)){e.next=16;break}return e.next=7,this.getDropOff(t,r,n);case 7:if(c=e.sent,""!==c){e.next=12;break}return e.abrupt("continue",13);case 12:return e.abrupt("break",16);case 13:u++,e.next=4;break;case 16:if(!c){e.next=22;break}return e.next=19,this.uploadTrackingNo(a,r,i,c,l);case 19:return e.abrupt("return",{code:200,data:c});case 22:return e.abrupt("return",{code:50005,data:o||"未获取到物流单号"});case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e["catch"](0),console.log(e.t0),e.abrupt("return",{code:50006,data:"error"});case 29:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,r,n,a,i,o,s){return e.apply(this,arguments)}return t}()},{key:"getPrintInfoFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,o,s,c,l,u,d,h,g,f,m,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getPrintWaybillType(r.shop_id,n);case 3:if(i=e.sent,200===i.code&&i.data){e.next=7;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败[501]"),!1),e.abrupt("return");case 7:return this.writeLog("订单【".concat(r.order_sn,"】获取面单类型成功"),!0),o=i.data.waybill_type,console.log(o,i,"fileType"),s=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=13,this.checkPackagePrintWaybillMultiShop(s,r.shop_id,n);case 13:if(c=e.sent,200===c.code&&c.data.list&&c.data.list.length&&c.data.list[0].package_number){e.next=17;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 17:return this.writeLog("订单【".concat(r.order_sn,"】获取包裹号成功"),!0),l=c.data.list[0].package_number,e.next=21,this.getSdConfig(r.shop_id,n);case 21:if(u=e.sent,console.log(u,"schemaType"),u){e.next=26;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 26:return this.writeLog("订单【".concat(r.order_sn,"】获取面单打印配置成功"),!0),"VN"===n&&"NORMAL"===o&&(u=2),"THERMAL"===o&&(u=3),d=[{order_id:Number(r.order_id),package_number:l,region_id:n,shop_id:Number(r.shop_id),channel_id:Number(r.logistics_channel)}],e.next=32,this.createSdJobsMultiShop(d,r.shop_id,n,o+"_PDF","Air Waybill."+r.actual_carrier,u);case 32:if(h=e.sent,200===h.code&&h.data.list&&h.data.list.length&&h.data.list[0].job_id){e.next=36;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败[504]"),!1),e.abrupt("return");case 36:return this.writeLog("订单【".concat(r.order_sn,"】创建打印任务成功"),!0),g=h.data.list[0].job_id,e.next=40,Object(p["z"])(2e3);case 40:return e.next=42,this.downloadSdJob(r.shop_id,g,n);case 42:if(f=e.sent,console.log(f,"1111111111111111"),200===f.code){e.next=54;break}if(120510475!==f.code){e.next=52;break}return console.log("重试"),e.next=49,this.downloadSdJob(r.shop_id,g,n);case 49:f=e.sent,e.next=54;break;case 52:return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(f.message),!1),e.abrupt("return");case 54:if(m=f.data,m){e.next=58;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 58:return e.next=60,this.checkFaceInfo(m,r.order_sn,a,r.actual_carrier,n,u,r);case 60:if(b=e.sent,console.log(b,"res6"),200===b.code){e.next=65;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(b.data,"[508]"),!1),e.abrupt("return");case 65:return e.next=67,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),b.data,".PDF");case 67:e.next=73;break;case 69:e.prev=69,e.t0=e["catch"](0),this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[000]"),!1),console.log(e.t0);case 73:case"end":return e.stop()}}),e,this,[[0,69]])})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"uploadFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i){var o,s,c,l,u,d,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=Object(p["x"])(!1,32)+"_"+(new Date).getTime()+i,e.next=3,this._this.$ossService.uploadFile(a,o);case 3:if(s=e.sent,console.log("url",s),!s){e.next=22;break}return c=[{url:s,orderSn:n.toString(),is_auto:this.isAuto}],l={sysMallId:t.toString(),mallId:r,faceSheetInfos:c},console.log(l),e.next=11,this.$commodityService.saveFaceSheetInfo(t,r,c);case 11:if(u=e.sent,d=JSON.parse(u),console.log(d,"res7"),!d||200!==d.code){e.next=19;break}return"handle"===this.activeType&&(h=this._this.tableData.findIndex((function(e){return e.order_sn===n})),h>-1&&this._this.$set(this._this.tableData[h],"hasLogistics","1")),e.abrupt("return",this.writeLog("订单【".concat(n,"】同步面单成功,上报成功"),!0));case 19:return e.abrupt("return",this.writeLog("订单【".concat(n,"】同步面单失败，上报失败，").concat(d.data.message),!1));case 20:e.next=23;break;case 22:return e.abrupt("return",this.writeLog("订单【".concat(n,"】获取面单异常！"),!1));case 23:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i){return e.apply(this,arguments)}return t}()},{key:"getPrintTWinfoFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,s,c,l,u,d,h,g,f,m=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=m.length>2&&void 0!==m[2]?m[2]:"TW",a=m.length>3?m[3]:void 0,e.prev=2,"30001"!=r.logistics_channel){e.next=6;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，黑猫无面单"),!1),e.abrupt("return",null);case 6:i="C2C_SHIPPING_LABEL_HTML",e.t0=Number(r.logistics_channel),e.next=30012===e.t0||30014===e.t0||30015===e.t0?10:12;break;case 10:return i="THERMAL_PDF",e.abrupt("break",14);case 12:return i="C2C_SHIPPING_LABEL_HTML",e.abrupt("break",14);case 14:return o=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=17,this.checkPackagePrintWaybillMultiShop(o,r.shop_id,n);case 17:if(s=e.sent,200===s.code&&s.data.list&&s.data.list.length&&s.data.list[0].package_number){e.next=21;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 21:if(c=s.data.list[0].package_number,l=null,"30012"!=r.logistics_channel){e.next=27;break}l=3,e.next=35;break;case 27:if("30014"!=r.logistics_channel&&"30015"!=r.logistics_channel){e.next=31;break}l=14,e.next=35;break;case 31:return e.next=33,this.getSdConfig(r.shop_id,n);case 33:l=e.sent,console.log(l,"schemaType");case 35:if(l){e.next=38;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 38:return u=[{order_id:Number(r.order_id),package_number:c,region_id:n,shop_id:Number(r.shop_id)}],"30014"!=r.logistics_channel&&"30015"!=r.logistics_channel||(u[0]["channel_id"]=r.logistics_channel),e.next=42,this.createSdJobsMultiShop(u,r.shop_id,n,i,"寄件单"+r.actual_carrier,l);case 42:if(d=e.sent,200===d.code&&d.data.list&&d.data.list.length&&d.data.list[0].job_id){e.next=46;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败"),!1),e.abrupt("return");case 46:return h=d.data.list[0].job_id,e.next=49,Object(p["z"])(3e3);case 49:return e.next=51,this.downloadTwFace(r,h,n,a);case 51:if(g=e.sent,!g){e.next=70;break}if("30005"!=r.logistics_channel&&"30006"!=r.logistics_channel){e.next=58;break}return e.next=56,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),g,".html");case 56:e.next=68;break;case 58:return e.next=60,this.checkFaceInfo(g,r.order_sn,a,r.actual_carrier,n,l);case 60:if(f=e.sent,200===f.code){e.next=66;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(f.data),!1),e.abrupt("return");case 66:return e.next=68,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),f.data,".PDF");case 68:e.next=72;break;case 70:return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，下载面单失败"),!1),e.abrupt("return");case 72:e.next=77;break;case 74:e.prev=74,e.t1=e["catch"](2),console.log("error",e.t1);case 77:case"end":return e.stop()}}),e,this,[[2,74]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"downloadTwFace",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.logistics_channel,"order.logistics_channel"),"30005"!=t.logistics_channel){e.next=9;break}return e.next=4,this.downloadSdJobTW(t.shop_id,r,n);case 4:if(i=e.sent,i){e.next=8;break}return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return",null);case 8:return e.abrupt("return",this.get711FaceInfo(a,i));case 9:if("30006"!=t.logistics_channel){e.next=19;break}return e.next=12,this.downloadSdJobTW(t.shop_id,r,n);case 12:if(o=e.sent,console.log(o,"faceData"),o){e.next=18;break}return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 18:return e.abrupt("return",this.getQuanJiaFaceInfo(a,o,t.shop_id));case 19:return e.next=21,this.downloadSdJob(t.shop_id,r,n);case 21:if(s=e.sent,200===s.code){e.next=32;break}if(120510475!==s.code){e.next=30;break}return console.log("重试"),e.next=27,this.downloadSdJob(t.shop_id,r,n);case 27:s=e.sent,e.next=32;break;case 30:return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败,").concat(s.message),!1),e.abrupt("return",null);case 32:return e.abrupt("return",s.data);case 33:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"get711FaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,s,c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=h.a.load(r),a=n('input[name="tempvar"]')[0].attribs.value||void 0,a){e.next=4;break}return e.abrupt("return",null);case 4:return i={PinCodeNumber:t,tempvar:a,NewWindow:"Y",BackTag:"https://seller.shopee.tw/portal/sale/"},o={headers:{Referer:"https://epayment.7-11.com.tw/C2C/C2CWeb/C2C.aspx","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36","Content-Type":"application/x-www-form-urlencoded",isGBK:!1}},o["params"]=i,e.next=9,window["NetMessageBridgeService"].post("https://epayment.7-11.com.tw/C2C/C2CWeb/PrintC2CPinCode.aspx",JSON.stringify(o),JSON.stringify(i));case 9:if(s=e.sent,c=JSON.parse(s),l=c.data,!l||!l.includes(t)){e.next=20;break}return l=l.replaceAll("css/C2CPrint.css","https://epayment.7-11.com.tw/C2C/C2CWeb/css/C2CPrint.css").replaceAll("BarCode.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/BarCode.ashx?CodeValue=").replaceAll("QRCode.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/QRCode.ashx?CodeValue=").replaceAll("BarCode128.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/BarCode128.ashx?CodeValue="),e.next=16,window["BaseUtilBridgeService"].htmlToBase64(l);case 16:return u=e.sent,e.abrupt("return",u);case 20:return e.abrupt("return",null);case 21:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"dataURLtoFile",value:function(e,t){var r=e.split(","),n=r[0].match(/:(.*?);/)[1],a=atob(r[1]),i=a.length,o=new Uint8Array(i);while(i--)o[i]=a.charCodeAt(i);return new File([o],t,{type:n})}},{key:"getQuanJiaFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,o,s,c,l,u,d,p,g,f,m,b,_,w,v,k;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=h.a.load(r),i=a("input")[0].attribs.value,o=a("input")[1].attribs.value,o=o.replace("&lt;","<").replace("&gt;",">").replace("&#39;","'"),s=Number(a("input")[2].attribs.value),c=a("input")[3].attribs.value,e.next=9,window["ConfigBridgeService"].getGlobalCacheInfo("mallInfo",n);case 9:return l=e.sent,u=JSON.parse(l),d=u.mall_main_id,u.IPType,p={ApiKey:i,Data:o,TimeStamp:s,Signature:c},g={headers:{Host:"external2.shopee.tw","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3",isProxyMallId:d.toString(),"Content-Type":"application/x-www-form-urlencoded",isGBK:!1}},g["params"]=p,e.next=16,window["NetMessageBridgeService"].post("https://external2.shopee.tw/ext/familymart/OrderPrint/OrderPrint.aspx",JSON.stringify(g),JSON.stringify(p));case 16:if(f=e.sent,m=JSON.parse(f),!m||200===m.status){e.next=25;break}if(!m||500!==m.status){e.next=24;break}return e.next=22,window["NetMessageBridgeService"].post("https://external2.shopee.tw/ext/familymart/OrderPrint/OrderPrint.aspx",JSON.stringify(g),JSON.stringify(p));case 22:f=e.sent,m=JSON.parse(f);case 24:m&&500===m.status?this.writeLog("同步面单异常,官方错误：官方服务器异常：".concat(m.statusText),!1):this.writeLog("同步面单异常".concat(m.statusText),!1);case 25:if(b=m.data,b&&b.includes(".gif")){e.next=28;break}return e.abrupt("return",null);case 28:if(_=h.a.load(b),console.log(_("img")),!_("img")){e.next=40;break}return w=_("img")[0].attribs.src,v="https://external2.shopee.tw/ext/familymart/OrderPrint/"+w,b=b.replace(w,v),e.next=36,window["BaseUtilBridgeService"].htmlToBase64(b);case 36:return k=e.sent,e.abrupt("return",k);case 40:return console.log("nullnull"),e.abrupt("return",null);case 42:e.next=48;break;case 44:return e.prev=44,e.t0=e["catch"](0),console.log(e.t0),e.abrupt("return",null);case 48:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getPrintWaybillType",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getPrintWaybillType(r,n);case 3:return a=e.sent,console.log(a,"面单类型"),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkPackagePrintWaybillMultiShop",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_info_list:t,shop_id:r},e.next=3,this.$shopeemanService.checkPackagePrintWaybillMultiShop(n,a);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getSdConfig",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getSdConfig(r,n);case 3:if(a=e.sent,i=null,!(200===a.code&&a.data&&a.data.suggest_schema&&a.data.suggest_schema.last_normal_selected_schema)){e.next=14;break}return o=!1,s=a.data.suggest_schema.last_normal_selected_schema,c=a.data.suggest_schema.suggest_default_schema,(s.length<1&&c.length>1||s.length>1)&&(o=!0),i=o||"VN"===r?"TW"===r?6:"MY"===r||"PH"===r||"VN"===r?3:"TH"===r||"ID"===r?2:Number(c[1]):s.length<1?Number(c[0]):Number(s[0]),e.abrupt("return",i);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSdJobsMultiShop",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,o){var s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={record_generate_schema:!1,package_list:t,generate_file_details:[{file_type:a,file_name:i,file_contents:[o]}],shop_id:r},e.next=3,this.$shopeemanService.createSdJobsMultiShop(n,s);case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i,o){return e.apply(this,arguments)}return t}()},{key:"downloadSdJob",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={job_id:r,shop_id:t},e.next=3,this.$shopeemanService.downloadSdJob(n,a);case 3:if(i=e.sent,e.prev=4,o=i&&JSON.parse(i.data),!o||0!==o.code){e.next=10;break}return e.abrupt("return",{code:200,data:i.rawBytes});case 10:return e.abrupt("return",{code:o.code||50001,message:o.message||""});case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e["catch"](4),e.abrupt("return",{code:200,data:i.rawBytes});case 16:case"end":return e.stop()}}),e,this,[[4,13]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"downloadSdJobTW",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={job_id:r,shop_id:t},e.next=3,this.$shopeemanService.downloadSdJob(n,a);case 3:return i=e.sent,console.log(i,"下载面单信息"),e.abrupt("return",i.data||"");case 6:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,o,s){var c,l,u,d,h,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.length,r,n,o),!(null===t||t.length<500)&&r&&n){e.next=4;break}return window["BaseUtilBridgeService"].checkAutoScriptLog("[".concat(r,"]面单长度小于500")),e.abrupt("return",{code:50001,data:"面单大小或平台物流获取异常，请重新同步！"});case 4:if(c=t,"VN"!=i||"J&T Exoress"!=a||2!=o){e.next=14;break}return e.next=8,this.cutFaseSize(t,r,!0,300,420,-420);case 8:if(l=e.sent,200==l.code&&l.data){e.next=11;break}return e.abrupt("return",{code:50001,data:l.msg});case 11:c=200==l.code&&l.data||t,e.next=30;break;case 14:if("VN"!=i||"VNPost Nhanh"!=a){e.next=23;break}return e.next=17,this.cutFaseSize(t,r,!0,300,425,-420);case 17:if(u=e.sent,200==u.code&&u.data){e.next=20;break}return e.abrupt("return",{code:50001,data:u.msg});case 20:c=200==u.code&&u.data||t,e.next=30;break;case 23:if("ID"!=i){e.next=30;break}return e.next=26,this.cutFaseSize(t,r,!0,425,595,0);case 26:if(d=e.sent,200==d.code&&d.data){e.next=29;break}return e.abrupt("return",{code:50001,data:d.msg});case 29:c=200==d.code&&d.data||t;case 30:return e.next=32,window["BaseUtilBridgeService"].checkFaceInfo(c,r,n);case 32:if(h=e.sent,p=JSON.parse(h),console.log(p,"blobToDataURL"),200!==p.code){e.next=39;break}return e.abrupt("return",{code:200,data:c});case 39:return e.abrupt("return",{code:50001,data:"订单【".concat(r,"】获取面单异常, ").concat(p.msg)});case 40:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i,o,s){return e.apply(this,arguments)}return t}()},{key:"cutFaseSize",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,o){var s,c,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={OrderNo:r,IsUseA4Size:n,PdfWidth:a,PdfHeight:i,LocationY:o},console.log(t,!0,JSON.stringify(s)),e.next=4,window["BaseUtilBridgeService"].getFaceData(t,!0,s);case 4:return c=e.sent,l=c&&JSON.parse(c),console.log(l,"cutFaseSize"),e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)})));function t(t,r,n,a,i,o){return e.apply(this,arguments)}return t}()},{key:"blobToDataURL",value:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)}},{key:"getPickListData",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,o=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,r=this.dealWithMallOrderGroup(t),n="NORMAL",a=regeneratorRuntime.mark((function e(t){var a,i,s,c,l,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r[t],i=a[0].country,s=t,c=r[t][0].mall_info.platform_mall_name,l=regeneratorRuntime.mark((function e(t){var r,l,u,d,h,p,g,f,m,b,_;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.slice(t,t+50),l=[],r.forEach((function(e){if(0!=e.order_id){var t={order_id:Number(e.order_id),shop_id:Number(s),region_id:i};l.push(t)}})),console.log(l,"orderInfolist"),e.next=6,o.checkPackagePrintWaybillMultiShop(l,s,i);case 6:if(u=e.sent,console.log(u,"packInfo"),200!==u.code){e.next=43;break}if(u.data.list.length){e.next=14;break}return o.writeLog("店铺【".concat(c,"】当前数据没有可下载的拣货单"),!1),e.abrupt("return","continue");case 14:return d=u.data.list,h=[],d.forEach((function(e){var t={order_id:Number(e.order_id),package_number:e.package_number,region_id:i,shop_id:Number(s)};h.push(t)})),e.next=19,o.createSdJobsMultiShop(h,s,i,n+"_PDF","PickList",0);case 19:if(p=e.sent,200===p.code&&p.data.list&&p.data.list.length&&p.data.list[0].job_id){e.next=24;break}o.writeLog("创建拣货单失败，".concat(p.data),!1),e.next=41;break;case 24:return g=p.data.list[0].job_id,e.next=27,o.downloadSdJob(s,g,i);case 27:if(f=e.sent,200===f.code){e.next=31;break}return o.writeLog("店铺【".concat(c,"】下载拣货单失败，").concat(f.message),!1),e.abrupt("return","continue");case 31:if(m=f.data,console.log(m.length,"base64"),m&&!(m.length<500)){e.next=36;break}return o.writeLog("店铺【".concat(c,"】下载拣货单失败，稍后请重试"),!1),e.abrupt("return","continue");case 36:return e.next=38,window["BaseUtilBridgeService"].downloadPickForm(m,c);case 38:b=e.sent,_=JSON.parse(b),200===_.code?o.writeLog("店铺【".concat(c,"】下载拣货单成功"),!0):o.writeLog("店铺【".concat(c,"】下载拣货单失败，").concat(_.msg),!1);case 41:e.next=44;break;case 43:403===u.code?o.writeLog("店铺【".concat(c,"】下载拣货单失败,店铺未登录"),!1):o.writeLog("店铺【".concat(c,"】下载拣货单失败"),!1);case 44:case"end":return e.stop()}}),e)})),u=0;case 6:if(!(u<a.length)){e.next=14;break}return e.delegateYield(l(u),"t0",8);case 8:if(d=e.t0,"continue"!==d){e.next=11;break}return e.abrupt("continue",11);case 11:u+=50,e.next=6;break;case 14:case"end":return e.stop()}}),e)})),e.t0=regeneratorRuntime.keys(r);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:e.next=15;break;case 12:e.prev=12,e.t3=e["catch"](0),console.log(e.t3,"error");case 15:this.writeLog("下载拣货单完成，请前往桌面【平台拣货单】文件夹查看",!0);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dealWithMallOrderGroup",value:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.mall_info.platform_mall_id]||(t[n.mall_info.platform_mall_id]=[]),t[n.mall_info.platform_mall_id].push(n)}return t}}]),e}()},"0443":function(e,t,r){"use strict";r("5da4")},"4c28":function(e,t,r){},"5da4":function(e,t,r){},8992:function(e,t,r){"use strict";r("4c28")},e762:function(e,t,r){"use strict";"function"===typeof TextDecoder&&new TextDecoder,"function"===typeof TextEncoder&&new TextEncoder;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=Array.prototype.slice.call(n);(e=>{let t={};e.forEach((e,r)=>t[e]=r)})(a),String.fromCharCode.bind(String),"function"===typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array)},ef52:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"delivery-manager"},[r("div",{staticClass:"selectBox"},[r("div",{staticClass:"left-box mar-right"},[r("div",{staticClass:"base-box"},[r("span",{staticClass:"base-title"},[e._v("基础操作")]),r("div",{staticClass:"base-item base-left"},[r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.syncSurfaceBefore}},[e._v("批量同步面单信息")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.batnchDownLoad(e.multipleSelection,"down")}}},[e._v("批量下载平台面单")]),r("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini"},model:{value:e.isDownloadOriginFace711,callback:function(t){e.isDownloadOriginFace711=t},expression:"isDownloadOriginFace711"}},[e._v("台湾站711原始面单")])],1),r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.batnchDownLoad(e.multipleSelection,"view")}}},[e._v("批量预览打印平台面单")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.getExportData}},[e._v("导出数据")]),r("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini"},model:{value:e.isDownloadOriginFaceQJ,callback:function(t){e.isDownloadOriginFaceQJ=t},expression:"isDownloadOriginFaceQJ"}},[e._v("台湾站全家原始面单")])],1),r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.beforeVirtual}},[e._v("批量打印台湾虚拟面单")]),r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:e.downLoadPickList}},[e._v("批量下载拣货单")])],1),r("el-row",{staticClass:"row-style"},[r("el-button",{staticClass:"btnWidth",attrs:{size:"mini",type:"primary"},on:{click:function(t){e.downloadSetVisible=!0}}},[e._v("批量下载自定义拣货单")])],1)],1)])]),r("div",{staticClass:"right-box"},[r("div",{staticClass:"base-box"},[r("span",{staticClass:"base-title"},[e._v("列表筛选操作")]),r("div",{staticClass:"base-item"},[r("el-row",{staticClass:"row-style"},[r("storeChoose",{attrs:{"is-all":!0,"span-width":"90px","select-width":"180px",source:"orderCenter"},on:{changeMallList:e.changeMallList}})],1),r("el-row",{staticClass:"row-style"},[r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("订单编号：")]),r("el-input",{staticClass:"inputBox",attrs:{size:"mini",clearable:""},model:{value:e.selectForm.orderSn,callback:function(t){e.$set(e.selectForm,"orderSn",t)},expression:"selectForm.orderSn"}})],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("采购物流单号：")]),r("el-input",{staticClass:"inputBox",attrs:{size:"mini",clearable:""},model:{value:e.selectForm.originalTrackingNumber,callback:function(t){e.$set(e.selectForm,"originalTrackingNumber",t)},expression:"selectForm.originalTrackingNumber"}})],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("截止时间：")]),r("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:function(t){return e.changeTime(t,"shipByDate")}},model:{value:e.shipByDate,callback:function(t){e.shipByDate=t},expression:"shipByDate"}})],1)]),r("el-row",{staticClass:"row-style"},[r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("发货状态：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.orderStatus,callback:function(t){e.$set(e.selectForm,"orderStatus",t)},expression:"selectForm.orderStatus"}},[r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.orderStatusList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("面单下载状态：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.isPrint,callback:function(t){e.$set(e.selectForm,"isPrint",t)},expression:"selectForm.isPrint"}},[r("el-option",{attrs:{label:"全部",value:""}}),r("el-option",{attrs:{label:"已下载",value:"1"}}),r("el-option",{attrs:{label:"未下载",value:"2"}})],1)],1),r("div",{staticClass:"tool-item"},[r("span",[e._v("创建时间：")]),r("el-date-picker",{staticStyle:{width:"300px"},attrs:{size:"mini","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:function(t){return e.changeTime(t,"createTime")}},model:{value:e.createTime,callback:function(t){e.createTime=t},expression:"createTime"}})],1)]),r("el-row",{staticClass:"row-style"},[r("div",{staticClass:"tool-item mar-right"},[r("span",[e._v("物流单号：")]),r("el-select",{staticClass:"inputBox",attrs:{placeholder:"",size:"mini"},model:{value:e.selectForm.hasTrackingNo,callback:function(t){e.$set(e.selectForm,"hasTrackingNo",t)},expression:"selectForm.hasTrackingNo"}},[r("el-option",{attrs:{label:"全部",value:""}}),r("el-option",{attrs:{label:"已申请",value:"1"}}),r("el-option",{attrs:{label:"未申请",value:"2"}})],1)],1),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getOrderList(1)}}},[e._v("搜索")]),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:function(t){e.goodsSearchVisible=!0}}},[e._v("订单号批量查询")]),r("el-button",{staticClass:"mar-right",attrs:{size:"mini",type:"primary"},on:{click:e.openBefore}},[e._v("批量添加本地备注")]),r("el-checkbox",{staticClass:"mar-right",model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}},[e._v("隐藏日志")]),r("p",{staticClass:"tableActive"},[e._v("同步和打印台湾站的面单信息（除711外），请走代理")])],1)],1)])])]),r("div",{staticClass:"content"},[r("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{"use-virtual":"",border:!1,data:e.tableData,"tooltip-effect":"dark",height:"630px"},on:{"selection-change":e.handleSelectionChange}},[r("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),r("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s((e.currentPage-1)*e.pageSize+t.$index+1))]}}])}),r("u-table-column",{attrs:{prop:"order_sn",label:"订单编号","min-width":"170px",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("i",{staticClass:"el-icon-document-copy copyStyle",on:{click:function(r){return e.copyItem(t.row.order_sn)}}}),r("span",{staticClass:"tableActive",on:{click:function(r){return e.viewDetails("orderDetail",t.row.order_id,t.row.mall_info.platform_mall_id)}}},[e._v(e._s(t.row.order_sn))])]}}])}),r("u-table-column",{attrs:{label:"操作",prop:"","min-width":"150px",fixed:"left",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-dropdown",{staticStyle:{width:"100px","margin-left":"10px"}},[r("el-button",{staticStyle:{width:"100px"},attrs:{size:"mini",plain:"",type:"primary"}},[e._v(" 更多操作"),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",[r("div",{staticClass:"dropdownItem",on:{click:function(r){return e.syncFaceDataSingle(t.row)}}},[e._v("同步面单信息")])]),r("el-dropdown-item",[r("div",{staticClass:"dropdownItem",on:{click:function(r){return e.batnchDownLoad([t.row],"view")}}},[e._v("面单预览")])]),r("el-dropdown-item",[0!=t.row.hasLogistics?r("div",{staticClass:"dropdownItem",on:{click:function(r){return e.batnchDownLoad([t.row],"down")}}},[e._v("下载面单")]):e._e()])],1)],1)]}}])}),r("u-table-column",{attrs:{"min-width":"80px",label:"站点",prop:"country",align:"center",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.mall_info?[e._v(e._s(e._f("chineseSite")(t.row.mall_info.country)))]:void 0}}],null,!0)}),r("u-table-column",{attrs:{label:"店铺名称",prop:"mall_info.platform_mall_name","min-width":"120px",align:"center","show-overflow-tooltip":""}}),r("u-table-column",{attrs:{align:"center",label:"商品数量","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.goods_count))]}}])}),r("u-table-column",{attrs:{align:"center",prop:"123456",label:"商品详情","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.openGoodsDetail(t.row)}}},[e._v("商品详情")])]}}])}),r("u-table-column",{attrs:{align:"center",prop:"created_time",label:"订单创建时间","min-width":"140"}}),r("u-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"截止发货时间","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.ship_by_date))]}}])}),r("u-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"是否已申请物流单号","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",{style:{color:""==t.row.tracking_no?"red":"#32CD32"}},[e._v(e._s(""==t.row.tracking_no?"未申请":"已申请"))])]}}])}),r("u-table-column",{attrs:{align:"center",prop:"ship_by_date",label:"是否同步面单信息","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",{style:{color:0==t.row.hasLogistics?"red":"#32CD32"}},[e._v(e._s(0==t.row.hasLogistics?"否":"是"))])]}}])}),r("u-table-column",{attrs:{align:"center",prop:"order_status",label:"发货状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",{style:{color:e.changeOrderStatus(t.row.order_status,"color")}},[e._v(e._s(e.changeOrderStatus(t.row.order_status)))])]}}])}),r("u-table-column",{attrs:{align:"center",prop:"logistics_name",label:"虾皮物流","min-width":"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.logistics_name))]}}])}),r("u-table-column",{attrs:{align:"center",prop:"tracking_no",label:"虾皮物流单号","min-width":"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.tracking_no))]}}])}),r("u-table-column",{attrs:{align:"center",prop:"remark",label:"本地备注","min-width":"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{directives:[{name:"show",rawName:"v-show",value:!(t.row.id===e.activeRemarkID),expression:"!(scope.row.id === activeRemarkID ? true : false)"}],staticStyle:{cursor:"pointer"},on:{click:function(r){return e.editRemark(t.row.id)}}},[r("el-input",{attrs:{disabled:"",size:"mini"},model:{value:t.row.remark,callback:function(r){e.$set(t.row,"remark",r)},expression:"scope.row.remark"}})],1),t.row.id===e.activeRemarkID?r("el-input",{attrs:{size:"mini"},on:{blur:function(r){return e.changeRemark(t.row.id)}},model:{value:e.orderRemark,callback:function(t){e.orderRemark=t},expression:"orderRemark"}}):e._e()]}}])}),r("u-table-column",{attrs:{align:"center",prop:"note",label:"shopee备注","min-width":"100","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.note))]}}])}),r("u-table-column",{attrs:{align:"center",prop:"note",label:"是否已下载面单","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s("1"==t.row.is_print?"已下载":"未下载"))]}}])})],1),r("div",{staticClass:"pagination"},[r("el-pagination",{attrs:{background:"","page-sizes":[20,50,100,200],"page-size":e.pageSize,"current-page":e.currentPage,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1),r("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}}),r("el-dialog",{attrs:{title:"商品详情",visible:e.goodsListVisible,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.goodsListVisible=t},close:e.closeDialog}},[r("el-table",{ref:"goodsTable",attrs:{data:e.goodsList,"tooltip-effect":"dark",height:"400px"}},[r("el-table-column",{attrs:{align:"center",prop:"goods_name",label:"商品名称","min-width":"180","show-overflow-tooltip":"",fixed:""}}),r("el-table-column",{attrs:{align:"center",prop:"order_sn",label:"订单编号","min-width":"120"}}),r("el-table-column",{attrs:{align:"center",label:"商品图片","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-image",{staticStyle:{width:"56px",height:"56px"},attrs:{src:e._f("imageRender")([t.row.goods_img])}})]}}])}),r("el-table-column",{attrs:{align:"center",prop:"goods_id",label:"商品ID","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(r){return e.openUrl(e.clickRow,t.row.goods_id,"product")}}},[e._v(e._s(t.row.goods_id))])]}}])}),r("el-table-column",{attrs:{align:"center",prop:"goods_count",label:"商品数量","min-width":"120"}}),r("el-table-column",{attrs:{align:"center",prop:"outer_goods_id",label:"parentSKU","min-width":"120","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{align:"center",prop:"variation_name",label:"商品规格","min-width":"120",fixed:"right"}})],1)],1),r("el-dialog",{attrs:{title:"订单号批量查询",visible:e.goodsSearchVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.goodsSearchVisible=t},close:e.closeDialog}},[r("p",[e._v("请输入订单号，一行一个，最多五十个")]),r("el-input",{attrs:{type:"textarea",resize:"none",rows:10},model:{value:e.goodsOrderSnStr,callback:function(t){e.goodsOrderSnStr=t},expression:"goodsOrderSnStr"}}),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.getOrderList(1,e.goodsOrderSnStr)}}},[e._v("批量查询")])],1)],1),r("el-dialog",{attrs:{title:"批量添加本地备注",visible:e.localRamarkVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.localRamarkVisible=t}}},[r("div",{staticClass:"remark-style"},[r("span",[e._v("本地备注")]),r("el-input",{attrs:{type:"textarea",resize:"none",rows:4,placeholder:"请输入内容"},model:{value:e.localRamark,callback:function(t){e.localRamark=t},expression:"localRamark"}})],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.batchSetRemark}},[e._v("批量添加")])],1)]),r("el-dialog",{attrs:{title:"自定义拣货单",visible:e.downloadSetVisible,width:"400px","close-on-click-modal":!1},on:{"update:visible":function(t){e.downloadSetVisible=t}}},[r("div",{staticClass:"downloadSetContent"},[r("el-checkbox-group",{staticClass:"downloadSetDetail",model:{value:e.downloadSetList,callback:function(t){e.downloadSetList=t},expression:"downloadSetList"}},[r("el-row",[r("h3",[e._v("请选择导出选项：")])]),r("el-row",[r("el-checkbox",{attrs:{label:"country"}},[e._v("站点")]),r("el-checkbox",{staticClass:"mall",attrs:{label:"platform_mall_name"}},[e._v("店铺名称")]),r("el-checkbox",{attrs:{label:"goods_name"}},[e._v("商品名称")])],1),r("el-row",[r("el-checkbox",{attrs:{label:"order_sn"}},[e._v("订单编号")]),r("el-checkbox",{attrs:{label:"outer_goods_id"}},[e._v("parentSKU")]),r("el-checkbox",{attrs:{label:"goods_count"}},[e._v("商品数量")])],1),r("el-row",[r("el-checkbox",{attrs:{label:"variation_name"}},[e._v("商品规格")]),r("el-checkbox",{attrs:{label:"goodsLink"}},[e._v("商品链接")]),r("el-checkbox",{attrs:{label:"goods_img"}},[e._v("商品图片")])],1),r("el-row",[r("el-checkbox",{attrs:{label:"order_status"}},[e._v("发货状态")]),r("el-checkbox",{attrs:{label:"ship_by_date"}},[e._v("截止发货时间")]),r("el-checkbox",{attrs:{label:"created_time"}},[e._v("订单创建时间")])],1),r("el-row",[r("el-checkbox",{attrs:{label:"logistics_name"}},[e._v("虾皮物流")]),r("el-checkbox",{attrs:{label:"tracking_no"}},[e._v("虾皮物流单号")])],1),r("el-row",[r("el-checkbox",{attrs:{label:"is_apply_tracking_no"}},[e._v("是否已申请物流单号")]),r("el-checkbox",{attrs:{label:"hasLogistics"}},[e._v("是否同步面单信息")])],1)],1)],1),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.downloadSetSave}},[e._v("生成")])],1)])],1)},a=[],i=r("2909"),o=r("1da1"),s=(r("96cf"),r("4de4"),r("b0c0"),r("99af"),r("ac1f"),r("5319"),r("159b"),r("a15b"),r("c740"),r("d3b7"),r("25f0"),r("b64b"),r("7db0"),r("caad"),r("2532"),r("a9e3"),r("d81d"),r("a434"),r("1276"),r("bcd0")),c=r("feb6"),l=r("0e0b"),u=(r("8237"),r("0098")),d=(r("e762"),{components:{storeChoose:c["a"]},data:function(){return{downloadSetVisible:!1,downloadSetList:[],pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},selectMallList:[],createTime:[],shipByDate:[],selectForm:{orderStatus:2,orderSn:"",isPrint:"",hasTrackingNo:"2",originalTrackingNumber:""},orderStatusList:s["q"],trackStatus:["","已申请","未申请"],logisticsStatusList:["未下载","已下载","未下载"],total:0,pageSize:20,currentPage:1,multipleSelection:[],tableLoading:!1,tableData:[],showConsole:!0,goodsList:[],goodsListVisible:!1,goodsSearchVisible:!1,goodsOrderSnStr:"",localRamarkVisible:!1,localRamark:"",activeRemarkID:"",orderRemark:"",isDownloadOriginFace711:!1,isDownloadOriginFaceQJ:!1}},mounted:function(){var e=this;console.log("ces"),this.createTime=Object(l["g"])(15),setTimeout((function(){e.getOrderList()}),2e3)},methods:{beforeVirtual:function(){var e=this,t=this.multipleSelection.filter((function(e){return"TW"==e.country}));if(!t.length)return this.$message.warning("请选择台湾站订单数据");this.$confirm("是否需要生成商品信息","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){e.downLoadVirtualTW(t,!0)})).catch((function(){e.downLoadVirtualTW(t,!1)}))},downLoadVirtualTW:function(e,t){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,i,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:for(n.prev=0,a=[],i=0;i<e.length;i++)o=e[i],s={PDFUrl:"",OrderNo:o.order_sn,MainOrderNo:o.main_order_sn,PlatformLogisticsId:o.tracking_no,PlatformLogisticsName:o.logistics_name,CreateTime:o.created_at,BuyerName:o.name,BuyerPhone:o.phone,BuyerAddress:o.address,BuyerNote:"",BarInfo:{BarCode:o.order_sn,BarCodeWidth:200,BarCodeHeight:50},SkuList:r.dealwithSkuList(o.goodsInfo),IsNeedCut:!(30007!=o.logistics_id&&30008!=o.logistics_id),IsUseA4Size:!1,PdfWidth:320,PdfHeight:425,LocationY:-420,PrintStatus:"0",MallId:o.mall_info.platform_mall_id,MallName:o.mall_info.mall_alias_name||o.mall_info.platform_mall_name},a.push(s);return n.next=5,window["BaseUtilBridgeService"].getVirtualFace(a,t);case 5:r.showConsole=!1,r.$refs.Logs.writeLog("虚拟面单下载完成,请前往软件所在文件夹查看",!0),n.next=11;break;case 9:n.prev=9,n.t0=n["catch"](0);case 11:case"end":return n.stop()}}),n,null,[[0,9]])})))()},dealwithSkuList:function(e){for(var t=[],r=0;r<e.length;r++){var n="規格： ".concat(e[r].variation_sku?e[r].variation_sku.replace("=|=",""):e[r].variation_name,"  數量：").concat(e[r].goods_count);t.push(n)}return t},updateOrderPrintStatus:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=[],e.forEach((function(e){n.push(e.MainOrderNo)})),a={mainOrderSns:n.join(","),isPrint:"1"},r.next=5,t.$api.updateOrderPrintStatus(a);case 5:i=r.sent,200===i.data.code&&n.forEach((function(e){var r=t.tableData.findIndex((function(t){return t.main_order_sn===e}));r>-1&&t.$set(t.tableData[r],"is_print","1")}));case 7:case"end":return r.stop()}}),r)})))()},changeTime:function(e,t,r){var n=Object(l["o"])(new Date(e[0]).getTime(),new Date(e[1]).getTime());if(n>93)return r?this[t][r]=Object(l["g"])(30):this[t]=Object(l["g"])(30),this.$message.warning("只支持查询或导出93天内的数据,请重新选择时间！")},downTWface:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,r=e.multipleSelection.filter((function(e){return"TW"==e.country})),r.length){t.next=4;break}return t.abrupt("return",e.$message.warning("请选择台湾站订单数据"));case 4:return n=[],r.forEach((function(e){n.push(e.main_order_sn)})),a=n.toString(),console.log(a,"idStr"),i={mainOrderSns:a},t.next=11,e.$api.getLogisticsInformationBatch(i);case 11:o=t.sent,console.log(o,"res"),s=[],s=200===o.data.code&&o.data.data.length?o.data.data:r,e.downFace(s,r,"TW",!1,!1,!1,!0),t.next=22;break;case 18:t.prev=18,t.t0=t["catch"](0),e.tableLoading=!1,console.log("downTWface",downTWface);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))()})),batnchDownLoad:function(e,t){var r=this;if(!e.length)return this.$message.warning("请选择要操作的数据！");"down"==t?this.$confirm("pdf文件后缀是否小写?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){r.batchPrintOrderSurface(e,!0,!0,!1,!1)})).catch((function(){r.batchPrintOrderSurface(e,!1,!0,!1,!1)})):"view"==t&&this.$confirm("是否需要打印虚拟面单?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){r.batchPrintOrderSurface(e,!1,!1,!0,!0)})).catch((function(){r.batchPrintOrderSurface(e,!1,!1,!0,!1)}))},batchPrintOrderSurface:function(e,t,r,n,a){var i=this;return Object(o["a"])(regeneratorRuntime.mark((function o(){var s,c,l,u,d,h;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(s="",c={},l="",e.forEach((function(e,t){c[e.country]=e.country,s=e.country,l=0===t?e.main_order_sn:l+","+e.main_order_sn})),!(Object.keys(c).length>1)){o.next=6;break}return o.abrupt("return",i.$message.warning("由于每个站点面单不一致，请分站点批量预览和打印！"));case 6:return u={mainOrderSns:l},d=[],o.prev=8,o.next=11,i.$api.getLogisticsInformationBatch(u);case 11:if(h=o.sent,console.log(h,"res"),200!==h.data.code){o.next=17;break}d=h.data.data,o.next=18;break;case 17:return o.abrupt("return",i.$message.warning("面单获取失败！"));case 18:if(d.length){o.next=20;break}return o.abrupt("return",i.$message.warning("暂无面单信息"));case 20:console.log(d,s,t,r,n,a,"-------------"),i.downFace(d,e,s,t,r,n,a),o.next=28;break;case 24:o.prev=24,o.t0=o["catch"](8),i.tableLoading=!1,console.log(o.t0);case 28:case"end":return o.stop()}}),o,null,[[8,24]])})))()},downFace:function(e,t,r,n,a,i,s){var c=this;return Object(o["a"])(regeneratorRuntime.mark((function o(){var l,u,d,h,p,g,f,m,b,_,w,v,k,x,S,y,L,O,C,I,R;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:c.showConsole=!1,c.$refs.Logs.consoleMsg="",o.prev=2,l=[],u=function(n){var a=e[n];if(!a.url&&"TW"!==r)return c.$refs.Logs.writeLog("订单".concat(a.order_sn,"未获取到面单信息"),!1),"continue";var i=t.find((function(e){return e.order_sn==a.order_sn}));console.log(i,"orderInfo");var o={PDFUrl:a.url||"",OrderNo:i.order_sn,MainOrderNo:i.main_order_sn,PlatformLogisticsId:i.tracking_no,PlatformLogisticsName:i.logistics_name,CreateTime:i.created_at,BuyerName:i.name,BuyerPhone:i.phone,BuyerAddress:a.data&&a.data.full_address?a.data.full_address:i.address,BuyerNote:"",BarInfo:{BarCode:i.order_sn,BarCodeWidth:200,BarCodeHeight:50},SkuList:c.dealwithSkuList(i.goodsInfo),IsNeedCut:!(30007!=i.logistics_id&&30008!=i.logistics_id),IsUseA4Size:!1,PdfWidth:320,PdfHeight:425,LocationY:-420,PrintStatus:"0",MallId:i.mall_info.platform_mall_id,MallName:i.mall_info.platform_mall_name};l.push(o)},d=0;case 6:if(!(d<e.length)){o.next=13;break}if(h=u(d),"continue"!==h){o.next=10;break}return o.abrupt("continue",10);case 10:d++,o.next=6;break;case 13:return p={IsDownload:a,PdfExtendName:n?".pdf":".PDF",PdfExtendNameIsLower:n,IsPrintVirtualFaceSheet:s,Site:r,IsShowWindow:i,PdfInfoList:l,VirtualPdfPath:{},ConvertFaceInfoList:[]},console.log(JSON.stringify(p),"111"),o.next=17,window["BaseUtilBridgeService"].getOrderPdfInfo(p);case 17:if(g=o.sent,f=JSON.parse(g),console.log(f,"pdfInfo"),200==f.code){o.next=24;break}for(b in m="",f.failList)m=m+","+b+","+f.failList[b],m=m.substring(1);return o.abrupt("return",c.$refs.Logs.writeLog("预览失败,".concat(m),!1));case 24:if(_=JSON.parse(JSON.stringify(l)),_.forEach((function(e){var t=f.data.find((function(t){return t&&t.OrderSn==e.OrderNo}));t&&(e.PDFUrl=t.PDFFilePath)})),console.log(JSON.stringify(_),"222"),w=null,v={},!s){o.next=37;break}return o.next=32,window["BaseUtilBridgeService"].getVirtualFace(_,!0);case 32:if(w=o.sent,v=w&&JSON.parse(w),console.log(v,"VirtualPdfPath"),v&&"200"==v.code){o.next=37;break}return o.abrupt("return",c.$message.warning("获取虚拟面单失败"));case 37:k=[],x=function(n){var a=e[n];if(console.log(n,a),!a.url&&"TW"!==r)return c.$refs.Logs.writeLog("订单".concat(a.order_sn,"未获取到面单信息"),!1),"continue";var i=t.find((function(e){return e.order_sn==a.order_sn})),o=f.data&&f.data.find((function(e){return e&&e.OrderSn==i.order_sn}))||null;console.log(o,"htmlUrl");var l={HtmlFilePath:o?o.PDFFilePath:a.url&&a.url.includes(".html")?a.url:"",PDFFilePath:o?o.PDFFilePath:a.url&&a.url.includes(".PDF")||a.url&&a.url.includes(".pdf")?a.url:"",LogisticsId:i.logistics_id.toString(),OrderSn:i.order_sn,MallId:Number(i.mall_info.platform_mall_id),VirtualFilePath:s?v.data[i.order_sn]:""};k.push(l),console.log(k,"-------")},S=0;case 40:if(!(S<e.length)){o.next=47;break}if(y=x(S),"continue"!==y){o.next=44;break}return o.abrupt("continue",44);case 44:S++,o.next=40;break;case 47:return console.log("333",JSON.stringify(k)),o.next=50,window["BaseUtilBridgeService"].htmlToPdf(k,!1,c.isDownloadOriginFace711,c.isDownloadOriginFaceQJ);case 50:if(L=o.sent,O=L&&JSON.parse(L),console.log(O,"convertFaceInfoModel"),200==O.code){o.next=57;break}for(I in C="",O.failList)C=C+","+I+","+O.failList[I],C=C.substring(1);return o.abrupt("return",c.$refs.Logs.writeLog("打印面单失败,".concat(C),!1));case 57:return R={IsDownload:a,PdfExtendName:n?".pdf":".PDF",PdfExtendNameIsLower:n,IsPrintVirtualFaceSheet:s,Site:r,IsShowWindow:i,PdfInfoList:_,VirtualPdfPath:s?v.data:{},ConvertFaceInfoList:O.data,isGetSourceTW:c.isDownloadOriginFace711||c.isDownloadOriginFaceQJ},console.log(JSON.stringify(R),"4444444--end"),c.tableLoading=!0,o.next=62,window["BaseUtilBridgeService"].downloadPdf(R);case 62:return c.tableLoading=!1,a&&c.$refs.Logs.writeLog("面单下载完成,请前往桌面查看",!0),o.next=66,c.updateOrderPrintStatus(l);case 66:s&&c.$refs.Logs.writeLog("虚拟面单下载完成,请前往软件所在文件夹查看",!0),o.next=75;break;case 69:o.prev=69,o.t0=o["catch"](2),console.log("error",o.t0),c.tableLoading=!1,o.t0.includes("进程")?c.$refs.Logs.writeLog("打印面单失败，文件被占用请重启软件",!1):c.$refs.Logs.writeLog("打印面单失败，".concat(o.t0),!1),console.log(o.t0,"downFace");case 75:case"end":return o.stop()}}),o,null,[[2,69]])})))()},syncFaceDataSingle:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.syncSurface([e],!0);case 1:case"end":return r.stop()}}),r)})))()},syncSurfaceBefore:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择数据！"));case 2:if(r=e.multipleSelection.filter((function(e){return"1"!==e.hasLogistics||""==e.tracking_no})),r.length){t.next=5;break}return t.abrupt("return",e.$message.warning("当前没有需要同步面单的订单！"));case 5:console.log(r,"arrFilterFrist"),n=r.filter((function(e){return"TW"==e.country})),console.log(n,"arrFilter"),n.length?e.$confirm("是否同时批量同步台湾站点的面单（同步台湾站的面单将会缩短发货时效，请谨慎选择）!","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){e.syncSurface(r,!0)})).catch((function(){var t=r.filter((function(e){return"TW"!==e.country}));e.syncSurface(t,!1)})):e.syncSurface(r,!1);case 9:case"end":return t.stop()}}),t)})))()},syncSurface:function(e,t){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.showConsole=!1,e.length){n.next=4;break}return r.$refs.Logs.writeLog("没有要同步的订单！",!0),n.abrupt("return");case 4:r.$refs.Logs.writeLog("同步面单信息开始，请耐心等待！",!0),a=new u["a"](r,r.$refs.Logs.writeLog),a.handleStart(e,t);case 7:case"end":return n.stop()}}),n)})))()},downLoadPickList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择数据！"));case 2:e.showConsole=!1,e.$refs.Logs.writeLog("下载拣货单开始，请耐心等待！",!0),r=new u["a"](e,e.$refs.Logs.writeLog),r.getPickListData(e.multipleSelection);case 6:case"end":return t.stop()}}),t)})))()},downloadSetSave:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n,a,o,c,l,u,d,h,p,g,f,m,b,_,w,v,k,x;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.downloadSetList.length||e.$message.warning("请选择需要导出的选项"),r=[],!e.multipleSelection.length){t.next=6;break}r=[e.multipleSelection],t.next=32;break;case 6:n=Object(i["a"])(e.selectMallList.map((function(e){return e.id}))).toString(),a=JSON.parse(JSON.stringify(e.selectForm)),a["page"]=1,a["pageSize"]=200,a["sysMallId"]=n,a["createTime"]=e.createTime.length?e.createTime[0]+" 00:00:00/"+e.createTime[1]+" 23:59:59":"",e.tableLoading=!0,console.log("getDeliveryList - params",a),o=[],c=[];case 16:return t.next=18,e.$api.getDeliveryList(a);case 18:l=t.sent,u=l.data,console.log("getDeliveryList - data",u),c=u&&200===u.code&&u.data.data&&u.data.data||[],c.forEach((function(t){t.goodsLink=e.joinLink(t,t.goodsInfo[0].goods_id)})),o=o.concat(c),a.page++;case 25:if(c&&c.length){t.next=16;break}case 26:if(e.tableLoading=!1,o.length){t.next=29;break}return t.abrupt("return",e.$message.warning("没有可导出的数据！"));case 29:if(console.log("exportData",o),d=JSON.parse(JSON.stringify(o)),d.length>7e3){h=0;while(d.length)r[h]=d.splice(0,7e3),h++}else r[0]=d;case 32:for(p=[],g=0;g<r.length;g++)for(f=r[g],m=function(t){for(var r=f[t],n=function(t){var n=r.goodsInfo[t],a={};e.downloadSetList.map((function(t){"country"===t?a[t]=r.mall_info&&r.mall_info.country?e.$filters.chineseSite(r.mall_info.country):"":"platform_mall_name"===t?a[t]=r.mall_info&&r.mall_info.platform_mall_name?r.mall_info.platform_mall_name:"":"goods_name"===t?a[t]=n.goods_name?n.goods_name:"":"outer_goods_id"===t?a[t]=n.outer_goods_id?n.outer_goods_id:"":"order_sn"===t?a[t]=n.order_sn?n.order_sn:"":"goods_count"===t?a[t]=n.goods_count?n.goods_count:"":"variation_name"===t?a[t]=n?n.variation_name:"":"goodsLink"===t?a[t]=r.goodsLink?r.goodsLink:"":"goods_img"===t?a[t]=n?e.$filters.imageRender([n.goods_img]):"":"created_time"===t?a[t]=r.created_time?r.created_time:"":"ship_by_date"===t?a[t]=r.ship_by_date?r.ship_by_date:"":"is_apply_tracking_no"===t?a[t]=r.is_apply_tracking_no?e.trackStatus[r.is_apply_tracking_no]:"":"hasLogistics"===t?a[t]=0==r.hasLogistics?"否":"是":"order_status"===t?a[t]=r.order_status?Object(s["d"])(r.order_status):"":"logistics_name"===t?a[t]=r.logistics_name?r.logistics_name:"":"tracking_no"===t&&(a[t]=r.tracking_no?r.tracking_no:"")})),p.push(a)},a=0;a<r.goodsInfo.length;a++)n(a)},b=0;b<f.length;b++)m(b);return _=JSON.stringify(p),t.next=37,e.$api.saveCustomerFaceData({faceData:_});case 37:w=t.sent,v=w.data,200===v.code?(x=(null===v||void 0===v||null===(k=v.data)||void 0===k?void 0:k.code)||"",console.log(e.$userInfo),e.$BaseUtilService.openUrl("http://".concat(window.location.host,"/customSetDownload?uid=").concat(e.$userInfo.muid,"&uuid=").concat(e.$userInfo.child_id,"&code=").concat(x))):e.$message.error("自定义拣货单展开失败"),e.downloadSetVisible=!1;case 41:case"end":return t.stop()}}),t)})))()},getExportData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i,s,c,l,u,d,h,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.multipleSelection.length){t.next=4;break}e.tableToExcel([e.multipleSelection]),t.next=36;break;case 4:return r="",e.selectMallList.forEach((function(e,t){r=0===t?e.id:r+","+e.id})),n=JSON.parse(JSON.stringify(e.selectForm)),n["page"]=1,n["pageSize"]=200,n["sysMallId"]=r,n["createTime"]=e.createTime.length?e.createTime[0]+" 00:00:00/"+e.createTime[1]+" 23:59:59":"",e.tableLoading=!0,t.next=14,e.$api.getDeliveryList(n);case 14:a=t.sent,i=a.data,s=[],c=i&&200===i.code&&i.data.data&&i.data.data||[];case 18:if(!c||!c.length){t.next=29;break}return c.forEach(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r.goodsLink=e.joinLink(r,r.goodsInfo[0].goods_id);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s=s.concat(c),n.page++,t.next=24,e.$api.getDeliveryList(n);case 24:l=t.sent,u=l.data,c=u&&200===u.code&&u.data.data&&u.data.data||[],t.next=18;break;case 29:if(e.tableLoading=!1,s.length){t.next=32;break}return t.abrupt("return",e.$message.warning("没有可导出的数据！"));case 32:if(d=[],h=JSON.parse(JSON.stringify(s)),h.length>7e3){p=0;while(h.length)d[p]=h.splice(0,7e3),p++}else d[0]=h;e.tableToExcel(d);case 36:case"end":return t.stop()}}),t)})))()},tableToExcel:function(e){for(var t=1,r="<tr>\n            <td>编号</td>\n            <td>站点</td>\n            <td>店铺名称</td>\n            <td>商品名称</td>\n            <td>parentSKU</td>\n            <td>订单编号</td>\n            <td>商品数量</td>\n            <td>商品规格</td>\n            <td>商品链接</td>\n            <td>商品图片</td>\n            <td>订单创建时间</td>\n            <td>截止发货时间</td>\n            <td>是否已申请物流单号</td>\n            <td>是否同步面单信息</td>\n            <td>发货状态</td>\n            <td>虾皮物流</td>\n            <td>虾皮物流单号</td>\n            </tr>",n=0;n<e.length;n++)for(var a=e[n],i=0;i<a.length;i++)for(var o=a[i],c=0;c<o.goodsInfo.length;c++){var u=o.goodsInfo[c];r+="<tr><td>".concat(t++,"</td>\n                <td>").concat(o.mall_info&&o.mall_info.country?this.$filters.chineseSite(o.mall_info.country):"\t","</td>\n                <td>").concat(o.mall_info&&o.mall_info.platform_mall_name?o.mall_info.platform_mall_name:"\t","</td>\n                <td>").concat(u.goods_name?u.goods_name:"\t","</td>\n                <td>").concat(u.outer_goods_id?u.outer_goods_id:"\t","</td>\n                <td style=\"mso-number-format:'@';\">").concat(u.order_sn?u.order_sn:"\t","</td>\n                <td>").concat(u.goods_count?u.goods_count:"\t","</td>\n                <td>").concat(u?u.variation_name:"\t","</td>\n                <td>").concat(o.goodsLink?o.goodsLink:"\t","</td>\n                <td>").concat(u?this.$filters.imageRender([u.goods_img]):"\t","</td>\n                <td>").concat(o.created_time?o.created_time:"\t","</td>\n                <td>").concat(o.ship_by_date?o.ship_by_date:"\t","</td>\n                <td>").concat(o.is_apply_tracking_no?this.trackStatus[o.is_apply_tracking_no]:"\t","</td>\n                <td>").concat(0==o.hasLogistics?"否":"是\t","</td>\n                <td>").concat(o.order_status?Object(s["d"])(o.order_status):"\t","</td>\n                <td>").concat(o.logistics_name?o.logistics_name:"\t","</td>\n                <td>").concat(o.tracking_no?o.tracking_no:"\t","</td>\n                </tr>")}Object(l["k"])("发货管理订单数据",r)},changeRemark:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$api.setLocalRemark({id:e,remark:t.orderRemark});case 2:if(n=r.sent,200!=n.data.code){r.next=9;break}return a=t.tableData.findIndex((function(t){return t.id===e})),t.$message.success("设置备注成功"),t.tableData[a].remark=t.orderRemark,t.activeRemarkID="",r.abrupt("return");case 9:t.$message.error("设置备注失败"),t.activeRemarkID="";case 11:case"end":return r.stop()}}),r)})))()},editRemark:function(e){this.activeRemarkID=e;var t=this.tableData.findIndex((function(t){return t.id===e}));this.orderRemark=this.tableData[t].remark},openBefore:function(){if(!this.multipleSelection.length)return this.$message.warning("请先选择需要备注的商品！");this.localRamarkVisible=!0},batchSetRemark:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择需要标记的商品！"));case 2:e.showConsole=!1,e.multipleSelection.forEach(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={id:r.id,remark:e.localRamark},t.next=3,e.$api.setLocalRemark(n);case 3:a=t.sent,200===a.data.code?(e.$refs.multipleTable.toggleRowSelection(r,!1),e.$refs.Logs.writeLog("订单编号【".concat(r.order_sn,"】备注成功"),!0)):e.$refs.Logs.writeLog("订单编号【".concat(r.order_sn,"】备注失败-").concat(a.data.message),!1),console.log(a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.closeDialog(),e.getOrderList();case 6:case"end":return t.stop()}}),t)})))()},handleKey:function(e){return e.split("\n").map((function(e){return e.replace(/(^\s*)|(\s*$)/g,"")})).filter((function(e){return""!=e}))},openGoodsDetail:function(e){this.clickRow=e,this.goodsList=e.goodsInfo,this.goodsListVisible=!0},closeDialog:function(){this.clickRow={},this.goodsList=[],this.goodsSearchVisible=!1,this.goodsOrderSnStr="",this.localRamark="",this.localRamarkVisible=!1},getOrderList:function(e,t){var r=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,i,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,a="",r.selectMallList.forEach((function(e,t){a=0===t?e.id:a+","+e.id})),i=JSON.parse(JSON.stringify(r.selectForm)),r.currentPage=e||r.currentPage,i["page"]=r.currentPage,i["pageSize"]=r.pageSize,i["sysMallIds"]=a,i["createTime"]=r.createTime&&r.createTime.length?r.createTime[0]+" 00:00:00/"+r.createTime[1]+" 23:59:59":"",i["shipByDate"]=r.shipByDate&&r.shipByDate.length?r.shipByDate[0]+" 00:00:00/"+r.shipByDate[1]+" 23:59:59":"",t&&(o=r.handleKey(t),console.log("snArr",o),o=o.splice(0,50),i.orderSn=o.join(",")),r.tableLoading=!0,n.next=14,r.$api.getDeliveryList(i);case 14:s=n.sent,console.log(s,"111111111"),200===s.data.code?(r.tableData=s.data.data.data,r.total=s.data.data.total):r.$message.error("获取列表失败，".concat(s.data?s.data.message:"")),r.tableLoading=!1,r.closeDialog(),console.log(r.tableData),n.next=25;break;case 22:n.prev=22,n.t0=n["catch"](0),r.tableLoading=!1;case 25:case"end":return n.stop()}}),n,null,[[0,22]])})))()},joinLink:function(e,t){var r="";if(e.mall_info&&e.mall_info.platform_mall_id){var n={platform_mall_id:e.mall_info?e.mall_info.platform_mall_id:""},a=this.$shopeemanService.getWebUrl(e.country,n);r=a+"/product/"+e.mall_info.platform_mall_id+"/"+t}return r},openUrl:function(e,t,r){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,o,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e,"product"!==r){a.next=8;break}return o={platform_mall_id:e.mall_info.platform_mall_id},a.next=5,n.$shopeemanService.getWebUrl(e.country,o);case 5:s=a.sent,console.log(s,"webUrl",e.country),i=s+"/product/"+e.mall_info.platform_mall_id+"/"+t;case 8:n.$BaseUtilService.openUrl(i);case 9:case"end":return a.stop()}}),a)})))()},viewDetails:function(e,t,r){var n={type:e,shopId:r,id:t};this.$BaseUtilService.getOrderDetailInfo(r,JSON.stringify(n))},changeMallList:function(e){this.selectMallList=e.mallList},handleCurrentChange:function(e){this.currentPage=e,this.getOrderList()},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getOrderList()},handleSelectionChange:function(e){this.multipleSelection=e},copyItem:function(e){var t=document.createElement("div");t.id="tempTarget",t.style.opacity="0",t.innerText=e,document.body.appendChild(t);try{var r=document.createRange();r.selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(r),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.$message.success("复制成功")}catch(n){}t.parentElement.removeChild(t)},changeOrderStatus:s["d"]}}),h=d,p=(r("0443"),r("2877")),g=Object(p["a"])(h,n,a,!1,null,"8b4e466e",null);t["default"]=g.exports},feb6:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ul",{staticClass:"storeChooseUL"},[e.isMall?r("li",[e._v(e._s(e._f("chineseSite")(e.countryVal)))]):r("li",{style:e.isReset&&"margin-bottom: 5px"},[r("span",{style:{width:e.spanWidth}},[e._v("所属站点：")]),r("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:"",disabled:e.isBanPerform},model:{value:e.countryVal,callback:function(t){e.countryVal=t},expression:"countryVal"}},[e.isAll?r("el-option",{attrs:{label:"全部",value:""}}):e._e(),e._l(e.countries,(function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),r("li",{style:e.isReset&&"margin-bottom: 5px"},[r("span",{style:{width:e.spanWidth}},[e._v("店铺分组：")]),r("el-select",{staticClass:"selectBox",attrs:{disabled:e.isBanPerform,multiple:"","collapse-tags":"",filterable:"",size:"mini"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupIdList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.group_name,value:e.id}})})),1)],1),r("li",{style:e.isReset&&"margin-bottom: 5px"},[r("span",{style:{width:e.spanWidth}},[e._v("店铺名称：")]),r("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.loadmoreMall,expression:"loadmoreMall"}],staticClass:"selectBox",attrs:{disabled:e.isBanPerform,placeholder:"",multiple:!e.isAShop,"collapse-tags":"","filter-method":e.filterMall,size:"mini",filterable:"",clearable:""},on:{"visible-change":function(t){return e.filterMall("")}},model:{value:e.site,callback:function(t){e.site=t},expression:"site"}},[e.isAShop?e._e():r("el-option",{attrs:{label:"全部",value:""}}),e._l(e.siteShowList,(function(t,n){return e.showMall(t,n)?r("el-option",{key:n,attrs:{label:t.mall_alias_name||t.platform_mall_name,value:t.platform_mall_id}}):e._e()}))],2)],1),e.isReset?r("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[r("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary",disabled:e.isBanPerform},on:{click:e.reset}},[e._v("　刷　　新　")])],1):e._e()])])},a=[],i=r("1da1"),o=r("b85c"),s=r("2909"),c=(r("96cf"),r("d81d"),r("fb6a"),r("caad"),r("2532"),r("d3b7"),r("25f0"),r("99af"),r("6062"),r("3ca3"),r("ddb0"),r("4de4"),r("159b"),r("c740"),r("7db0"),r("7646")),l=r("2b0e");l["default"].directive("loadmore",{bind:function(e,t){var r=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");r.addEventListener("scroll",(function(){this.scrollHeight-this.scrollTop<=this.clientHeight+50?t.value(!0,this):this.scrollTop<30&&t.value(!1,this)}))}});var u={name:"StoreChoose",props:{spanWidth:{type:String,default:"80px"},parentCountry:{type:String,default:"TH"},isMall:{type:Boolean,default:function(){return!1}},isBanPerform:{type:Boolean,default:function(){return!1}},isAll:{type:Boolean,default:function(){return!1}},isReset:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}},isAShop:{type:Boolean,default:function(){return!1}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],siteShowList:[],countries:this.$filters.countries_option,mallListAPIInstance:new c["a"](this),isShowName:"",isShowNameAll:!1,showMallNumber:100,mallShowIndex:0,jsonMallData:[],filterMallTime:null}},watch:{siteList:function(e){this.siteShowList=e},countryVal:{handler:function(e,t){this.isShowName="",this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(e,t){var r=this;if(this.isAllowSet2){this.isShowName="",this.isAllowSet2=!1;var n=t.indexOf("")>-1,a=e.indexOf("")>-1;n!==a?this.groupId=a?Object(s["a"])(this.groupIdList.map((function(e){return e.id}))):[]:a?this.groupId=e.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length-1&&this.groupId.unshift(""),setTimeout((function(){r.isAllowSet2=!0,r.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(e,t){var r=this;if(this.isAllowSet1){this.isAllowSet1=!1;var n=this.isShowName;if(!this.isAShop){var a=t.includes(""),i=e.includes("");if(a!==i||t.toString()===e.toString()&&this.isShowNameAll)if(i&&(!n||n&&!this.isShowNameAll)){var c=n&&Object(s["a"])(this.siteShowList.map((function(e){return e.platform_mall_id})))||[""].concat(Object(s["a"])(this.siteList.map((function(e){return e.platform_mall_id})))),l=new Set([].concat(Object(s["a"])(c),Object(s["a"])(t)));this.site=Object(s["a"])(l),this.isShowNameAll=!0,n&&this.siteList.length===this.site.length&&this.site.unshift("")}else{this.isShowNameAll=!1;var u=[];if(n){var d=n&&Object(s["a"])(this.siteShowList.map((function(e){return e.platform_mall_id}))),h=d.length>this.site.length&&this.site||d,p=d.length>this.site.length&&d||this.site;u=new Set(this.site);var g,f=Object(o["a"])(p);try{for(f.s();!(g=f.n()).done;){var m=g.value;h.includes(m)&&u.delete(m)}}catch(b){f.e(b)}finally{f.f()}u.delete("")}this.site=Object(s["a"])(u)}else i?this.site=e.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length?this.site.unshift(""):this.isShowNameAll=!1}setTimeout((function(){r.changeMallList(),r.filterMall(n),r.isAllowSet1=!0}),10)}},deep:!0}},mounted:function(){this.countryVal=this.isMall?this.parentCountry:this.isAll?"":"TH"},methods:{reset:function(){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},ddMallGoodsGetMallList:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,a,i,o,c,l,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.site=[],n=t.countryVal,a=[],!(t.jsonMallData.length>0)){r.next=7;break}a=t.jsonMallData,r.next=12;break;case 7:return r.next=9,t.$appConfig.temporaryCacheInfo("get","mallAllData","");case 9:i=r.sent,a=JSON.parse(i)||[],t.jsonMallData=JSON.parse(i)||[];case 12:if(!(a.length>0)){r.next=17;break}1===e&&(t.siteList=""===n?a:a.filter((function(e){return e.country===n}))),2===e&&(0===t.groupId.length?t.siteList=[]:(t.siteList=[],t.groupId.forEach((function(e){a.forEach((function(r){n?e===r.group_id&&n===r.country&&t.siteList.push(r):e===r.group_id&&t.siteList.push(r)}))})))),r.next=22;break;case 17:return o={country:"",mallGroupIds:""},r.next=20,t.mallListAPIInstance.ddMallGoodsGetMallList(o);case 20:c=r.sent,200===c.code?(t.$appConfig.temporaryCacheInfo("save","mallAllData",c.data),l=c.data||[],t.siteList=l,t.jsonMallData=l,t.siteList=""===n?l:l.filter((function(e){return e.country===n}))):t.$message.error("获取分组、店铺列表失败");case 22:u=[],0===t.groupIdList.length&&(t.groupIdList=[{group_name:"全部",id:""}],t.siteList.forEach((function(e){var t=u.findIndex((function(t){return t&&t.id===e.group_id}));e.group_name&&t<0&&u.push({group_name:e.group_name,id:e.group_id})})),u.zzSort("id"),t.groupIdList=[].concat(Object(s["a"])(t.groupIdList),u),t.groupId=[""].concat(Object(s["a"])(u.map((function(e){return e.id}))))),setTimeout((function(){t.isAllowSet2=!0,t.isAllowSet1=!0,t.site=!t.isAShop&&[""]||""}),10);case 25:case"end":return r.stop()}}),r)})))()},changeMallList:function(){var e=this,t=[],r="";if(this.isAShop){var n=this.siteList.find((function(t){return t.platform_mall_id===e.site}));r=this.site,t.push(n)}else this.site.forEach((function(n){if(n){var a=e.siteList.find((function(e){return e.platform_mall_id===n}));t.push(a),r+=n+","}}));!this.countryVal&&this.groupId.indexOf("")>-1&&(r=t.length!==this.siteList.length&&r||""),this.source?this.$emit("changeMallList",{mallList:t,source:this.source,searchAll:r,country:this.countryVal.toLocaleUpperCase()}):(t["country"]=this.countryVal,this.$emit("changeMallList",t))},filterMall:function(e){var t=this,r=e&&this.isShowName!==e?1e3:100;this.filterMallTime&&(clearTimeout(this.filterMallTime),this.filterMallTime=null),this.filterMallTime=setTimeout((function(){t.isShowName!==e&&(t.mallShowIndex=0),t.isShowName=e||"";var r=t.siteList;e&&(r=t.siteList.filter((function(t){var r=t.mall_alias_name||t.platform_mall_name;return r.includes(e)}))),t.siteShowList=r}),r)},showMall:function(e,t){var r=e.mall_alias_name||e.platform_mall_name,n=this.site[0]===e.platform_mall_id;return n||this.mallShowIndex<=t&&t<=this.mallShowIndex+this.showMallNumber&&(!this.isShowName||r.includes(this.isShowName))},loadmoreMall:function(e,t){if(this.siteShowList.length>this.showMallNumber){var r=0;e?(r=this.mallShowIndex+10,r=r<this.siteShowList.length-this.showMallNumber&&r||this.siteShowList.length-this.showMallNumber):(r=this.mallShowIndex-10,r=r>0&&r||0),r!==this.mallShowIndex&&(t.scrollTop=e?t.scrollTop-100:30),this.mallShowIndex=r}}}},d=u,h=(r("8992"),r("2877")),p=Object(h["a"])(d,n,a,!1,null,null,null);t["a"]=p.exports}}]);