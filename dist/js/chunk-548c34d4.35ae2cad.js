(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-548c34d4"],{"45cd":function(e,t,a){"use strict";a("c56d")},"53ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}},c56d:function(e,t,a){},c68c:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"batch-chat"},[a("div",{staticClass:"select-box"},[a("div",{staticClass:"select-mall"},[a("storeChoose",{attrs:{"is-all":!0,"span-width":"80px","select-width":"180px",source:"orderCenter"},on:{changeMallList:e.changeMallList}}),e.btnLoading?a("el-button",{staticClass:"mar-left",attrs:{type:"primary",size:"mini"},on:{click:e.cancel}},[e._v("停 止")]):a("el-button",{staticClass:"mar-left",attrs:{type:"primary",size:"mini"},on:{click:e.chatStart}},[e._v("开 始")]),a("el-button",{staticClass:"mar-left",attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清空日志")]),a("el-checkbox",{staticClass:"mar-left",model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}},[e._v("隐藏日志")])],1),a("div",{staticClass:"chat-set-box"},[a("div",{staticClass:"base-box left-box"},[a("span",{staticClass:"base-title"},[e._v("私聊对象")]),a("div",{staticClass:"base-item"},[a("div",{staticClass:"row-style"},[a("el-radio-group",{on:{change:e.changeUserType},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[a("el-radio",{attrs:{label:"order"}},[e._v("订单客户")]),a("el-radio",{attrs:{label:"fans"}},[e._v("粉丝用户")])],1)],1),a("div",{staticClass:"row-style"},[a("p",[a("el-checkbox",{attrs:{disabled:"fans"===e.radio},model:{value:e.filterCheck,callback:function(t){e.filterCheck=t},expression:"filterCheck"}},[e._v("过滤 ")]),a("el-input",{staticStyle:{width:"50px"},attrs:{disabled:"fans"===e.radio,placeholder:"请输入内容",size:"mini"},model:{value:e.filterDays,callback:function(t){e.filterDays=t},expression:"filterDays"}}),e._v(" 天以前的订单 ")],1)]),a("div",{staticClass:"row-style"},[a("div",{staticClass:"base-box mar-top"},[a("span",{staticClass:"base-title"},[e._v("订单类型选择")]),a("div",{staticClass:"base-item"},[a("el-checkbox-group",{attrs:{disabled:"fans"===e.radio||e.btnLoading},model:{value:e.orderType,callback:function(t){e.orderType=t},expression:"orderType"}},e._l(e.orderTypeList,(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])})),1)],1)])])])]),a("div",{staticClass:"base-box center-box mar-left"},[a("span",{staticClass:"base-title"},[e._v("私聊内容")]),a("div",{staticClass:"base-item"},[a("div",{staticClass:"row-style"},[a("el-input",{staticStyle:{height:"60px"},attrs:{type:"textarea",resize:"none",rows:3,clearable:"",size:"mini"},model:{value:e.sendText,callback:function(t){e.sendText=t},expression:"sendText"}}),a("div",{staticClass:"chat-content-btn"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.addMessage}},[e._v("添加消息")]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"若添加多条内容则会随机选择一条发送，建议添加多条不通的内容降低被平台屏蔽风险",placement:"right-end"}},[a("i",{staticClass:"el-icon-question"})])],1)],1),a("div",{staticClass:"row-style"},[a("div",{staticClass:"chat-content-list"},e._l(e.messageList,(function(t,n){return a("div",{key:n,staticClass:"chat-content-item"},[a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:function(t){return e.deleteMessage(n)}}},[e._v("删除")]),a("span",{staticClass:"mar-left"},[e._v(e._s(t))])],1)})),0)])])]),a("div",{staticClass:"right-box mar-left"},[a("div",{staticClass:"base-box mar-top"},[a("span",{staticClass:"base-title"},[a("el-checkbox",{staticClass:"mar-left",attrs:{disabled:e.btnLoading},model:{value:e.isSendDiscount,callback:function(t){e.isSendDiscount=t},expression:"isSendDiscount"}},[e._v("是否发送优惠券")])],1),a("div",{staticClass:"base-item"},[a("el-radio",{attrs:{label:"random",disabled:e.btnLoading},model:{value:e.radioDiscountType,callback:function(t){e.radioDiscountType=t},expression:"radioDiscountType"}},[e._v("随机优惠券")]),a("el-radio",{attrs:{label:"fixed",disabled:e.btnLoading},model:{value:e.radioDiscountType,callback:function(t){e.radioDiscountType=t},expression:"radioDiscountType"}},[e._v("固定优惠券")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",disabled:e.btnLoading},model:{value:e.discountName,callback:function(t){e.discountName=t},expression:"discountName"}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"请输入固定优惠券的名称，多个店铺可以通过名称找到相应的优惠券",placement:"right-end"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"base-box mar-top"},[a("span",{staticClass:"base-title"},[a("el-checkbox",{staticClass:"mar-left",attrs:{disabled:e.btnLoading},model:{value:e.isSendGoods,callback:function(t){e.isSendGoods=t},expression:"isSendGoods"}},[e._v("是否发送商品")])],1),a("div",{staticClass:"base-item"},[a("el-radio",{attrs:{label:"random",disabled:e.btnLoading},model:{value:e.radioGoodsType,callback:function(t){e.radioGoodsType=t},expression:"radioGoodsType"}},[e._v("随机商品")]),a("el-radio",{attrs:{label:"fixed",disabled:e.btnLoading},model:{value:e.radioGoodsType,callback:function(t){e.radioGoodsType=t},expression:"radioGoodsType"}},[e._v("固定商品")]),a("el-input",{staticStyle:{width:"180px","margin-left":"24px"},attrs:{size:"mini",disabled:e.btnLoading},model:{value:e.GoodsId,callback:function(t){e.GoodsId=t},expression:"GoodsId"}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"请输入固定商品ID，固定商品只在商品所在店铺下有效",placement:"right-end"}},[a("i",{staticClass:"el-icon-question"})])],1)]),a("div",{staticClass:"base-box mar-top"},[a("span",{staticClass:"base-title"},[e._v("发送设置")]),a("div",{staticClass:"base-item"},[e._v(" 发送私聊数量"),a("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},model:{value:e.sendNum,callback:function(t){e.sendNum=t},expression:"sendNum"}}),e._v("（0标表示无限制）发送间隔 "),a("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini"},model:{value:e.sendTime,callback:function(t){e.sendTime=t},expression:"sendTime"}}),e._v("秒 ")],1)])])])]),a("div",{staticClass:"content"},[a("u-table",{ref:"multipleTable",attrs:{data:e.tableData,"header-cell-style":{background:"#f7fafa"},height:"520px"}},[a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.$index+1))]}}])}),a("u-table-column",{attrs:{width:"80px",label:"站点",prop:"country",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("chineseSite")(a.country))+" ")]}}])}),a("u-table-column",{attrs:{width:"120px",label:"店铺名称",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.mallInfo.mall_alias_name||a.mallInfo.platform_mall_name)+" ")]}}])}),a("u-table-column",{attrs:{align:"center",prop:"userName",label:"私聊用户",width:"120","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",prop:"userType",label:"用户类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.userType[a.userType])+" ")]}}])}),a("u-table-column",{attrs:{align:"center",prop:"chatMessage",label:"私聊内容",width:"300"}}),a("u-table-column",{attrs:{prop:"chatDiscount",label:"发送优惠券",align:"center",width:"120px"}}),a("u-table-column",{attrs:{align:"center",prop:"chatGoods",label:"发送商品",width:"100"}}),a("u-table-column",{attrs:{align:"center",prop:"remark",label:"操作信息","min-width":"400","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.remark))]}}])})],1)],1),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}})],1)},r=[],s=a("53ca"),i=a("1da1"),o=(a("96cf"),a("99af"),a("fb6a"),a("ac1f"),a("466d"),a("159b"),a("3ca3"),a("ddb0"),a("498a"),a("a9e3"),a("c740"),a("4de4"),a("caad"),a("2532"),a("7db0"),a("b0c0"),a("d3b7"),a("25f0"),a("a434"),a("6c27")),c=a("feb6"),l=a("2f6f"),u=a("0e0b"),d={name:"BusinessAnalyseStoreSelection",components:{storeChoose:c["a"]},data:function(){return{selectMallList:[],showConsole:!0,radio:"order",filterDays:30,filterCheck:!1,orderType:["unpaid"],orderTypeList:[{label:"未支付",value:"unpaid"},{label:"待发货",value:"toship"},{label:"已发货",value:"shipping"},{label:"已取消",value:"cancelled"},{label:"已完成",value:"completed"}],userType:{unpaid:"未支付订单",toship:"待发货订单",shipping:"已发货订单",cancelled:"已取消订单",completed:"已完成订单",fans:"粉丝用户"},chatContent:"",sendNum:0,sendTime:10,radioDiscountType:"random",radioGoodsType:"random",discountName:"",GoodsId:"",isSendDiscount:!1,isSendGoods:!1,messageList:[],sendText:"",tableData:[],findChatList:[],StoreSelection:new l["a"](this),btnLoading:!1,isStop:!1}},mounted:function(){},methods:{cancel:function(){this.isStop=!0,this.btnLoading=!1,Object(u["x"])(),this.$refs.Logs.writeLog("停止操作,可能需要一些时间！",!1),this.$alert("正在停止操作，可能需要一些时间！","提示",{confirmButtonText:"确定"})},changeUserType:function(){var e=this;"fans"===this.radio&&this.$confirm("批量私聊粉丝用户操作违反shopee官方政策，可能会被shopee官方冻结台湾站店铺发送消息大于1000个后，会被官方禁言24小时，因批量私聊粉丝用户导致店铺被封，后果自行承担，请谨慎使用","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){})).catch((function(){e.radio="order"}))},orderBatchMessage:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,s,i,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.length>1&&void 0!==t[1]?t[1]:{count:5},n.prev=1,!a.isStop){n.next=5;break}return a.btnLoading=!1,n.abrupt("return");case 5:s=[],i="",o=0;case 8:if(!(o<a.orderType.length)){n.next=19;break}return i=a.orderType[o],n.next=12,a.getOrderUser(e,i);case 12:if(n.t0=n.sent,n.t0){n.next=15;break}n.t0=[];case 15:s=n.t0;case 16:o++,n.next=8;break;case 19:if(!s.length){n.next=36;break}if(c=s,!(a.sendNum>0)){n.next=29;break}if(!(a.sendNum>=s.length)){n.next=26;break}c=s,n.next=29;break;case 26:return n.next=28,a.getRandomArrayElements(s,a.sendNum);case 28:c=n.sent;case 29:return a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】获取到订单用户").concat(c.length,"条"),!0),n.next=32,a.batchSendMessage(c,e,i);case 32:return n.next=34,Object(u["h"])(1e3*a.sendTime);case 34:n.next=37;break;case 36:a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】未获取到订单用户，聊天结束"),!0);case 37:n.next=41;break;case 39:n.prev=39,n.t1=n["catch"](1);case 41:return n.prev=41,--r.count,n.finish(41);case 44:case"end":return n.stop()}}),n,null,[[1,39,41,44]])})))()},fansBatchMessage:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,s,i,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.length>1&&void 0!==t[1]?t[1]:{count:5},n.prev=1,!a.isStop){n.next=5;break}return a.btnLoading=!1,n.abrupt("return");case 5:return s="fans",n.next=8,a.getFansAll(e);case 8:if(i=n.sent,!i.length){n.next=26;break}if(o=i,!(a.sendNum>0)){n.next=19;break}if(!(a.sendNum>=i.length)){n.next=16;break}o=i,n.next=19;break;case 16:return n.next=18,a.getRandomArrayElements(i,a.sendNum);case 18:o=n.sent;case 19:return a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】获取到粉丝用户").concat(o.length,"条"),!0),n.next=22,a.batchSendMessage(o,e,s);case 22:return n.next=24,Object(u["h"])(1e3*a.sendTime);case 24:n.next=27;break;case 26:a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】未获取到粉丝用户，聊天结束"),!0);case 27:n.next=31;break;case 29:n.prev=29,n.t0=n["catch"](1);case 31:return n.prev=31,--r.count,n.finish(31);case 34:case"end":return n.stop()}}),n,null,[[1,29,31,34]])})))()},chatStart:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.tableData=[],t.prev=1,e.isStop=!1,e.selectMallList.length){t.next=5;break}return t.abrupt("return",e.$message.warning("请选择店铺！"));case 5:if("order"!==e.radio){t.next=8;break}if(e.orderType.length){t.next=8;break}return t.abrupt("return",e.$message.warning("请至少选择一种订单类型！"));case 8:if(e.messageList.length||e.isSendDiscount&&(!e.isSendDiscount||"fixed"!=e.radioDiscountType||e.discountName)||e.isSendGoods&&(!e.isSendGoods||"fixed"!=e.radioGoodsType||e.GoodsId)){t.next=10;break}return t.abrupt("return",e.$message.warning("无可发送内容！"));case 10:if(e.btnLoading=!0,e.showConsole=!1,!e.isStop){t.next=15;break}return e.btnLoading=!1,t.abrupt("return");case 15:if("order"!=e.radio){t.next=20;break}return t.next=18,Object(u["c"])(e.selectMallList,e.orderBatchMessage);case 18:t.next=22;break;case 20:return t.next=22,Object(u["c"])(e.selectMallList,e.fansBatchMessage);case 22:e.btnLoading=!1,t.next=29;break;case 25:t.prev=25,t.t0=t["catch"](1),e.btnLoading=!1,e.$alert("出现错误，已停止执行","提示",{confirmButtonText:"确定",callback:function(e){}});case 29:case"end":return t.stop()}}),t,null,[[1,25]])})))()},getRandomArrayElements:function(e,t){return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,s,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.slice(0),r=e.length,s=r-t;while(r-- >s)o=Math.floor((r+1)*Math.random()),i=n[o],n[o]=n[r],n[r]=i;return a.abrupt("return",n.slice(s));case 3:case"end":return a.stop()}}),a)})))()},getFansAll:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,r,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=1,r=40,s=[],a.next=5,t.getFans(e,n,r);case 5:i=a.sent;case 6:if(!i.length){a.next=20;break}if(!t.isStop){a.next=9;break}return a.abrupt("break",20);case 9:if(s=s.concat(i),!(i.length<r)){a.next=14;break}i=[],a.next=18;break;case 14:return n++,a.next=17,t.getFans(e,n,r);case 17:i=a.sent;case 18:a.next=6;break;case 20:return a.abrupt("return",s);case 21:case"end":return a.stop()}}),a)})))()},getFans:function(e,t,a){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var s,i,o,c,l,u,d,m,b;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.isStop){r.next=3;break}return n.btnLoading=!1,r.abrupt("return");case 3:return s=[],r.next=6,n.$shopeemanService.getWebUrl(e.country);case 6:return i=r.sent,o=i+"/shop/"+e.platform_mall_id+"/followers/",c=(t-1)*a,l={offset:c,limit:a,offset_of_offset:0,_:(new Date).getTime(),__classic__:1},r.next=12,window["NetMessageBridgeService"].get(o,JSON.stringify({params:l,headers:{isGBK:!1}}));case 12:return u=r.sent,d=JSON.parse(u),m=d.data,b=m.match(/<li\s*data-follower-shop-id=.(\d+).\s*data-follower[^>]+>[\s\t\n]+<a[^>]+username='([^>]+)'\s*userid=.([0-9]+).\s*?class=.shop-href.>/g),b&&b.length&&b.forEach((function(e){var t=e.match(/data-follower-shop-id=.(\d+)/)[1],a=e.match(/username='(\w+)'/)?e.match(/username='(\w+)'/)[1]:"";if(""!==a){var n=e.match(/userid='(\d+)'/)[1],r={shopId:t,username:a,user_id:n};s.push(r)}})),r.abrupt("return",s);case 18:case"end":return r.stop()}}),r)})))()},batchSendMessage:function(e,t,a){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.isStop){r.next=3;break}return n.btnLoading=!1,r.abrupt("return");case 3:return r.prev=3,r.delegateYield(regeneratorRuntime.mark((function r(){var i,o,c,l,d,m,b,p,f,h,g;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,window["ConfigBridgeService"].getGlobalCacheInfo("mallInfo",t.platform_mall_id);case 2:return i=r.sent,o=i&&JSON.parse(i),c=o.web_login_info.ShopeeUid,l={params:{_uid:"0-".concat(c),_v:"5.8.0",_ts:Math.round((new Date).getTime()/1e3)}},d={shop_id:t.platform_mall_id},r.next=9,n.$shopeemanService.loginMessage(t.country,d,l);case 9:m=r.sent,b=m.data.token,p="",f=regeneratorRuntime.mark((function r(s){var i,o,l,d,m,f,h,g,x,_,v,k,y,w,D,S,L,T,C,M,$,N,I,O,G,R,j,z,B,U,A,q;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!n.isStop){r.next=3;break}return n.btnLoading=!1,r.abrupt("return",{v:{v:void 0}});case 3:if(i=e[s],o=i.buyer_user?i.buyer_user.user_name.trim():i.username.trim(),l=Number(i.user_id),b){r.next=8;break}return r.abrupt("return","continue");case 8:if(!n.messageList.length){r.next=19;break}return d=n.tableData.findIndex((function(e){return e.userName==o})),d<0&&(m={country:t.country,mallInfo:t,userName:o,userType:a,chatMessage:"",chatDiscount:"",chatGoods:"",remark:""},n.tableData.push(m)),f="",1==n.messageList.length?f=n.messageList[0]:(h=n.messageList.filter((function(e){return e!==p})),g=Math.floor(Math.random()*h.length),f=h[g]),x=(new Date).getTime(),r.next=16,n.sendMessage("text",f,{},l,Number(t.platform_mall_id),b,t.country,x,c);case 16:_=r.sent,v=n.tableData.findIndex((function(e){return e.userName==o})),200===_.code?(p=f,n.$set(n.tableData[v],"remark","".concat(n.tableData[v].remark,"【消息发送成功】")),n.$set(n.tableData[v],"chatMessage",f)):n.$set(n.tableData[v],"remark","".concat(n.tableData[v].remark,"【消息发送失败  ").concat(_.data.message.includes("user_is_forbiddenUser is forbidden for this action")?"该用户禁止发送消息":"","】"));case 19:if(!n.isSendDiscount){r.next=38;break}return r.next=22,n.sendDiscount(t.country,t.platform_mall_id);case 22:if(k=r.sent,y=n.tableData.findIndex((function(e){return e.userName==o})),y<0&&(w={country:t.country,mallInfo:t,userName:o,userType:a,chatMessage:"",chatDiscount:"",chatGoods:"",remark:""},n.tableData.push(w)),D=null,S="",k.length?"random"===n.radioDiscountType?(L=Math.floor(Math.random()*k.length),D=k[L]):(D=k.find((function(e){return e.name==n.discountName.trim()})),D||(S="【没有找到名为".concat(n.discountName,"】的优惠券"))):(D=null,S="【没有可以使用的优惠券】"),T=n.tableData.findIndex((function(e){return e.userName==o})),D){r.next=33;break}n.$set(n.tableData[T],"remark","".concat(n.tableData[T].remark).concat(S)),r.next=38;break;case 33:return C=(new Date).getTime(),r.next=36,n.sendMessage("voucher","",D,l,Number(t.platform_mall_id),b,t.country,C,c);case 36:M=r.sent,200===M.code?(n.$set(n.tableData[T],"remark","".concat(n.tableData[T].remark,"【优惠券发送成功】")),n.$set(n.tableData[T],"chatDiscount","".concat(D.name))):n.$set(n.tableData[T],"remark","".concat(n.tableData[T].remark,"【消息发送失败  ").concat(M.data.message.includes("user_is_forbiddenUser is forbidden for this action")?"该用户禁止发送消息":"","】"));case 38:if(!n.isSendGoods){r.next=66;break}if($=n.tableData.findIndex((function(e){return e.userName==o})),$<0&&(N={country:t.country,mallInfo:t,userName:o,userType:a,chatMessage:"",chatDiscount:"",chatGoods:"",remark:""},n.tableData.push(N)),I=null,O="",G={offset:0,limit:100,need_brand:0,need_item_model:0,is_ads:0,platform_mall_id:t.platform_mall_id,country:t.country},"random"!=n.radioGoodsType){r.next=51;break}return r.next=47,n.StoreSelection.productSelector(G);case 47:R=r.sent,200==R.code&&R.data.length?(j=Math.floor(Math.random()*R.data.length),I=R.data[j]):O="【没有可以发送的商品】",r.next=56;break;case 51:return G["id"]=n.GoodsId,r.next=54,n.StoreSelection.productSelector(G);case 54:z=r.sent,200==z.code&&z.data.length?I=z.data[0]:O="【没有找到商品ID为".concat(n.GoodsId,"的商品】");case 56:if(B=n.tableData.findIndex((function(e){return e.userName==o})),I){r.next=61;break}n.$set(n.tableData[B],"remark","".concat(n.tableData[B].remark).concat(O)),r.next=66;break;case 61:return U=(new Date).getTime(),r.next=64,n.sendMessage("product","",I,l,Number(t.platform_mall_id),b,t.country,U,c);case 64:A=r.sent,200===A.code?(n.$set(n.tableData[B],"remark","".concat(n.tableData[B].remark,"【商品发送成功】")),n.$set(n.tableData[B],"chatGoods","".concat(I.itemid))):n.$set(n.tableData[B],"remark","".concat(n.tableData[B].remark,"【消息发送失败  ").concat(A.data.message.includes("user_is_forbiddenUser is forbidden for this action")?"该用户禁止发送消息":"","】"));case 66:return q=n.tableData.findIndex((function(e){return e.userName==o})),n.$set(n.tableData[q],"remark","".concat(n.tableData[q].remark,"【操作结束】")),r.next=70,Object(u["h"])(1e3*n.sendTime);case 70:case"end":return r.stop()}}),r)})),h=0;case 14:if(!(h<e.length)){r.next=24;break}return r.delegateYield(f(h),"t0",16);case 16:if(g=r.t0,"continue"!==g){r.next=19;break}return r.abrupt("continue",21);case 19:if("object"!==Object(s["a"])(g)){r.next=21;break}return r.abrupt("return",g.v);case 21:h++,r.next=14;break;case 24:case"end":return r.stop()}}),r)}))(),"t0",5);case 5:if(i=r.t0,"object"!==Object(s["a"])(i)){r.next=8;break}return r.abrupt("return",i.v);case 8:r.next=12;break;case 10:r.prev=10,r.t1=r["catch"](3);case 12:case"end":return r.stop()}}),r,null,[[3,10]])})))()},sendDiscount:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,s,i,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={offset:0,limit:40,promotion_type:1,shop_id:t},s=[],n.next=4,a.$shopeemanService.getVouchers(e,r);case 4:i=n.sent,o=i.data.voucher_list;case 6:if(!o.length){n.next=22;break}if(!a.isStop){n.next=10;break}return a.btnLoading=!1,n.abrupt("break",22);case 10:if(s=s.concat(o),!(o.length<40)){n.next=15;break}o=[],n.next=20;break;case 15:return r.promotion_type++,n.next=18,a.$shopeemanService.getVouchers(e,r);case 18:c=n.sent,o=c&&c.data&&c.data.voucher_list||[];case 20:n.next=6;break;case 22:return n.abrupt("return",s);case 23:case"end":return n.stop()}}),n)})))()},sendMessage:function(e,t,a,n,r,s,o,c,l){var u=this;return Object(i["a"])(regeneratorRuntime.mark((function i(){var d,m,b,p,f,h,g;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return g=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},h=function(){return g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g()},d={},"text"==e&&(d={text:t}),"product"==e&&(d={product_id:a.itemid,shop_id:r}),"voucher"==e&&(d={voucher_code:a.voucher_code,voucher_id:a.voucher_id}),m={request_id:h(),to_id:n,type:e,content:d,chat_send_option:{force_send_cancel_order_warning:!1,comply_cancel_order_warning:!1},device_id:h(),shop_id:r},b=u.sha256("/webchat/api/v1.2/messages",m,c,l),p={headers:{referer:"/webchat/conversations","Content-Type":"text/plain;charset=UTF-8","x-s":b,"x-v":1,Authorization:"Bearer ".concat(s)},params:{_uid:"0-".concat(l),_ts:c,_v:"6.1.1"}},i.next=11,u.$shopeemanService.sendMessage(o,m,p);case 11:return f=i.sent,i.abrupt("return",f);case 13:case"end":return i.stop()}}),i)})))()},sha256:function(e,t,a,n){var r=e.match(/v\d+(.\d+)*/)[0],s="396c15ad-6d3e-4018-98be-cef58cb45cd0",i="6.1.1",c=r,l=n,u=t["request_id"],d=t["to_id"],m=t["type"],b="";"text"===m&&(b=t.content.text);var p="key=".concat(s,"&plat=").concat(i,"&ver=").concat(c,"&fromID=").concat(l,"&reqID=").concat(u,"&toID=").concat(d,"&timestamp=").concat(a,"&type=").concat(m,"&strinput=").concat(b),f="".concat(p),h=Object(o["sha256"])(f);return h},getOrderUser:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,s,i,o,c,l,u,d,m,b,p,f,h,g,x,_,v,k,y,w,D,S,L,T,C,M,$;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=[],"shipping"!=t){n.next=46;break}return s={page_size:40,page_number:1,total:0,sort_by:"confirmed_date_desc",shop_id:e.platform_mall_id},n.next=5,a.$shopeemanService.getToShipOrderIdList(e.country,s);case 5:if(i=n.sent,200!==i.code){n.next=39;break}o=i.data,c=o.package_list,l=o.total;case 8:if(!c.length){n.next=37;break}if(!a.isStop){n.next=12;break}return a.btnLoading=!1,n.abrupt("break",37);case 12:u=[],d=0;case 14:if(!(d<c.length)){n.next=23;break}return m=c.slice(d,d+5),n.next=18,a.$shopeemanService.getDetailsByOrderIds(e.country,{from_seller_data:!1,orders:a.changeParams(m),shop_id:e.platform_mall_id});case 18:b=n.sent,200===b.code&&(p=b.data&&b.data.orders||[],u=u.concat(b.data.orders),p&&p.length&&(a.filterCheck?(f=p.filter((function(e){return(new Date).getTime()-1e3*e.create_time<24*a.filterDays*60*60*1e3})),r=r.concat(f)):r=r.concat(p)));case 20:d+=5,n.next=14;break;case 23:if(h="",h=u[u.length-1].create_time,!(c.length<40||h&&(new Date).getTime()-1e3*h>24*a.filterDays*60*60*1e3)){n.next=29;break}c=[],n.next=35;break;case 29:return s.page_number++,s.total=l,n.next=33,a.$shopeemanService.getToShipOrderIdList(a.mall.country,s);case 33:g=n.sent,c=g&&g.data&&g.data.package_list||[];case 35:n.next=8;break;case 37:n.next=44;break;case 39:if(403!==i.code){n.next=43;break}return n.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】未登录"),!1));case 43:return n.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(i.code,"-").concat(i.data),!1));case 44:n.next=88;break;case 46:return x={from_page_number:1,source:t,page_size:40,page_number:1,total:0,is_massship:!1,shop_id:e.platform_mall_id},n.next=49,a.$shopeemanService.getOrderIdList(e.country,x);case 49:if(_=n.sent,200!==_.code){n.next=83;break}v=_.data,k=v.orders,y=v.page_info;case 52:if(!k.length){n.next=81;break}if(!a.isStop){n.next=56;break}return a.btnLoading=!1,n.abrupt("break",81);case 56:w=[],D=0;case 58:if(!(D<k.length)){n.next=67;break}return S=k.slice(D,D+5),n.next=62,a.$shopeemanService.getDetailsByOrderIds(e.country,{from_seller_data:!1,orders:S,shop_id:e.platform_mall_id});case 62:L=n.sent,200===L.code&&(T=L.data&&L.data.orders||[],w=w.concat(L.data.orders),T&&T.length&&(a.filterCheck?(C=T.filter((function(e){return(new Date).getTime()-1e3*e.create_time<24*a.filterDays*60*60*1e3})),r=r.concat(C)):r=r.concat(T)));case 64:D+=5,n.next=58;break;case 67:if(M="",M=w[w.length-1].create_time,!(k.length<40||M&&(new Date).getTime()-1e3*M>24*a.filterDays*60*60*1e3)){n.next=73;break}k=[],n.next=79;break;case 73:return x.page_number++,x.total=y.total,n.next=77,a.$shopeemanService.getOrderIdList(e.country,x);case 77:$=n.sent,k=$&&$.data&&$.data.orders||[];case 79:n.next=52;break;case 81:n.next=88;break;case 83:if(403!==_.code){n.next=87;break}return n.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】未登录"),!1));case 87:return n.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mall_alias_name||e.platform_mall_name,"】").concat(_.code,"-").concat(_.data),!1));case 88:return n.abrupt("return",r);case 89:case"end":return n.stop()}}),n)})))()},changeParams:function(e){var t=[];return e.forEach((function(e){var a={order_id:e.order_id,region_id:e.region_id||e.region,shop_id:e.shop_id};t.push(a)})),t},addMessage:function(){if(""!=this.sendText)return this.messageList.indexOf(this.sendText.trim())>-1?this.$message.warning("请不要添加重复信息!"):void this.messageList.push(this.sendText)},deleteMessage:function(e){this.messageList.splice(e,1)},clearLog:function(){this.$refs.Logs.consoleMsg=""},changeMallList:function(e){this.selectMallList=e.mallList}}},m=d,b=(a("45cd"),a("2877")),p=Object(b["a"])(m,n,r,!1,null,"d0150058",null);t["default"]=p.exports}}]);