(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a96573b0"],{5551:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i=a("1da1"),n=a("d4ec"),r=a("bee2"),o=(a("d3b7"),a("25f0"),a("96cf"),function(){function e(t){Object(n["a"])(this,e),this._this=t}return Object(r["a"])(e,[{key:"getDiscountNominate",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.item,e.prev=1,i={},i["limit"]=100,i["offset"]=a.offset,i["mallId"]=a.platform_mall_id,i["discount_id"]=a.discount_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/nominate/?",i);case 9:if(n=e.sent,r=this.isJsonString(this.isJsonString(n).data),!r||0!==r.code){e.next=15;break}return e.abrupt("return",{code:200,data:r.data});case 15:if(2!==r.code&&2!==r.errcode){e.next=19;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 19:return e.abrupt("return",{code:-2,data:"查询折扣活动详情失败"});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"查询折扣活动详情异常： ".concat(e.t0)});case 25:case"end":return e.stop()}}),e,this,[[1,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getByDiscountids",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,o,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,i=t.promotionid,n=t.limit,r=t.discountType,e.prev=1,o={},o["discount_id_list"]=i,o["discount_type"]=r,o["limit"]=n,o["offset"]=a.offset,o["mallId"]=a.platform_mall_id,e.next=10,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/get_by_discountids/?",o);case 10:if(s=e.sent,c=this.isJsonString(this.isJsonString(s).data),!c||0!==c.code){e.next=16;break}return e.abrupt("return",{code:200,data:c.data});case 16:if(2!==c.code&&2!==c.errcode){e.next=20;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 20:return e.abrupt("return",{code:-2,data:"获取列表数据失败"});case 21:e.next=26;break;case 23:return e.prev=23,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取列表数据异常： ".concat(e.t0)});case 26:case"end":return e.stop()}}),e,this,[[1,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDiscountStandardSearch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,o,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,i=t.keyword,n=t.searchType,r=t.discountType,e.prev=1,o={},o["keyword"]=i,o["search_type"]=n,"all"!==r&&(o["promotion_status"]=r),o["mallId"]=a.platform_mall_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/standard_search/?",o);case 9:if(s=e.sent,c=this.isJsonString(this.isJsonString(s).data),!c||0!==c.code){e.next=15;break}return e.abrupt("return",{code:200,data:c.data});case 15:if(2!==c.code&&2!==c.errcode){e.next=19;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 19:return e.abrupt("return",{code:-2,data:"获取失败"});case 20:e.next=25;break;case 22:return e.prev=22,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取promotionid数据异常： ".concat(e.t0)});case 25:case"end":return e.stop()}}),e,this,[[1,22]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDiscountList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.mItem,i=t.limit,n=t.discountType,e.prev=1,r={},r["limit"]=i,r["offset"]=a.offset,r["discount_type"]=n,r["mallId"]=a.platform_mall_id,e.next=9,this._this.$shopeemanService.getChinese(a.country,"/api/marketing/v3/discount/list/?",r);case 9:if(o=e.sent,s=this.isJsonString(this.isJsonString(o).data),console.log("111",s),!s||0!==s.code){e.next=16;break}return e.abrupt("return",{code:200,data:s.data});case 16:if(2!==s.code&&2!==s.errcode){e.next=20;break}return e.abrupt("return",{code:201,data:"店铺未登录"});case 20:return e.abrupt("return",{code:-2,data:"获取失败"});case 21:e.next=26;break;case 23:return e.prev=23,e.t0=e["catch"](1),e.abrupt("return",{code:-2,data:"获取折扣列表数据异常： ".concat(e.t0)});case 26:case"end":return e.stop()}}),e,this,[[1,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isJsonString",value:function(e){if("string"!==typeof e)return e;try{return JSON.parse(e),JSON.parse(e)}catch(t){return e}}},{key:"stopActive",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var i,n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,i={},i["discount_id"]=t.discount_id.toString(),i["action"]=a,i["mallId"]=t.platform_mall_id,e.next=7,this._this.$shopeemanService.mixChinese(t.country,"/api/marketing/v3/discount/?",i,{Headers:{"Content-Type":" application/json"}},"delete");case 7:if(n=e.sent,r=n&&JSON.parse(n),console.log(r),!r||200!==r.status){e.next=19;break}if(o=JSON.parse(r.data),!o||0!==o.code){e.next=16;break}return e.abrupt("return",{code:200,data:o.data||[]});case 16:return e.abrupt("return",{code:50001,data:o.message||r.statusText||""});case 17:e.next=22;break;case 19:if(403!==r.status){e.next=21;break}return e.abrupt("return",{code:r.status,data:"操作失败，店铺未登录！"});case 21:return e.abrupt("return",{code:r.status,data:"操作失败".concat(r.statusText)});case 22:e.next=27;break;case 24:return e.prev=24,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 27:case"end":return e.stop()}}),e,this,[[0,24]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"createActive",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.postChinese(t,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}});case 3:if(i=e.sent,n=i&&JSON.parse(i),console.log(n),!n||200!==n.status){e.next=15;break}if(r=JSON.parse(n.data),!r||0!==r.code){e.next=12;break}return e.abrupt("return",{code:200,data:r.data||[]});case 12:return e.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 13:e.next=18;break;case 15:if(403!==n.status){e.next=17;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 17:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"putActive",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.mixChinese(t,"/api/marketing/v3/discount/?",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=e.sent,n=i&&JSON.parse(i),console.log(n),!n||200!==n.status){e.next=15;break}if(r=JSON.parse(n.data),!r||0!==r.code){e.next=12;break}return e.abrupt("return",{code:200,data:r.data||[]});case 12:return e.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 13:e.next=18;break;case 15:if(403!==n.status){e.next=17;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 17:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"putModelActive",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._this.$shopeemanService.mixChinese(t,"/api/marketing/v3/discount/nominate/",a,{Headers:{"Content-Type":" application/json"}},"put");case 3:if(i=e.sent,n=i&&JSON.parse(i),console.log(n),!n||200!==n.status){e.next=15;break}if(r=JSON.parse(n.data),!r||0!==r.code){e.next=12;break}return e.abrupt("return",{code:200,data:r.data||[]});case 12:return e.abrupt("return",{code:50001,data:r.message||n.statusText||""});case 13:e.next=18;break;case 15:if(403!==n.status){e.next=17;break}return e.abrupt("return",{code:n.status,data:"操作失败，店铺未登录！"});case 17:return e.abrupt("return",{code:n.status,data:"操作失败".concat(n.statusText)});case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e["catch"](0),e.abrupt("return",{code:-2,data:"操作异常： ".concat(e.t0)});case 23:case"end":return e.stop()}}),e,this,[[0,20]])})));function t(t,a){return e.apply(this,arguments)}return t}()}]),e}())},9925:function(e,t,a){"use strict";a("abe5")},aa44:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"contaniner"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"活动列表",name:"list"}},[a("el-row",{staticClass:"header"},[a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:e.changeMallList}})],1),a("ul",{staticStyle:{"margin-left":"20px"}},[a("li",[a("span",[e._v("活动状态：")]),a("el-select",{staticStyle:{width:"100px"},attrs:{disabled:e.isDisabled,size:"mini",filterable:""},model:{value:e.discountType,callback:function(t){e.discountType=t},expression:"discountType"}},[a("el-option",{attrs:{value:"all",label:"全部"}}),e._l(e.discountTypeList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})}))],2)],1),a("li",[a("el-input",{staticStyle:{width:"242px"},attrs:{disabled:e.isDisabled,size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},e._l(e.searchTypeList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:e.queryData}},[e._v("搜 索")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:e.createNewActive}},[e._v("创建新的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:e.batchStopActive}},[e._v("批量结束活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:e.restartActivityDia}},[e._v("重新启动已过期的活动")]),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:e.exportData}},[e._v("数据导出")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"20px"},attrs:{disabled:e.isDisabled},model:{value:e.hideEnded,callback:function(t){e.hideEnded=t},expression:"hideEnded"}},[e._v("不显示过期活动")]),a("el-checkbox",{model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}},[e._v("隐藏日志")])],1)])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{ref:"plTable",attrs:{data:e.tableData,"use-virtual":"",height:660,"row-height":45,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":e.handleSelectionChange1}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺","min-width":"150",prop:"mallName"}}),a("u-table-column",{attrs:{align:"center",label:"活动ID","min-width":"150",prop:"discount_id"}}),a("u-table-column",{attrs:{align:"center",label:"活动名称","min-width":"150",prop:"title"}}),a("u-table-column",{attrs:{align:"center",label:"活动状态","min-width":"100",prop:"statusName"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",{style:e.statusNameColor[i.statusName]&&"color:"+e.statusNameColor[i.statusName]},[e._v(" "+e._s(i.statusName)+" ")])]}}])}),a("u-table-column",{attrs:{sortable:"",align:"center",label:"商品数量","min-width":"100",prop:"total_product"}}),a("u-table-column",{attrs:{align:"center",label:"活动时间","min-width":"270"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$dayjs(a.start_time).format("MM/DD/YYYY HH:mm:ss")+" - "+e.$dayjs(a.end_time).format("MM/DD/YYYY HH:mm:ss"))+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"240"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.$index;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.searchDiscountDetail(i)}}},[e._v("查看详情")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.copyAndOpen(i.platform_mall_id,i.discount_id)}}},[e._v("复制")]),"进行中"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.stopActiveSingle(i,n,"stop")}}},[e._v("结束")]):e._e(),"即将开始"===i.statusName?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.stopActiveSingle(i,n,"delete")}}},[e._v("删除")]):e._e()]}}])})],1),e.timeVisible?a("el-dialog",{staticClass:"time-dialog",attrs:{title:"选择时间",visible:e.timeVisible,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.timeVisible=t}}},[a("div",{staticClass:"content"},[a("span",[e._v("折扣促销时间：")]),a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"mini"},model:{value:e.promotionTime,callback:function(t){e.promotionTime=t},expression:"promotionTime"}})],1),a("div",{staticClass:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{size:"mini"},on:{click:function(t){e.timeVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.determineRestart}},[e._v("确 定")])],1)]):e._e()],1)],1),a("el-tab-pane",{attrs:{label:"活动编辑",name:"edit"}},[a("el-row",{staticClass:"header edit"},[e.activeRow.discount_id?e._e():a("ul",{staticStyle:{"margin-bottom":"10px"}},[a("storeChoose",{on:{changeMallList:e.changeMallListEdit}})],1),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",[a("span",[e._v("活动名称：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:e.activeDicountName,callback:function(t){e.activeDicountName=t},expression:"activeDicountName"}})],1),a("li",[a("span",[e._v("活动时间：")]),a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss",size:"mini",type:"datetimerange","unlink-panels":"","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.activeDate,callback:function(t){e.activeDate=t},expression:"activeDate"}})],1),a("li",[a("span",[e._v("商品编号：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:e.activeProductId,callback:function(t){e.activeProductId=t},expression:"activeProductId"}}),a("el-button",{staticStyle:{"margin-left":"21px"},attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.searchDetail}},[e._v("搜 索")])],1)]),a("ul",{staticStyle:{margin:"0 0 10px 20px"}},[a("li",{staticStyle:{"margin-right":"19px"}},[a("span",[e._v("活动折扣：")]),a("el-input",{attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:e.activeDiscount,callback:function(t){e.activeDiscount=t},expression:"activeDiscount"}}),e._v("% ")],1),a("li",[a("span",[e._v("限购数量：")]),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",oninput:"value=value.replace(/\\s+/g,'')",clearable:""},model:{value:e.limitNum,callback:function(t){e.limitNum=t},expression:"limitNum"}})],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.batchUpdateDiscount}},[e._v("批量修改折扣和限购")]),e.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.changeDiscountInfo}},[e._v("修改活动信息")]):e._e(),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.addGoods}},[e._v("添加商品")]),e.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.addActiveTo}},[e._v("添加商品到已有活动")]):e._e(),e.activeRow.discount_id?a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:function(t){return e.searchDiscountDetail(e.activeRow)}}},[e._v("获取活动已有物品")]):e._e(),e.activeRow.discount_id?e._e():a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.btnLoading},on:{click:e.createActive}},[e._v("创建活动")]),a("el-checkbox",{staticStyle:{"margin-left":"10px"},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}},[e._v("隐藏日志")])],1)]),a("ul",{staticStyle:{margin:"0 0 0 20px"}},[a("span",{staticStyle:{color:"red"}},[e._v("折扣公式为：折扣价格=商品原价*折扣%。如原价100元的商品，输入80，最后的折扣价格为80元")])])]),a("el-row",{attrs:{id:"article"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"editPlTable",attrs:{data:e.editTableData,"use-virtual":"",height:620,"row-height":68,"data-changes-scroll-top":!1,border:!1,"header-cell-style":{textAlign:"center",backgroundColor:"#f5f7fa"}},on:{"selection-change":e.handleSelectionChange2}},[a("u-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("u-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),a("u-table-column",{attrs:{align:"center",label:"店铺名称","min-width":"150",prop:"platform_mall_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.mall_alias_name||t.row.platform_mall_name)+" ")]}}])}),a("u-table-column",{attrs:{align:"center",label:"主图","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticStyle:{width:"32px",height:"32px",display:"inline-block"},attrs:{effect:"light",placement:"right-end","visible-arrow":!1,enterable:!1}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("el-image",{staticStyle:{width:"400px",height:"400px"},attrs:{src:e._f("imageRender")([t.row.image])}})],1),a("el-image",{staticStyle:{width:"32px",height:"32px"},attrs:{src:e._f("imageRender")([t.row.image,!0])}})],1)]}}])}),a("u-table-column",{attrs:{align:"center",label:"商品名称","min-width":"150",prop:"name","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"商品编号","min-width":"150",prop:"itemid"}}),a("u-table-column",{attrs:{align:"center",label:"商品规格","min-width":"150",prop:"skuName","show-overflow-tooltip":""}}),a("u-table-column",{attrs:{align:"center",label:"原价",width:"120",prop:"normal_price"}}),a("u-table-column",{attrs:{align:"center",label:"售价",width:"120",prop:"promotion_price"}}),a("u-table-column",{attrs:{align:"center",label:"折扣",width:"120",prop:"discount"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(Number(i.discount).toFixed(2)))])]}}])}),a("u-table-column",{attrs:{align:"center",label:"购买限制","min-width":"150",prop:"user_item_limit"}}),a("u-table-column",{attrs:{align:"center",label:"操作","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.editStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.deleteEditGoods(t.row,t.$index)}}},[e._v("删 除")]):e._e(),t.row.deleteStatus?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.deleteActiveGoods(t.row,t.$index)}}},[e._v("删除活动商品")]):e._e()]}}])})],1)],1)],1)],1),a("div",{staticClass:"logging"},[a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}})],1),a("el-dialog",{attrs:{visible:e.goodsItemSelectorVisible,top:"7vh",title:"商品选择","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1280px"},on:{"update:visible":function(t){e.goodsItemSelectorVisible=t}}},[e.goodsItemSelectorVisible?a("goodsItemSelector",{attrs:{"is-need-filter-act":!0,mall:e.selectMallListEdit},on:{changeGoodsItem:e.changeGoodsItem}}):e._e()],1)],1)},n=[],r=a("b85c"),o=a("1da1"),s=(a("96cf"),a("4de4"),a("a434"),a("c740"),a("3ca3"),a("ddb0"),a("99af"),a("159b"),a("b0c0"),a("a9e3"),a("b680"),a("ac1f"),a("1276"),a("7db0"),a("a15b"),a("d3b7"),a("25f0"),a("01cd")),c=a("0e0b"),l=a("feb6"),u=a("5551"),d={components:{StoreChoose:l["a"],goodsItemSelector:s["a"]},data:function(){return{activeName:"list",GoodsDiscount:new u["a"](this),showConsole:!0,promotionTime:[],timeVisible:!1,hideEnded:!0,limit:100,isDisabled:!1,keyword:"",searchType:"promotion_name",discountType:"all",selectMallList:[],selectMallListEdit:[],tableData:[],multipleSelection:[],endedActivityData:[],discountTypeList:[{value:"ongoing",label:"进行中"},{value:"upcoming",label:"即将开始"},{value:"ended",label:"已过期"}],searchTypeList:[{value:"promotion_name",label:"活动名称"},{value:"item_name",label:"商品名称"},{value:"item_id",label:"商品ID"}],statusNameColor:{"进行中":"green","即将开始":"orangered"},editTableData:[],editTableDataCopy:[],editMultipleSelection:[],activeDicountName:"",activeProductId:"",activeDate:"",activeRow:{},loading:!1,activeDiscount:"",limitNum:"",goodsItemSelectorVisible:!1,selectGoods:[],btnLoading:!1}},methods:{deleteActiveGoods:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var i,n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e,"deleteActiveGoods"),i={discount_id:a.activeRow.discount_id,itemid:e.itemid,mallId:a.activeRow.platform_mall_id},t.next=4,a.$shopeemanService.deleteChinese(a.activeRow.country,"/api/marketing/v3/discount/nominate/",i,{headers:{"Content-Type":"application/json"}});case 4:if(n=t.sent,r=JSON.parse(n),200!==r.status){t.next=16;break}if(o=JSON.parse(r.data),!o||0!==o.code){t.next=13;break}a.$message.success("删除成功"),a.editTableData=a.editTableData.filter((function(t){return t.itemid!==e.itemid})),t.next=14;break;case 13:return t.abrupt("return",a.$message.warning("删除商品失败,".concat(o.message)));case 14:t.next=21;break;case 16:if(403!==r.status){t.next=20;break}return t.abrupt("return",a.$message.warning("删除商品失败，店铺未登录！"));case 20:return t.abrupt("return",a.$message.warning("删除商品失败！"));case 21:console.log(r,"resObj");case 22:case"end":return t.stop()}}),t)})))()},deleteEditGoods:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:a.editTableData.splice(t,1),n=a.editTableDataCopy.findIndex((function(t){return t.itemid===e.itemid})),a.editTableDataCopy.splice(n,1);case 3:case"end":return i.stop()}}),i)})))()},addActiveTo:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.editTableData.filter((function(e){return 1===e.editStatus})),a.length){t.next=3;break}return t.abrupt("return",e.$message.warning("没有可添加的商品！"));case 3:e.showConsole=!1,i=e.activeRow.discount_id,e.loading=!0,n=Object(r["a"])(a),t.prev=7,s=regeneratorRuntime.mark((function t(){var a,n,r,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=o.value,t.next=3,e.searchProductDetail(a.itemid,a.platform_mall_id,a.country);case 3:if(n=t.sent,!n.length){t.next=9;break}return t.next=7,e.setModelActive(n,a.platform_mall_id,a.country,a.itemid,i,a.platform_mall_name);case 7:r=t.sent,r&&(s=e.editTableData.findIndex((function(e){return e.itemid==a.itemid})),c=e.editTableDataCopy.findIndex((function(e){return e.itemid==a.itemid})),e.$set(e.editTableData[s],"editStatus",2),e.$set(e.editTableDataCopy[c],"editStatus",2),console.log(e.editTableData[s],e.editTableDataCopy[c]),e.$nextTick((function(){e.$refs.editPlTable.toggleRowSelection([{row:e.editTableData[s],selected:!1}])})));case 9:case"end":return t.stop()}}),t)})),n.s();case 10:if((o=n.n()).done){t.next=14;break}return t.delegateYield(s(),"t0",12);case 12:t.next=10;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t["catch"](7),n.e(t.t1);case 19:return t.prev=19,n.f(),t.finish(19);case 22:e.loading=!1;case 23:case"end":return t.stop()}}),t,null,[[7,16,19,22]])})))()},copyAndOpen:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var n;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:n={type:"route",shopId:e,route:"https://seller.th.shopee.cn/portal/marketing/discount/create?from=".concat(t)},a.$BaseUtilService.getOrderDetailInfo(e,JSON.stringify(n));case 2:case"end":return i.stop()}}),i)})))()},addGoods:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs.editPlTable.clearSelection(),e.activeDiscount&&e.limitNum){t.next=3;break}return t.abrupt("return",e.$message.warning("请先填写活动折扣和限购数量！"));case 3:if(!(e.activeDiscount<0||e.activeDiscount>100||e.limitNum<0||e.activeDiscount%1!==0)){t.next=5;break}return t.abrupt("return",e.$message.warning("折扣信息或限购数量有误！"));case 5:if(e.activeDicountName){t.next=7;break}return t.abrupt("return",e.$message.warning("活动名称不能为空"));case 7:if(console.log(e.activeDate,"this.activeDate"),e.activeDate&&e.activeDate.length){t.next=10;break}return t.abrupt("return",e.$message.warning("请选择活动时间"));case 10:e.goodsItemSelectorVisible=!0;case 11:case"end":return t.stop()}}),t)})))()},createActive:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.activeDiscount&&e.limitNum){t.next=2;break}return t.abrupt("return",e.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(e.activeDiscount<0||e.activeDiscount>100||e.limitNum<0||e.activeDiscount%1!==0)){t.next=4;break}return t.abrupt("return",e.$message.warning("折扣信息或限购数量有误！"));case 4:if(e.selectGoods.length){t.next=6;break}return t.abrupt("return",e.$message.warning("请先选择商品！"));case 6:if(e.activeDate&&e.activeDate.length){t.next=8;break}return t.abrupt("return",e.$message.warning("请先选择活动时间！"));case 8:e.showConsole=!1,e.btnLoading=!0,e.$refs.Logs.writeLog("开始创建活动",!0),a=regeneratorRuntime.mark((function t(a){var i,n,o,s,c,l,u,d,m,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.selectMallListEdit[a],n=Math.round(new Date(e.activeDate[0]).getTime()/1e3),o=Math.round(new Date(e.activeDate[1]).getTime()/1e3),t.prev=3,s={fe_status:"upcoming",highlight:"",title:e.activeDicountName,start_time:n,end_time:o,status:1,mallId:i.platform_mall_id},t.next=7,e.GoodsDiscount.createActive(i.country,s);case 7:if(c=t.sent,console.log("res",c),200!==c.code){t.next=31;break}e.$refs.Logs.writeLog("店铺【".concat(i.mall_alias_name||i.platform_mall_name,"】,创建活动【").concat(e.activeDicountName,"】成功"),!0),l=c.data.discount_id,u=e.selectGoods.filter((function(e){return e.platform_mall_id===i.platform_mall_id})),d=Object(r["a"])(u),t.prev=14,p=regeneratorRuntime.mark((function t(){var a,n,r,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=m.value,t.next=3,e.searchProductDetail(a.itemid,a.platform_mall_id,a.country);case 3:if(n=t.sent,!n.length){t.next=9;break}return t.next=7,e.setModelActive(n,i.platform_mall_id,i.country,a.itemid,l,i.platform_mall_name);case 7:r=t.sent,r&&(o=e.editTableData.findIndex((function(e){return e.itemid===a.itemid})),s=e.editTableDataCopy.findIndex((function(e){return e.itemid===a.itemid})),e.$set(e.editTableData[o],"editStatus",2),e.$set(e.editTableDataCopy[s],"editStatus",2),e.$nextTick((function(){e.$refs.editPlTable.toggleRowSelection([{row:e.editTableData[o],selected:!1}])})));case 9:case"end":return t.stop()}}),t)})),d.s();case 17:if((m=d.n()).done){t.next=21;break}return t.delegateYield(p(),"t0",19);case 19:t.next=17;break;case 21:t.next=26;break;case 23:t.prev=23,t.t1=t["catch"](14),d.e(t.t1);case 26:return t.prev=26,d.f(),t.finish(26);case 29:t.next=32;break;case 31:403===c.code?e.$refs.Logs.writeLog("店铺【".concat(i.mall_alias_name||i.platform_mall_name,"】创建活动失败,店铺未登录"),!1):e.$refs.Logs.writeLog("店铺【".concat(i.mall_alias_name||i.platform_mall_name,"】创建活动失败,").concat(c.data),!1);case 32:t.next=38;break;case 34:t.prev=34,t.t2=t["catch"](3),e.btnLoading=!1,console.log(t.t2,"joiuoi");case 38:a===e.selectMallListEdit.length-1&&(e.btnLoading=!1);case 39:case"end":return t.stop()}}),t,null,[[3,34],[14,23,26,29]])})),i=0;case 13:if(!(i<e.selectMallListEdit.length)){t.next=18;break}return t.delegateYield(a(i),"t0",15);case 15:i++,t.next=13;break;case 18:e.$refs.Logs.writeLog("活动创建结束",!0);case 19:case"end":return t.stop()}}),t)})))()},setModelActive:function(e,t,a,i,n,r){var s=this;return Object(o["a"])(regeneratorRuntime.mark((function o(){var c,l,u,d;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return c=[],e.forEach((function(e){var a={discount:100-s.activeDiscount,itemid:i,model_name:e.name,modelid:e.id,price_before_discount:Number(e.price),promotion_price:Number((e.price*s.activeDiscount/100).toFixed(16)),promotionid:n,selected:!0,shopid:Number(t),status:1,total_item_limit:0,user_item_limit:s.limitNum};c.push(a)})),l={discount_id:n,discount_model_list:c,mallId:t},o.next=5,s.GoodsDiscount.putModelActive(a,l);case 5:if(u=o.sent,200!==u.code){o.next=15;break}return d=s.editTableData.findIndex((function(e){return e.itemid==i})),s.$set(s.editTableData[d],"discount",1-s.activeDiscount/100),s.$set(s.editTableData[d],"promotion_price_after_tax",Number((s.activeDiscount/100*s.editTableData[d].price).toFixed(1))),s.$set(s.editTableData[d],"user_item_limit",s.limitNum),s.$refs.Logs.writeLog("店铺【".concat(r,"】,商品【").concat(i,"】创建活动成功"),!0),o.abrupt("return",!0);case 15:return u.data.indexOf("some item has participated in promotion")>-1?s.$refs.Logs.writeLog("店铺【".concat(r,"】,添加商品【").concat(i,"】至活动失败,商品已参加活动不能再此参加"),!0):s.$refs.Logs.writeLog("店铺【".concat(r,"】,添加商品【").concat(i,"】至活动失败,").concat(u.data?u.data:""),!1),o.abrupt("return",!1);case 17:case"end":return o.stop()}}),o)})))()},searchProductDetail:function(e,t,a){var i=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={product_id:e,version:"3.2.0",shop_id:t},n.next=3,i.$shopeemanService.searchProductDetail(a,r);case 3:if(o=n.sent,200!==o.code){n.next=8;break}return n.abrupt("return",o.data.model_list);case 8:return n.abrupt("return",[]);case 9:case"end":return n.stop()}}),n)})))()},changeGoodsItem:function(e){var t=this;this.selectGoods=e.goodsList,e.goodsList.forEach((function(e){e.promotion_price=(e.price*(t.activeDiscount/100)).toFixed(2),e.discount=(1-t.activeDiscount/100).toFixed(2),e.image=e.images.split(",")[0],e.editStatus=1,e.normal_price=e.price})),this.editTableData=e.goodsList.concat(this.editTableData),Object(c["z"])(1e3),e.goodsList.forEach((function(e){t.$nextTick((function(){t.$refs.editPlTable.toggleRowSelection([{row:e,selected:!0}])}))})),console.log(this.editMultipleSelection,"3333333333"),this.editMultipleSelection=e.goodsList,this.editTableDataCopy=JSON.parse(JSON.stringify(this.editTableData)),console.log("changeGoodsItem",this.editTableData,e),this.goodsItemSelectorVisible=!1},batchUpdateDiscount:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.activeDiscount&&e.limitNum){t.next=2;break}return t.abrupt("return",e.$message.warning("请先填写活动折扣和限购数量！"));case 2:if(!(e.activeDiscount<0||e.activeDiscount>100||e.limitNum<0||e.activeDiscount%1!==0)){t.next=4;break}return t.abrupt("return",e.$message.warning("折扣信息或限购数量有误！"));case 4:if(e.editMultipleSelection.length){t.next=6;break}return t.abrupt("return",e.$message.warning("请先勾选数据！"));case 6:e.$message.success("正在修改信息...."),a=Object(r["a"])(e.editMultipleSelection);try{for(n=function(){var t=i.value;e.$delete(t,"discount"),e.$set(t,"discount",(1-e.activeDiscount/100).toFixed(2)),e.$delete(t,"promotion_price"),e.$set(t,"promotion_price",Number((e.activeDiscount/100*t.normal_price).toFixed(1))),e.$delete(t,"user_item_limit"),e.$set(t,"user_item_limit",e.limitNum);e.editTableData.findIndex((function(e){return e.modelid===t.modelid}));var a=e.editTableDataCopy.findIndex((function(e){return e.modelid===t.modelid}));a>-1&&(e.editTableDataCopy[a].discount=(1-e.activeDiscount/100).toFixed(2),e.editTableDataCopy[a].promotion_price=Number((e.activeDiscount/100*t.normal_price).toFixed(1)),e.editTableDataCopy[a].user_item_limit=e.limitNum)},a.s();!(i=a.n()).done;)n()}catch(o){a.e(o)}finally{a.f()}e.$message.success("修改完成");case 10:case"end":return t.stop()}}),t)})))()},updateDiscount:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.editMultipleSelection.length){t.next=3;break}return e.$refs.Logs.writeLog("没有要修改的折扣信息",!0),t.abrupt("return");case 3:return a=[],e.editMultipleSelection.forEach((function(t){var i={itemid:t.itemid,modelid:t.modelid,promotion_price:Number((e.activeDiscount/100*t.normal_price).toFixed(1)),user_item_limit:Number(e.limitNum),status:t.status};a.push(i)})),i={discount_id:e.activeRow.discount_id,discount_model_list:a,mallId:e.activeRow.platform_mall_id},e.showConsole=!1,t.next=9,e.GoodsDiscount.putModelActive(e.activeRow.country,i);case 9:n=t.sent,200===n.code?(e.$refs.Logs.writeLog("修改折扣信息成功",!0),e.$refs.editPlTable.clearSelection()):e.$refs.Logs.writeLog("修改折扣信息失败：".concat(n.data),!1);case 11:case"end":return t.stop()}}),t)})))()},changeDiscountInfo:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.activeDate),a=new Date(e.activeDate[0]).getTime(),i=new Date(e.activeDate[1]).getTime(),(a<e.activeRow.start_time||a>e.activeRow.end_time)&&e.$alert("开始时间要晚于".concat(e.$dayjs(e.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss"),"，早于").concat(e.$dayjs(e.activeRow.end_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i<e.activeRow.start_time||i>e.activeRow.end_time)&&e.$alert("结束时间要早于".concat(e.$dayjs(e.activeRow.start_time).format("YYYY-MM-DD HH:mm:ss")),"提示",{confirmButtonText:"确定"}),(i-a)/1e3/60/60<1&&e.$alert("活动时间不得小于1小时","提示",{confirmButtonText:"确定"}),n={status:e.activeRow.status,title:e.activeDicountName,start_time:Math.round(a/1e3),discount_id:e.activeRow.discount_id,source:e.activeRow.source,end_time:Math.round(i/1e3),mallId:e.activeRow.platform_mall_id},t.next=9,e.GoodsDiscount.putActive(e.activeRow.country,n);case 9:r=t.sent,200===r.code?e.$refs.Logs.writeLog("修改活动信息成功",!0):e.$refs.Logs.writeLog("修改活动信息失败：".concat(r.data),!1),e.updateDiscount();case 12:case"end":return t.stop()}}),t)})))()},createNewActive:function(){var e=(new Date).getTime()+6e5,t=e+72e5;this.activeName="edit",this.activeRow={},this.editTableData=[],this.editTableDataCopy=[],this.activeDicountName="",this.selectGoods=[],this.activeDate=[this.$dayjs(e).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(t).format("YYYY-MM-DD HH:mm:ss")]},searchDetail:function(){var e=this;this.activeProductId?this.editTableData=this.editTableDataCopy.filter((function(t){return t.itemid==e.activeProductId})):this.editTableData=this.editTableDataCopy},searchDiscountDetail:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.activeName="edit",t.activeRow=e,t.activeDicountName=e.title,t.activeDate=[t.$dayjs(e.start_time).format("YYYY-MM-DD HH:mm:ss"),t.$dayjs(e.end_time).format("YYYY-MM-DD HH:mm:ss")],t.activeDiscount="",t.limitNum="",t.editTableData=[],t.selectMallListEdit=[{country:e.country,platform_mall_name:e.platform_mall_name,platform_mall_id:e.platform_mall_id,id:e.mallId,mall_alias_name:e.mall_alias_name,group_id:0,group_name:"",mall_type:1}],t.btnLoading=!0,a.next=11,t.getDiscountDetail(e);case 11:t.btnLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},getDiscountDetail:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log(e,"val"),t.loading=!0,a.prev=2,a.delegateYield(regeneratorRuntime.mark((function a(){var i,n,r,o,s,c,l,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=100,n={limit:i,offset:0,discount_id:e.discount_id,platform_mall_id:e.platform_mall_id,country:e.country},a.next=4,t.GoodsDiscount.getDiscountNominate({item:n});case 4:r=a.sent,o=200===r.code&&r.data.item_info||[],s=r.data.model_info||{},c=r.data.discount_item_list||[],l=r.data.price_stock_info||[];case 9:if(!o.length){a.next=25;break}if(o.forEach((function(a){s[a.itemid]&&s[a.itemid].length&&s[a.itemid].forEach((function(i){var n=JSON.parse(JSON.stringify(a)),r=c.find((function(e){return e.itemid===a.itemid&&e.modelid===i.modelid})),o=l.find((function(e){return e.item_id===a.itemid})),s=o.sku_stock_price_list.find((function(e){return e.model_id===i.modelid})),u=Object.assign(n,i,r,s.price_info);u.price=i.price,u.name=a.name,u.skuName=i.name,u.image=a.images.split(",")[0],u.platform_mall_name=e.mallName,u.country=e.country,u.platform_mall_id=e.platform_mall_id,u.promotion_price=r?r.promotion_price:0,u.discount=s&&s.price_info?(1-u.promotion_price/u.normal_price).toFixed(2):"";var d=t.editTableData.findIndex((function(e){return e.deleteStatus&&u.itemid===e.itemid}));d<0&&(u.deleteStatus=!0),t.editTableData.push(u)}))})),!(o.length<100)){a.next=15;break}o=[],a.next=23;break;case 15:return n.offset+=i,a.next=18,t.GoodsDiscount.getDiscountNominate({item:n});case 18:u=a.sent,o=200===u.code&&u.data.item_info||[],s=200===u.code&&u.data.model_info||{},c=200===u.code&&u.data.discount_item_list||[],l=200===u.code&&u.data.price_stock_info||[];case 23:a.next=9;break;case 25:t.editTableDataCopy=JSON.parse(JSON.stringify(t.editTableData)),t.$refs.Logs.writeLog("获取详情结束,".concat(t.editTableData.length,"条"),!0),t.loading=!1;case 28:case"end":return a.stop()}}),a)}))(),"t0",4);case 4:a.next=10;break;case 6:a.prev=6,a.t1=a["catch"](2),console.log(a.t1),t.loading=!1;case 10:case"end":return a.stop()}}),a,null,[[2,6]])})))()},batchStopActive:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.multipleSelection.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请先选择数据！"));case 2:e.showConsole=!1,e.$refs.Logs.consoleMsg="",e.$refs.Logs.writeLog("请在执行操作，请稍等",!0),e.multipleSelection.forEach(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(a){var i,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!((new Date).getTime()-a.start_time<36e5)){t.next=4;break}e.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：折扣活动开始一小时后才能结束！"),!1),t.next=8;break;case 4:return t.next=6,e.GoodsDiscount.stopActive(a,"stop");case 6:i=t.sent,200===i.code?(n=e.tableData.findIndex((function(e){return e.discount_id==a.discount_id})),e.$set(e.tableData[n],"statusName","已过期"),e.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动成功"),!0)):e.$refs.Logs.writeLog("活动【".concat(a.title,"-").concat(a.discount_id,"】结束活动失败：").concat(i.data),!1);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 6:case"end":return t.stop()}}),t)})))()},stopActiveSingle:function(e,t,a){var i=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("stop"!==a){n.next=3;break}if(!((new Date).getTime()-e.start_time<36e5)){n.next=3;break}return n.abrupt("return",i.$message.warning("折扣活动开始一小时后才能结束！"));case 3:return console.log(e,"row"),i.showConsole=!1,i.$refs.Logs.writeLog("请在执行操作，请稍等",!0),n.next=8,i.GoodsDiscount.stopActive(e,a);case 8:r=n.sent,200===r.code?("delete"===a?i.tableData.splice(t,1):i.$set(i.tableData[t],"statusName","已过期"),i.$refs.Logs.writeLog("活动【".concat(e.title,"-").concat(e.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动成功"),!0)):i.$refs.Logs.writeLog("活动【".concat(e.title,"-").concat(e.discount_id,"】【").concat("delete"===a?"删除":"结束","】活动失败：").concat(r.data),!1);case 10:case"end":return n.stop()}}),n)})))()},exportData:function(){var e=this;if(!this.multipleSelection.length)return this.$message.warning("请选择要导出的数据！");var t=1,a="<tr>\n            <td>编号</td>\n            <td>店铺</td>\n            <td>活动ID</td>\n            <td>活动名称</td>\n            <td>活动状态</td>\n            <td>商品数量</td>\n            <td>活动时间</td>\n            </tr>";this.multipleSelection.forEach((function(i){a+="<tr><td>".concat(t++,"</td>\n        <td>").concat(i.mallName?"".concat(i.country,"-").concat(i.mallName):"\t","</td>\n        <td>").concat(i.discount_id?i.discount_id:"\t","</td>\n        <td>").concat(i.title?i.title:"\t","</td>\n        <td>").concat(i.statusName?i.statusName:"\t","</td>\n        <td>").concat(i.total_product?i.total_product:"\t","</td>\n        <td>").concat(i.start_time&&i.end_time?"".concat(e.$dayjs(i.start_time).format("MM/DD/YYYY HH:mm:ss")," - ").concat(e.$dayjs(i.end_time).format("MM/DD/YYYY HH:mm:ss")):"\t","</td>\n        </tr>\n        ")})),Object(c["k"])("商品折扣活动数据",a)},clearLog:function(){this.$refs.Logs.consoleMsg=""},restartActivityDia:function(){this.endedActivityData=[];for(var e=0;e<(null===(t=this.multipleSelection)||void 0===t?void 0:t.length);e++){var t,a=this.multipleSelection[e];"已过期"===a.statusName&&this.endedActivityData.push(a)}if(!this.endedActivityData.length)return this.$message("请选择已过期活动执行此操作");this.timeVisible=!0,this.promotionTime=[(new Date).getTime()+18e5,(new Date).getTime()+54e5]},determineRestart:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==(a=e.promotionTime)&&void 0!==a&&a.length){t.next=2;break}return t.abrupt("return",e.$message.warning("请选择折扣促销时间"));case 2:return e.timeVisible=!1,e.isDisabled=!0,e.$refs.Logs.writeLog("开始重启已过期的活动，请耐心等待！",!0),e.endedActivityData.forEach((function(e){e.offset=0,e.mList=[]})),e.showConsole=!1,t.next=9,Object(c["d"])(e.endedActivityData,e.restartActivity);case 9:e.isDisabled=!1;case 10:case"end":return t.stop()}}),t)})))()},restartActivity:function(e){var t=arguments,a=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var n,r,o,s,c,l,u,d,m,p,f,g,b,h,v,_,w,x,D,k,y,L,S,$,T,R,N,M;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r=Math.round(new Date(a.promotionTime[0]).getTime()/1e3),o=Math.round(new Date(a.promotionTime[1]).getTime()/1e3),s=null,i.prev=4,c={},c["item"]=e,i.next=9,a.GoodsDiscount.getDiscountNominate(c);case 9:if(l=i.sent,200===l.code){i.next=12;break}return i.abrupt("return",a.$refs.Logs.writeLog("获取【".concat(e.title,"】【").concat(e.discount_id,"】错误：").concat(l.data),!1));case 12:u=l.data.item_info,d=l.data.discount_item_list,m=l.data.model_info,p=[],f=[],g={},console.log("nominateRe---------------",l);case 19:if(!u.length){i.next=36;break}if(f=f.concat(u),p=p.concat(d),g=Object.assign(g,m),!(u.length<100)){i.next=27;break}u=[],i.next=34;break;case 27:return c.item.offset+=100,i.next=30,a.GoodsDiscount.getDiscountNominate(c);case 30:b=i.sent,u=200===b.code?b.data.item_info:[],d=200===b.code?b.data.discount_item_list:[],m=200===b.code?b.data.model_info:{};case 34:i.next=19;break;case 36:return a.$refs.Logs.writeLog("获取【".concat(e.title,"】【").concat(e.discount_id,"】详情结束，共").concat(f.length,"件商品"),!0),h=f.filter((function(e){return 1===e.status})),v=[],h.forEach((function(e){v.push(e.itemid)})),_={end_time:o,item_id_list:v,start_time:r,mallId:e.platform_mall_id},i.next=43,a.$shopeemanService.overlapDiscount(e.country,_);case 43:if(w=i.sent,200!==w.code){i.next=72;break}if(console.log(w,"res--overlap"),w.data.fail_main_items.length&&(x=[],w.data.fail_main_items.forEach((function(e){x.push(e.item_id)})),a.$refs.Logs.writeLog("活动【".concat(e.title,"】,商品【").concat(x.join(","),"】已经参加了活动，不能再重复参加"),!0)),!w.data.succ_main_items.length){i.next=69;break}return D={discount_id:null,end_time:o,start_time:r,source:0,status:1,title:e.title,mallId:e.platform_mall_id},i.next=51,a.GoodsDiscount.createActive(e.country,D);case 51:if(k=i.sent,console.log("resC",k),200!==k.code){i.next=58;break}s=k.data.discount_id,a.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】,创建活动【").concat(e.title,"】成功，开始添加活动商品"),!0),i.next=59;break;case 58:return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】,创建活动【").concat(e.title,"】失败,").concat(k.data),!0));case 59:return y=[],w.data.succ_main_items.forEach((function(e){for(var t=g[e.item_id],a=function(a){var i=t[a],n=p.find((function(t){return t.itemid===e.item_id&&t.modelid===i.modelid}));if(!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:e.item_id.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};y.push(r)},i=0;i<t.length;i++)a(i)})),L={discount_id:s,discount_model_list:y,mallId:e.platform_mall_id},i.next=64,a.GoodsDiscount.putModelActive(e.country,L);case 64:S=i.sent,200===S.code?a.$refs.Logs.writeLog("活动【".concat(e.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(e.title,"】重启失败,重启添加商品失败").concat(S.data),!0),console.log("putModelRes",S),i.next=70;break;case 69:a.$refs.Logs.writeLog("活动【".concat(e.title,"】重启失败,无可重启商品"),!0);case 70:i.next=91;break;case 72:return $={discount_id:null,end_time:o,start_time:r,source:0,status:1,title:e.title,mallId:e.platform_mall_id},i.next=75,a.GoodsDiscount.createActive(e.country,$);case 75:if(T=i.sent,console.log("resC",T),200!==T.code){i.next=82;break}s=T.data.discount_id,a.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】,创建活动【").concat(e.title,"】成功，开始添加活动商品"),!0),i.next=83;break;case 82:return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(e.mallName,"】,创建活动【").concat(e.title,"】失败,").concat(T.data),!0));case 83:return R=[],f.forEach((function(e){for(var t=g[e.itemid],a=function(a){var i=t[a],n=p.find((function(t){return t.itemid===e.itemid&&t.modelid===i.modelid}));if(console.log(n,"discountInfo"),!n)return"continue";var r={is_stock_insufficient:!1,status:1,itemid:e.itemid.toString(),user_item_limit:n?n.user_item_limit:0,promotion_price:n?n.promotion_price.toString():"0",promotion_price_after_tax:n?n.promotion_price_after_tax.toString():"0",promotion_stock:n?n.promotion_stock.toString():"0",modelid:i.modelid.toString()};R.push(r)},i=0;i<t.length;i++)a(i)})),N={discount_id:s,discount_model_list:R,mallId:e.platform_mall_id},i.next=88,a.GoodsDiscount.putModelActive(e.country,N);case 88:M=i.sent,200===M.code?a.$refs.Logs.writeLog("活动【".concat(e.title,"】,重启成功，添加商品成功"),!0):a.$refs.Logs.writeLog("活动【".concat(e.title,"】,重启添加商品失败").concat(M.data),!0),console.log("putModelRes",M);case 91:i.next=96;break;case 93:i.prev=93,i.t0=i["catch"](4),console.log(i.t0,"error");case 96:return i.prev=96,--n.count,i.finish(96);case 99:case"end":return i.stop()}}),i,null,[[4,93,96,99]])})))()},queryData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.selectMallList.length){t.next=2;break}return t.abrupt("return",e.$message("请选择店铺"));case 2:return e.isDisabled=!0,e.showConsole=!1,e.tableData=[],e.$refs.Logs.consoleMsg="",e.$refs.Logs.writeLog("开始查询",!0),e.selectMallList.forEach((function(e){e.offset=0,e.mList=[]})),t.next=10,Object(c["d"])(e.selectMallList,e.getDiscountList);case 10:e.$refs.Logs.writeLog("查询结束",!0),e.isDisabled=!1;case 12:case"end":return t.stop()}}),t)})))()},getDiscountList:function(e){var t=arguments,a=this;return Object(o["a"])(regeneratorRuntime.mark((function i(){var n,r,o,s,c,l,u,d,m,p,f,g,b,h;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r="",o=0,s="",r=e.mall_alias_name||e.platform_mall_name,c={},c["mItem"]=e,c["discountType"]=a.discountType,c["limit"]=a.limit,i.prev=9,l=[],!a.keyword){i.next=22;break}return c["keyword"]=a.keyword,c["searchType"]=a.searchType,i.next=16,a.GoodsDiscount.getDiscountStandardSearch(c);case 16:if(p=i.sent,200===p.code){i.next=19;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(p.data),!1));case 19:if(null!==(u=p.data)&&void 0!==u&&u.hits&&!((null===(d=p.data)||void 0===d||null===(m=d.hits)||void 0===m?void 0:m.length)<=0)){i.next=21;break}return i.abrupt("return",a.$refs.Logs.writeLog("店铺【".concat(r,"】共查询到【0】条数据"),!0));case 21:p.data.hits.forEach((function(e){l.push(e.promotionid)}));case 22:if(!(a.keyword&&(null===l||void 0===l?void 0:l.length)>0)){i.next=29;break}return c["promotionid"]=l,i.next=26,a.GoodsDiscount.getByDiscountids(c);case 26:s=i.sent,i.next=32;break;case 29:return i.next=31,a.GoodsDiscount.getDiscountList(c);case 31:s=i.sent;case 32:if(200===s.code){for(o=s.data.total_count,f=0;f<s.data.discount_list.length;f++)g=s.data.discount_list[f],g.mallName=r,g.start_time=1e3*g.start_time,g.end_time=1e3*g.end_time,g.country=e.country,g.platform_mall_id=e.platform_mall_id,g.mall_alias_name=e.mall_alias_name,g.platform_mall_name=e.platform_mall_name,g.mallId=e.id,b=(new Date).getTime(),g.start_time>b?g.statusName="即将开始":g.end_time<b?g.statusName="已过期":g.statusName="进行中";e.mList=e.mList.concat(s.data.discount_list),h=s.data.discount_list,a.hideEnded&&(h=s.data.discount_list.filter((function(e){return"已过期"!==e.statusName}))),a.tableData=a.tableData.concat(h)}else a.$refs.Logs.writeLog("店铺【".concat(r,"】：").concat(s.data),!1);e.offset+=a.limit;case 34:if(e.mList.length<o&&0!==o){i.next=22;break}case 35:a.$refs.Logs.writeLog("查询店铺【".concat(r,"】活动数据结束"),!0),console.log("tableData",a.tableData),i.next=42;break;case 39:i.prev=39,i.t0=i["catch"](9),a.$refs.Logs.writeLog("店铺【".concat(r,"】异常：").concat(i.t0),!1);case 42:return i.prev=42,--n.count,i.finish(42);case 45:case"end":return i.stop()}}),i,null,[[9,39,42,45]])})))()},filterData:function(e){for(var t=[],a=0;a<e.length;a++){var i=e[a];this.hideEnded&&"已过期"===i.statusName||t.push(i)}return t},handleClick:function(e,t){if("edit"===this.activeName){var a=(new Date).getTime()+6e5,i=a+72e5;this.activeDate=[this.$dayjs(a).format("YYYY-MM-DD HH:mm:ss"),this.$dayjs(i).format("YYYY-MM-DD HH:mm:ss")]}},handleSelectionChange1:function(e){this.multipleSelection=e},handleSelectionChange2:function(e){this.editMultipleSelection=e},changeMallListEdit:function(e){this.selectMallListEdit=e,this.country=e.country},changeMallList:function(e){this.selectMallList=e,this.country=e.country}}},m=d,p=(a("9925"),a("2877")),f=Object(p["a"])(m,i,n,!1,null,"2bcb1c15",null);t["default"]=f.exports},abe5:function(e,t,a){}}]);