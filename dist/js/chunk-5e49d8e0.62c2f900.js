(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e49d8e0"],{"0098":function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r("1da1"),a=r("d4ec"),o=r("bee2"),i=r("ade3"),s=(r("96cf"),r("4de4"),r("159b"),r("99af"),r("c740"),r("7db0"),r("a9e3"),r("d3b7"),r("25f0"),r("caad"),r("2532"),r("5b81"),r("ac1f"),r("1276"),r("466d"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a9"),r("72f7"),r("5319"),r("3ca3"),r("ddb0"),r("fb6a"),r("bda5")),c=r("5f91"),u=r("b5e1"),l=r("a91f"),m=r("1431"),p=r.n(m),g=r("0e0b"),d=r("bcd0"),h=function(){function e(t,r){Object(a["a"])(this,e),Object(i["a"])(this,"$api",s["a"]),Object(i["a"])(this,"$shopeemanService",new c["a"]),Object(i["a"])(this,"$commodityService",new u["a"]),Object(i["a"])(this,"$appConfig",new l["a"]),Object(i["a"])(this,"isStop",!1),Object(i["a"])(this,"_this",null),Object(i["a"])(this,"pageSize",40),Object(i["a"])(this,"writeLog",void 0),Object(i["a"])(this,"orders",[]),Object(i["a"])(this,"schemaType",""),Object(i["a"])(this,"activeType","handle"),Object(i["a"])(this,"isAuto",!1),Object(i["a"])(this,"isApplyForceFaceInfo",!1),this._this=t,this.writeLog=r}return Object(o["a"])(e,[{key:"autoStart",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getEmptyTrackingNoOrder();case 6:if(t=e.sent,200!==t.data.code){e.next=24;break}if(r=t.data.data||[],n=r.filter((function(e){return"TW"!=e.country})),n.length){e.next=12;break}return e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-目前没有要同步的订单！",!1));case 12:this.writeLog("一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 14:if(!(a<n.length)){e.next=21;break}return o=n[a],e.next=18,this.autoMainFlow(o);case 18:a++,e.next=14;break;case 21:this.writeLog("自动同步物流-面单完成",!0),e.next=25;break;case 24:this.writeLog("【自动同步物流-面单】，终止-获取待同步物流订单数据失败",!1);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-".concat(e.t0),!1));case 31:case"end":return e.stop()}}),e,this,[[2,27]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoStartStore",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getNotHaveLogisticsInformations();case 6:if(t=e.sent,console.log(t,"0000000"),200!==t.data.code){e.next=26;break}if(r=t.data.data||[],n=[],r.forEach((function(e){e.orders.forEach((function(t){t.platform_mall_id=e.platform_mall_id,n.push(t)}))})),n.length){e.next=14;break}return e.abrupt("return",this.writeLog("【自动同步仓库中没有面单-面单】，终止-目前没有要同步的订单！",!1));case 14:this.writeLog("【仓库中没有面单】一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 16:if(!(a<n.length)){e.next=23;break}return o=n[a],e.next=20,this.autoMainFlow(o);case 20:a++,e.next=16;break;case 23:this.writeLog("自动仓库中没有面单完成",!0),e.next=27;break;case 26:this.writeLog("【自动仓库中没有面单】，终止获取数据失败",!1);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动仓库中没有面单】，终止-".concat(e.t0),!1));case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoStartNoLogi",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isAuto=!0,this.activeType="auto",e.prev=2,this.isApplyForceFaceInfo=!1,e.next=6,this.$api.getNoLogisticsOrders();case 6:if(t=e.sent,console.log(t,"0000000"),200!==t.data.code){e.next=26;break}if(r=t.data.data||[],n=[],r.forEach((function(e){e.orders.forEach((function(t){t.platform_mall_id=e.platform_mall_id,n.push(t)}))})),n.length){e.next=14;break}return e.abrupt("return",this.writeLog("【自动同步订单中没有面单-面单】，终止-目前没有要同步的订单！",!1));case 14:this.writeLog("【订单中没有面单】一共获取到需要自动同步的订单".concat(n.length,"条"),!0),a=0;case 16:if(!(a<n.length)){e.next=23;break}return o=n[a],e.next=20,this.autoMainFlow(o);case 20:a++,e.next=16;break;case 23:this.writeLog("自动同步物流-面单完成",!0),e.next=27;break;case 26:this.writeLog("【自动同步物流-面单】，终止-获取待同步物流订单数据失败",!1);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e["catch"](2),console.log(e.t0,"error"),e.abrupt("return",this.writeLog("【自动同步物流-面单】，终止-".concat(e.t0),!1));case 33:case"end":return e.stop()}}),e,this,[[2,29]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"autoMainFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,s,c,u,l,m,p,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("TW"!==t.country){e.next=2;break}return e.abrupt("return",this.writeLog("自动流程不同步台湾站面单",!1));case 2:if(console.log(t,"4244242425432"),r=t.platform_mall_id||(t.mall_info?t.mall_info.platform_mall_id:""),n=t.sys_mall_id||(t.mall_info?t.mall_info.id:"")||"",a=t.order_id||t.platform_order_id,o=t.country||"",i=t.order_sn||t.main_order_sn||t.platform_order_sn,e.prev=8,s=null,0!=a&&a){e.next=19;break}return c={keyword:i,shop_id:r},e.next=14,this.$shopeemanService.getOrderHint(o,c);case 14:u=e.sent,console.log(u,"getOrderHint"),s=200===u.code&&u.data&&u.data.orders&&u.data.orders.length&&u.data.orders[0]||null,e.next=24;break;case 19:return l={order_id:a,shop_id:r},e.next=22,this.$shopeemanService.getDetailsSinger(o,l);case 22:m=e.sent,s=200===m.code&&m.data||null;case 24:if(console.log(s,"orderInfo",t),s){e.next=28;break}return this.writeLog("订单【".concat(i,"】同步面单失败,获取订单详情失败,请检查店铺登录状态！"),!1),e.abrupt("return");case 28:return e.next=30,this.checkTrackInfo(s,o);case 30:if(p=e.sent,console.log(p,"trackInfo"),!p.trackingNo){e.next=39;break}return e.next=35,this.uploadTrackingNo(n,r,i,p.trackingNo,p.logistics_channel);case 35:return e.next=37,this.getPrintInfoFlow(n,s,o,p.trackingNo);case 37:e.next=50;break;case 39:return e.next=41,this.applyOrderTrackingNo(a,r,s.logistics_channel,o,n,i);case 41:if(g=e.sent,console.log("applyInfo",g),200!==g.code){e.next=48;break}return e.next=46,this.getPrintInfoFlow(n,s,o,g.data);case 46:e.next=50;break;case 48:return this.writeLog("订单【".concat(i,"】同步面单失败,获取运单号失败,").concat(g.data),!1),e.abrupt("return");case 50:e.next=55;break;case 52:e.prev=52,e.t0=e["catch"](8),console.log(e.t0);case 55:case"end":return e.stop()}}),e,this,[[8,52]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleStart",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.isAuto=!1,this.activeType="handle",this.isApplyForceFaceInfo=r||!1,this.orders=t,n=0;case 5:if(!(n<t.length)){e.next=13;break}return a=t[n],console.log(a),e.next=10,this.handleMainFlow(a);case 10:n++,e.next=5;break;case 13:this.writeLog("面单同步已完成",!0);case 14:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"handleMainFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,s,c,u,l,m,p,g,d,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.platform_mall_id||(t.mall_info?t.mall_info.platform_mall_id:""),n=t.sys_mall_id||(t.mall_info?t.mall_info.id:""),a=t.order_id,o=t.country,i=t.order_sn||t.main_order_sn,e.prev=5,s=null,0!=a&&a){e.next=16;break}return c={keyword:i,shop_id:r},e.next=11,this.$shopeemanService.getOrderHint(o,c);case 11:u=e.sent,console.log(u,"getOrderHint"),s=200===u.code&&u.data&&u.data.orders&&u.data.orders.length&&u.data.orders[0]||null,e.next=21;break;case 16:return l={order_id:a,shop_id:r},e.next=19,this.$shopeemanService.getDetailsSinger(o,l);case 19:m=e.sent,s=200===m.code&&m.data||null;case 21:if(console.log(s,"orderInfo",t),s){e.next=25;break}return this.writeLog("订单【".concat(i,"】同步面单失败,获取订单详情失败,请检查店铺登录状态！"),!1),e.abrupt("return");case 25:if(p=this.checkTrackInfo(s,o),console.log(p,"trackInfo"),!p.trackingNo){e.next=41;break}return e.next=30,this.uploadTrackingNo(n,r,i,p.trackingNo,p.logistics_channel);case 30:if(g=this._this.tableData.findIndex((function(e){return e.order_sn===t.order_sn})),g>-1&&this._this.$set(this._this.tableData[g],"tracking_no",p.trackingNo),"TW"!==t.country){e.next=37;break}return e.next=35,this.getPrintTWinfoFlow(n,s,o,p.trackingNo);case 35:e.next=39;break;case 37:return e.next=39,this.getPrintInfoFlow(n,s,o,p.trackingNo);case 39:e.next=59;break;case 41:return e.next=43,this.applyOrderTrackingNo(a,r,s.logistics_channel,o,n,i);case 43:if(d=e.sent,console.log("applyInfo",d),200!==d.code){e.next=57;break}if(h=this._this.tableData.findIndex((function(e){return e.order_sn===t.order_sn})),h>-1&&this._this.$set(this._this.tableData[h],"tracking_no",d.data),"TW"!==t.country){e.next=53;break}return e.next=51,this.getPrintTWinfoFlow(n,s,o,d.data);case 51:e.next=55;break;case 53:return e.next=55,this.getPrintInfoFlow(n,s,o,d.data);case 55:e.next=59;break;case 57:return this.writeLog("订单【".concat(i,"】同步面单失败，获取运单号失败,").concat(d.data),!1),e.abrupt("return");case 59:e.next=64;break;case 61:e.prev=61,e.t0=e["catch"](5),console.log(e.t0);case 64:case"end":return e.stop()}}),e,this,[[5,61]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getForderLogistics",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_id:t,shop_id:r},e.next=3,this.$shopeemanService.getForderLogistics(n,a);case 3:if(o=e.sent,!(o&&200===o.code&&o.data&&o.data.list&&o.data.list.length)){e.next=8;break}return e.abrupt("return",o.data.list[0].thirdparty_tracking_number);case 8:return e.abrupt("return","");case 9:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getDropOff",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_id:t,shop_id:r},e.next=3,this.$shopeemanService.getDropOff(n,a);case 3:return o=e.sent,console.log(o,"000000"),i=o.data&&o.data.list&&o.data.list[0]&&o.data.list[0].forders&&o.data.list[0].forders[0]&&o.data.list[0].forders[0].third_party_tn||null,i||(i=o.data&&o.data.consignment_no||""),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkTrackInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={},n["orderId"]=t.order_id,n["logistics_channel"]=t.logistics_channel||"",e.next=5,this.getDropOff(t.order_id,t.shop_id,r);case 5:return n["trackingNo"]=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkIsAutoApplyTrackingNumber",value:function(e){var t=d["x"].find((function(t){return t.ShipId==e}));return!(!t||1!=t.IsDeafult)}},{key:"applyOrderTrackingNo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o,i){var s,c,u,l,m,p,d,h,f,_,b,w,v,k,x,y,T,L,S,O;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("TW"!==a||this.isApplyForceFaceInfo){e.next=2;break}return e.abrupt("return",{code:50001,data:"台湾站不强制申请物流单号"});case 2:return e.next=4,this.$appConfig.getUserConfig();case 4:if(s=e.sent,c=s&&JSON.parse(s),console.log(),"TW"===a||c&&c.is_apply_shopee_logistics){e.next=10;break}if(this.isApplyForceFaceInfo){e.next=10;break}return e.abrupt("return",this.getShopeeShipNumber(t,r,a,o,i));case 10:if(u=this.checkIsAutoApplyTrackingNumber(n),u){e.next=13;break}return e.abrupt("return",this.getShopeeShipNumber(t,r,a,o,i,"不支持自动申请虾皮运输单号功能"));case 13:if(e.prev=13,"TW"!==a){e.next=60;break}return l={shop_id:r},e.next=18,this.$shopeemanService.getShopSellerRealName(a,l);case 18:if(m=e.sent,p=""!=m&&m?m:null,p||(p="nick"),"30001"!=n){e.next=45;break}return d={shop_id:r},e.next=25,this.$shopeemanService.getShop(a,d);case 25:if(h=e.sent,f=200===h.code&&h.data.pickup_address_id||null,f){e.next=29;break}return e.abrupt("return",{code:50002,data:"no_address"});case 29:return _={order_id:t,address_id:f,channel_id:n,shop_id:r},e.next=32,this.$shopeemanService.getPickupTimeSlots(a,_);case 32:if(b=e.sent,w=200===b.code&&b.data.time_slots&&b.data.time_slots[0].value||null,console.log(b,w,"pickTimeResult"),console.log("ShopInfoResult",h),w){e.next=38;break}return e.abrupt("return",{code:50003,data:"no_pickup_time"});case 38:return v={order_id:t,channel_id:n,forder_id:t,seller_real_name:p,pickup_time:w,seller_address_id:f,shop_id:r},e.next=41,this.$shopeemanService.handleOutOrder(a,v);case 41:k=e.sent,console.log("applyResult11",k),e.next=58;break;case 45:if("30014"!=n&&"30015"!=n){e.next=53;break}return x={order_id:t,seller_real_name:p,slug:"30014"==n?"SLTW003":"SLTW001",shipping_mode:"dropoff",shop_id:r},e.next=49,this.$shopeemanService.handleOutOrder(a,x);case 49:y=e.sent,console.log("applyResult55",y),e.next=58;break;case 53:return T={order_id:t,channel_id:n,forder_id:t,seller_real_name:p,shop_id:r},e.next=56,this.$shopeemanService.handleOutOrder(a,T);case 56:L=e.sent,console.log("applyResult22",L);case 58:e.next=65;break;case 60:return S={order_id:t,channel_id:n,forder_id:t,shop_id:r},e.next=63,this.$shopeemanService.handleOutOrder(a,S);case 63:O=e.sent,console.log("applyResult33",O);case 65:return e.next=67,Object(g["A"])(2e3);case 67:return e.abrupt("return",this.getShopeeShipNumber(t,r,a,o,i,"",n));case 70:return e.prev=70,e.t0=e["catch"](13),console.log(e.t0),e.abrupt("return",{code:50004,data:"catch - error"});case 74:case"end":return e.stop()}}),e,this,[[13,70]])})));function t(t,r,n,a,o,i){return e.apply(this,arguments)}return t}()},{key:"uploadTrackingNo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=[{orderSn:n,trackingNo:a,logisticsId:o}],e.next=3,this.$commodityService.saveLogisticsInfo(t,r,i);case 3:s=e.sent,c=JSON.parse(s),200===c.code?this.writeLog("订单【".concat(n,"】同步物流成功，上报成功"),!0):this.writeLog("订单【".concat(n,"】同步物流失败，上报失败"),!1);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,o){return e.apply(this,arguments)}return t}()},{key:"getShopeeShipNumber",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o,i,s){var c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,c="",u=s,l=0;case 4:if(!(l<3)){e.next=16;break}return e.next=7,this.getDropOff(t,r,n);case 7:if(c=e.sent,""!==c){e.next=12;break}return e.abrupt("continue",13);case 12:return e.abrupt("break",16);case 13:l++,e.next=4;break;case 16:if(!c){e.next=22;break}return e.next=19,this.uploadTrackingNo(a,r,o,c,u);case 19:return e.abrupt("return",{code:200,data:c});case 22:return e.abrupt("return",{code:50005,data:i||"未获取到物流单号"});case 23:e.next=29;break;case 25:return e.prev=25,e.t0=e["catch"](0),console.log(e.t0),e.abrupt("return",{code:50006,data:"error"});case 29:case"end":return e.stop()}}),e,this,[[0,25]])})));function t(t,r,n,a,o,i,s){return e.apply(this,arguments)}return t}()},{key:"getPrintInfoFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,s,c,u,l,m,p,d,h,f,_;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getPrintWaybillType(r.shop_id,n);case 3:if(o=e.sent,200===o.code&&o.data){e.next=7;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败[501]"),!1),e.abrupt("return");case 7:return this.writeLog("订单【".concat(r.order_sn,"】获取面单类型成功"),!0),i=o.data.waybill_type,console.log(i,o,"fileType"),s=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=13,this.checkPackagePrintWaybillMultiShop(s,r.shop_id,n);case 13:if(c=e.sent,200===c.code&&c.data.list&&c.data.list.length&&c.data.list[0].package_number){e.next=17;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 17:return this.writeLog("订单【".concat(r.order_sn,"】获取包裹号成功"),!0),u=c.data.list[0].package_number,e.next=21,this.getSdConfig(r.shop_id,n);case 21:if(l=e.sent,console.log(l,"schemaType"),l){e.next=26;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 26:return this.writeLog("订单【".concat(r.order_sn,"】获取面单打印配置成功"),!0),"VN"===n&&"NORMAL"===i&&(l=2),"THERMAL"===i&&(l=3),m=[{order_id:Number(r.order_id),package_number:u,region_id:n,shop_id:Number(r.shop_id),channel_id:Number(r.logistics_channel)}],e.next=32,this.createSdJobsMultiShop(m,r.shop_id,n,i+"_PDF","Air Waybill."+r.actual_carrier,l);case 32:if(p=e.sent,200===p.code&&p.data.list&&p.data.list.length&&p.data.list[0].job_id){e.next=36;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败[504]"),!1),e.abrupt("return");case 36:return this.writeLog("订单【".concat(r.order_sn,"】创建打印任务成功"),!0),d=p.data.list[0].job_id,e.next=40,Object(g["A"])(2e3);case 40:return e.next=42,this.downloadSdJob(r.shop_id,d,n);case 42:if(h=e.sent,console.log(h,"1111111111111111"),200===h.code){e.next=54;break}if(120510475!==h.code){e.next=52;break}return console.log("重试"),e.next=49,this.downloadSdJob(r.shop_id,d,n);case 49:h=e.sent,e.next=54;break;case 52:return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(h.message),!1),e.abrupt("return");case 54:if(f=h.data,f){e.next=58;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 58:return e.next=60,this.checkFaceInfo(f,r.order_sn,a,r.actual_carrier,n,l,r);case 60:if(_=e.sent,console.log(_,"res6"),200===_.code){e.next=65;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(_.data,"[508]"),!1),e.abrupt("return");case 65:return e.next=67,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),_.data,".PDF");case 67:e.next=73;break;case 69:e.prev=69,e.t0=e["catch"](0),this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[000]"),!1),console.log(e.t0);case 73:case"end":return e.stop()}}),e,this,[[0,69]])})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"uploadFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o){var i,s,c,u,l,m,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=Object(g["y"])(!1,32)+"_"+(new Date).getTime()+o,e.next=3,this._this.$ossService.uploadFile(a,i);case 3:if(s=e.sent,console.log("url",s),!s){e.next=22;break}return c=[{url:s,orderSn:n.toString(),is_auto:this.isAuto}],u={sysMallId:t.toString(),mallId:r,faceSheetInfos:c},console.log(u),e.next=11,this.$commodityService.saveFaceSheetInfo(t,r,c);case 11:if(l=e.sent,m=JSON.parse(l),console.log(m,"res7"),!m||200!==m.code){e.next=19;break}return"handle"===this.activeType&&(p=this._this.tableData.findIndex((function(e){return e.order_sn===n})),p>-1&&this._this.$set(this._this.tableData[p],"hasLogistics","1")),e.abrupt("return",this.writeLog("订单【".concat(n,"】同步面单成功,上报成功"),!0));case 19:return e.abrupt("return",this.writeLog("订单【".concat(n,"】同步面单失败，上报失败，").concat(m.data.message),!1));case 20:e.next=23;break;case 22:return e.abrupt("return",this.writeLog("订单【".concat(n,"】获取面单异常！"),!1));case 23:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,o){return e.apply(this,arguments)}return t}()},{key:"getPrintTWinfoFlow",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,s,c,u,l,m,p,d,h,f=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=f.length>2&&void 0!==f[2]?f[2]:"TW",a=f.length>3?f[3]:void 0,e.prev=2,"30001"!=r.logistics_channel){e.next=6;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，黑猫无面单"),!1),e.abrupt("return",null);case 6:o="C2C_SHIPPING_LABEL_HTML",e.t0=Number(r.logistics_channel),e.next=30012===e.t0||30014===e.t0||30015===e.t0?10:12;break;case 10:return o="THERMAL_PDF",e.abrupt("break",14);case 12:return o="C2C_SHIPPING_LABEL_HTML",e.abrupt("break",14);case 14:return i=[{order_id:Number(r.order_id),shop_id:Number(r.shop_id),region_id:n}],e.next=17,this.checkPackagePrintWaybillMultiShop(i,r.shop_id,n);case 17:if(s=e.sent,200===s.code&&s.data.list&&s.data.list.length&&s.data.list[0].package_number){e.next=21;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，未获取到包裹号[502]"),!1),e.abrupt("return");case 21:if(c=s.data.list[0].package_number,u=null,"30012"!=r.logistics_channel){e.next=27;break}u=3,e.next=35;break;case 27:if("30014"!=r.logistics_channel&&"30015"!=r.logistics_channel){e.next=31;break}u=14,e.next=35;break;case 31:return e.next=33,this.getSdConfig(r.shop_id,n);case 33:u=e.sent,console.log(u,"schemaType");case 35:if(u){e.next=38;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，获取面单打印配置失败[503]"),!1),e.abrupt("return");case 38:return l=[{order_id:Number(r.order_id),package_number:c,region_id:n,shop_id:Number(r.shop_id)}],"30014"!=r.logistics_channel&&"30015"!=r.logistics_channel||(l[0]["channel_id"]=r.logistics_channel),e.next=42,this.createSdJobsMultiShop(l,r.shop_id,n,o,"寄件单"+r.actual_carrier,u);case 42:if(m=e.sent,200===m.code&&m.data.list&&m.data.list.length&&m.data.list[0].job_id){e.next=46;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，创建打印任务失败"),!1),e.abrupt("return");case 46:return p=m.data.list[0].job_id,e.next=49,Object(g["A"])(3e3);case 49:return e.next=51,this.downloadTwFace(r,p,n,a);case 51:if(d=e.sent,!d){e.next=70;break}if("30005"!=r.logistics_channel&&"30006"!=r.logistics_channel){e.next=58;break}return e.next=56,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),d,".html");case 56:e.next=68;break;case 58:return e.next=60,this.checkFaceInfo(d,r.order_sn,a,r.actual_carrier,n,u);case 60:if(h=e.sent,200===h.code){e.next=66;break}return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，").concat(h.data),!1),e.abrupt("return");case 66:return e.next=68,this.uploadFaceInfo(t.toString(),r.shop_id.toString(),r.order_sn.toString(),h.data,".PDF");case 68:e.next=72;break;case 70:return this.writeLog("订单【".concat(r.order_sn,"】同步面单失败，下载面单失败"),!1),e.abrupt("return");case 72:e.next=77;break;case 74:e.prev=74,e.t1=e["catch"](2),console.log("error",e.t1);case 77:case"end":return e.stop()}}),e,this,[[2,74]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"downloadTwFace",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.logistics_channel,"order.logistics_channel"),"30005"!=t.logistics_channel){e.next=9;break}return e.next=4,this.downloadSdJobTW(t.shop_id,r,n);case 4:if(o=e.sent,o){e.next=8;break}return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return",null);case 8:return e.abrupt("return",this.get711FaceInfo(a,o));case 9:if("30006"!=t.logistics_channel){e.next=19;break}return e.next=12,this.downloadSdJobTW(t.shop_id,r,n);case 12:if(i=e.sent,console.log(i,"faceData"),i){e.next=18;break}return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败[505]"),!1),e.abrupt("return");case 18:return e.abrupt("return",this.getQuanJiaFaceInfo(a,i,t.shop_id));case 19:return e.next=21,this.downloadSdJob(t.shop_id,r,n);case 21:if(s=e.sent,200===s.code){e.next=32;break}if(120510475!==s.code){e.next=30;break}return console.log("重试"),e.next=27,this.downloadSdJob(t.shop_id,r,n);case 27:s=e.sent,e.next=32;break;case 30:return this.writeLog("订单【".concat(t.order_sn,"】同步面单失败,下载失败,").concat(s.message),!1),e.abrupt("return",null);case 32:return e.abrupt("return",s.data);case 33:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"get711FaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,s,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=p.a.load(r),a=n('input[name="tempvar"]')[0].attribs.value||void 0,a){e.next=4;break}return e.abrupt("return",null);case 4:return o={PinCodeNumber:t,tempvar:a,NewWindow:"Y",BackTag:"https://seller.shopee.tw/portal/sale/"},i={headers:{Referer:"https://epayment.7-11.com.tw/C2C/C2CWeb/C2C.aspx","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36","Content-Type":"application/x-www-form-urlencoded",isGBK:!1}},i["params"]=o,e.next=9,window["NetMessageBridgeService"].post("https://epayment.7-11.com.tw/C2C/C2CWeb/PrintC2CPinCode.aspx",JSON.stringify(i),JSON.stringify(o));case 9:if(s=e.sent,c=JSON.parse(s),u=c.data,!u||!u.includes(t)){e.next=20;break}return u=u.replaceAll("css/C2CPrint.css","https://epayment.7-11.com.tw/C2C/C2CWeb/css/C2CPrint.css").replaceAll("BarCode.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/BarCode.ashx?CodeValue=").replaceAll("QRCode.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/QRCode.ashx?CodeValue=").replaceAll("BarCode128.ashx?CodeValue=","https://epayment.7-11.com.tw/C2C/C2CWeb/BarCode128.ashx?CodeValue="),e.next=16,window["BaseUtilBridgeService"].htmlToBase64(u);case 16:return l=e.sent,e.abrupt("return",l);case 20:return e.abrupt("return",null);case 21:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"dataURLtoFile",value:function(e,t){var r=e.split(","),n=r[0].match(/:(.*?);/)[1],a=atob(r[1]),o=a.length,i=new Uint8Array(o);while(o--)i[o]=a.charCodeAt(o);return new File([i],t,{type:n})}},{key:"getQuanJiaFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o,i,s,c,u,l,m,g,d,h,f,_,b,w,v,k;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=p.a.load(r),o=a("input")[0].attribs.value,i=a("input")[1].attribs.value,i=i.replace("&lt;","<").replace("&gt;",">").replace("&#39;","'"),s=Number(a("input")[2].attribs.value),c=a("input")[3].attribs.value,e.next=9,window["ConfigBridgeService"].getGlobalCacheInfo("mallInfo",n);case 9:return u=e.sent,l=JSON.parse(u),m=l.mall_main_id,l.IPType,g={ApiKey:o,Data:i,TimeStamp:s,Signature:c},d={headers:{Host:"external2.shopee.tw","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3",isProxyMallId:m.toString(),"Content-Type":"application/x-www-form-urlencoded",isGBK:!1}},d["params"]=g,e.next=16,window["NetMessageBridgeService"].post("https://external2.shopee.tw/ext/familymart/OrderPrint/OrderPrint.aspx",JSON.stringify(d),JSON.stringify(g));case 16:if(h=e.sent,f=JSON.parse(h),!f||200===f.status){e.next=25;break}if(!f||500!==f.status){e.next=24;break}return e.next=22,window["NetMessageBridgeService"].post("https://external2.shopee.tw/ext/familymart/OrderPrint/OrderPrint.aspx",JSON.stringify(d),JSON.stringify(g));case 22:h=e.sent,f=JSON.parse(h);case 24:f&&500===f.status?this.writeLog("同步面单异常,官方错误：官方服务器异常：".concat(f.statusText),!1):this.writeLog("同步面单异常".concat(f.statusText),!1);case 25:if(_=f.data,_&&_.includes(".gif")){e.next=28;break}return e.abrupt("return",null);case 28:if(b=p.a.load(_),console.log(b("img")),!b("img")){e.next=40;break}return w=b("img")[0].attribs.src,v="https://external2.shopee.tw/ext/familymart/OrderPrint/"+w,_=_.replace(w,v),e.next=36,window["BaseUtilBridgeService"].htmlToBase64(_);case 36:return k=e.sent,e.abrupt("return",k);case 40:return console.log("nullnull"),e.abrupt("return",null);case 42:e.next=48;break;case 44:return e.prev=44,e.t0=e["catch"](0),console.log(e.t0),e.abrupt("return",null);case 48:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getPrintWaybillType",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getPrintWaybillType(r,n);case 3:return a=e.sent,console.log(a,"面单类型"),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkPackagePrintWaybillMultiShop",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={order_info_list:t,shop_id:r},e.next=3,this.$shopeemanService.checkPackagePrintWaybillMultiShop(n,a);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getSdConfig",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={shop_id:t},e.next=3,this.$shopeemanService.getSdConfig(r,n);case 3:if(a=e.sent,o=null,!(200===a.code&&a.data&&a.data.suggest_schema&&a.data.suggest_schema.last_normal_selected_schema)){e.next=14;break}return i=!1,s=a.data.suggest_schema.last_normal_selected_schema,c=a.data.suggest_schema.suggest_default_schema,(s.length<1&&c.length>1||s.length>1)&&(i=!0),o=i||"VN"===r?"TW"===r?6:"MY"===r||"PH"===r||"VN"===r?3:"TH"===r||"ID"===r?2:Number(c[1]):s.length<1?Number(c[0]):Number(s[0]),e.abrupt("return",o);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSdJobsMultiShop",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o,i){var s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={record_generate_schema:!1,package_list:t,generate_file_details:[{file_type:a,file_name:o,file_contents:[i]}],shop_id:r},e.next=3,this.$shopeemanService.createSdJobsMultiShop(n,s);case 3:return c=e.sent,e.abrupt("return",c);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,o,i){return e.apply(this,arguments)}return t}()},{key:"downloadSdJob",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={job_id:r,shop_id:t},e.next=3,this.$shopeemanService.downloadSdJob(n,a);case 3:if(o=e.sent,e.prev=4,i=o&&JSON.parse(o.data),!i||0!==i.code){e.next=10;break}return e.abrupt("return",{code:200,data:o.rawBytes});case 10:return e.abrupt("return",{code:i.code||50001,message:i.message||""});case 11:e.next=16;break;case 13:return e.prev=13,e.t0=e["catch"](4),e.abrupt("return",{code:200,data:o.rawBytes});case 16:case"end":return e.stop()}}),e,this,[[4,13]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"downloadSdJobTW",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={job_id:r,shop_id:t},e.next=3,this.$shopeemanService.downloadSdJob(n,a);case 3:return o=e.sent,console.log(o,"下载面单信息"),e.abrupt("return",o.data||"");case 6:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"checkFaceInfo",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o,i,s){var c,u,l,m,p,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.length,r,n,i),!(null===t||t.length<500)&&r&&n){e.next=4;break}return window["BaseUtilBridgeService"].checkAutoScriptLog("[".concat(r,"]面单长度小于500")),e.abrupt("return",{code:50001,data:"面单大小或平台物流获取异常，请重新同步！"});case 4:if(c=t,"VN"!=o||"J&T Exoress"!=a||2!=i){e.next=14;break}return e.next=8,this.cutFaseSize(t,r,!0,300,420,-420);case 8:if(u=e.sent,200==u.code&&u.data){e.next=11;break}return e.abrupt("return",{code:50001,data:u.msg});case 11:c=200==u.code&&u.data||t,e.next=30;break;case 14:if("VN"!=o||"VNPost Nhanh"!=a){e.next=23;break}return e.next=17,this.cutFaseSize(t,r,!0,300,425,-420);case 17:if(l=e.sent,200==l.code&&l.data){e.next=20;break}return e.abrupt("return",{code:50001,data:l.msg});case 20:c=200==l.code&&l.data||t,e.next=30;break;case 23:if("ID"!=o){e.next=30;break}return e.next=26,this.cutFaseSize(t,r,!0,425,595,0);case 26:if(m=e.sent,200==m.code&&m.data){e.next=29;break}return e.abrupt("return",{code:50001,data:m.msg});case 29:c=200==m.code&&m.data||t;case 30:return e.next=32,window["BaseUtilBridgeService"].checkFaceInfo(c,r,n);case 32:if(p=e.sent,g=JSON.parse(p),console.log(g,"blobToDataURL"),200!==g.code){e.next=39;break}return e.abrupt("return",{code:200,data:c});case 39:return e.abrupt("return",{code:50001,data:"订单【".concat(r,"】获取面单异常, ").concat(g.msg)});case 40:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,o,i,s){return e.apply(this,arguments)}return t}()},{key:"cutFaseSize",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r,n,a,o,i){var s,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={OrderNo:r,IsUseA4Size:n,PdfWidth:a,PdfHeight:o,LocationY:i},console.log(t,!0,JSON.stringify(s)),e.next=4,window["BaseUtilBridgeService"].getFaceData(t,!0,s);case 4:return c=e.sent,u=c&&JSON.parse(c),console.log(u,"cutFaseSize"),e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})));function t(t,r,n,a,o,i){return e.apply(this,arguments)}return t}()},{key:"blobToDataURL",value:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)}},{key:"getPickListData",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,r=this.dealWithMallOrderGroup(t),n="NORMAL",a=regeneratorRuntime.mark((function e(t){var a,o,s,c,u,l,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=r[t],o=a[0].country,s=t,c=r[t][0].mall_info.platform_mall_name,u=regeneratorRuntime.mark((function e(t){var r,u,l,m,p,g,d,h,f,_,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.slice(t,t+50),u=[],r.forEach((function(e){if(0!=e.order_id){var t={order_id:Number(e.order_id),shop_id:Number(s),region_id:o};u.push(t)}})),console.log(u,"orderInfolist"),e.next=6,i.checkPackagePrintWaybillMultiShop(u,s,o);case 6:if(l=e.sent,console.log(l,"packInfo"),200!==l.code){e.next=43;break}if(l.data.list.length){e.next=14;break}return i.writeLog("店铺【".concat(c,"】当前数据没有可下载的拣货单"),!1),e.abrupt("return","continue");case 14:return m=l.data.list,p=[],m.forEach((function(e){var t={order_id:Number(e.order_id),package_number:e.package_number,region_id:o,shop_id:Number(s)};p.push(t)})),e.next=19,i.createSdJobsMultiShop(p,s,o,n+"_PDF","PickList",0);case 19:if(g=e.sent,200===g.code&&g.data.list&&g.data.list.length&&g.data.list[0].job_id){e.next=24;break}i.writeLog("创建拣货单失败，".concat(g.data),!1),e.next=41;break;case 24:return d=g.data.list[0].job_id,e.next=27,i.downloadSdJob(s,d,o);case 27:if(h=e.sent,200===h.code){e.next=31;break}return i.writeLog("店铺【".concat(c,"】下载拣货单失败，").concat(h.message),!1),e.abrupt("return","continue");case 31:if(f=h.data,console.log(f.length,"base64"),f&&!(f.length<500)){e.next=36;break}return i.writeLog("店铺【".concat(c,"】下载拣货单失败，稍后请重试"),!1),e.abrupt("return","continue");case 36:return e.next=38,window["BaseUtilBridgeService"].downloadPickForm(f,c);case 38:_=e.sent,b=JSON.parse(_),200===b.code?i.writeLog("店铺【".concat(c,"】下载拣货单成功"),!0):i.writeLog("店铺【".concat(c,"】下载拣货单失败，").concat(b.msg),!1);case 41:e.next=44;break;case 43:403===l.code?i.writeLog("店铺【".concat(c,"】下载拣货单失败,店铺未登录"),!1):i.writeLog("店铺【".concat(c,"】下载拣货单失败"),!1);case 44:case"end":return e.stop()}}),e)})),l=0;case 6:if(!(l<a.length)){e.next=14;break}return e.delegateYield(u(l),"t0",8);case 8:if(m=e.t0,"continue"!==m){e.next=11;break}return e.abrupt("continue",11);case 11:l+=50,e.next=6;break;case 14:case"end":return e.stop()}}),e)})),e.t0=regeneratorRuntime.keys(r);case 5:if((e.t1=e.t0()).done){e.next=10;break}return o=e.t1.value,e.delegateYield(a(o),"t2",8);case 8:e.next=5;break;case 10:e.next=15;break;case 12:e.prev=12,e.t3=e["catch"](0),console.log(e.t3,"error");case 15:this.writeLog("下载拣货单完成，请前往桌面【平台拣货单】文件夹查看",!0);case 16:case"end":return e.stop()}}),e,this,[[0,12]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dealWithMallOrderGroup",value:function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];t[n.mall_info.platform_mall_id]||(t[n.mall_info.platform_mall_id]=[]),t[n.mall_info.platform_mall_id].push(n)}return t}}]),e}()},"31af":function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r("b85c"),a=r("1da1"),o=r("d4ec"),i=r("bee2"),s=r("ade3"),c=(r("96cf"),r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0"),r("b0c0"),r("99af"),r("7db0"),r("4de4"),r("ac1f"),r("466d"),r("4d63"),r("25f0"),r("bda5")),u=r("6ac8"),l=r("bb97"),m=r("a91f"),p=function(){function e(t){Object(o["a"])(this,e),Object(s["a"])(this,"$appConfig",new m["a"]),Object(s["a"])(this,"$baseUtilService",new u["a"]),Object(s["a"])(this,"$LogisticBridgeService",new l["a"]),Object(s["a"])(this,"$api",c["a"]),Object(s["a"])(this,"userInfo",this.$appConfig.getUserInfo()),Object(s["a"])(this,"logCallback",void 0),Object(s["a"])(this,"buyerAccountContainer",null),Object(s["a"])(this,"ordersContainer",null),Object(s["a"])(this,"allSetting",void 0),Object(s["a"])(this,"_that",null),Object(s["a"])(this,"writeLog",void 0),this.writeLog=t}return Object(i["a"])(e,[{key:"start",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,r,a){var o,i,s,c,u,l,m,p,g,d,h=this,f=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=f.length>3&&void 0!==f[3]?f[3]:[],this.writeLog=a,this._that=t,e.next=5,this.getGlobalSetting();case 5:if(i=[],!o.length){e.next=10;break}i=o,e.next=13;break;case 10:return e.next=12,this.getOrdersFromServer();case 12:i=e.sent;case 13:if(i=this.filterOrder(i),i.length){e.next=17;break}return this.writeLog("目前没有需要获取物流单号的订单",!1),e.abrupt("return");case 17:this.writeLog("获取到【".concat(i.length,"】条需要同步物流的订单"),!0),s=new Map,c=function(e){var t=i[e],n=t.shot_order_info.buy_account_info?t.shot_order_info.buy_account_info.name:"",a=t.shot_order_info.buy_account_info?t.shot_order_info.buy_account_info.type:"",o=t.shot_order_sn||t.order_sn;if(!n)return h.writeLog("【".concat(e+1,"/").concat(i.length,"】订单【").concat(o,"】对应的买手号为空，请检查！"),!1),"continue";if(10001==a||1e4==a)return h.writeLog("【".concat(e+1,"/").concat(i.length,"】订单【").concat(o,"】对应的买手号【").concat(n,"】无需同步采购物流！"),!0),"continue";var c=r.find((function(e){return e.name===n&&a===e.type}));if(!c)return h.writeLog("【".concat(e+1,"/").concat(i.length,"】订单【").concat(o,"】对应的买手号【").concat(n,"】没有找到，请登录对应买手号."),!1),"continue";if(s.has(c)){var u=s.get(c);u.push(t)}else s.set(c,[t])},u=0;case 21:if(!(u<i.length)){e.next=28;break}if(l=c(u),"continue"!==l){e.next=25;break}return e.abrupt("continue",25);case 25:u++,e.next=21;break;case 28:if(0===s.size){e.next=49;break}m=Object(n["a"])(s.keys()),e.prev=30,m.s();case 32:if((p=m.n()).done){e.next=41;break}return g=p.value,d=s.get(g),this.buyerAccountContainer=g,this.ordersContainer=d,e.next=39,this.syncLogistic();case 39:e.next=32;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e["catch"](30),m.e(e.t0);case 46:return e.prev=46,m.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[30,43,46,49]])})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"getOrdersFromServer",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.getOrdersFromServerCycle();case 3:return r=e.sent,200===r.code?t=r.data.orderList:this.writeLog("获取需要同步物流的订单失败原因:".concat(r.code,": ").concat(r.data),!1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getOrdersFromServerCycle",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$api.getOriginalTrackingNumberEmpty();case 3:if(t=e.sent,200!==t.data.code){e.next=7;break}return r={total:t.data.data.length,orderList:t.data.data},e.abrupt("return",{code:200,data:r});case 7:return e.abrupt("return",{code:t.data.code,data:t.data.message});case 10:if(e.prev=10,e.t0=e["catch"](0),!e.t0.response){e.next=14;break}return e.abrupt("return",{code:e.t0.response.status,data:e.t0.response.data.message});case 14:return e.abrupt("return",{code:-2,data:"getOrdersFromServerCycle-catch:".concat(e.t0)});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"filterOrder",value:function(e){return e.filter((function(e){return!e.logistics||!e.logistics.tracking_number&&e.shot_order_info&&e.shot_order_info.shot_order_sn&&e.buy_account_info}))}},{key:"syncLogistic",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(this.buyerAccountContainer,this.ordersContainer,"syncLogistic"),!this.buyerAccountContainer||!this.ordersContainer){e.next=24;break}e.t0=this.buyerAccountContainer.type,e.next=1===e.t0?5:2===e.t0?8:8===e.t0?11:9===e.t0?14:10===e.t0?17:11===e.t0?20:23;break;case 5:return e.next=7,this.syncLogisticAggregation("拼多多");case 7:return e.abrupt("break",24);case 8:return e.next=10,this.syncLogisticAggregation("淘宝");case 10:return e.abrupt("break",24);case 11:return e.next=13,this.syncLogisticAggregation("1688");case 13:return e.abrupt("break",24);case 14:return e.next=16,this.syncLogisticAggregation("lazada");case 16:return e.abrupt("break",24);case 17:return e.next=19,this.syncLogisticAggregation("京喜");case 19:return e.abrupt("break",24);case 20:return e.next=22,this.syncLogisticAggregation("shopee");case 22:return e.abrupt("break",24);case 23:return e.abrupt("break",24);case 24:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"changeType",value:function(e){switch(e){case 1:return 1;case 2:return 0;case 8:return 5;case 10:return 3;case 9:return 7;case 11:return 8;default:return e}}},{key:"changeAccountParams",value:function(e){var t={UserNameCache:e.cache_path,Password:"",shotOrderPlatform:this.changeType(e.type),LoginedCookies:e.login_info,UserName:e.name,Cookiestr:JSON.stringify(e.login_info),AccountType:e.type,Ua:e.ua,Country:e.site||""};return t}},{key:"syncLogisticAggregation",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,s,c,u,l,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this.ordersContainer,n=r.length,a=this.changeAccountParams(this.buyerAccountContainer),o=0;case 4:if(!(o<n)){e.next=44;break}if(i=r[o],s=i.shot_order_info.shot_order_sn||"",s){e.next=10;break}return this.writeLog("(".concat(t,")订单【").concat(i.order_sn,"】获取上家物流失败,订单无采购单号"),!1),e.abrupt("continue",41);case 10:return e.prev=10,console.log(a.shotOrderPlatform,s,a),e.next=14,this.$baseUtilService.getOriginLogistics(a.shotOrderPlatform,s,a);case 14:if(c=e.sent,200===c.Code){e.next=18;break}return this.writeLog("(".concat(t,")订单【").concat(i.order_sn,"】获取上家物流失败, ").concat(c.Msg,"(买手号: ").concat(a.UserName,")"),!1),e.abrupt("continue",41);case 18:if(c.TrackingNumber){e.next=21;break}return this.writeLog("(".concat(t,")订单【").concat(i.order_sn,"】未发货，(买手号: ").concat(a.UserName,")"),!1,"#ff9900"),e.abrupt("continue",41);case 21:return u=this.changetbOrderName(c.TrackingName),l={sysOrderId:i.id,trackingNumber:c.TrackingNumber,trackingNumberCompany:c.TrackingName},e.next=25,this.saveOrderLogistics(l);case 25:if(m=e.sent,200===m.code){e.next=29;break}return this.writeLog("(".concat(t,")订单【").concat(i.order_sn,"】上报物流失败原因: ").concat(m.code,": ").concat(m.data),!1),e.abrupt("continue",41);case 29:this.writeLog("(".concat(t,")订单【").concat(i.order_sn,"】同步物流成功"),!0),i.logistics||(i.logistics={}),i.logistics.tracking_number=c.TrackingNumber,i.logistics.logistics_company=c.TrackingName,i.logistics.logistics_company_code=u,e.next=41;break;case 36:return e.prev=36,e.t0=e["catch"](10),console.log(e.t0),this.writeLog("订单【".concat(i.order_sn,"获取上家物流失败原因(").concat(t,"): ").concat(JSON.stringify(e.t0)),!1),e.abrupt("continue",41);case 41:o++,e.next=4;break;case 44:this.ordersContainer=null,this.buyerAccountContainer=null;case 46:case"end":return e.stop()}}),e,this,[[10,36]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getGlobalSetting",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$appConfig.getUserConfig();case 3:t=e.sent,r=JSON.parse(t),this.allSetting=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),this.allSetting=null;case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"saveOrderLogistics",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$api.uploadTrackingNumber(t);case 3:if(r=e.sent,console.log(r,"saveOrderLogistics"),200!==r.data.code){e.next=7;break}return e.abrupt("return",{code:200,data:"物流信息上报成功"});case 7:return e.abrupt("return",{code:r.data.code,data:r.data.message});case 10:if(e.prev=10,e.t0=e["catch"](0),!e.t0.response){e.next=14;break}return e.abrupt("return",{code:e.t0.response.status,data:e.t0.response.data.message});case 14:return e.abrupt("return",{code:-2,data:"sync-service-saveOrderLogistics-catch:".concat(JSON.stringify(e.t0))});case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"delay",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=setTimeout((function(){clearTimeout(r),e(!0)}),t)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"changetbOrderName",value:function(e){var t=JSON.parse(JSON.stringify(e));switch(t){case(t.match(RegExp(/圆通速递/))||{}).input:t="YTO";break;case(t.match(RegExp(/圆通快递/))||{}).input:t="YTO";break;case(t.match(RegExp(/韵达快递/))||{}).input:t="YUNDA";break;case(t.match(RegExp(/天天快递/))||{}).input:t="TTKDEX";break;case(t.match(RegExp(/顺丰速运/))||{}).input:t="SF";break;case(t.match(RegExp(/顺丰快递/))||{}).input:t="SF";break;case(t.match(RegExp(/百世快递/))||{}).input:t="HTKY";break;case(t.match(RegExp(/申通快递/))||{}).input:t="STO";break;case(t.match(RegExp(/中通快递/))||{}).input:t="ZTO";break;case(t.match(RegExp(/优速快递/))||{}).input:t="UC";break;case(t.match(RegExp(/EMS/))||{}).input:t="EMS";break;case(t.match(RegExp(/国通快递/))||{}).input:t="GTO";break;case(t.match(RegExp(/其它/))||{}).input:t="OTHER";break;case(t.match(RegExp(/极兔速递/))||{}).input:t="OTHER";break;case(t.match(RegExp(/邮政快递包裹/))||{}).input:t="POSTB";break;case(t.match(RegExp(/EMS经济快递/))||{}).input:t="EYB";break;default:t="";break}return t}}]),e}()},58660:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r("53ca"),a=r("b85c"),o=r("1da1"),i=r("d4ec"),s=r("bee2"),c=r("ade3"),u=(r("99af"),r("3ca3"),r("ddb0"),r("c740"),r("a9e3"),r("96cf"),r("f68b")),l=r("a254"),m=r("2b0e"),p=r("0e0b"),g=null,d=function(){function e(){Object(i["a"])(this,e),Object(c["a"])(this,"MallAPIInstance",new u["a"](new m["default"])),Object(c["a"])(this,"MarketManagerAPIInstance",new l["a"](new m["default"]))}return Object(s["a"])(e,[{key:"add0",value:function(e){return e<10?"0"+e:e}},{key:"formatTime",value:function(e){var t=new Date(e),r=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),o=t.getHours(),i=t.getMinutes(),s=t.getSeconds();return r+"-"+g.add0(n)+"-"+g.add0(a)+" "+g.add0(o)+":"+g.add0(i)+":"+g.add0(s)}},{key:"isLogin",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,g.MallAPIInstance.isLogin(t);case 2:if(r=e.sent,200!==r.code||!r.data){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"topAction",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={country:t.country,mallId:t.sys_mall_id,goodsID:t.id},console.log("置顶",t),e.next=4,g.MarketManagerAPIInstance.topGoods(r);case 4:if(n=e.sent,0!==n.ecode){e.next=12;break}return e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.sys_mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品置顶成功"});case 8:return console.log("topAction-商品置顶suc"),e.abrupt("return",!0);case 12:return e.next=14,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.sys_mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品【".concat(t.id,"】置顶失败").concat(n.message)});case 14:return console.log("topAction-商品置顶fail"),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,window.BaseUtilBridgeService.getTopGoodsTask("all");case 2:if(t=e.sent,console.log(t),t.length){e.next=7;break}return console.log("暂无任务"),e.abrupt("return");case 7:return g=this,e.next=10,Object(p["d"])(t,this.runtesk);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"runtesk",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var r,o,i,s,c,u,l,m,p,d=this,h=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{count:1},e.prev=1,e.next=4,window.BaseUtilBridgeService.getTopGoods(t.mall_id,"0");case 4:if(o=e.sent,o.length){e.next=10;break}return e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"已置顶完所有商品"});case 8:return console.log("已置顶完所有商品"),e.abrupt("return");case 10:return e.next=12,g.isLogin({platform_mall_id:t.mall_id,country:t.country});case 12:if(i=e.sent,i){e.next=19;break}return e.next=16,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"店铺未登录"});case 16:return console.log("登录未登录"),setTimeout((function(){console.log("104-----s")}),1e3),e.abrupt("return");case 19:if(s=new Date(t.next_top_time).getTime(),!(s>(new Date).getTime())){e.next=26;break}return console.log(t.country+"未到执行时间"),e.next=24,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"未到置顶时间"});case 24:return setTimeout(this.runtesk(t,r={count:1}),162e5),e.abrupt("return");case 26:return e.next=28,window.BaseUtilBridgeService.getTopGoods(t.mall_id,"0");case 28:if(c=e.sent,console.log("查询未置顶的商品",c),c.length){e.next=35;break}return console.log("已置顶完所有商品"),e.next=34,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"已置顶完所有商品"});case 34:return e.abrupt("return");case 35:u=Object(a["a"])(c),e.prev=36,m=regeneratorRuntime.mark((function e(){var n,a,o,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=l.value,e.next=3,g.MarketManagerAPIInstance.topedGoods({country:t.country,mallId:t.mall_id});case 3:if(a=e.sent,0===a.ecode){e.next=11;break}return console.log("店铺【".concat(t.mall_name,"】商品置顶数据获取失败")),e.next=8,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"店铺【".concat(t.mall_name,"】商品置顶数据获取失败")});case 8:return console.log("414-商品数据获取失败"),setTimeout(d.runtesk(t,r={count:1}),162e5),e.abrupt("return",{v:void 0});case 11:if(o=a.data,!(o.findIndex((function(e){return e===Number(n.goods_id)}))>=0)){e.next=21;break}return e.next=15,window.BaseUtilBridgeService.saveTopGoods({mall_id:t.mall_id,goods_id:n.goods_id,is_top:"1"});case 15:return i=e.sent,console.log("商品表状态更新",i),e.next=19,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"".concat(n.goods_id,"商品正在置顶")});case 19:return console.log("426-该商品正在置顶"),e.abrupt("return","continue");case 21:if(!(o.length>=5)){e.next=27;break}return e.next=24,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品置顶已达上限"});case 24:return console.log("商品置顶已达上限",o),setTimeout(d.runtesk(t,r={count:1}),162e5),e.abrupt("return",{v:void 0});case 27:return console.log("置顶",n),s={country:n.country,mallId:n.sys_mall_id,goodsID:n.id},e.next=31,d.MarketManagerAPIInstance.topGoods(s);case 31:if(c=e.sent,0!==c.ecode){e.next=40;break}return e.next=35,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品置顶成功"});case 35:return console.log("置顶成功"),e.next=38,window.BaseUtilBridgeService.saveTopGoods({mall_id:t.mall_name,goods_id:n.goods_id,is_top:"1"});case 38:e.next=43;break;case 40:return e.next=42,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品【".concat(n.id,"】置顶失败").concat(c.message)});case 42:console.log("置顶失败");case 43:case"end":return e.stop()}}),e)})),u.s();case 39:if((l=u.n()).done){e.next=48;break}return e.delegateYield(m(),"t0",41);case 41:if(p=e.t0,"continue"!==p){e.next=44;break}return e.abrupt("continue",46);case 44:if("object"!==Object(n["a"])(p)){e.next=46;break}return e.abrupt("return",p.v);case 46:e.next=39;break;case 48:e.next=53;break;case 50:e.prev=50,e.t1=e["catch"](36),u.e(e.t1);case 53:return e.prev=53,u.f(),e.finish(53);case 56:setTimeout(this.runtesk(t,r={count:1}),162e5),e.next=64;break;case 59:return e.prev=59,e.t2=e["catch"](1),console.log("try-catch",e.t2),e.next=64,window.BaseUtilBridgeService.saveTopGoodsHistory({country:t.country,mall_name:t.mall_name,mall_id:t.mall_id,log_time:g.formatTime((new Date).getTime()),log_message:"商品置顶失败".concat(e.t2)});case 64:return e.prev=64,--r.count,e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[1,59,64,67],[36,50,53,56]])})));function t(t){return e.apply(this,arguments)}return t}()}]),e}()},bb97:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r("d4ec"),a=r("bee2"),o=function(){function e(){Object(n["a"])(this,e),this.nativeService=window["LogisticBridgeService"]}return Object(a["a"])(e,[{key:"getLogisticByOrderIdAsync",value:function(e,t){return this.nativeService.getLogisticByOrderIdAsync(e,t)}}]),e}()},c17c:function(e,t,r){"use strict";r("f856")},d1dd:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r("53ca"),a=r("b85c"),o=r("2909"),i=r("1da1"),s=r("d4ec"),c=r("bee2"),u=r("ade3"),l=(r("96cf"),r("a9e3"),r("ac1f"),r("1276"),r("a434"),r("159b"),r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0"),r("4de4"),r("b680"),r("d81d"),r("99af"),r("25f0"),r("c740"),r("f68b")),m=r("0e0b"),p=r("2b0e"),g=null,d=function(){function e(){Object(s["a"])(this,e),Object(u["a"])(this,"mallTest",""),Object(u["a"])(this,"MallAPIInstance",new l["a"](new p["default"])),Object(u["a"])(this,"mallSearchList",[]),Object(u["a"])(this,"storeLogList",{})}return Object(c["a"])(e,[{key:"autoAddFenceActive",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=["MY","TW","VN","ID","PH","TH","SG","BR","MX","CO","CL","PL"],r=0,n=t;case 2:if(!(r<n.length)){e.next=14;break}return a=n[r],o={},o["country"]=a,o["log_message"]=[],e.next=9,window.BaseUtilBridgeService.getAttentionUserTask(a);case 9:i=e.sent,i.length&&(console.log(i),s=(new Date).getTime(),c=Number(i[0].exec_time),this.runTesk(s-c,i));case 11:r++,e.next=2;break;case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"runTesk",value:function(e,t){var r=this;this.storeLogList["".concat(t[0].country)]={},this.storeLogList["".concat(t[0].country)].log_message=[],e=e>0?0:0-e,e?(console.log("该任务还未到执行时间",t[0].country,t[0]),this.storeLogList["".concat(t[0].country)].log_message.push({option:"【".concat(t[0].country,"】该任务还未到执行时间"),activeTime:this.formatTime((new Date).getTime())})):(console.log("任务即将执行",t[0].country,t[0]),this.storeLogList["".concat(t[0].country)].log_message.push({option:"【".concat(t[0].country,"】任务即将执行...."),activeTime:this.formatTime((new Date).getTime())})),setTimeout(Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,o,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.searchMall(t[0]);case 2:return e.next=4,r.startCancer(t[0]);case 4:return n={country:t[0].country,mall_ids:t[0].mall_ids,mall_names:t[0].mall_names,product_max:t[0].product_max,last_login_day:t[0].last_login_day,open_hour:t[0].open_hour,open_minute:t[0].open_minute,key_word:t[0].key_word,follow_number:t[0].follow_number,follow_interval:t[0].follow_interval,is_not_follow_min_order_evaluation:t[0].is_not_follow_min_order_evaluation,min_order_evaluation:t[0].min_order_evaluation,is_not_follow_followed_day:t[0].is_not_follow_followed_day,followed_day:t[0].followed_day,followed_type:t[0].followed_type,cancel_follow_number:t[0].cancel_follow_number,cancel_follow_sort_type:t[0].cancel_follow_sort_type,exec_time:(new Date).getTime()},e.next=7,window.BaseUtilBridgeService.saveAttentionUserTask(n);case 7:return a=e.sent,console.log("addTest",a),e.next=11,window.BaseUtilBridgeService.getAttentionUserTask(t[0].country);case 11:return o=e.sent,r.storeLogList["".concat(t[0].country)].task_id=o[0].id,r.storeLogList["".concat(t[0].country)].country=o[0].country,r.storeLogList["".concat(t[0].country)].created_at=r.formatTime((new Date).getTime()),r.storeLogList["".concat(t[0].country)].log_message=JSON.stringify(r.storeLogList["".concat(t[0].country)].log_message),e.next=18,window.BaseUtilBridgeService.saveAttentionUserLog(r.storeLogList["".concat(t[0].country)]);case 18:i=e.sent,console.log("日志存储",i);case 20:case"end":return e.stop()}}),e)}))),e)}},{key:"add0",value:function(e){return e<10?"0"+e:e}},{key:"formatTime",value:function(t){var r=new e,n=new Date(t),a=n.getFullYear(),o=n.getMonth()+1,i=n.getDate(),s=n.getHours(),c=n.getMinutes(),u=n.getSeconds();return a+"-"+r.add0(o)+"-"+r.add0(i)+" "+r.add0(s)+":"+r.add0(c)+":"+r.add0(u)}},{key:"searchMall",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,u,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=10*t.mall_ids.split(",").length,n=[],console.log("正在查询关注店铺"),this.storeLogList["".concat(t.country)].log_message.push({option:"正在查询【".concat(t.key_word,"】相关店铺...."),activeTime:this.formatTime((new Date).getTime())}),a=0;case 5:if(!(a<r)){e.next=35;break}return i={},i["country"]=t.country,i["mallId"]=Number(t.mall_ids.split(",")[0]),i["newest"]=60*a,i["keyword"]=t.key_word,i["min_order_evaluation"]=t.min_order_evaluation,e.next=14,this.searchMallInstance(i);case 14:if(s=e.sent,s.length){e.next=19;break}return console.log("暂无数据"),this.storeLogList["".concat(t.country)].log_message.push({option:"暂无数据",activeTime:this.formatTime((new Date).getTime())}),e.abrupt("return");case 19:return e.next=21,this.filterList(s,t);case 21:if(c=e.sent,!c.length){e.next=29;break}if((u=n).push.apply(u,Object(o["a"])(c)),!(n.length>=r)){e.next=27;break}return n=n.splice(0,r),e.abrupt("break",35);case 27:e.next=32;break;case 29:return console.log("此关键词暂无更多数据！"),this.storeLogList["".concat(t.country)].log_message.push({option:"此关键词暂无更多数据！",activeTime:this.formatTime((new Date).getTime())}),e.abrupt("break",35);case 32:a++,e.next=5;break;case 35:console.log("店铺搜索获取结束"),this.storeLogList["".concat(t.country)].log_message.push({option:"店铺搜索获取结束",activeTime:this.formatTime((new Date).getTime())}),this.mallSearchList=[],n.forEach((function(e){e.item_basic.totalRate=e.item_basic.item_rating.rating_count.reduce((function(e,t,r,n){return e+t})),l.mallSearchList.push(e.item_basic)})),console.log("店铺数据",this.mallSearchList);case 40:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"searchMallInstance",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["country"]=t.country,r["mallId"]=t.mallId,r["by"]="relevancy",r["keyword"]=t.keyword,r["limit"]=60,r["newest"]=t.newest,r["order"]="desc",r["page_type"]="search",r["rating_filter"]=t.min_order_evaluation,e.prev=10,e.next=13,this.MallAPIInstance.addCancerMall(r);case 13:if(n=e.sent,200!==n.status){e.next=18;break}return e.abrupt("return",JSON.parse(n.data).items);case 18:return console.log("店铺搜索请求失败,230-line:".concat(n.status)),this.storeLogList["".concat(t.country)].log_message.push({option:"店铺搜索请求失败,230-line:".concat(n.status),activeTime:this.formatTime((new Date).getTime())}),e.abrupt("return",[]);case 21:e.next=28;break;case 23:return e.prev=23,e.t0=e["catch"](10),console.log("店铺搜索请求失败,234-line:".concat(e.t0)),this.storeLogList["".concat(t.country)].log_message.push({option:"店铺搜索请求失败,234-line:".concat(e.t0),activeTime:this.formatTime((new Date).getTime())}),e.abrupt("return",[]);case 28:case"end":return e.stop()}}),e,this,[[10,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"filterList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[],a=new Map,t.forEach((function(e){a.has(e.item_basic.itemid)||a.has(e.item_basic.shopid)||a.set(e.itemid,e)})),n=Object(o["a"])(a.values()),i=Number(r.product_max),s=n.filter((function(e){var t=e.item_basic.item_rating.rating_count.reduce((function(e,t,r,n){return e+t}));if(Number(e.item_basic.liked_count)>=100&&Number(e.item_basic.liked_count)<=1e4&&Number(e.item_basic.item_rating.rating_star.toFixed(2))>=4.5&&Number(e.item_basic.item_rating.rating_star.toFixed(2))<=5&&t>=50&&t<=5e3&&e.item_basic.stock>=i)return e})),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"startCancer",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.mallSearchList.length<=0)){e.next=4;break}return console.log(t.country+"当前关键词【".concat(t.key_word,"】暂无数据")),this.storeLogList["".concat(t.country)].log_message.push({option:"当前关键词【".concat(t.key_word,"】暂无数据"),activeTime:this.formatTime((new Date).getTime())}),e.abrupt("return");case 4:return r=t.mall_ids.split(","),n=t.mall_names.split(","),a=this.mallSearchList.map((function(e){return e.shopid})),o=r.map((function(e,r){var o={};return o.platform_mall_id=e,o.mall_alias_name=n[r],o.country=t.country,o.mallIDlist=a,o.Tesk_follow_number=t.follow_number,o.followed_type=t.followed_type,o.follow_interval=t.follow_interval,o.last_login_day=t.last_login_day,o.min_order_evaluation=t.min_order_evaluation,o})),console.log("开始处理关注店铺数据......"),g=this,this.storeLogList["".concat(t.country)].log_message.push({option:"开始处理关注店铺数据......",activeTime:this.formatTime((new Date).getTime())}),e.next=13,Object(m["d"])(o,this.getFllowerInfo);case 13:this.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.country,"】数据处理结束"),activeTime:this.formatTime((new Date).getTime())}),console.log("【".concat(t.country,"】数据处理结束"));case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFllowerInfo",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,o,i,s,c,u,l,p,d,h=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{count:1},e.prev=1,o=t.mallIDlist,t.following=0,t.fence=0,t.newFollow=0,t.cancerFollow=0,t.state="-",e.next=10,g.isLoginFun(t);case 10:if(i=e.sent,console.log(),i){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,g.getHomeMallData(t);case 16:if(s=e.sent,s){e.next=21;break}return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】店铺暂无数据")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】店铺暂无数据"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return");case 21:c=t.newFollow,u=Object(a["a"])(o),e.prev=23,p=regeneratorRuntime.mark((function e(){var r,n,o,i,s,u,p,d,h,f,_,b,w,v,k,x,y,T,L,S,O,R,N,I,A,j,D,C,B,F;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=l.value,!g.isStop){e.next=3;break}return e.abrupt("return",{v:void 0});case 3:if(n={},n["country"]=t.country,n["mallId"]=t.platform_mall_id,n["shopid"]=r,"0"!==t.followed_type){e.next=136;break}return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】正在获取").concat(r,"店铺粉丝信息")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】正在获取").concat(r,"店铺粉丝信息"),activeTime:g.formatTime((new Date).getTime())}),o=!0,n["offset"]=0,e.next=14,g.GetShopLikes(n);case 14:i=e.sent,console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】获取第").concat(n.offset/20+1,"页粉丝")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】获取第").concat(n.offset/20+1,"页粉丝"),activeTime:g.formatTime((new Date).getTime())}),s=Object(a["a"])(i),e.prev=18,s.s();case 20:if((u=s.n()).done){e.next=60;break}if(p=u.value,!g.isStop){e.next=24;break}return e.abrupt("return",{v:void 0});case 24:return e.next=26,g.filterShopDatas(i,t.country,t.platform_mall_id);case 26:if(d=e.sent,d){e.next=29;break}return e.abrupt("continue",58);case 29:return e.next=31,window.BaseUtilBridgeService.getAttentionUser(t.country,t.platform_mall_id.toString(),p.ShopId);case 31:if(h=e.sent,!h.attention_shop_id){e.next=34;break}return e.abrupt("continue",58);case 34:return e.next=36,g.runAttention(p,t,r);case 36:if(f=e.sent,!f){e.next=44;break}return c++,e.next=41,BaseUtilBridgeService.saveAttentionUser({country:t.country,mall_id:t.platform_mall_id.toString(),attention_shop_id:p.ShopId});case 41:e.sent,e.next=48;break;case 44:return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(p.UserName,"失败")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(p.UserName,"失败"),activeTime:g.formatTime((new Date).getTime())}),o=!1,e.abrupt("continue",58);case 48:if(!Number(t.Tesk_follow_number)){e.next=53;break}if(!(c>=Number(t.Tesk_follow_number))){e.next=51;break}return e.abrupt("return",{v:void 0});case 51:e.next=58;break;case 53:if(!(t.following+c>=3e3)){e.next=58;break}return console.log("关注已达上限"),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增关注").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())}),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注已达上限"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 58:e.next=20;break;case 60:e.next=65;break;case 62:e.prev=62,e.t0=e["catch"](18),s.e(e.t0);case 65:return e.prev=65,s.f(),e.finish(65);case 68:console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】新增关注").concat(c,"个")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增关注").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())});case 70:if(!o){e.next=130;break}if(!g.isStop){e.next=73;break}return e.abrupt("return",{v:void 0});case 73:return n["offset"]+=20,e.next=76,g.GetShopLikes(n);case 76:i=e.sent,console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】获取第").concat(n.offset/20+1,"页粉丝数据")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】获取第").concat(n.offset/20+1,"页粉丝数据"),activeTime:g.formatTime((new Date).getTime())}),_=0;case 80:if(!(_<i.length)){e.next=123;break}if(!g.isStop){e.next=83;break}return e.abrupt("return",{v:void 0});case 83:return b=i[_],e.next=86,g.filterShopDatas(b,t.country,t.platform_mall_id,t.last_login_day);case 86:if(w=e.sent,w){e.next=89;break}return e.abrupt("continue",120);case 89:return e.next=91,window.BaseUtilBridgeService.getAttentionUser(t.country,t.platform_mall_id.toString(),b.ShopId);case 91:if(v=e.sent,!v.attention_shop_id){e.next=94;break}return e.abrupt("continue",120);case 94:return e.next=96,g.runAttention(b,t,r);case 96:if(k=e.sent,!k){e.next=104;break}return c++,e.next=101,BaseUtilBridgeService.saveAttentionUser({country:t.country,mall_id:t.platform_mall_id.toString(),attention_shop_id:b.ShopId});case 101:e.sent,e.next=107;break;case 104:return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(b.UserName,"失败")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(b.UserName,"失败"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("continue",120);case 107:if(!Number(t.Tesk_follow_number)){e.next=114;break}if(!(c>=Number(t.Tesk_follow_number))){e.next=112;break}return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个粉丝")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个粉丝"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 112:e.next=120;break;case 114:if(!(t.following+c>=3e3)){e.next=120;break}return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个")),console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】关注已达上限")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())}),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注已达上限"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 120:_++,e.next=80;break;case 123:return i.length<20&&(console.log("【".concat(r,"】查找结束")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(r,"】查找结束"),activeTime:g.formatTime((new Date).getTime())}),o=!1),console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())}),e.next=128,Object(m["A"])(1e3*Number(t.follow_interval));case 128:e.next=70;break;case 130:console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】操作结束")),console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())}),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】操作结束"),activeTime:that.formatTime((new Date).getTime())}),e.next=240;break;case 136:return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】正在获取评价用户信息")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】正在获取评价用户信息"),activeTime:g.formatTime((new Date).getTime())}),x=!0,y=[],T=g.mallSearchList.findIndex((function(e){return e.shopid===Number(r)})),L=g.mallSearchList[T].itemid,S=0,g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】获取").concat(r,"第【").concat(S/52+1,"】页评价用户"),activeTime:g.formatTime((new Date).getTime())}),e.next=146,g.GetShopComment(L,r,t,S);case 146:if(y=e.sent,y.length){e.next=150;break}return g.storeLogList["".concat(t.country)].log_message.push({option:"".concat(r,"暂无用户评价"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return","continue");case 150:O=0;case 151:if(!(O<y.length)){e.next=187;break}return R=y[O],N={},N["ShopId"]=R.author_shopid,N["UserName"]=R.author_username,e.next=158,window.BaseUtilBridgeService.getAttentionUser(t.country,t.platform_mall_id.toString(),N.ShopId);case 158:if(I=e.sent,!I.attention_shop_id){e.next=161;break}return e.abrupt("continue",184);case 161:return e.next=163,g.runAttention(N,t,R.shopid);case 163:if(A=e.sent,!A){e.next=171;break}return c++,e.next=168,BaseUtilBridgeService.saveAttentionUser({country:t.country,mall_id:t.platform_mall_id.toString(),attention_shop_id:N.ShopId});case 168:e.sent,e.next=174;break;case 171:return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(N.UserName,"失败"),activeTime:g.formatTime((new Date).getTime())}),x=!1,e.abrupt("continue",184);case 174:if(!Number(t.Tesk_follow_number)){e.next=180;break}if(!(c>=Number(t.Tesk_follow_number))){e.next=178;break}return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注成功"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 178:e.next=184;break;case 180:if(!(t.following+c>=3e3)){e.next=184;break}return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】新增").concat(c,"个"),activeTime:g.formatTime((new Date).getTime())}),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注已达上限"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 184:O++,e.next=151;break;case 187:g.$set(t,"newFollow",c);case 188:if(!x){e.next=238;break}if(!g.isStop){e.next=191;break}return e.abrupt("return",{v:void 0});case 191:return S+=52,g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】获取").concat(r,"第【").concat(S/52+1,"】页评价用户"),activeTime:g.formatTime((new Date).getTime())}),e.next=195,g.GetShopComment(L,r,t,S);case 195:y=e.sent,j=0;case 197:if(!(j<y.length)){e.next=233;break}if(!g.isStop){e.next=200;break}return e.abrupt("return",{v:void 0});case 200:return D=y[j],C={},C["ShopId"]=D.shopid,C["UserName"]=D.author_username,e.next=206,window.BaseUtilBridgeService.getAttentionUser(t.country,t.platform_mall_id.toString(),C.ShopId);case 206:if(B=e.sent,!B.attention_shop_id){e.next=209;break}return e.abrupt("continue",230);case 209:return e.next=211,g.runAttention(C,t,r);case 211:if(F=e.sent,!F){e.next=219;break}return c++,e.next=216,BaseUtilBridgeService.saveAttentionUser({country:t.country,mall_id:t.platform_mall_id.toString(),attention_shop_id:C.ShopId});case 216:e.sent,e.next=221;break;case 219:return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注").concat(C.UserName,"失败"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("continue",230);case 221:if(!Number(t.Tesk_follow_number)){e.next=227;break}if(!(c>=Number(t.Tesk_follow_number))){e.next=225;break}return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注成功"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 225:e.next=230;break;case 227:if(!(t.following+c>=3e3)){e.next=230;break}return g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注已达上限"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",{v:void 0});case 230:j++,e.next=197;break;case 233:return y.length<52&&(g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】查找结束"),activeTime:g.formatTime((new Date).getTime())}),x=!1),e.next=236,Object(m["A"])(1e3*Number(t.follow_interval));case 236:e.next=188;break;case 238:g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】成功关注").concat(c,"个粉丝"),activeTime:g.formatTime((new Date).getTime())}),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】操作结束"),activeTime:g.formatTime((new Date).getTime())});case 240:case"end":return e.stop()}}),e,null,[[18,62,65,68]])})),u.s();case 26:if((l=u.n()).done){e.next=35;break}return e.delegateYield(p(),"t0",28);case 28:if(d=e.t0,"continue"!==d){e.next=31;break}return e.abrupt("continue",33);case 31:if("object"!==Object(n["a"])(d)){e.next=33;break}return e.abrupt("return",d.v);case 33:e.next=26;break;case 35:e.next=40;break;case 37:e.prev=37,e.t1=e["catch"](23),u.e(e.t1);case 40:return e.prev=40,u.f(),e.finish(40);case 43:g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】关注结束"),activeTime:g.formatTime((new Date).getTime())}),e.next=50;break;case 46:e.prev=46,e.t2=e["catch"](1),console.log(e.t2),g.storeLogList["".concat(t.country)].log_message.push({option:"用户信息获取失败-line373，".concat(e.t2),activeTime:g.formatTime((new Date).getTime())});case 50:return e.prev=50,--r.count,e.finish(50);case 53:case"end":return e.stop()}}),e,null,[[1,46,50,53],[23,37,40,43]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isLoginFun",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,g.MallAPIInstance.isLogin(t);case 2:if(r=e.sent,200!==r.code||!r.data){e.next=7;break}return e.abrupt("return",!0);case 7:return console.log("【".concat(t.mall_alias_name||t.platform_mall_name,"】店铺未登录")),g.storeLogList["".concat(t.country)].log_message.push({option:"【".concat(t.mall_alias_name||t.platform_mall_name,"】店铺未登录"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHomeMallData",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["country"]=t.country,r["mallId"]=t.platform_mall_id,e.next=5,g.MallAPIInstance.UserProfile(r);case 5:if(n=e.sent,200!==n.code){e.next=19;break}return a=n.data.username,r["username"]=a,e.next=11,g.MallAPIInstance.getHomeMallinfo(r);case 11:if(o=e.sent,200!==o.code){e.next=16;break}return e.abrupt("return",o.data);case 16:return e.abrupt("return","");case 17:e.next=20;break;case 19:return e.abrupt("return","");case 20:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHomeFollowingList",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={},n["country"]=t.country,n["mallId"]=t.platform_mall_id,n["offset"]=0,n["mallName"]=t.mall_alias_name||t.platform_mall_name,e.next=7,this.getHomeFllowering(n);case 7:if(a=e.sent,o=a,o.length){e.next=11;break}return e.abrupt("return",[]);case 11:if(!(a.length>=20)){e.next=21;break}if(!this.isStop){e.next=14;break}return e.abrupt("break",21);case 14:return n["offset"]+=20,e.next=17,this.getHomeFllowering(n);case 17:a=e.sent,o=o.concat(a),e.next=11;break;case 21:return e.abrupt("return",o);case 22:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"GetShopLikes",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["country"]=t.country,r["mallId"]=t.mallId,r["shopid"]=t.shopid,r["offset"]=t.offset,r["limit"]=20,r["offset_of_offset"]=0,r["timeStamp"]=(new Date).getTime(),e.next=10,g.MallAPIInstance.getFllower(r);case 10:if(n=e.sent,200!==n.code){e.next=15;break}return e.abrupt("return",n.data);case 15:return g.storeLogList["".concat(t.country)].log_message.push({option:"粉丝获取失败",activeTime:g.formatTime((new Date).getTime())}),console.log("粉丝获取失败，".concat(n.message)),e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"filterShopDatas",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,g.getActiveUser({country:r,mallId:n,userName:t.UserName});case 2:if(o=e.sent,i=new Date((new Date).toLocaleDateString()).getTime(),s=i-i*(Number(a)-1),!(o>s)){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()},{key:"getActiveUser",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={},r["country"]=t.country,r["mallId"]=t.mallId,r["username"]=t.userName,e.next=6,g.MallAPIInstance.getActiveTimeFollower(r);case 6:if(n=e.sent,200!==n.code){e.next=11;break}return e.abrupt("return",1e3*Number(n.data.last_active_time));case 11:return g.$refs.Logs.writeLog("店铺活跃状态获取失败:".concat(n.message),!1),e.abrupt("return","");case 13:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"runAttention",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n){var a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={},a["country"]=r.country,a["mallId"]=r.platform_mall_id,a["userShopid"]=t.ShopId,a["followMallID"]=n,e.next=7,g.MallAPIInstance.buyerFollow(a);case 7:if(o=e.sent,console.log("关注",o),200===o.code){e.next=14;break}console.log("【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"失败,").concat(o.message)),g.storeLogList["".concat(r.country)].log_message.push({option:"【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"失败,").concat(o.message),activeTime:g.formatTime((new Date).getTime())}),e.next=22;break;case 14:if(!o.data){e.next=20;break}return console.log("【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"成功")),g.storeLogList["".concat(r.country)].log_message.push({option:"【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"成功"),activeTime:g.formatTime((new Date).getTime())}),e.abrupt("return",!0);case 20:console.log("【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"失败,").concat(o.message)),g.storeLogList["".concat(r.country)].log_message.push({option:"【".concat(r.mall_alias_name||r.platform_mall_name,"】关注").concat(t.UserName,"失败,").concat(o.message),activeTime:g.formatTime((new Date).getTime())});case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"GetShopComment",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o={},o["mallId"]=n.platform_mall_id,o["country"]=n.country,o["itemid"]=t,o["offset"]=a,o["shopid"]=r,e.next=8,g.MallAPIInstance.getShoppComment(o);case 8:if(i=e.sent,200!==i.code){e.next=15;break}return s=i.data.ratings||[],c=s.filter((function(e){if(e.rating_star>=Number(n.min_order_evaluation))return e})),e.abrupt("return",c);case 15:return console.log("商品评价获取失败".concat(i.message)),g.storeLogList["".concat(n.country)].log_message.push({option:"商品评价获取失败".concat(i.message),activeTime:that.formatTime((new Date).getTime())}),e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}()}]),e}()},df50:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auto-order"},[r("Logs",{ref:"Logs",staticClass:"logBox",attrs:{clear:""},model:{value:e.showConsole,callback:function(t){e.showConsole=t},expression:"showConsole"}})],1)},a=[],o=r("1da1"),i=(r("a9e3"),r("99af"),r("96cf"),r("bcd0")),s=r("de70"),c=r("0098"),u=r("31af"),l=r("d1dd"),m=r("58660"),p={data:function(){return{topGoodsInstance:new m["a"],AutoAddFenceInstance:new l["a"](this),showConsole:!1,mallList:[],statusListFirst:i["E"],statusListSecond:i["A"],statusListThird:i["B"],buyerAccountList:[],logisiticeTime:2,isAutoLogisitice:"1",isApplyShopeeLogistics:"2"}},mounted:function(){var e=this;this.getAllMall(),this.$refs.Logs.writeLog("定时任务分别在五分钟、八分钟之后开启",!0),window["BaseUtilBridgeService"].checkAutoScriptLog("定时任务分别在五分钟、八分钟之后开启");try{this.syncLogis(),this.syncShopeeFace(),setTimeout((function(){e.syncOrders(e.statusListFirst,"auto-first",60),setInterval((function(){e.syncOrders(e.statusListFirst,"auto-first",60)}),144e5)}),3e5),setTimeout((function(){e.syncOrders(e.statusListSecond,"auto-second",60),setInterval((function(){e.syncOrders(e.statusListSecond,"auto-second",60)}),18e5)}),48e4),setTimeout((function(){e.syncOrders(e.statusListThird,"auto-third",60),setInterval((function(){e.syncOrders(e.statusListThird,"auto-third",60)}),36e5)}),48e4),this.checkTimeAutoFollow(),this.goodsTop()}catch(t){this.$refs.Logs.writeLog("error".concat(t),!1),console.log(t,"errorerrorerrorerrorerror")}},methods:{syncShopeeFace:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$appConfig.getUserConfig();case 3:r=t.sent,r=r&&JSON.parse(r)||{},e.isApplyShopeeLogistics=r&&r.is_apply_shopee_logistics||"2","1"===e.isApplyShopeeLogistics&&(setTimeout((function(){e.syncFaceData(),setInterval((function(){e.syncFaceData()}),72e5)}),48e4),setTimeout((function(){e.syncFaceStore(),setInterval((function(){e.syncFaceStore()}),36e5)}),18e4),setTimeout((function(){e.syncFaceNoFace(),setInterval((function(){e.syncFaceNoFace()}),72e5)}),3e5)),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),e.$refs.Logs.writeLog("面单,".concat(t.t0),!1);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},syncLogis:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$appConfig.getUserConfig();case 2:if(r=t.sent,r=r&&JSON.parse(r)||{},e.isAutoLogisitice=r&&r.is_auto_ori_logistics||"1",e.logisiticeTime=r&&r.ori_logistics_interval_time||4,"2"!==e.isAutoLogisitice){t.next=10;break}return t.next=9,e.getAccountList();case 9:setTimeout((function(){e.logisticeSync(),setInterval((function(){e.logisticeSync()}),60*Number(e.logisiticeTime)*60*1e3)}),36e4);case 10:case"end":return t.stop()}}),t)})))()},syncOrders:function(e,t,r){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var o,i,c,u,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:window["BaseUtilBridgeService"].checkAutoScriptLog("开始自动同步订单"),n.$refs.Logs.writeLog("【".concat(t,"】开始同步"),!0),o=0;case 3:if(!(o<n.mallList.length)){a.next=17;break}i=n.mallList[o],c=0;case 6:if(!(c<e.length)){a.next=14;break}return u=e[c],l=new s["a"](i,u,n,n.$refs.Logs.writeLog),a.next=11,l.start("".concat(o+1,"/").concat(n.mallList.length),t,r);case 11:c++,a.next=6;break;case 14:o++,a.next=3;break;case 17:case"end":return a.stop()}}),a)})))()},getAllMall:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$appConfig.getGlobalCacheInfo("allMallInfo","key");case 2:if(r=t.sent,n=r&&JSON.parse(r),n)for(a in n)e.mallList.push(n[a]);console.log(e.mallList,JSON.parse(r));case 6:case"end":return t.stop()}}),t)})))()},syncFaceData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.Logs.writeLog("开始同步面单---------------------------",!0),window["BaseUtilBridgeService"].checkAutoScriptLog("开始同步面单、平台物流"),r=new c["a"](e,e.$refs.Logs.writeLog),r.autoStart();case 4:case"end":return t.stop()}}),t)})))()},getAccountList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.getBuyerList();case 2:r=t.sent,n=r.data,200===n.code&&(e.buyerAccountList=n.data);case 5:case"end":return t.stop()}}),t)})))()},logisticeSync:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return window["BaseUtilBridgeService"].checkAutoScriptLog("开始自动同步采购物流"),e.$refs.Logs.writeLog("开始自动同步采购物流---------------------------",!0),r=new u["a"],t.next=5,r.start(e,e.buyerAccountList,e.$refs.Logs.writeLog);case 5:case"end":return t.stop()}}),t)})))()},checkTimeAutoFollow:function(){var e=this;setTimeout((function(){e.AutoAddFenceInstance.autoAddFenceActive()}),6e5)},goodsTop:function(){var e=this;setTimeout((function(){e.topGoodsInstance.init()}),48e4)},syncFaceStore:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.Logs.writeLog("开始同步仓库中没有面单",!0),window["BaseUtilBridgeService"].checkAutoScriptLog("开始同步仓库中没有面单"),r=new c["a"](e,e.$refs.Logs.writeLog),r.autoStartStore();case 4:case"end":return t.stop()}}),t)})))()},syncFaceNoFace:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window["BaseUtilBridgeService"].checkAutoScriptLog("开始同步订单中没有面单"),r=new c["a"](e,e.$refs.Logs.writeLog),r.autoStartNoLogi();case 3:case"end":return t.stop()}}),t)})))()}}},g=p,d=(r("c17c"),r("2877")),h=Object(d["a"])(g,n,a,!1,null,"07ed7a6e",null);t["default"]=h.exports},f856:function(e,t,r){}}]);