(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-845d0b78"],{"3e57":function(e,t,a){"use strict";a("ebb2")},"8992a":function(e,t,a){"use strict";a("f455")},add3:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail"},[a("div",{staticClass:"condetion",staticStyle:{"background-color":"white",padding:"8px"}},[a("div",{staticClass:"row1"},[a("storeChoose",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}}),a("div",{staticStyle:{"margin-left":"20px"}},[a("label",[e._v("活动：")]),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.activeType,callback:function(t){e.activeType=t},expression:"activeType"}},[a("el-option",{attrs:{label:"全部",value:"0"}}),a("el-option",{attrs:{label:"进行中",value:"1"}}),a("el-option",{attrs:{label:"接下来有活动",value:"2"}}),a("el-option",{attrs:{label:"活动已过期",value:"3"}})],1)],1),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary"},on:{click:e.getTableList}},[e._v("搜索")])],1),a("div",{staticClass:"row2",staticStyle:{"margin-top":"8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTest}},[e._v("创建运费促销活动")]),a("el-button",{attrs:{size:"mini"},on:{click:e.stopCreate}},[e._v("停止活动创建")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallstopTestMul}},[e._v("批量结束勾选活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"8px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")]),a("el-checkbox",{model:{value:e.isShowPast,callback:function(t){e.isShowPast=t},expression:"isShowPast"}},[e._v("不显示过期活动")])],1)]),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),a("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableList,height:"800px","use-virtual":"",border:!1,"header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[a("u-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),a("u-table-column",{attrs:{type:"index",fixed:"",label:"序号","min-width":"50px"}}),a("u-table-column",{attrs:{prop:"",label:"站点",align:"center","min-width":"50px",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(e._f("chineseSite")(a.country)))]}}])}),a("u-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"100px"}}),a("u-table-column",{attrs:{prop:"promotion_name",label:"促销名称",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"voucher_status",label:"活动状态",align:"center","min-width":"80px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["进行中"===i.voucher_status?a("span",{staticStyle:{color:"#0ad10a"}},[e._v(e._s(i.voucher_status))]):e._e(),"即将开始"===i.voucher_status?a("span",{staticStyle:{color:"orange"}},[e._v(e._s(i.voucher_status))]):e._e(),"已过期"===i.voucher_status?a("span",[e._v(e._s(i.voucher_status))]):e._e()]}}])}),a("u-table-column",{attrs:{prop:"",label:"促销期间",align:"center","min-width":"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("div",[3220050630===i.end_time?a("div",[e._v(" 无限制 ")]):a("div",{staticStyle:{display:"flex","flex-flow":"column"}},[a("span",[e._v(e._s(i.formStartime)+"-")]),a("span",[e._v(e._s(i.formEndtime))])])])]}}])}),a("u-table-column",{attrs:{prop:"deliverWay",label:"运送渠道",align:"center","min-width":"180px"}}),a("u-table-column",{attrs:{prop:"topNum",label:"运费",align:"center","min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return e._l(i.tiers,(function(t,n){return a("div",{key:n,staticStyle:{display:"flex"}},[a("span",[e._v("购买满"+e._s(e._f("siteCoin")(i.country))+e._s(t.min_order_total)+",")]),0===Number(t.discount_delta)?a("span",[e._v("免运费")]):a("span",[e._v("运费减免"+e._s(e._f("siteCoin")(i.country))+e._s(t.discount_delta))])])}))}}])}),a("u-table-column",{attrs:{prop:"min_spend",label:"操作",align:"center","min-width":"80px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return["进行中"===i.voucher_status?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MallstopTest(i)}}},[e._v("停止")]):e._e(),"即将开始"===i.voucher_status?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.MalldelTest(i)}}},[e._v("删除 ")]):e._e()]}}])})],1)],1),a("el-dialog",{staticClass:"edit-group-dialog",attrs:{visible:e.proVisible,width:"860px",top:"5vh",title:"运费促销","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.proVisible=t}}},[a("el-form",{attrs:{"label-position":"right","label-width":"160px"}},[a("el-form-item",{attrs:{label:"促销名称"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"字符长度需小于20",size:"mini"},model:{value:e.proName,callback:function(t){e.proName=t},expression:"proName"}})],1),a("el-form-item",{staticStyle:{color:"red"},attrs:{label:"促销时间"}},[a("el-radio-group",{model:{value:e.proTimeType,callback:function(t){e.proTimeType=t},expression:"proTimeType"}},[a("el-radio",{attrs:{label:"0"}},[e._v("无限制")]),a("el-radio",{attrs:{label:"1"}},[e._v("所选的促销期间 "),a("el-date-picker",{staticStyle:{width:"330px"},attrs:{size:"mini","value-format":"timestamp",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{focus:function(t){e.proTimeType="1"}},model:{value:e.proTime,callback:function(t){e.proTime=t},expression:"proTime"}})],1)],1)],1),a("el-form-item",{attrs:{label:"运输渠道"}},[a("el-checkbox-group",{model:{value:e.deliverWay,callback:function(t){e.deliverWay=t},expression:"deliverWay"}},e._l(e.deliverWayList,(function(t){return a("el-checkbox",{key:t.channelid,attrs:{disabled:e.isDeliverWay,label:t.channelid}},[e._v(e._s(t.name))])})),1),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){e.getdeliverWay(),e.showlog=!1}}},[e._v("刷新物流渠道")])],1),a("el-form-item",{attrs:{label:"运费",align:"center"}},[a("el-table",{attrs:{data:e.freightlist,"header-cell-style":{background:"#f7fafa"},"row-style":{height:"60px"}}},[a("el-table-column",{attrs:{type:"index",label:"阶层","max-width":"60px"}}),a("el-table-column",{attrs:{prop:"minCost",label:"最低消费金额",width:"190px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+" | "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content1,placement:"top-start"}},[a("span",[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},on:{focus:function(a){return e.checkMinCost(t.row,t.$index)},blur:function(a){return e.clearCost(t.row)}},model:{value:t.row.minCost,callback:function(a){e.$set(t.row,"minCost",a)},expression:"scope.row.minCost"}}),a("br")],1)]),a("span",{staticStyle:{color:"red","margin-top":"-4px"}},[e._v(" "+e._s(t.row.minCostLimit)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"freight",label:"运费",width:"340px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{staticClass:"freightType",on:{change:function(a){return e.changeFreightType(t.row)}},model:{value:t.row.freightType,callback:function(a){e.$set(t.row,"freightType",a)},expression:"scope.row.freightType"}},[a("el-radio",{attrs:{label:"1"}},[e._v("免运费")]),a("el-radio",{attrs:{label:"0"}},[e._v(" 补贴"+e._s(e._f("siteCoin")(e.selectMallList[0]&&e.selectMallList[0].country))+"| "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.content2,placement:"top-start"}},[a("span",[a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},on:{focus:function(a){return e.checkFreightCost(t.row,t.$index)},blur:function(a){return e.clearFreight(t.row)}},model:{value:t.row.freight,callback:function(a){e.$set(t.row,"freight",a)},expression:"scope.row.freight"}}),a("br")],1)]),"0"===t.row.freightType?a("span",{staticStyle:{color:"red"}},[e._v(" "+e._s(t.row.freightLimit)+" ")]):e._e()],1)],1)]}}])}),a("el-table-column",{attrs:{prop:"",label:"操作",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e.freightlist.length>1?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delrule(i)}}},[e._v("删除")]):e._e()]}}])})],1),e.freightlist.length>1?a("span",{staticStyle:{color:"red","margin-left":"-330px"}},[e._v(" 较高的最低消费将享有较高的运费折扣。免运费只能使用一层 ")]):e._e()],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.freightlist.length>=3},on:{click:e.addRule}},[e._v("新增促销规则")])],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addProTestFun}},[e._v("保存")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.proVisible=!1}}},[e._v("取消")])],1)],1)],1)],1)},n=[],r=a("291b"),s=(a("e186"),a("d5a2"),a("8798"),a("88a8"),a("77de"),a("a0d4"),a("29f6"),a("34bc"),a("b6df"),a("feb6")),l=a("a254"),o=a("0e0b"),c=(a("fb52"),{components:{storeChoose:s["a"]},data:function(){return{runload:!1,freightArrange:{MY:{MaxMinAmmount:1e4,MinAmmount:0,MaxFreeAmmount:1e4,FreeAmmount:.5},VN:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999e3,MaxMinAmmount:2e7},PH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:999,MaxMinAmmount:5e3},ID:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:5e5,MaxMinAmmount:5e6},TW:{MinAmmount:0,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:999999999},TH:{MinAmmount:0,FreeAmmount:1,MaxFreeAmmount:1500,MaxMinAmmount:3e4},BR:{MinAmmount:999999999,FreeAmmount:0,MaxFreeAmmount:999999999,MaxMinAmmount:0},SG:{MinAmmount:0,FreeAmmount:.5,MaxFreeAmmount:999999,MaxMinAmmount:5e3}},arrList:[],willList:[],doingList:[],pastList:[],isDeliverWay:!1,deliverWayList:[],freightlist:[{minCost:"",freightType:"0",freight:"",minCostLimit:"",freightLimit:""}],deliverWay:[],proTimeType:"0",proTime:[],proName:"",isShowPast:!0,tableLoading:!1,singerStop:!1,MarketManagerAPIInstance:new l["a"](this),showlog:!0,activeType:"0",tableList:[],proVisible:!1,dialogtitle:"",coupontype:"2",couponName:"",rewardType:"0",discountType:"1",discountNum:"",limitPrice:"0",maxPrice:"",minPrice:"",pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},useQuantity:"",couponhide:"0",couponGoodslist:[],selectMallList:[],stoptoping:!1,mallTableSelect:[],getTable:[],minCostLimit:"",freightLimit:""}},computed:{content1:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MinAmmount;return"当前站点最低消费金额取值范围".concat(t,"-").concat(e)},content2:function(){var e=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,t=this.freightArrange[this.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount;return"当前站点运费折扣取值范围".concat(t,"-").concat(e)}},created:function(){},methods:{getProDelivery:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={country:e.country,mallId:e.platform_mall_id},a.prev=1,t.$refs.Logs.writeLog("正在获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流信息")),a.next=5,t.MarketManagerAPIInstance.ProDelivery(i);case 5:if(n=a.sent,0!==n.ecode){a.next=15;break}if(t.$refs.Logs.writeLog("获取【".concat(e.mall_alias_name||e.platform_mall_name,"】物流成功"),!0),r=n.data.data.enabled||[],r.length){a.next=12;break}return t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无物流选项"),!1),a.abrupt("return");case 12:t.deliverWayList.length?r.forEach((function(e){var a=t.deliverWayList.findIndex((function(t){return e.channelid===t.channelid}));a<0&&t.deliverWayList.push(e)})):t.deliverWayList=r,a.next=18;break;case 15:s="","token not found"===n.message&&(s="店铺未登录"),t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】物流：").concat(s||n.message),!1);case 18:a.next=23;break;case 20:a.prev=20,a.t0=a["catch"](1),t.$message.warning("".concat(a.t0));case 23:case"end":return a.stop()}}),a,null,[[1,20]])})))()},delrule:function(e){var t=this.couponGoodslist.findIndex((function(t){return t===e}));this.freightlist.splice(t,1)},save:function(){},addRule:function(){var e={minCost:"",freightType:"0",freight:""};this.freightlist.push(e)},clearLog:function(){this.$refs.Logs.consoleMsg=""},handleSelectionChange:function(e){this.mallTableSelect=e},MallstopTestMul:function(){var e=this;this.mallTableSelect.length?this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.mallTableSelect.length)){t.next=7;break}return t.next=4,e.MallstopTestFun(e.mallTableSelect[a]);case 4:a++,t.next=1;break;case 7:e.getTableList();case 8:case"end":return t.stop()}}),t)})))).catch((function(){})):this.$message.warning("请选择要操作的数据")},MallstopTest:function(e){var t=this;this.$confirm("您确定要结束此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MallstopTestFun(e)})).catch((function(){}))},MallstopTestFun:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={country:e.country,mallId:e.platform_mall_id,datainfo:e},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.stopPromotion(i);case 5:n=a.sent,0===n.ecode?(t.$refs.Logs.writeLog("------已停止【".concat(e.promotion_name,"】优惠活动------"),!0),t.$set(e,"voucher_status","已过期"),t.$set(e,"formEndtime",t.formatTime((new Date).getTime())),t.$set(e,"end_time",(new Date).getTime()/1e3)):t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】优惠活动,").concat(n.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("停止【".concat(e.promotion_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},MalldelTest:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.$confirm("您确定要删除此运费促销吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.MalldelTestFun(e)})).catch((function(){}));case 1:case"end":return a.stop()}}),a)})))()},MalldelTestFun:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i={country:e.country,mallId:e.platform_mall_id,datainfo:e},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.stopPromotion(i);case 5:n=a.sent,0===n.ecode?(t.$refs.Logs.writeLog("------已删除【".concat(e.promotion_name,"】优惠活动------"),!0),r=t.tableList.findIndex((function(t){return t===e})),t.tableList.splice(r,1)):t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】优惠活动,").concat(n.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("删除【".concat(e.promotion_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},stopCreate:function(){Object(o["z"])(),this.$refs.Logs.writeLog("已停止创建")},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),a=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),r=t.getHours(),s=t.getMinutes(),l=t.getSeconds();return a+"-"+this.add0(i)+"-"+this.add0(n)+" "+this.add0(r)+":"+this.add0(s)+":"+this.add0(l)},changeMallList:function(e){this.selectMallList=e},getInfo:function(e){var t=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,s,l,o,c,u,m,h;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},i.prev=1,r={country:e.country,mallId:e.platform_mall_id,offset:e.offset,limit:10},i.next=5,a.MarketManagerAPIInstance.logisticsPromotion(r);case 5:if(s=i.sent,0===s.ecode){i.next=12;break}return l="","token not found"===s.message&&(l="店铺未登录"),"marketing module no permission"===s.message&&(l="营销无权限模块"),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】数据请求失败,").concat(l||s.message),!1),i.abrupt("return");case 12:if(o=0===s.ecode?s.data.data.promotions:[],c=0===s.ecode?s.data.data.channels_info:[],o.length){i.next=17;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无数据")),i.abrupt("return");case 17:if(!o.length){i.next=33;break}for(u=function(t){var i=o[t];i.platform_mall_id=e.platform_mall_id,i.country=e.country,i.mallName=e.mall_alias_name||e.platform_mall_name,i.formStartime=a.formatTime(1e3*i.start_time),i.formEndtime=a.formatTime(1e3*i.end_time);var n=(new Date).getTime();n<1e3*i.start_time?(i.voucher_status="即将开始",a.willList.push(i)):n>1e3*i.start_time&&n<1e3*i.end_time?(i.voucher_status="进行中",a.doingList.push(i)):(i.voucher_status="已过期",a.pastList.push(i));var r=c.findIndex((function(e){return Number(i.channel_ids[0])===Number(e.channel_id)}));i.deliverWay=c[r].name,i.channalData=c[r],a.arrList.push(i)},m=0;m<o.length;m++)u(m);if(a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】总数据：").concat(s.data.data.total_num,"条,正在请求第【").concat(r.offset/r.limit+1,"】页"),!0),!(o.length<r.limit)){i.next=25;break}o.length=[],i.next=31;break;case 25:return r.offset=r.offset+r.limit,i.next=28,a.MarketManagerAPIInstance.logisticsPromotion(r);case 28:h=i.sent,o=0===h.data.code?h.data.data.promotions:[],c=0===h.data.code?h.data.data.channels_info:[];case 31:i.next=17;break;case 33:a.isShowPast?"0"===a.activeType?a.getTable=a.willList.concat(a.doingList):"1"===a.activeType?a.getTable=a.doingList:"2"===a.activeType?a.getTable=a.willList:a.getTable=[]:("1"===a.activeType&&(a.getTable=a.doingList),"2"===a.activeType&&(a.getTable=a.willList),"3"===a.activeType&&(a.getTable=a.pastList),"0"===a.activeType&&(a.getTable=a.arrList)),i.next=39;break;case 36:i.prev=36,i.t0=i["catch"](1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】--catch，").concat(i.t0),!1);case 39:return i.prev=39,n.count--,i.finish(39);case 42:case"end":return i.stop()}}),i,null,[[1,36,39,42]])})))()},getTableList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.multipleTable.clearSelection(),e.selectMallList.forEach((function(e){e.offset=0,e.prizeList=[]})),e.getTable=[],e.arrList=[],e.willList=[],e.doingList=[],e.pastList=[],e.showlog=!1,e.tableLoading=!0,e.$refs.Logs.writeLog("正在请求数据......",!0),t.next=12,Object(o["c"])(e.selectMallList,e.getInfo);case 12:t.sent,e.$refs.Logs.writeLog("请求数据结束"),e.tableLoading=!1,e.tableList=e.getTable;case 16:case"end":return t.stop()}}),t)})))()},checkMinCost:function(e,t){if(this.freightlist.length>1)for(var a=0;a<this.freightlist.length;a++)if(t!==a){var i=this.freightlist[a];"1"===i.freightType&&this.$set(e,"minCostLimit","少过".concat(i.minCost))}},clearCost:function(e){this.$set(e,"minCostLimit","")},clearFreight:function(e){this.$set(e,"freightLimit","")},changeFreightType:function(e){this.$set(e,"freight","")},checkFreightCost:function(e,t){var a=[];if(this.freightlist.length>1)for(var i=0;i<this.freightlist.length;i++)if(t!==i){var n=this.freightlist[i];"1"===n.freightType?this.$set(e,"freightLimit","多于".concat(a[0]||"0")):(a.push(Number(n.freight)),Number(n.minCost)>Number(e.minCost)?this.$set(e,"freightLimit","少过".concat(Math.min.apply(Math,a))):this.$set(e,"freightLimit","多过".concat(Math.max.apply(Math,a))))}},addProTest:function(){this.showlog=!0,this.selectMallList.length?(this.proVisible=!0,this.deliverWayList=[],this.getdeliverWay()):this.$message.warning("请选择需要创建的店铺")},getdeliverWay:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.selectMallList.length)){t.next=7;break}return t.next=4,e.getProDelivery(e.selectMallList[a]);case 4:a++,t.next=1;break;case 7:e.$refs.Logs.writeLog("物流请求结束");case 8:case"end":return t.stop()}}),t)})))()},addProTestFun:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,n,r,s,l,c,u,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.proName&&!(e.proName.length>20)){t.next=3;break}return e.$message.warning("促销名称不能为空，且不能大于20个字符"),t.abrupt("return");case 3:if(e.proTime.length&&e.proTimeType,"1"!==e.proTimeType){t.next=15;break}if(e.proTime.length){t.next=8;break}return e.$message.warning("请选择活动有效时间"),t.abrupt("return");case 8:if(a=(new Date).getTime(),!(a>Number(e.proTime[0]))){t.next=12;break}return e.$message.warning("请输入比当前较晚的开始时间"),t.abrupt("return");case 12:if(!Number(e.proTime[1]-Number(e.proTime[0])<36e5)){t.next=15;break}return e.$message.warning("结束时间至少比开始时间晚一个小时"),t.abrupt("return");case 15:if(e.deliverWay.length){t.next=18;break}return e.$message.warning("运输渠道不能为空"),t.abrupt("return");case 18:i=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxMinAmmount,n=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MinAmmount,r=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].MaxFreeAmmount,s=e.freightArrange[e.selectMallList[0].country.toLocaleUpperCase()].FreeAmmount,l=0;case 23:if(!(l<e.freightlist.length)){t.next=54;break}if(c=e.freightlist[l],c.minCost&&("0"!==c.freightType||c.freight)){t.next=28;break}return e.$message.warning("请设置运费规则"),t.abrupt("return");case 28:if(!(Number(c.minCost)>i||Number(c.minCost)<n)){t.next=31;break}return e.$message.warning("当前站点最低消费金额取值范围".concat(n,"-").concat(i)),t.abrupt("return");case 31:if("1"===c.freightType||!(Number(c.freight)>r||Number(c.freight)<s)){t.next=34;break}return e.$message.warning("当前站点运费折扣取值范围".concat(s,"-").concat(r)),t.abrupt("return");case 34:u=0;case 35:if(!(u<e.freightlist.length)){t.next=51;break}if(l!==u){t.next=38;break}return t.abrupt("continue",48);case 38:if(m=e.freightlist[u],"1"!==c.freightType||"1"!==m.freightType){t.next=42;break}return e.$message.warning("免运费只能使用在一层，且在最低消费金额最大层"),t.abrupt("return");case 42:if(!("1"===c.freightType&&Number(c.minCost)<Number(m.minCost))){t.next=45;break}return e.$message.warning("免运费只能使用在最低消费金额最大层"),t.abrupt("return");case 45:if(!("1"!==c.freightType&&"1"!==m.freightType&&Number(c.minCost)<Number(m.minCost)&&Number(c.freight)>Number(m.freight))){t.next=48;break}return e.$message.warning("更高的最低消费金额应有更高的运费折扣金额"),t.abrupt("return");case 48:u++,t.next=35;break;case 51:l++,t.next=23;break;case 54:return e.proVisible=!1,e.showlog=!1,e.$refs.Logs.writeLog("正在创建任务......"),t.next=59,Object(o["c"])(e.selectMallList,e.createPromiton);case 59:t.sent,e.$refs.Logs.writeLog("创建任务结束"),e.getTableList();case 62:case"end":return t.stop()}}),t)})))()},createPromiton:function(e){var t=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var n,r,s,l,o,c,u;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r="",s="","0"===a.proTimeType?(r=Math.floor((new Date).getTime()/1e3),s=3220050630):(r=Math.floor(Number(a.proTime[0])/1e3),s=Math.floor(Number(a.proTime[1])/1e3)),l=[],a.freightlist.forEach((function(e,t){var a={discount_flag:"0"===e.freightType?4:2,placeholder:e.freightLimit,index:t,min_order_total:Number(e.minCost),discount_delta:"0"===e.freightType?Number(e.freight):0};l.push(a)})),i.prev=6,o={country:e.country,mallId:e.platform_mall_id,start_time:r,end_time:s,tiers:l,channel_ids:a.deliverWay,promotion_name:a.proName},i.next=10,a.MarketManagerAPIInstance.checkPromotionTest(o);case 10:c=i.sent,0!==c.ecode?(u="",1400109500===c.data.code&&(u="所选期间与该店铺的其他活动期间重叠"),1400101105===c.data.code&&(u="运输渠道未知,或者时间勾选错误"),"token not found"===c.message&&(u="店铺未登录"),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(u||c.message),!1)):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建成功"),!0),i.next=17;break;case 14:i.prev=14,i.t0=i["catch"](6),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败：").concat(i.t0,"};"),!1);case 17:return i.prev=17,n.count--,i.finish(17);case 20:case"end":return i.stop()}}),i,null,[[6,14,17,20]])})))()}}}),u=c,m=(a("3e57"),a("cba8")),h=Object(m["a"])(u,i,n,!1,null,"b4cd3acc",null);t["default"]=h.exports},ebb2:function(e,t,a){},f455:function(e,t,a){},feb6:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ul",{staticClass:"storeChooseUL"},[e.isMall?a("li",[e._v(e._s(e._f("chineseSite")(e.countryVal)))]):a("li",{style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("所属站点：")]),a("el-select",{staticClass:"siteSelectBox",attrs:{size:"mini",filterable:"",disabled:e.isBanPerform},model:{value:e.countryVal,callback:function(t){e.countryVal=t},expression:"countryVal"}},[e.isAll?a("el-option",{attrs:{label:"全部",value:""}}):e._e(),e._l(e.countries,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2)],1),a("li",{style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("店铺分组：")]),a("el-select",{staticClass:"selectBox",attrs:{disabled:e.isBanPerform,multiple:"","collapse-tags":"",filterable:"",size:"mini"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupIdList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.group_name,value:e.id}})})),1)],1),a("li",{style:e.isReset&&"margin-bottom: 5px"},[a("span",{style:{width:e.spanWidth}},[e._v("店铺名称：")]),a("el-select",{directives:[{name:"loadmore",rawName:"v-loadmore",value:e.loadmoreMall,expression:"loadmoreMall"}],staticClass:"selectBox",attrs:{disabled:e.isBanPerform,placeholder:"",multiple:!e.isAShop,"collapse-tags":"","filter-method":e.filterMall,size:"mini",filterable:"",clearable:""},on:{"visible-change":function(t){return e.filterMall("")}},model:{value:e.site,callback:function(t){e.site=t},expression:"site"}},[e.isAShop?e._e():a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.siteShowList,(function(t,i){return e.showMall(t,i)?a("el-option",{key:i,attrs:{label:t.mall_alias_name||t.platform_mall_name,value:t.platform_mall_id}}):e._e()}))],2)],1),e.isReset?a("li",{staticStyle:{"margin-bottom":"5px","margin-left":"25px"}},[a("el-button",{staticStyle:{"justify-self":"self-end"},attrs:{size:"mini",type:"primary",disabled:e.isBanPerform},on:{click:e.reset}},[e._v("　刷　　新　")])],1):e._e()])])},n=[],r=a("291b"),s=a("66b1"),l=a("1938"),o=(a("e186"),a("8b24"),a("7a95"),a("186e"),a("36ca"),a("8798"),a("2c28"),a("d5a2"),a("dd92"),a("f5aa"),a("2f9e"),a("876e"),a("88a8"),a("77de"),a("2bf0"),a("7646")),c=a("430a");c["default"].directive("loadmore",{bind:function(e,t){var a=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");a.addEventListener("scroll",(function(){this.scrollHeight-this.scrollTop<=this.clientHeight+50?t.value(!0,this):this.scrollTop<30&&t.value(!1,this)}))}});var u={name:"StoreChoose",props:{spanWidth:{type:String,default:"80px"},parentCountry:{type:String,default:"TH"},isMall:{type:Boolean,default:function(){return!1}},isBanPerform:{type:Boolean,default:function(){return!1}},isAll:{type:Boolean,default:function(){return!1}},isReset:{type:Boolean,default:function(){return!1}},source:{type:String,default:function(){return""}},isAShop:{type:Boolean,default:function(){return!1}}},data:function(){return{isAllowSet1:!0,isAllowSet2:!0,countryVal:null,groupId:[],groupIdList:[],site:[],siteList:[],siteShowList:[],countries:this.$filters.countries_option,mallListAPIInstance:new o["a"](this),isShowName:"",isShowNameAll:!1,showMallNumber:100,mallShowIndex:0,jsonMallData:[],filterMallTime:null}},watch:{siteList:function(e){this.siteShowList=e},countryVal:{handler:function(e,t){this.isShowName="",this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},deep:!0},groupId:{handler:function(e,t){var a=this;if(this.isAllowSet2){this.isShowName="",this.isAllowSet2=!1;var i=t.indexOf("")>-1,n=e.indexOf("")>-1;i!==n?this.groupId=n?Object(l["a"])(this.groupIdList.map((function(e){return e.id}))):[]:n?this.groupId=e.slice(1):this.groupIdList.length>0&&this.groupId.length===this.groupIdList.length-1&&this.groupId.unshift(""),setTimeout((function(){a.isAllowSet2=!0,a.ddMallGoodsGetMallList(2)}),10)}},deep:!0},site:{handler:function(e,t){var a=this;if(this.isAllowSet1){this.isAllowSet1=!1;var i=this.isShowName;if(!this.isAShop){var n=t.includes(""),r=e.includes("");if(n!==r||t.toString()===e.toString()&&this.isShowNameAll)if(r&&(!i||i&&!this.isShowNameAll)){var o=i&&Object(l["a"])(this.siteShowList.map((function(e){return e.platform_mall_id})))||[""].concat(Object(l["a"])(this.siteList.map((function(e){return e.platform_mall_id})))),c=new Set([].concat(Object(l["a"])(o),Object(l["a"])(t)));this.site=Object(l["a"])(c),this.isShowNameAll=!0,i&&this.siteList.length===this.site.length&&this.site.unshift("")}else{this.isShowNameAll=!1;var u=[];if(i){var m=i&&Object(l["a"])(this.siteShowList.map((function(e){return e.platform_mall_id}))),h=m.length>this.site.length&&this.site||m,p=m.length>this.site.length&&m||this.site;u=new Set(this.site);var f,d=Object(s["a"])(p);try{for(d.s();!(f=d.n()).done;){var g=f.value;h.includes(g)&&u.delete(g)}}catch(b){d.e(b)}finally{d.f()}u.delete("")}this.site=Object(l["a"])(u)}else r?this.site=e.slice(1):this.siteList.length>0&&this.siteList.length===this.site.length?this.site.unshift(""):this.isShowNameAll=!1}setTimeout((function(){a.changeMallList(),a.filterMall(i),a.isAllowSet1=!0}),10)}},deep:!0}},mounted:function(){this.countryVal=this.isMall?this.parentCountry:this.isAll?"":"TH"},methods:{reset:function(){this.isAllowSet2=!1,this.groupId=[],this.groupIdList=[],this.ddMallGoodsGetMallList(1)},ddMallGoodsGetMallList:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i,n,r,s,o,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.site=[],i=t.countryVal,n=[],!(t.jsonMallData.length>0)){a.next=7;break}n=t.jsonMallData,a.next=12;break;case 7:return a.next=9,t.$appConfig.temporaryCacheInfo("get","mallAllData","");case 9:r=a.sent,n=JSON.parse(r)||[],t.jsonMallData=JSON.parse(r)||[];case 12:if(!(n.length>0)){a.next=17;break}1===e&&(t.siteList=""===i?n:n.filter((function(e){return e.country===i}))),2===e&&(0===t.groupId.length?t.siteList=[]:(t.siteList=[],t.groupId.forEach((function(e){n.forEach((function(a){i?e===a.group_id&&i===a.country&&t.siteList.push(a):e===a.group_id&&t.siteList.push(a)}))})))),a.next=22;break;case 17:return s={country:"",mallGroupIds:""},a.next=20,t.mallListAPIInstance.ddMallGoodsGetMallList(s);case 20:o=a.sent,200===o.code?(t.$appConfig.temporaryCacheInfo("save","mallAllData",o.data),c=o.data||[],t.siteList=c,t.jsonMallData=c,t.siteList=""===i?c:c.filter((function(e){return e.country===i}))):t.$message.error("获取分组、店铺列表失败");case 22:u=[],0===t.groupIdList.length&&(t.groupIdList=[{group_name:"全部",id:""}],t.siteList.forEach((function(e){var t=u.findIndex((function(t){return t&&t.id===e.group_id}));e.group_name&&t<0&&u.push({group_name:e.group_name,id:e.group_id})})),u.zzSort("id"),t.groupIdList=[].concat(Object(l["a"])(t.groupIdList),u),t.groupId=[""].concat(Object(l["a"])(u.map((function(e){return e.id}))))),setTimeout((function(){t.isAllowSet2=!0,t.isAllowSet1=!0,t.site=!t.isAShop&&[""]||""}),10);case 25:case"end":return a.stop()}}),a)})))()},changeMallList:function(){var e=this,t=[],a="";if(this.isAShop){var i=this.siteList.find((function(t){return t.platform_mall_id===e.site}));a=this.site,t.push(i)}else this.site.forEach((function(i){if(i){var n=e.siteList.find((function(e){return e.platform_mall_id===i}));t.push(n),a+=i+","}}));!this.countryVal&&this.groupId.indexOf("")>-1&&(a=t.length!==this.siteList.length&&a||""),this.source?this.$emit("changeMallList",{mallList:t,source:this.source,searchAll:a,country:this.countryVal.toLocaleUpperCase()}):(t["country"]=this.countryVal,this.$emit("changeMallList",t))},filterMall:function(e){var t=this,a=e&&this.isShowName!==e?1e3:100;this.filterMallTime&&(clearTimeout(this.filterMallTime),this.filterMallTime=null),this.filterMallTime=setTimeout((function(){t.isShowName!==e&&(t.mallShowIndex=0),t.isShowName=e||"";var a=t.siteList;e&&(a=t.siteList.filter((function(t){var a=t.mall_alias_name||t.platform_mall_name;return a.includes(e)}))),t.siteShowList=a}),a)},showMall:function(e,t){var a=e.mall_alias_name||e.platform_mall_name,i=this.site[0]===e.platform_mall_id;return i||this.mallShowIndex<=t&&t<=this.mallShowIndex+this.showMallNumber&&(!this.isShowName||a.includes(this.isShowName))},loadmoreMall:function(e,t){if(this.siteShowList.length>this.showMallNumber){var a=0;e?(a=this.mallShowIndex+10,a=a<this.siteShowList.length-this.showMallNumber&&a||this.siteShowList.length-this.showMallNumber):(a=this.mallShowIndex-10,a=a>0&&a||0),a!==this.mallShowIndex&&(t.scrollTop=e?t.scrollTop-100:30),this.mallShowIndex=a}}}},m=u,h=(a("8992a"),a("cba8")),p=Object(h["a"])(m,i,n,!1,null,null,null);t["a"]=p.exports}}]);