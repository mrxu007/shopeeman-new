(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49e6f9c3"],{"22eb":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail"},[a("div",{staticClass:"condetion",staticStyle:{"background-color":"white",padding:"8px"}},[a("div",{staticClass:"row1"},[a("storeChoose",{staticStyle:{"margin-left":"-20px"},attrs:{"show-mall-all":!0},on:{changeMallList:e.changeMallList}}),a("div",{staticStyle:{"margin-left":"20px"}},[a("label",[e._v("状态：")]),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.activeType,callback:function(t){e.activeType=t},expression:"activeType"}},[a("el-option",{attrs:{label:"全部",value:"0"}}),a("el-option",{attrs:{label:"进行中",value:"1"}}),a("el-option",{attrs:{label:"接下来有活动",value:"2"}}),a("el-option",{attrs:{label:"活动已过期",value:"3"}})],1)],1),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary"},on:{click:e.getTableList}},[e._v("搜索")]),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary"},on:{click:e.stopSearch}},[e._v("停止搜索")])],1),a("div",{staticClass:"row2",staticStyle:{"margin-top":"8px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.createTestVisile}},[e._v("创建加购促销活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.MallvoucherDelMul}},[e._v("批量删除/结束活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"8px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")]),a("el-checkbox",{staticStyle:{"margin-left":"-10px"},model:{value:e.isShowPast,callback:function(t){e.isShowPast=t},expression:"isShowPast"}},[e._v("不显示过期活动")])],1)]),a("Logs",{ref:"Logs",attrs:{clear:""},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}}),a("div",{staticClass:"tableDetail",staticStyle:{"margin-top":"8px"}},[a("u-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"multipleTable",attrs:{data:e.tableList,height:"800px","use-virtual":"",border:!1,"header-cell-style":{background:"#f7fafa"}},on:{"selection-change":e.handleSelectionChange}},[a("u-table-column",{attrs:{type:"selection",width:"55",fixed:""}}),a("u-table-column",{attrs:{type:"index",fixed:"",label:"序号","min-width":"50px"}}),a("u-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"add_on_deal_name",label:"活动名称",align:"center","min-width":"150px"}}),a("u-table-column",{attrs:{prop:"sub_type",label:"活动类型",align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(1===Number(a.sub_type)?"消费满赠":"加购折扣"))]}}])}),a("u-table-column",{attrs:{prop:"voucher_status",label:"活动状态",align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["进行中"===r.voucher_status?a("span",{staticStyle:{color:"#0ad10a"}},[e._v(e._s(r.voucher_status))]):e._e(),"即将开始"===r.voucher_status?a("span",{staticStyle:{color:"orange"}},[e._v(e._s(r.voucher_status))]):e._e(),"已过期"===r.voucher_status?a("span",[e._v(e._s(r.voucher_status))]):e._e()]}}])}),a("u-table-column",{attrs:{prop:"",label:"促销期间",align:"center","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",{staticStyle:{display:"flex","flex-flow":"column"}},[a("span",[e._v(e._s(r.formStartime)+"-"+e._s(r.formEndtime))])])]}}])}),a("u-table-column",{attrs:{prop:"min_spend",label:"操作",align:"center","min-width":"180px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",{staticStyle:{display:"flex"}},["进行中"===r.voucher_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.MallvoucherStopFun(r)}}},[e._v("停止")]):e._e(),"即将开始"===r.voucher_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.MallvoucherDelFun(r)}}},[e._v("删除")]):e._e(),"进行中"===r.voucher_status||"即将开始"===r.voucher_status?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.editGoods(r)}}},[e._v("编辑商品")]):e._e(),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.copyActive(r)}}},[e._v("复制活动")])],1)]}}])})],1)],1),a("el-dialog",{staticClass:"edit-group-dialog",attrs:{visible:e.proVisible,width:"1280px",height:"600px",top:"5vh",title:"加购优惠","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.proVisible=t},close:e.dialogClose}},[a("ul",[a("li",[a("div",{staticStyle:{"margin-left":"10px","margin-bottom":"5px"}},[e._v("基本资料")]),a("ul",{staticStyle:{border:"1px solid #d4d1d1",padding:"10px","border-radius":"8px"}},[a("li",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("div",[e._v(" 操作店铺 "),a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",size:"mini"},model:{value:e.optionMall,callback:function(t){e.optionMall=t},expression:"optionMall"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.selectMallList,(function(t){return a("el-option",{key:t.id,attrs:{disabled:e.disSelect,label:t.mall_alias_name||t.platform_mall_name,value:t.platform_mall_id}})}))],2)],1),a("div",{staticStyle:{"margin-left":"50px"}},[a("el-radio-group",{model:{value:e.discountType,callback:function(t){e.discountType=t},expression:"discountType"}},[a("el-radio",{attrs:{disabled:e.unchangeRadio,label:"0"}},[e._v("折扣优惠")]),a("el-radio",{attrs:{disabled:e.unchangeRadio,label:"1"}},[e._v("赠品满最低消费")])],1),"0"===e.discountType?a("span",{staticStyle:{"margin-left":"16px"}},[e._v(" 加购限制 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"买家在同一个订单里最多加购的商品数量是(1-100)",placement:"top-start"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.addLimit,callback:function(t){e.addLimit=t},expression:"addLimit"}})],1)],1):e._e(),"1"===e.discountType?a("span",{staticStyle:{"margin-left":"16px"}},[e._v(" 赠品规则 消费"),a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.costNum,callback:function(t){e.costNum=t},expression:"costNum"}}),e._v(" 以获得 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"赠品的数量应在(1-50)内",placement:"top-start"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{size:"mini",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.sendNum,callback:function(t){e.sendNum=t},expression:"sendNum"}})],1),e._v(" 个赠品 ")],1):e._e()],1)]),a("li",{staticStyle:{display:"flex"}},[a("div",[e._v(" 促销名称 "),a("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini",maxlength:"24"},model:{value:e.proName,callback:function(t){e.proName=t},expression:"proName"}})],1),a("div",{staticStyle:{"margin-left":"50px"}},[e._v(" 活动时间 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"开始时间必须比当前时间晚一个小时;结束时间必须比开始时间晚一个小时",placement:"top-start"}},[a("el-date-picker",{staticStyle:{width:"330px"},attrs:{size:"mini","value-format":"timestamp",type:"datetimerange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.proTime,callback:function(t){e.proTime=t},expression:"proTime"}})],1)],1),e.isedit?a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:e.saveActiveInfo_Edit}},[e._v("编辑保存")]):a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:e.saveActiveInfo}},[e._v("保存活动")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.clearLog}},[e._v("清除日志")]),a("el-checkbox",{staticStyle:{"margin-left":"8px","margin-top":"5px"},model:{value:e.showlog,callback:function(t){e.showlog=t},expression:"showlog"}},[e._v("隐藏日志")])],1)])]),a("li",{staticStyle:{display:"flex","margin-top":"10px"}},[a("div",{staticClass:"masterGoods"},[a("div",{staticStyle:{"margin-left":"10px","margin-bottom":"5px"}},[e._v("主要商品")]),a("ul",{staticStyle:{border:"1px solid #d4d1d1",padding:"10px","border-radius":"8px"}},[a("li",{staticStyle:{"margin-bottom":"5px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.openShowMul(1)}}},[e._v("开启")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.openShowMul(2)}}},[e._v("关闭")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.delMasterMulFun}},[e._v("删除")]),a("el-button",{staticStyle:{"margin-left":"65px"},attrs:{size:"mini",type:"primary"},on:{click:e.addMasterGoods}},[e._v("添加主要商品")])],1),a("li",[a("el-table",{staticStyle:{width:"400px"},attrs:{data:e.masterGoodslist,"header-cell-style":{background:"#f7fafa"},height:"400px"},on:{"selection-change":e.MasterSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"50",fixed:""}}),a("el-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"120px"}}),a("el-table-column",{attrs:{prop:"item_id",label:"商品",align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"statusShow",label:"状态",align:"center","min-width":"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(a){return e.changeShow(t.row,t.$index,"master")}},model:{value:t.row.statusShow,callback:function(a){e.$set(t.row,"statusShow",a)},expression:"scope.row.statusShow"}})],1)]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"80px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.delMasterFun(t.row,t.$index,"master")}}},[e._v("删除")])],1)]}}])})],1)],1)])]),a("div",{staticClass:"addGoods",staticStyle:{"margin-left":"10px"}},[a("div",{staticStyle:{"margin-left":"10px","margin-bottom":"5px"}},[e._v("加购商品")]),a("ul",{staticStyle:{border:"1px solid #d4d1d1",padding:"10px","border-radius":"8px"}},[a("li",{staticStyle:{display:"flex","margin-bottom":"5px"}},[a("div",[e._v("折扣："),a("el-input",{staticStyle:{width:"50px"},attrs:{size:"mini",maxlength:"2",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},model:{value:e.addGoodsDiscount,callback:function(t){e.addGoodsDiscount=t},expression:"addGoodsDiscount"}}),e._v("%")],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:e.changePriceMul}},[e._v("批量更新")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.otherGoodsOpenMul(1)}}},[e._v("开启")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.otherGoodsOpenMul(2)}}},[e._v("关闭")]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.otherGoodsDelMul}},[e._v("删除")]),a("el-button",{staticStyle:{"margin-left":"200px"},attrs:{size:"mini",type:"primary"},on:{click:e.addOtherGoodsFun}},[e._v("添加加购商品")])],1),a("li",[a("el-table",{attrs:{data:e.addGoodsList,"header-cell-style":{background:"#f7fafa"},height:"400px"},on:{"selection-change":e.otherSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"50",fixed:""}}),a("el-table-column",{attrs:{prop:"mallName",label:"店铺",align:"center","min-width":"120px",fixed:""}}),a("el-table-column",{attrs:{prop:"itemid",label:"商品",align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"price",label:"原价",align:"center","min-width":"100px"}}),"0"===e.othertableType?a("el-table-column",{attrs:{label:"折扣",align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticStyle:{width:"62px"},attrs:{size:"mini",maxlength:"2",onkeyup:"value=value.replace(/[^\\d.]/g,0)"},on:{blur:function(a){return e.changePrice(t.row)}},model:{value:t.row.discount,callback:function(a){e.$set(t.row,"discount",a)},expression:"scope.row.discount"}}),e._v("% ")]}}],null,!1,4099849545)}):e._e(),a("el-table-column",{attrs:{prop:"addPrice",label:"加购价格",align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(Number(a.price)*(100-Number(a.discount))*.01||a.addPrice))]}}])}),"0"===e.othertableType?a("el-table-column",{attrs:{prop:"addStatus",label:"加购显示",align:"center","min-width":"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(a){return e.buyShow(t.row,t.$index)}},model:{value:t.row.addStatus,callback:function(a){e.$set(t.row,"addStatus",a)},expression:"scope.row.addStatus"}})],1)]}}],null,!1,4032103874)}):e._e(),a("el-table-column",{attrs:{prop:"showStatus",label:"状态",align:"center","min-width":"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(a){return e.otherGoodsOpen(t.row,t.row.showStatus?1:2)}},model:{value:t.row.showStatus,callback:function(a){e.$set(t.row,"showStatus",a)},expression:"scope.row.showStatus"}})],1)]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"100px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.otherGoodsDel(r)}}},[e._v("删除")])],1)]}}])})],1)],1)])])])])]),a("div",{staticClass:"on_new_dialog"},[a("el-dialog",{attrs:{visible:e.goodsItemSelectorVisible,top:"7vh",title:"商品选择","close-on-click-modal":!1,"close-on-press-escape":!1,width:"1280px"},on:{"update:visible":function(t){e.goodsItemSelectorVisible=t}}},[e.goodsItemSelectorVisible?a("goodsItemSelector",{attrs:{mall:e.selectMallList},on:{changeGoodsItem:e.changeGoodsItem}}):e._e()],1)],1)],1)},n=[],s=a("53ca"),i=a("1da1"),o=(a("96cf"),a("c740"),a("d3b7"),a("25f0"),a("a9e3"),a("159b"),a("b680"),a("3ca3"),a("ddb0"),a("a434"),a("99af"),a("feb6")),c=a("a254"),l=a("e1e4"),u=a("0e0b"),d=a("01cd"),m=(a("c4e3"),a("c84e"),a("b719"),{components:{storeChoose:o["a"],goodsItemSelector:d["a"]},data:function(){return{editMallAccount:[],isedit:!1,copyData:"",isCopy:!1,unchangeRadio:!1,GoodsManagerAPIInstance:new l["a"](this),currentDate:!1,disSelect:!1,othertableType:"0",masterGoods:!1,otherGoods:!1,goodsItemSelectorVisible:!1,arrList:[],willList:[],doingList:[],pastList:[],addGoodsDiscount:"",addGoodsList:[],masterGoodslist:[],sendNum:0,costNum:0,addLimit:0,optionMall:"",discountType:"0",proTime:[],proName:"",isShowPast:!0,tableLoading:!1,MarketManagerAPIInstance:new c["a"](this),showlog:!0,activeType:"0",tableList:[],proVisible:!1,pickerOptions:{disabledDate:function(e){return e.getTime()<(new Date).getTime()-864e5}},shopAccountMallList:[],selectMallList:[],stoptoping:!1,mallTableSelect:[],goodsMasterTableSelect:[],otherMasterTableSelect:[],getTable:[],getcreateNewTest:[],saveActive:!1}},created:function(){this.inittime()},methods:{dialogClose:function(){this.isedit=!1,this.editMallAccount.length&&(this.selectMallList=this.editMallAccount)},copyActive:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i,o,c,l,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isCopy=!0,t.unchangeRadio=!0,t.getcreateNewTest=[],t.proVisible=!0,t.currentDate=e,r=t.selectMallList.findIndex((function(t){return t.mall_alias_name===e.mallName||t.platform_mall_name===e.mallName})),t.optionMall=t.selectMallList[r].platform_mall_id,t.editMallAccount=t.selectMallList,n=[t.selectMallList[r]],n.country=t.selectMallList[r].country,t.selectMallList=n,t.disSelect=!0,t.discountType=e.sub_type.toString(),t.othertableType=e.sub_type.toString(),t.addLimit=e.sub_item_limit,t.costNum=e.purchase_min_spend,t.sendNum=e.per_gift_num,t.proName="",t.proTime=[1e3*Number(e.start_time),1e3*Number(e.end_time)],s={country:e.country,mallId:e.platform_mall_id,add_on_deal_id:e.add_on_deal_id},t.$refs.Logs.writeLog("正在请求主要商品"),a.next=23,t.MarketManagerAPIInstance.getMasterGoods(s);case 23:return i=a.sent,0===i.ecode?(t.$refs.Logs.writeLog("主要商品数据加载成功",!0),o=i.data.data.main_item_list,o.forEach((function(t){t.mallName=e.mallName,t.statusShow=1===t.status})),t.masterGoodslist=o):t.$refs.Logs.writeLog("主要商品请求失败：".concat(i.message),!1),t.$refs.Logs.writeLog("正在请求附加商品"),a.next=28,t.MarketManagerAPIInstance.getOtherGoods(s);case 28:c=a.sent,0===c.ecode?(t.$refs.Logs.writeLog("附加商品数据加载成功",!0),l=c.data.data.item_info,u=c.data.data.model_info,d=c.data.data.sub_item_list,l.forEach((function(a){a.mallName=e.mallName,a.modelinfo=u[a.itemid];var r=d.findIndex((function(e){return Number(e.item_id)===Number(a.itemid)}));a.addPrice=d[r].input_sub_item_price,a.discount=100-100*(Number(a.addPrice)/Number(a.price)).toFixed(2);var n=t.currentDate.sub_item_priority.findIndex((function(e){return Number(e)===Number(a.itemid)}));a.addStatus=n>=0;var s=d.findIndex((function(e){return Number(e.item_id)===Number(a.itemid)&&2===Number(e.status)}));a.showStatus=s<0})),t.addGoodsList=l):t.$refs.Logs.writeLog("附加商品请求失败：".concat(c.message),!1),t.copyData=t.currentDate,t.currentDate="";case 32:case"end":return a.stop()}}),a)})))()},editGoods:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i,o,c,l,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isedit=!0,t.isCopy=!1,t.unchangeRadio=!0,t.getcreateNewTest=[],t.proVisible=!0,t.currentDate=e,r=t.selectMallList.findIndex((function(t){return t.mall_alias_name===e.mallName||t.platform_mall_name===e.mallName})),t.optionMall=t.selectMallList[r].platform_mall_id,t.editMallAccount=t.selectMallList,n=[t.selectMallList[r]],n.country=t.selectMallList[r].country,t.selectMallList=n,t.disSelect=!0,t.discountType=e.sub_type.toString(),t.othertableType=e.sub_type.toString(),t.addLimit=e.sub_item_limit,t.costNum=e.purchase_min_spend,t.sendNum=e.per_gift_num,t.proName=e.add_on_deal_name,t.proTime=[1e3*Number(e.start_time),1e3*Number(e.end_time)],s={country:e.country,mallId:e.platform_mall_id,add_on_deal_id:e.add_on_deal_id},t.$refs.Logs.writeLog("正在请求主要商品"),a.next=24,t.MarketManagerAPIInstance.getMasterGoods(s);case 24:return i=a.sent,0===i.ecode?(t.$refs.Logs.writeLog("主要商品数据加载成功",!0),o=i.data.data.main_item_list,o.forEach((function(t){t.mallName=e.mallName,t.statusShow=1===t.status})),t.masterGoodslist=o):t.$refs.Logs.writeLog("主要商品请求失败：".concat(i.message),!1),t.$refs.Logs.writeLog("正在请求附加商品"),a.next=29,t.MarketManagerAPIInstance.getOtherGoods(s);case 29:c=a.sent,0===c.ecode?(t.$refs.Logs.writeLog("附加商品数据加载成功",!0),l=c.data.data.item_info,u=c.data.data.model_info,d=c.data.data.sub_item_list,l.forEach((function(a){a.mallName=e.mallName,a.modelinfo=u[a.itemid];var r=d.findIndex((function(e){return Number(e.item_id)===Number(a.itemid)}));a.addPrice=d[r].input_sub_item_price,a.discount=100-100*(Number(a.addPrice)/Number(a.price)).toFixed(2);var n=t.currentDate.sub_item_priority.findIndex((function(e){return Number(e)===Number(a.itemid)}));a.addStatus=n>=0;var s=d.findIndex((function(e){return Number(e.item_id)===Number(a.itemid)&&2===Number(e.status)}));a.showStatus=s<0})),t.addGoodsList=l):t.$refs.Logs.writeLog("附加商品请求失败：".concat(c.message),!1);case 31:case"end":return a.stop()}}),a)})))()},changePriceMul:function(){if(this.saveActive||this.getcreateNewTest.length||this.currentDate)if(this.addGoodsDiscount)if(this.otherMasterTableSelect.length)for(var e=0;e<this.otherMasterTableSelect.length;e++)this.$set(this.otherMasterTableSelect[e],"discount",this.addGoodsDiscount),this.changePriceFun(this.otherMasterTableSelect[e]);else this.$message.warning("请选择要更新的商品");else this.$message.warning("请输入正确的折扣信息");else this.$message.warning("请先保存活动")},changePrice:function(e){e.discount?this.changePriceFun(e):this.$message.warning("请输入正确的折扣信息")},changePriceFun:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.showlog=!1,!t.getcreateNewTest.length){a.next=12;break}r=regeneratorRuntime.mark((function a(r){var n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.getcreateNewTest[r],s={country:n.country,mallId:n.platform_mall_id,add_on_deal_id:n.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(t){var a={item_id:t.itemid,model_id:t.modelid,status:1,sub_item_price:Number(e.price)*(100-Number(e.discount))*.01,sub_item_limit:1};s.sub_item_list.push(a)})),a.next=5,t.MarketManagerAPIInstance.changeDiscount(s);case 5:i=a.sent,0!==i.ecode&&t.$refs.Logs.writeLog("价格修改失败".concat(i.message),!1);case 7:case"end":return a.stop()}}),a)})),n=0;case 4:if(!(n<t.getcreateNewTest.length)){a.next=9;break}return a.delegateYield(r(n),"t0",6);case 6:n++,a.next=4;break;case 9:t.$refs.Logs.writeLog("价格修改成功",!0),a.next=18;break;case 12:return s={country:t.currentDate.country,mallId:t.currentDate.platform_mall_id,add_on_deal_id:t.currentDate.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(t){var a={item_id:t.itemid,model_id:t.modelid,status:1,sub_item_price:Number(e.price)*(100-Number(e.discount))*.01,sub_item_limit:1};s.sub_item_list.push(a)})),a.next=16,t.MarketManagerAPIInstance.changeDiscount(s);case 16:i=a.sent,0===i.ecode?t.$refs.Logs.writeLog("价格修改成功",!0):t.$refs.Logs.writeLog("价格修改失败".concat(i.message),!1);case 18:case"end":return a.stop()}}),a)})))()},buyShow:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,s,i,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a.saveActive||a.getcreateNewTest.length||a.currentDate){t.next=3;break}return a.$message.warning("请先保存活动"),t.abrupt("return");case 3:if(e.showStatus){t.next=6;break}return a.$message.warning("请先开启状态"),t.abrupt("return");case 6:if(r=[],a.addGoodsList.forEach((function(e){e.addStatus&&r.push(e.itemid)})),!a.getcreateNewTest.length){t.next=23;break}n=0;case 10:if(!(n<a.getcreateNewTest.length)){t.next=20;break}return s=a.getcreateNewTest[n],i={country:s.country,mallId:s.mallId,add_on_deal_id:s.add_on_deal_id,add_on_deal_name:s.add_on_deal_name,start_time:s.start_time,end_time:s.end_time,sub_type:s.sub_type,sub_item_limit:s.sub_item_limit,sub_item_priority:r},t.next=15,a.MarketManagerAPIInstance.changeBuyShow(i);case 15:o=t.sent,0===o.ecode?a.$refs.Logs.writeLog("加购状态修改成功",!0):a.$refs.Logs.writeLog("加购修改失败".concat(o.message),!1);case 17:n++,t.next=10;break;case 20:a.getTableList(),t.next=28;break;case 23:return c={country:a.currentDate.country,mallId:a.currentDate.platform_mall_id,add_on_deal_id:a.currentDate.add_on_deal_id,add_on_deal_name:a.currentDate.add_on_deal_name,start_time:a.currentDate.start_time,end_time:a.currentDate.end_time,sub_type:a.currentDate.sub_type,sub_item_limit:a.currentDate.sub_item_limit,sub_item_priority:r},t.next=26,a.MarketManagerAPIInstance.changeBuyShow(c);case 26:l=t.sent,0===l.ecode?(a.$refs.Logs.writeLog("加购状态修改成功",!0),a.getTableList()):a.$refs.Logs.writeLog("加购修改失败".concat(l.message),!1);case 28:case"end":return t.stop()}}),t)})))()},otherGoodsOpenMul:function(e){if(this.saveActive||this.getcreateNewTest.length||this.currentDate)if(this.otherMasterTableSelect.length)for(var t=0;t<this.otherMasterTableSelect.length;t++)this.otherGoodsOpen(this.otherMasterTableSelect[t],e);else this.$message.warning("请选择商品");else this.$message.warning("请先保存活动")},otherGoodsOpen:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.getcreateNewTest.length){r.next=7;break}if(e.discount||0!==a.getcreateNewTest[0].sub_type){r.next=5;break}return a.$set(e,"showStatus",!e.showStatus),a.$message.warning("请输入正确的折扣信息"),r.abrupt("return");case 5:r.next=11;break;case 7:if(e.discount||0!==a.currentDate.sub_type){r.next=11;break}return a.$set(e,"showStatus",!e.showStatus),a.$message.warning("请输入正确的折扣信息"),r.abrupt("return");case 11:if(a.showlog=!1,!a.getcreateNewTest.length){r.next=22;break}n=regeneratorRuntime.mark((function r(n){var s,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=a.getcreateNewTest[n],i={country:s.country,mallId:s.platform_mall_id,add_on_deal_id:s.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(a){var r={item_id:a.itemid,model_id:a.modelid,status:t,sub_item_limit:1};0===s.sub_type?r.sub_item_price=Number(e.price)*(100-Number(e.discount))*.01:r.sub_item_price=0,i.sub_item_list.push(r)})),1===t?a.$set(e,"showStatus",!0):a.$set(e,"showStatus",!1),r.next=6,a.MarketManagerAPIInstance.changeDiscount(i);case 6:o=r.sent,0===o.ecode?a.$refs.Logs.writeLog("状态修改成功",!0):a.$refs.Logs.writeLog("状态修改失败".concat(o.message),!1);case 8:case"end":return r.stop()}}),r)})),s=0;case 15:if(!(s<a.getcreateNewTest.length)){r.next=20;break}return r.delegateYield(n(s),"t0",17);case 17:s++,r.next=15;break;case 20:r.next=29;break;case 22:return i={country:a.currentDate.country,mallId:a.currentDate.platform_mall_id,add_on_deal_id:a.currentDate.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(r){var n={item_id:r.itemid,model_id:r.modelid,status:t,sub_item_limit:1};0===a.currentDate.sub_type?n.sub_item_price=Number(e.price)*(100-Number(e.discount))*.01:n.sub_item_price=0,i.sub_item_list.push(n)})),1===t?a.$set(e,"showStatus",!0):a.$set(e,"showStatus",!1),r.next=27,a.MarketManagerAPIInstance.changeDiscount(i);case 27:o=r.sent,0===o.ecode?a.$refs.Logs.writeLog("状态修改成功",!0):a.$refs.Logs.writeLog("状态修改失败".concat(o.message),!1);case 29:case"end":return r.stop()}}),r)})))()},otherGoodsDelMul:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.saveActive||e.getcreateNewTest.length||e.currentDate){t.next=3;break}return e.$message.warning("请先保存活动"),t.abrupt("return");case 3:if(e.otherMasterTableSelect.length){t.next=6;break}return e.$message.warning("请选择商品"),t.abrupt("return");case 6:e.$confirm("您确定要删除这些商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=0;a<e.otherMasterTableSelect.length;a++)e.otherGoodsDelFun(e.otherMasterTableSelect[a]);case 1:case"end":return t.stop()}}),t)}))));case 7:case"end":return t.stop()}}),t)})))()},otherGoodsDel:function(e){var t=this;this.saveActive||this.getcreateNewTest.length||this.currentDate?this.$confirm("您确定要删除改商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.otherGoodsDelFun(e);case 1:case"end":return a.stop()}}),a)})))):this.$message.warning("请先保存活动")},otherGoodsDelFun:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.getcreateNewTest.length){a.next=10;break}r=regeneratorRuntime.mark((function a(r){var n,s,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.getcreateNewTest[r],s={country:n.country,mallId:n.platform_mall_id,add_on_deal_id:n.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(t){var a={item_id:t.itemid,model_id:t.modelid,status:0,sub_item_limit:1};0===n.sub_type?a.sub_item_price=Number(e.price)*(100-Number(e.discount))*.01:a.sub_item_price=0,s.sub_item_list.push(a)})),a.next=5,t.MarketManagerAPIInstance.changeDiscount(s);case 5:i=a.sent,0===i.ecode?(o=t.addGoodsList.findIndex((function(t){return t.itemid===e.itemid})),t.addGoodsList.splice(o,1),t.$refs.Logs.writeLog("【".concat(e.itemid,"】删除成功"),!0)):t.$refs.Logs.writeLog("删除失败".concat(i.message),!1);case 7:case"end":return a.stop()}}),a)})),n=0;case 3:if(!(n<t.getcreateNewTest.length)){a.next=8;break}return a.delegateYield(r(n),"t0",5);case 5:n++,a.next=3;break;case 8:a.next=17;break;case 10:return t.showlog=!1,s={country:t.currentDate.country,mallId:t.currentDate.platform_mall_id,add_on_deal_id:t.currentDate.add_on_deal_id,sub_item_list:[]},e.modelinfo.forEach((function(a){var r={item_id:a.itemid,model_id:a.modelid,status:0,sub_item_limit:1};0===t.currentDate.sub_type?r.sub_item_price=Number(e.price)*(100-Number(e.discount))*.01:r.sub_item_price=0,s.sub_item_list.push(r)})),a.next=15,t.MarketManagerAPIInstance.changeDiscount(s);case 15:i=a.sent,0===i.ecode?(o=t.addGoodsList.findIndex((function(t){return t.itemid===e.itemid})),t.addGoodsList.splice(o,1),t.$refs.Logs.writeLog("【".concat(e.itemid,"】删除成功"),!0)):t.$refs.Logs.writeLog("删除失败".concat(i.message),!1);case 17:case"end":return a.stop()}}),a)})))()},inittime:function(){var e=(new Date).getTime()+3e5,t=e+36e5;this.proTime=[e,t]},stopSearch:function(){Object(u["B"])(),this.stoptoping=!0,this.$refs.Logs.writeLog("正在停止查询")},createTestVisile:function(){this.isCopy=!1,this.unchangeRadio=!1,this.showlog=!0,this.selectMallList.length?(this.addGoodsList=[],this.masterGoodslist=[],this.getcreateNewTest=[],this.masterGoods=!1,this.otherGoods=!1,this.proVisible=!0,this.currentDate="",this.clearInfo()):this.$message.warning("请选择店铺")},clearInfo:function(){this.discountType="0",this.addLimit="0",this.sendNum="0",this.costNum="0",this.proName="",this.proTime=[],this.masterGoodslist=[],this.addGoodsDiscount="",this.addGoodsList=[]},saveActiveInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s,i,o,c,l,u,d,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs.Logs.writeLog("活动保存中...请勿重复操作"),e.saveActive=!1,"0"!==e.discountType||!(0===Number(e.addLimit)||Number(e.addLimit)>100)){t.next=5;break}return e.$message.warning("请输入加购限制,加购限制范围在1-100"),t.abrupt("return");case 5:if("1"!==e.discountType||e.costNum&&0!==Number(e.sendNum)&&!(Number(e.sendNum)>50)){t.next=8;break}return e.$message.warning("请输入消费数量以及赠品数量,赠品限制范围在1-50"),t.abrupt("return");case 8:if(e.proName.length&&!(e.proName.length>24)){t.next=11;break}return e.$message.warning("请输入促销名称，名称长不可超过24个字符"),t.abrupt("return");case 11:if(a=(new Date).getTime(),!(a>Number(e.proTime[0]))){t.next=15;break}return e.$message.warning("请输入比当前较晚的开始时间"),t.abrupt("return");case 15:if(!Number(e.proTime[1]-Number(e.proTime[0])<36e5)){t.next=18;break}return e.$message.warning("结束时间至少比开始时间晚一个小时"),t.abrupt("return");case 18:if(!e.isCopy){t.next=46;break}return r={country:e.copyData.country,platform_mall_id:e.copyData.platform_mall_id,mall_alias_name:e.copyData.mallName},t.next=22,e.saveActiveInfoFun(r);case 22:return n={country:e.getcreateNewTest[0].country,mallId:e.getcreateNewTest[0].mallId,add_on_deal_id:e.getcreateNewTest[0].add_on_deal_id,main_item_list:[]},e.masterGoodslist.forEach((function(e){n.main_item_list.push({item_id:e.item_id,status:e.status})})),t.next=26,e.saveActiveMasterGoods(n);case 26:return s=t.sent,e.$refs.Logs.writeLog("".concat(e.copyData.mallName,"主要商品请求成功"),!0),0!==s.ecode?e.$refs.Logs.writeLog("【".concat(e.copyData.mallName,"】商品添加请求失败,").concat(s.message),!1):(i="",s.data.data.main_item_list.forEach((function(t){0!==t.err_code?(3450015===t.err_code&&(i="商品不能重复参与同一时段的活动，该商品正在参与其他活动"),e.$refs.Logs.writeLog("".concat(e.copyData.mallName,"【").concat(t.item_id,"】主要商品添加失败,").concat(i||t.err_code),!1)):e.$refs.Logs.writeLog("".concat(e.copyData.mallName,"【").concat(t.item_id,"】主要商品添加成功"),!0)}))),o=[],e.addGoodsList.forEach((function(e){o.push(e.itemid)})),c={country:e.getcreateNewTest[0].country,mallId:e.getcreateNewTest[0].mallId,add_on_deal_id:e.getcreateNewTest[0].add_on_deal_id,item_list:o},t.next=34,e.MarketManagerAPIInstance.AddotherGooods(c);case 34:l=t.sent,e.$refs.Logs.writeLog("".concat(e.copyData.mallName,"附加请求成功"),!0),0===l.ecode?(e.$refs.Logs.writeLog("【".concat(e.copyData.mallName,"】商品请求成功"),!0),l.data.data.fail_items.length&&l.data.data.fail_items.forEach((function(t){e.$refs.Logs.writeLog("".concat(e.copyData.mallName,"【").concat(t,"】商品添加失败,").concat(s.message),!1)}))):e.$refs.Logs.writeLog("【".concat(e.copyData.mallName,"】附加商品请求异常,添加失败,").concat(s.message),!1),u=regeneratorRuntime.mark((function t(a){var r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.addGoodsList[a],n={country:e.getcreateNewTest[0].country,mallId:e.getcreateNewTest[0].mallId,add_on_deal_id:e.getcreateNewTest[0].add_on_deal_id,sub_item_list:[]},r.modelinfo.forEach((function(t){var a={item_id:t.itemid,model_id:t.modelid,status:1,sub_item_limit:1};0===e.getcreateNewTest[0].sub_type?a.sub_item_price=Number(r.price)*(100-Number(r.discount))*.01:a.sub_item_price=0,n.sub_item_list.push(a)})),t.next=6,e.MarketManagerAPIInstance.changeDiscount(n);case 6:s=t.sent,0===s.ecode?e.$refs.Logs.writeLog("状态开启成功",!0):e.$refs.Logs.writeLog("状态开启失败".concat(s.message),!1);case 9:case"end":return t.stop()}}),t)})),d=0;case 39:if(!(d<e.addGoodsList.length)){t.next=44;break}return t.delegateYield(u(d),"t0",41);case 41:d++,t.next=39;break;case 44:t.next=54;break;case 46:m=0;case 47:if(!(m<e.selectMallList.length)){t.next=53;break}return t.next=50,e.saveActiveInfoFun(e.selectMallList[m]);case 50:m++,t.next=47;break;case 53:e.$refs.Logs.writeLog("活动创建结束");case 54:case"end":return t.stop()}}),t)})))()},saveActiveInfo_Edit:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.saveActive=!1,e.showlog=!1,"0"!==e.discountType||!(0===Number(e.addLimit)||Number(e.addLimit)>100)){t.next=5;break}return e.$message.warning("请输入加购限制,加购限制范围在1-100"),t.abrupt("return");case 5:if("1"!==e.discountType||e.costNum&&0!==Number(e.sendNum)&&!(Number(e.sendNum)>50)){t.next=8;break}return e.$message.warning("请输入消费数量以及赠品数量,赠品限制范围在1-50"),t.abrupt("return");case 8:if(e.proName.length&&!(e.proName.length>24)){t.next=11;break}return e.$message.warning("请输入促销名称，名称长不可超过24个字符"),t.abrupt("return");case 11:if(a=(new Date).getTime(),!(a>Number(e.proTime[0]))){t.next=15;break}return e.$message.warning("请输入比当前较晚的开始时间"),t.abrupt("return");case 15:if(!Number(e.proTime[1]-Number(e.proTime[0])<36e5)){t.next=18;break}return e.$message.warning("结束时间至少比开始时间晚一个小时"),t.abrupt("return");case 18:return r={country:e.currentDate.country,mallId:e.currentDate.platform_mall_id,add_on_deal_id:e.currentDate.add_on_deal_id,add_on_deal_name:e.proName,start_time:Math.floor(e.proTime[0]/1e3),end_time:Math.floor(e.proTime[1]/1e3),sub_type:e.discountType,sub_item_limit:e.addLimit,purchase_min_spend:e.costNum,per_gift_num:e.sendNum},t.next=21,e.MarketManagerAPIInstance.saveActiveEdit(r);case 21:n=t.sent,0===e.currentDate.sub_type&&(e.currentDate.sub_item_limit=n.data.data.sub_item_limit),0===n.ecode?e.$refs.Logs.writeLog("------【".concat(e.currentDate.mallName,"】修改成功------"),!0):1400109600===n.data.code?e.$refs.Logs.writeLog("------【".concat(e.currentDate.mallName,"】修改失败:促销时间只能在原来时间内缩短。"),!1):e.$refs.Logs.writeLog("------【".concat(e.currentDate.mallName,"】修改失败------"),!1);case 24:case"end":return t.stop()}}),t)})))()},saveActiveInfoFun:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.showlog=!1,r={country:e.country,mallId:e.platform_mall_id,add_on_deal_name:t.proName,start_time:Math.floor(t.proTime[0]/1e3),end_time:Math.floor(t.proTime[1]/1e3),sub_type:t.discountType,sub_item_limit:t.addLimit,purchase_min_spend:t.costNum,per_gift_num:t.sendNum},a.next=5,t.MarketManagerAPIInstance.saveActiveAddondeal(r);case 5:n=a.sent,0===n.ecode?(t.$refs.Logs.writeLog("------【".concat(e.mall_alias_name||e.platform_mall_name,"】创建成功------"),!0),t.saveActive=!0,s=n.data.data,s.country=e.country,s.mallId=e.platform_mall_id,s.mallname=e.mall_alias_name||e.platform_mall_name,t.getcreateNewTest.push(s),t.othertableType=t.discountType):(i="","token not found"===n.message&&(i="店铺未登录"),t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败,").concat(i||n.message),!1)),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](0),t.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】创建失败--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[0,9]])})))()},addMasterGoods:function(){this.saveActive||this.getcreateNewTest.length||this.currentDate?(this.goodsItemSelectorVisible=!0,this.masterGoods=!0,this.otherGoods=!1):this.$message.warning("请先保存活动")},changeGoodsItem:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,c,l,u,d,m,g,_,p,f,h,b,w,v,x;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.goodsList.length){a.next=3;break}return t.$message.warning("请先选择商品"),a.abrupt("return");case 3:if(!t.getcreateNewTest.length){a.next=47;break}if(!t.masterGoods){a.next=12;break}r=regeneratorRuntime.mark((function a(r){var n,s,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=t.getcreateNewTest[r],s={country:n.country,mallId:n.mallId,add_on_deal_id:n.add_on_deal_id,main_item_list:[]},e.goodsList.forEach((function(e){e.status=1,s.main_item_list.push({item_id:e.itemid,status:e.status,platform_mall_id:e.platform_mall_id})})),a.next=5,t.saveActiveMasterGoods(s);case 5:i=a.sent,0!==i.ecode?t.$refs.Logs.writeLog("1126-请求异常,商品添加失败".concat(i.message),!1):(o=[],i.data.data.main_item_list.forEach((function(e){0===e.err_code?o.push(e.item_id):3450015===e.err_code&&t.$refs.Logs.writeLog("".concat(n.mallname,"【").concat(e.item_id,"】商品不能重复参与同一时段的活动，该商品正在参与其他活动"),!1)})),s.main_item_list.forEach((function(e){e.statusShow=1===e.status,e.mallName=n.mallname;var a=o.findIndex((function(t){return e.item_id===t})),r=t.masterGoodslist.findIndex((function(t){return n.mallId===t.platform_mall_id&&t.item_id===e.item_id}));r<0&&a>=0&&t.masterGoodslist.push(e)})),t.$refs.Logs.writeLog("【".concat(n.mallname,"】添加").concat(o.length,"个商品"),!0));case 7:case"end":return a.stop()}}),a)})),n=0;case 7:if(!(n<t.getcreateNewTest.length)){a.next=12;break}return a.delegateYield(r(n),"t0",9);case 9:n++,a.next=7;break;case 12:if(!t.otherGoods){a.next=45;break}if(0!==t.getcreateNewTest[0].sub_type||t.addGoodsList.length||!(e.goodsList.length>t.getcreateNewTest[0].sub_item_limit)){a.next=16;break}return t.$message.warning("附加商品最多添加".concat(t.getcreateNewTest[0].sub_item_limit,"个")),a.abrupt("return");case 16:if(!(0===t.getcreateNewTest[0].sub_type&&t.addGoodsList.length&&t.addGoodsList.length+e.goodsList.length>t.getcreateNewTest[0].sub_item_limit)){a.next=19;break}return t.$message.warning("附加商品最多添加".concat(t.getcreateNewTest[0].sub_item_limit,"个")),a.abrupt("return");case 19:if(1!==t.getcreateNewTest[0].sub_type||t.addGoodsList.length||!(e.goodsList.length>100)){a.next=22;break}return t.$message.warning("附加商品最多添加100个"),a.abrupt("return");case 22:if(!(1===t.getcreateNewTest[0].sub_type&&t.addGoodsList.length&&t.addGoodsList.length+e.goodsList.length>100)){a.next=25;break}return t.$message.warning("附加商品最多添加100个"),a.abrupt("return");case 25:i=function(a){var r=e.goodsList[a],n=t.masterGoodslist.findIndex((function(e){return Number(e.item_id)===Number(r.itemid)}));if(n>=0)return t.$message.warning("附加商品不能与主商品相同"),{v:void 0}},o=0;case 27:if(!(o<e.goodsList.length)){a.next=34;break}if(c=i(o),"object"!==Object(s["a"])(c)){a.next=31;break}return a.abrupt("return",c.v);case 31:o++,a.next=27;break;case 34:l=[],u=[],e.goodsList.forEach((function(e){var a=t.addGoodsList.findIndex((function(t){return Number(t.item_id)===Number(e.itemid)}));a<0?(l.push(e),u.push(e.itemid.toString())):t.$refs.Logs.writeLog("已过滤重复商品",!0)})),t.getcreateNewTest.forEach((function(e){e.item_list=l})),d=regeneratorRuntime.mark((function e(a){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={country:t.getcreateNewTest[a].country,mallId:t.getcreateNewTest[a].mallId,productIds:u},e.next=3,t.getModelinfo(r);case 3:n=e.sent,n&&(t.getcreateNewTest[a].item_list.forEach((function(e){n.forEach((function(t){Number(e.itemid)===Number(t.itemid)&&(e.modelinfo=t.modelList)}))})),t.getcreateNewTest[a].platform_mall_id=t.getcreateNewTest[a].mallId,t.addOtherGoods(t.getcreateNewTest[a]));case 5:case"end":return e.stop()}}),e)})),m=0;case 40:if(!(m<t.getcreateNewTest.length)){a.next=45;break}return a.delegateYield(d(m),"t1",42);case 42:m++,a.next=40;break;case 45:a.next=86;break;case 47:if(!t.masterGoods){a.next=54;break}return g={country:t.currentDate.country,mallId:t.currentDate.platform_mall_id,add_on_deal_id:t.currentDate.add_on_deal_id,main_item_list:[]},e.goodsList.forEach((function(e){e.status=1,g.main_item_list.push({item_id:e.itemid,status:e.status})})),a.next=52,t.saveActiveMasterGoods(g);case 52:_=a.sent,0!==_.ecode?t.$refs.Logs.writeLog("【".concat(t.currentDate.mallName,"】商品添加失败,").concat(_.message),!1):(g.main_item_list.forEach((function(e){e.statusShow=1===e.status,e.mallName=t.currentDate.mallName;var a=t.masterGoodslist.findIndex((function(t){return t.item_id===e.item_id}));a<0?t.masterGoodslist.push(e):t.$refs.Logs.writeLog("------【".concat(t.currentDate.mallName,"】已过滤重复数组------"),!0)})),t.$refs.Logs.writeLog("【".concat(t.currentDate.mallName,"】商品添加成功"),!0));case 54:if(!t.otherGoods){a.next=85;break}if(0!==t.currentDate.sub_type||t.addGoodsList.length||!(e.goodsList.length>t.currentDate.sub_item_limit)){a.next=58;break}return t.$message.warning("附加商品最多添加".concat(t.currentDate.sub_item_limit,"个")),a.abrupt("return");case 58:if(!(0===t.currentDate.sub_type&&t.addGoodsList.length&&t.addGoodsList.length+e.goodsList.length>t.currentDate.sub_item_limit)){a.next=61;break}return t.$message.warning("附加商品最多添加".concat(t.currentDate.sub_item_limit,"个")),a.abrupt("return");case 61:if(1!==t.currentDate.sub_type||t.addGoodsList.length||!(e.goodsList.length>100)){a.next=64;break}return t.$message.warning("附加商品最多添加100个"),a.abrupt("return");case 64:if(!(1===t.currentDate.sub_type&&t.addGoodsList.length&&t.addGoodsList.length+e.goodsList.length>100)){a.next=67;break}return t.$message.warning("附加商品最多添加100个"),a.abrupt("return");case 67:p=function(a){var r=e.goodsList[a],n=t.masterGoodslist.findIndex((function(e){return Number(e.item_id)===Number(r.itemid)}));if(n>=0)return t.$message.warning("附加商品不能与主商品相同"),{v:void 0}},f=0;case 69:if(!(f<e.goodsList.length)){a.next=76;break}if(h=p(f),"object"!==Object(s["a"])(h)){a.next=73;break}return a.abrupt("return",h.v);case 73:f++,a.next=69;break;case 76:return b=[],w=[],e.goodsList.forEach((function(e){var a=t.addGoodsList.findIndex((function(t){return Number(t.item_id)===Number(e.itemid)}));a<0?(b.push(e),w.push(e.itemid.toString())):t.$refs.Logs.writeLog("已过滤重复商品",!0)})),t.currentDate.item_list=b,v={country:t.currentDate.country,mallId:t.currentDate.platform_mall_id,productIds:w},a.next=83,t.getModelinfo(v);case 83:x=a.sent,x?(t.currentDate.item_list.forEach((function(e){x.forEach((function(t){Number(e.itemid)===Number(t.itemid)&&(e.modelinfo=t.modelList)}))})),t.addOtherGoods(t.currentDate)):t.$refs.Logs.writeLog("商品无法添加",!1);case 85:t.getTableList();case 86:case"end":return a.stop()}}),a)})))()},getModelinfo:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={country:e.country,mallId:e.mallId,productIds:e.productIds},a.next=3,t.GoodsManagerAPIInstance.getshopGoodsDetail(r);case 3:if(n=a.sent,0!==n.ecode){a.next=9;break}return s=n.data.products.items,a.abrupt("return",s);case 9:return t.$refs.Logs.writeLog("商品sku获取失败",!1),a.abrupt("return",null);case 11:case"end":return a.stop()}}),a)})))()},saveActiveMasterGoods:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.showlog=!1,r={country:e.country,mallId:e.mallId,add_on_deal_id:e.add_on_deal_id,main_item_list:e.main_item_list},a.next=5,t.MarketManagerAPIInstance.ActiveAddMasterGooods(r);case 5:return n=a.sent,t.goodsItemSelectorVisible=!1,a.abrupt("return",n);case 10:a.prev=10,a.t0=a["catch"](0),t.$refs.Logs.writeLog("【".concat(e.mallname,"】操作添加失败--catch,").concat(a.t0),!1);case 13:case"end":return a.stop()}}),a,null,[[0,10]])})))()},MasterSelectionChange:function(e){this.goodsMasterTableSelect=e},otherSelectionChange:function(e){this.otherMasterTableSelect=e},openShowMul:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i,o,c,l,u,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.saveActive||t.getcreateNewTest.length||t.currentDate){a.next=3;break}return t.$message.warning("请先保存活动"),a.abrupt("return");case 3:if(t.goodsMasterTableSelect.length){a.next=6;break}return t.$message.warning("请先选择商品信息!"),a.abrupt("return");case 6:if(!t.getcreateNewTest.length){a.next=20;break}r=0;case 8:if(!(r<t.getcreateNewTest.length)){a.next=18;break}for(n={country:t.getcreateNewTest[r].country,mallId:t.getcreateNewTest[r].mallId,add_on_deal_id:t.getcreateNewTest[r].add_on_deal_id,main_item_list:[]},s=0;s<t.goodsMasterTableSelect.length;s++)i=t.goodsMasterTableSelect[s],1===e?t.$set(i,"statusShow",!0):t.$set(i,"statusShow",!1),i.status=e,n.main_item_list.push({status:i.status,item_id:i.item_id});return a.next=13,t.saveActiveMasterGoods(n);case 13:o=a.sent,0!==o.ecode?t.$refs.Logs.writeLog("【".concat(t.getcreateNewTest[r].mallName,"】商品状态修改失败,").concat(o.message),!1):t.$refs.Logs.writeLog("【".concat(t.getcreateNewTest[r].mallName,"】商品状态修改成功"),!0);case 15:r++,a.next=8;break;case 18:a.next=26;break;case 20:for(c={country:t.currentDate.country,mallId:t.currentDate.platform_mall_id,add_on_deal_id:t.currentDate.add_on_deal_id,main_item_list:[]},l=0;l<t.goodsMasterTableSelect.length;l++)u=t.goodsMasterTableSelect[l],1===e?t.$set(u,"statusShow",!0):t.$set(u,"statusShow",!1),u.status=e,c.main_item_list.push({status:u.status,item_id:u.item_id});return a.next=24,t.saveActiveMasterGoods(c);case 24:d=a.sent,0!==d.ecode?t.$refs.Logs.writeLog("【".concat(t.currentDate.mallName,"】商品状态修改失败,").concat(d.message),!1):t.$refs.Logs.writeLog("【".concat(t.currentDate.mallName,"】商品状态修改成功"),!0);case 26:case"end":return a.stop()}}),a)})))()},changeShow:function(e,t,a){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,s,i,o,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r.saveActive||r.getcreateNewTest.length||r.currentDate){t.next=3;break}return r.$message.warning("请先保存活动"),t.abrupt("return");case 3:if(!r.getcreateNewTest.length){t.next=19;break}if("master"!==a){t.next=17;break}n=0;case 6:if(!(n<r.getcreateNewTest.length)){t.next=17;break}return s=r.getcreateNewTest[n],i={country:s.country,mallId:s.mallId,add_on_deal_id:s.add_on_deal_id,main_item_list:[]},e.statusShow?i.main_item_list=[{status:1,item_id:e.item_id}]:i.main_item_list=[{status:2,item_id:e.item_id}],t.next=12,r.saveActiveMasterGoods(i);case 12:o=t.sent,0!==o.ecode?r.$refs.Logs.writeLog("【".concat(s.mallName,"】商品状态修改失败,").concat(o.message),!1):r.$refs.Logs.writeLog("【".concat(s.mallName,"】商品状态修改成功"),!0);case 14:n++,t.next=6;break;case 17:t.next=27;break;case 19:if("master"!==a){t.next=26;break}return c={country:r.currentDate.country,mallId:r.currentDate.platform_mall_id,add_on_deal_id:r.currentDate.add_on_deal_id,main_item_list:[]},e.statusShow?c.main_item_list=[{status:1,item_id:e.item_id}]:c.main_item_list=[{status:2,item_id:e.item_id}],t.next=24,r.saveActiveMasterGoods(c);case 24:l=t.sent,0!==l.ecode?r.$refs.Logs.writeLog("【".concat(r.currentDate.mallName,"】商品状态修改失败,").concat(l.message),!1):r.$refs.Logs.writeLog("【".concat(r.currentDate.mallName,"】商品状态修改成功"),!0);case 26:case 27:case"end":return t.stop()}}),t)})))()},delMasterMulFun:function(){var e=this;this.saveActive||this.getcreateNewTest.length||this.currentDate?this.masterGoodslist.length?this.$confirm("您确定要删除这些商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.delMasterMul();case 1:case"end":return t.stop()}}),t)})))):this.$message.warning("请先选择商品信息"):this.$message.warning("请先保存活动")},delMasterMul:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s,i,o,c,l,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.getcreateNewTest.length){t.next=14;break}a=0;case 2:if(!(a<e.getcreateNewTest.length)){t.next=12;break}for(r={country:e.getcreateNewTest[a].country,mallId:e.getcreateNewTest[a].mallId,add_on_deal_id:e.getcreateNewTest[a].add_on_deal_id,main_item_list:[]},n=0;n<e.goodsMasterTableSelect.length;n++)s=e.goodsMasterTableSelect[n],s.status=0,r.main_item_list.push({status:s.status,item_id:s.item_id});return t.next=7,e.saveActiveMasterGoods(r);case 7:i=t.sent,0!==i.ecode?e.$refs.Logs.writeLog("【".concat(e.getcreateNewTest[a].mallname,"】商品删除修改失败,").concat(i.message),!1):(e.goodsMasterTableSelect.forEach((function(t){var a=e.masterGoodslist.findIndex((function(e){return e.item_id===t.item_id}));e.masterGoodslist.splice(a,1)})),e.$refs.Logs.writeLog("【".concat(e.getcreateNewTest[a].mallname,"】商品删除成功"),!0));case 9:a++,t.next=2;break;case 12:t.next=20;break;case 14:for(o={country:e.currentDate.country,mallId:e.currentDate.platform_mall_id,add_on_deal_id:e.currentDate.add_on_deal_id,main_item_list:[]},c=0;c<e.goodsMasterTableSelect.length;c++)l=e.goodsMasterTableSelect[c],l.status=0,o.main_item_list.push({status:l.status,item_id:l.item_id});return t.next=18,e.saveActiveMasterGoods(o);case 18:u=t.sent,0!==u.ecode?e.$refs.Logs.writeLog("【".concat(e.currentDate.mallName,"】商品删除修改失败,").concat(u.message),!1):(e.goodsMasterTableSelect.forEach((function(t){var a=e.masterGoodslist.findIndex((function(e){return e.item_id===t.item_id}));e.masterGoodslist.splice(a,1)})),e.$refs.Logs.writeLog("【".concat(e.currentDate.mallName,"】商品删除成功"),!0));case 20:case"end":return t.stop()}}),t)})))()},delMasterFun:function(e,t,a){var r=this;this.saveActive||this.getcreateNewTest.length||this.currentDate?this.$confirm("您确定要删除该商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r.delMaster(e,t,a);case 1:case"end":return n.stop()}}),n)})))):this.$message.warning("请先保存活动")},delMaster:function(e,t,a){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var n,s,i,o,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!r.getcreateNewTest.length){a.next=13;break}n=0;case 2:if(!(n<r.getcreateNewTest.length)){a.next=11;break}return s={country:r.getcreateNewTest[n].country,mallId:r.getcreateNewTest[n].mallId,add_on_deal_id:r.getcreateNewTest[n].add_on_deal_id,main_item_list:[{status:0,item_id:e.item_id}]},a.next=6,r.saveActiveMasterGoods(s);case 6:i=a.sent,0!==i.ecode?r.$refs.Logs.writeLog("【".concat(r.getcreateNewTest[n].mallname,"】商品删除修改失败,").concat(i.message),!1):(r.masterGoodslist.splice(t,1),r.$refs.Logs.writeLog("【".concat(r.getcreateNewTest[n].mallname,"】商品删除成功"),!0));case 8:n++,a.next=2;break;case 11:a.next=18;break;case 13:return o={country:r.currentDate.country,mallId:r.currentDate.platform_mall_id,add_on_deal_id:r.currentDate.add_on_deal_id,main_item_list:[{status:0,item_id:e.item_id}]},a.next=16,r.saveActiveMasterGoods(o);case 16:c=a.sent,0!==c.ecode?r.$refs.Logs.writeLog("【".concat(r.currentDate.mallName,"】商品删除修改失败,").concat(c.message),!1):(r.masterGoodslist.splice(t,1),r.$refs.Logs.writeLog("【".concat(r.currentDate.mallName,"】商品删除成功"),!0));case 18:case"end":return a.stop()}}),a)})))()},addOtherGoodsFun:function(){this.saveActive||this.getcreateNewTest.length||this.currentDate?this.masterGoodslist.length?(this.goodsItemSelectorVisible=!0,this.otherGoods=!0,this.masterGoods=!1):this.$message.warning("请至少选择一个主要商品"):this.$message.warning("请先保存活动")},addOtherGoods:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,t.showlog=!1,r=[],e.item_list.forEach((function(e){r.push(e.itemid)})),n={country:e.country,mallId:e.platform_mall_id,add_on_deal_id:e.add_on_deal_id,item_list:r},a.next=7,t.MarketManagerAPIInstance.AddotherGooods(n);case 7:s=a.sent,0===s.ecode?(t.$refs.Logs.writeLog("商品数据请求成功",!0),i=[],s.data.data.succ_items.length&&s.data.data.succ_items.forEach((function(e){i.push(e.item_id)})),t.$refs.Logs.writeLog("【".concat(e.mallname||e.mallName,"】添加").concat(i.length,"个商品"),!0),e.item_list.forEach((function(a){var r=i.findIndex((function(e){return a.itemid===e}));r>=0&&(a.mallName=e.mallname||e.mallName,0===e.sub_type?(t.$set(a,"discount",0),a.addPrice=a.discount?a.price:a.price*Number(a.discount),t.$set(a,"addStatus",!1),t.$set(a,"showStatus",!1)):(a.addPrice=0,t.$set(a,"showStatus",!1)),t.addGoodsList.push(a))}))):t.$refs.Logs.writeLog("【".concat(e.mallName||e.mallname,"】商品请求异常,添加失败,").concat(s.message),!1),t.goodsItemSelectorVisible=!1,a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](0),t.$refs.Logs.writeLog("【".concat(e.mallName||e.mallname,"】加购商品添加失败--catch,").concat(a.t0),!1);case 15:case"end":return a.stop()}}),a,null,[[0,12]])})))()},clearLog:function(){this.$refs.Logs.consoleMsg=""},handleSelectionChange:function(e){this.mallTableSelect=e},MallvoucherDelMul:function(){var e=this;this.mallTableSelect.length?this.$confirm("确定要删除或停止这些活动吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.mallTableSelect.length)){t.next=12;break}if(r=e.mallTableSelect[a],"即将开始"!==r.voucher_status){t.next=6;break}return t.next=6,e.MallvoucherDel(r);case 6:if("进行中"!==r.voucher_status){t.next=9;break}return t.next=9,e.MallvoucherStop(r);case 9:a++,t.next=1;break;case 12:e.getTableList();case 13:case"end":return t.stop()}}),t)})))):this.$message.warning("请选择要操作的数据")},MallvoucherStopFun:function(e){var t=this;this.$confirm("确定要停止该活动吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.MallvoucherStop(e);case 2:t.getTableList();case 3:case"end":return a.stop()}}),a)}))))},MallvoucherStop:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={country:e.country,mallId:e.platform_mall_id,add_on_deal_id:e.add_on_deal_id},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.stopOndealList(r);case 5:n=a.sent,0===n.ecode?t.$refs.Logs.writeLog("------成功停止【".concat(e.add_on_deal_name,"】优惠活动------"),!0):t.$refs.Logs.writeLog("停止【".concat(e.add_on_deal_name,"】优惠活动,").concat(n.message),!1),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("停止【".concat(e.add_on_deal_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},MallvoucherDelFun:function(e){var t=this;this.$confirm("确定要删除该活动吗？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.MallvoucherDel(e);case 2:t.getTableList();case 3:case"end":return a.stop()}}),a)}))))},MallvoucherDel:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r={country:e.country,mallId:e.platform_mall_id,add_on_deal_id:e.add_on_deal_id},a.prev=1,t.showlog=!1,a.next=5,t.MarketManagerAPIInstance.delondealList(r);case 5:n=a.sent,0===n.ecode?t.$refs.Logs.writeLog("------成功删除【".concat(e.add_on_deal_name,"】优惠活动------"),!0):(s="","only upcoming campaign can delete"===n.message&&(s="只有即将进行的活动才能删除"),t.$refs.Logs.writeLog("删除【".concat(e.add_on_deal_name,"】优惠活动,").concat(s||n.message),!1)),a.next=12;break;case 9:a.prev=9,a.t0=a["catch"](1),t.$refs.Logs.writeLog("删除【".concat(e.add_on_deal_name,"】--catch,").concat(a.t0),!1);case 12:case"end":return a.stop()}}),a,null,[[1,9]])})))()},stopCreate:function(){Object(u["B"])(),this.$refs.Logs.writeLog("已停止创建")},add0:function(e){return e<10?"0"+e:e},formatTime:function(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,n=t.getDate(),s=t.getHours(),i=t.getMinutes(),o=t.getSeconds();return a+"-"+this.add0(r)+"-"+this.add0(n)+" "+this.add0(s)+":"+this.add0(i)+":"+this.add0(o)},changeMallList:function(e){this.selectMallList=e},getInfo:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s,i,o,c,l,u,d;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r.prev=1,s={country:e.country,mallId:e.platform_mall_id,offset:e.offset,count:50},r.next=5,a.MarketManagerAPIInstance.getAddondealList(s);case 5:if(i=r.sent,0===i.ecode){r.next=11;break}return o="","token not found"===i.message&&(o="店铺未登录"),a.$refs.Logs.writeLog("1794-【".concat(e.mall_alias_name||e.platform_mall_name,"】数据请求失败,").concat(o||i.message||"操作频繁，请稍后再试"),!1),r.abrupt("return");case 11:if(c=0===i.ecode?i.data.data.add_on_deal_list:[],c.length){r.next=15;break}return a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】暂无数据")),r.abrupt("return");case 15:if(!c.length){r.next=45;break}if(!a.stoptoping){r.next=18;break}return r.abrupt("return");case 18:l=0;case 19:if(!(l<c.length)){r.next=33;break}if(!a.stoptoping){r.next=22;break}return r.abrupt("return");case 22:u=c[l],u.platform_mall_id=e.platform_mall_id,u.country=e.country,u.mallName=e.mall_alias_name||e.platform_mall_name,u.formStartime=a.formatTime(1e3*u.start_time),u.formEndtime=a.formatTime(1e3*u.end_time),1===Number(u.status)?(u.voucher_status="即将开始",a.willList.push(u)):2===Number(u.status)?(u.voucher_status="进行中",a.doingList.push(u)):(u.voucher_status="已过期",a.pastList.push(u)),a.arrList.push(u);case 30:l++,r.next=19;break;case 33:if(a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】,正在请求第【").concat(s.offset/s.count+1,"】页"),!0),!(c.length<s.count)){r.next=38;break}c.length=[],r.next=43;break;case 38:return s.offset=s.offset+s.count,r.next=41,a.MarketManagerAPIInstance.logisticsPromotion(s);case 41:d=r.sent,c=0===d.data.code?d.data.data.add_on_deal_list:[];case 43:r.next=15;break;case 45:a.isShowPast?"0"===a.activeType?a.getTable=a.willList.concat(a.doingList):"1"===a.activeType?a.getTable=a.doingList:"2"===a.activeType?a.getTable=a.willList:a.getTable=[]:("1"===a.activeType&&(a.getTable=a.doingList),"2"===a.activeType&&(a.getTable=a.willList),"3"===a.activeType&&(a.getTable=a.pastList),"0"===a.activeType&&(a.getTable=a.arrList)),r.next=51;break;case 48:r.prev=48,r.t0=r["catch"](1),a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】--catch，").concat(r.t0),!1);case 51:return r.prev=51,n.count--,r.finish(51);case 54:case"end":return r.stop()}}),r,null,[[1,48,51,54]])})))()},getPrizeDetail:function(e){var t=arguments,a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,s,i,o,c,l,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.length>1&&void 0!==t[1]?t[1]:{count:1},r.prev=1,s={country:e.country,mallId:e.platform_mall_id,campaign_id:e.campaign_id},r.next=5,a.MarketManagerAPIInstance.FollowPrizeDetail(s);case 5:i=r.sent,0===i.data.code?(o=i.data.data,c=null,l=null,u=o.min_spend,0===Number(o.reward_type)&&(o.discount.value?(c=o.discount.value,l=""):(c="".concat((100-Number(o.discount.percentage))/10,"折"),l="0.00"===o.discount.cap?"无限制":o.discount.cap)),1===Number(o.reward_type)&&(c="".concat(o.coin_cash_back.percentage,"%折扣,(Shopee币回扣)"),l="0.00"===o.coin_cash_back.cap?"无限制":o.coin_cash_back.cap+"(Shopee币)"),a.$set(e,"discountInfo",c),a.$set(e,"topNum",l),a.$set(e,"min_spend",u)):a.$refs.Logs.writeLog("【".concat(e.mall_alias_name||e.platform_mall_name,"】,").concat(i.message),!1),r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](1),a.$refs.Logs.writeLog("Detailcatch，".concat(r.t0),!1);case 12:return r.prev=12,n.count--,r.finish(12);case 15:case"end":return r.stop()}}),r,null,[[1,9,12,15]])})))()},getTableList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.disSelect=!1,e.$refs.multipleTable.clearSelection(),e.selectMallList.forEach((function(e){e.offset=0})),e.getTable=[],e.arrList=[],e.willList=[],e.doingList=[],e.pastList=[],e.showlog=!1,e.tableLoading=!0,e.$refs.Logs.writeLog("正在请求数据......",!0),t.next=13,Object(u["d"])(e.selectMallList,e.getInfo);case 13:t.sent,e.$refs.Logs.writeLog("请求数据结束"),e.tableLoading=!1,e.tableList=e.getTable;case 17:case"end":return t.stop()}}),t)})))()}}}),g=m,_=(a("3e49"),a("2877")),p=Object(_["a"])(g,r,n,!1,null,"2f8d215e",null);t["default"]=p.exports},"3e49":function(e,t,a){"use strict";a("46ab")},"46ab":function(e,t,a){},"53ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}}}]);