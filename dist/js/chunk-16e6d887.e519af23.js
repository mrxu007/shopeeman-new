(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16e6d887"],{"422c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"contaniner"},[a("el-row",{staticClass:"header"},[a("el-col",{staticClass:"header-top",attrs:{span:24}},[a("ul",[a("li",[a("span",[e._v("分组名称：")]),a("el-input",{attrs:{placeholder:"",size:"mini"},model:{value:e.groupName,callback:function(t){e.groupName=t},expression:"groupName"}})],1),a("li",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.getGroup}},[e._v("查询")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openGroupDialog(null)}}},[e._v("新增分组")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.deleteGroup}},[e._v("删除当前分组")])],1)])])],1),a("el-row",{staticClass:"article"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.buttonStatus.search,expression:"buttonStatus.search"}],ref:"plTable",attrs:{height:"calc(100vh - 140px)",data:e.groupList,"header-cell-style":{backgroundColor:"#f5f7fa"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),a("el-table-column",{attrs:{align:"center",type:"index",label:"序列号",width:"100"}}),a("el-table-column",{attrs:{align:"center",label:"分组名称",prop:"group_name"}}),a("el-table-column",{attrs:{align:"center",label:"绑定运营"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.new_role_operator.join(",")||"-")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"绑定客服"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.new_role_customer_servicer.join(",")||"-")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"绑定跟单"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.new_role_follower_id.join(",")||"-")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.openGroupDialog(n)}}},[e._v("修改分组")])]}}])})],1)],1),a("el-dialog",{staticClass:"edit-group-dialog",attrs:{title:e.typeOpt?"修改店铺分组":"新增店铺分组",visible:e.editGroupDialogVisible,width:"1000px","before-close":e.handleClose,"close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{"update:visible":function(t){e.editGroupDialogVisible=t}}},[a("el-row",{staticClass:"contaniner-dialog"},[a("div",{staticClass:"con-lft"},[a("ul",[a("li",{directives:[{name:"show",rawName:"v-show",value:e.typeOpt,expression:"typeOpt"}]},[a("p",[e._v("分组列表：")]),a("el-select",{attrs:{placeholder:"",size:"mini"},on:{change:e.switchSelectMallStatus},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupList,(function(e,t){return a("el-option",{key:t,attrs:{value:e.id,label:e.group_name}})})),1)],1),a("li",{directives:[{name:"show",rawName:"v-show",value:!e.typeOpt,expression:"!typeOpt"}]},[a("p",[e._v("新增分组：")]),a("el-input",{attrs:{placeholder:"",size:"mini"},model:{value:e.addGroupName,callback:function(t){e.addGroupName="string"===typeof t?t.trim():t},expression:"addGroupName"}})],1),a("li",{staticClass:"btn"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addOrUpdatemallGroup}},[e._v("保存")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.typeOpt,expression:"!typeOpt"}],attrs:{type:"primary",size:"mini"},on:{click:e.openExcelDialog}},[e._v("Excel导入分组")])],1),a("li",[a("div",{staticClass:"text-log"},[a("div",{staticClass:"text-log-content"})])])])]),a("div",{staticClass:"con-rht"},[a("ul",[a("li",[a("p",[e._v("站点：")]),a("el-select",{attrs:{placeholder:"",size:"mini"},on:{change:e.switchSelectMallStatus},model:{value:e.siteId,callback:function(t){e.siteId=t},expression:"siteId"}},[a("el-option",{attrs:{label:"全部",value:0}}),e._l(e.countries,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],2),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.switchSelectMallStatus}},[e._v("刷新店铺")])],1),a("li",[a("p",[e._v("店铺ID：")]),a("el-input",{attrs:{placeholder:"",size:"mini"},model:{value:e.systemId,callback:function(t){e.systemId="string"===typeof t?t.trim():t},expression:"systemId"}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.switchSelectMallStatus}},[e._v("查询")]),a("el-checkbox",{on:{change:e.switchSelectMallStatus},model:{value:e.isHide,callback:function(t){e.isHide=t},expression:"isHide"}},[e._v("隐藏已绑定分组店铺")])],1)]),a("div",{staticClass:"con-rht-text"},[a("span",[e._v("绑定当前分组的店铺始终会显示")])]),a("div",{staticClass:"con-rht-table"},[a("u-table",{ref:"plTable2",attrs:{height:420,"use-virtual":"","header-cell-style":{backgroundColor:"#f5f7fa"},"data-changes-scroll-top":!1,"row-height":50,border:!1}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号"}}),a("el-table-column",{attrs:{align:"center",prop:"",label:"站点"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("chineseSite")(a.country))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",prop:"platform_mall_id",label:"店铺ID"}}),a("el-table-column",{attrs:{align:"center",prop:"platform_mall_name",label:"店铺名称"}}),a("el-table-column",{attrs:{align:"center",prop:"group_name",label:"已绑定分组"}}),a("u-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[n.isSelected?a("el-button",{staticStyle:{margin:"0"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.delbingingMall(n)}}},[e._v("删除")]):a("el-button",{staticStyle:{margin:"0"},attrs:{size:"mini",plain:""},on:{click:function(t){return e.addbingingMall(n)}}},[e._v("添加")])]}}])})],1)],1)])])],1),a("el-dialog",{staticClass:"excel-dialog",attrs:{title:"Excel导入店铺分组",visible:e.ExcelDialogVisible,width:"500px","before-close":e.handleClose2,"close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{"update:visible":function(t){e.ExcelDialogVisible=t}}},[a("ul",[a("li",{staticClass:"btn"},[a("el-upload",{ref:"importRef",attrs:{accept:".xls, .xlsx",action:"https://jsonplaceholder.typicode.com/posts/","on-change":e.importTemplateEvent,"show-file-list":!1,"auto-upload":!1}},[a("el-button",{attrs:{data:e.importTemplateData,size:"mini",type:"primary"}},[e._v(" 批量导入 ")])],1),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.downloadTemplate("downExcelGroupTemplate")}}},[e._v("下载模板")]),a("span",{staticClass:"tip"},[e._v("请先下载数据模板再进行批量导入")])],1),a("li",{staticClass:"tip2"},[a("p",[e._v("导入信息：")])]),a("li",[a("div",{staticClass:"text-log"},[a("div",{staticClass:"text-log-content",domProps:{innerHTML:e._s(e.consoleMsg)}})])])])])],1)},r=[],i=a("1da1"),l=(a("96cf"),a("b0c0"),a("d81d"),a("99af"),a("b64b"),a("3ca3"),a("ddb0"),a("7db0"),a("a15b"),a("d3b7"),a("c740"),a("a434"),a("498a"),a("4de4"),a("ac1f"),a("841c"),a("5319"),a("4d63"),a("25f0"),a("0e0b")),s=a("1146"),o=a.n(s),c={data:function(){return{groupName:"",groupList:[],groupListTemp:[],consoleMsg:"",buttonStatus:{search:!1,addGroup:!1,delGroup:!1},multipleSelection:[],typeOpt:"",editGroupDialogVisible:!1,ExcelDialogVisible:!1,groupId:"",siteId:0,systemId:"",addGroupName:"",mallList:[],mallListTemp:[],countries:this.$filters.countries_option,isHide:!1,bindMallList:[],bindMallListObj:{del:{},add:{}},firstReFresh:!0,importTemplateData:""}},created:function(){this.getGroup(),this.getMallList()},methods:{handleSelectionChange:function(e){this.multipleSelection=e},handleClose:function(e){e(),this.reset()},handleClose2:function(e){e(),this.consoleMsg=""},downloadTemplate:function(e){this[e]()},importTemplateEvent:function(e){var t=this,a={0:e.raw};if(/\.(xls|xlsx)$/.test(a[0].name.toLowerCase()))if(a.length<=0)this.writeLog("表格为空",!1);else{var n=new FileReader;n.onload=function(e){var a=e.target.result,n=o.a.read(a,{type:"binary"}),r=n.SheetNames[0],i=o.a.utils.sheet_to_json(n.Sheets[r]);t.importTemplateData=i,i=null,t.writeLog("正在读取中...",!0),t.importGroupName(),t.$refs.importRef.value=""},n.readAsBinaryString(a[0])}else this.writeLog("上传格式不对,请上传xls、xls格式的文件",!1)},importGroupName:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,l,s,o,c,u,p,d,m,g,b;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.importTemplateData.length,n={},r={},e.mallListTemp.map((function(e){r["".concat(e.platform_mall_id)]=e.id})),i=0;case 5:if(!(i<a)){t.next=20;break}if(l=e.importTemplateData[i],l["店铺ID(必填)"]){t.next=10;break}return e.writeLog("(".concat(i+1,"/").concat(a,")item['店铺ID(必填)']"),!1),t.abrupt("continue",17);case 10:if(l["分组名称(必填)"]){t.next=13;break}return e.writeLog("(".concat(i+1,"/").concat(a,")分组名称(必填)"),!1),t.abrupt("continue",17);case 13:s=l["店铺ID(必填)"]+"",o=l["分组名称(必填)"],n["".concat(o)]||(n["".concat(o)]=[]),n["".concat(o)].push(r[s]);case 17:i++,t.next=5;break;case 20:c={},u=null,p=1,d=Object.keys(n).length,m=regeneratorRuntime.mark((function t(a){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.groupList.find((function(e){return e.group_name===a})),!r){t.next=10;break}return c["groupName"]=a,c["groupId"]=r.id,c["sysMallIds"]=n[a].join(","),t.next=7,e.$api.updateGroup(c);case 7:u=t.sent,t.next=15;break;case 10:return c["groupName"]=a,c["sysMallIds"]=n[a].join(","),t.next=14,e.$api.addGroup(c);case 14:u=t.sent;case 15:if(200===u.data.code){t.next=20;break}return e.$message.error(),e.writeLog("(".concat(p,"/").concat(d,")店铺分组导入失败: ").concat(u.data.message),!1),e.buttonStatus.addGroup=!1,t.abrupt("return","continue");case 20:e.writeLog("(".concat(p,"/").concat(d,")店铺分组名：【").concat(a,"】导入成功"),!0),p++;case 22:case"end":return t.stop()}}),t)})),t.t0=regeneratorRuntime.keys(n);case 26:if((t.t1=t.t0()).done){t.next=34;break}return g=t.t1.value,t.delegateYield(m(g),"t2",29);case 29:if(b=t.t2,"continue"!==b){t.next=32;break}return t.abrupt("continue",26);case 32:t.next=26;break;case 34:e.getGroup(),e.getMallList(),e.writeLog("导入结束",!0),e.importTemplateData=null;case 38:case"end":return t.stop()}}),t)})))()},downExcelGroupTemplate:function(){var e='<tr>\n      <td style="width: 200px; text-align:left;">店铺名称<span style="color:red">(必填)</span></td>\n      <td style="width: 200px; text-align:left;">店铺ID<span style="color:red">(必填)</span></td>\n      <td style="width: 200px; text-align:left;">分组名称<span style="color:red">(必填)</span></td>\n      </tr>';this.mallListTemp.map((function(t){e+='\n          <tr>\n            <td style="width: 200px; text-align:left;">'.concat(t.platform_mall_name,'</td>\n            <td style="width: 200px; text-align:left;">').concat(t.platform_mall_id,'</td>\n            <td style="width: 200px; text-align:left;">').concat(t.group_name||"","</td>\n          </tr>\n        ")})),Object(l["g"])("批量导入分组",e)},openExcelDialog:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.ExcelDialogVisible=!0;case 1:case"end":return t.stop()}}),t)})))()},openGroupDialog:function(e){this.typeOpt=e,this.editGroupDialogVisible=!0,this.reset(),e&&(this.groupId=e.id),this.switchSelectMallStatus()},tableScroll:function(e){e.scrollTop,e.scrollLeft,e.table,e.judgeFlse},delbingingMall:function(e){var t=this.bindMallList.findIndex((function(t){return t.id===e.id}));e.isSelected=!1,this.bindMallListObj["del"][e.id]||(this.bindMallListObj["del"][e.id]=e,this.bindMallListObj["add"][e.id]&&delete this.bindMallListObj["add"][e.id]),this.bindMallList.splice(t,1)},addbingingMall:function(e){this.bindMallList.push(e),this.bindMallListObj["add"][e.id]||(this.bindMallListObj["add"][e.id]=e,this.bindMallListObj["del"][e.id]&&delete this.bindMallListObj["del"][e.id]),e.isSelected=!0},search:function(){var e=this,t=0;this.mallListTemp=this.mallList;var a=!1,n=!1;0!==this.siteId&&(a=!0,t++),this.systemId.trim()&&(n=!0,t++),t>0&&(this.mallListTemp=this.mallListTemp.filter((function(r){var i=0;if(a&&r["country"]===e.siteId&&i++,n&&e.systemId.indexOf("".concat(r.platform_mall_id))>-1&&i++,i===t)return r}))),this.isHide&&(this.mallListTemp=this.mallListTemp.filter((function(e){return!e.group_name})))},reset:function(){this.bindMallList=[],this.bindMallListObj["del"]={},this.bindMallListObj["add"]={}},switchSelectMallStatus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.reset(),e.typeOpt?e.mallList.map((function(t){t.mall_group_id===e.groupId?e.addbingingMall(t):t.isSelected=!1})):e.mallList.map((function(e){e.isSelected=!1})),e.search(),n={},e.mallListTemp.map((function(e){n["".concat(e.platform_mall_id)]="1"})),r=[],e.bindMallList.map((function(e){var t=n[e.platform_mall_id];t||r.push(e)})),(a=e.mallListTemp).push.apply(a,r),e.$nextTick((function(){e.$refs.plTable2.reloadData(e.mallListTemp)}));case 9:case"end":return t.stop()}}),t)})))()},getGroup:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.buttonStatus.search){t.next=2;break}return t.abrupt("return");case 2:return e.buttonStatus.search=!0,a={groupName:e.groupName},t.next=6,e.$api.getMallGroup(a);case 6:if(n=t.sent,200===n.data.code){t.next=11;break}return e.$message.error("获取店铺分组列表失败:  ".concat(n.data.message)),e.buttonStatus.search=!1,t.abrupt("return");case 11:e.groupList=n.data.data,e.groupListTemp=e.groupList,e.buttonStatus.search=!1;case 14:case"end":return t.stop()}}),t)})))()},addOrUpdatemallGroup:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,l,s,o,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.buttonStatus.addGroup){t.next=2;break}return t.abrupt("return");case 2:if(a=e.addGroupName,n=e.typeOpt,r=n?"修改":"添加",a||n){t.next=8;break}return e.$message.error("新增分组名不能为空"),t.abrupt("return");case 8:if(i=e.groupList.find((function(e){return e.group_name===a})),!i||n){t.next=12;break}return e.$message.error("分组名已存在"),t.abrupt("return");case 12:if(e.buttonStatus.addGroup=!0,l=e.bindMallList.map((function(e){return e.id})),0!==l.length||!n){t.next=18;break}return e.$message.error("请至少勾选一个店铺"),e.buttonStatus.addGroup=!1,t.abrupt("return");case 18:if(s={},s["sysMallIds"]=l.join(","),o=null,n){t.next=28;break}return s["groupName"]=e.addGroupName,t.next=25,e.$api.addGroup(s);case 25:o=t.sent,t.next=34;break;case 28:return u=null===(c=e.groupList.find((function(t){return t.id===e.groupId})))||void 0===c?void 0:c.group_name,s["groupName"]=u,s["groupId"]=e.groupId,t.next=33,e.$api.updateGroup(s);case 33:o=t.sent;case 34:if(200===o.data.code){t.next=38;break}return e.$message.error("店铺分组".concat(r,"失败: ").concat(o.data.message)),e.buttonStatus.addGroup=!1,t.abrupt("return");case 38:e.$message.success("店铺分组".concat(r,"成功")),e.buttonStatus.addGroup=!1,e.editGroupDialogVisible=!1,n?(e.updateClientData(),e.getMallList()):e.getGroup();case 42:case"end":return t.stop()}}),t)})))()},updateClientData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r,i,l,s,o,c,u,p,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.bindMallListObj["add"],r=e.bindMallListObj["del"],i=e.groupId,l=null===(a=e.groupList.find((function(e){return e.id===i})))||void 0===a?void 0:a.group_name,t.t0=regeneratorRuntime.keys(r);case 5:if((t.t1=t.t0()).done){t.next=15;break}return s=t.t1.value,o=r[s].platform_mall_id,t.next=10,e.$appConfig.getGlobalCacheInfo("mallInfo",o);case 10:c=t.sent,c=JSON.parse(c),void 0!==c.GroupName&&"".concat(i)!==c.mall_group_id||(c.GroupName="",c.mall_group_id=0,e.$appConfig.updateInfoMall(o,JSON.stringify(c))),t.next=5;break;case 15:t.t2=regeneratorRuntime.keys(n);case 16:if((t.t3=t.t2()).done){t.next=30;break}return u=t.t3.value,p=n[u].platform_mall_id,t.next=21,e.$appConfig.getGlobalCacheInfo("mallInfo",p);case 21:if(d=t.sent,d=JSON.parse(d),void 0!==d.GroupName&&"".concat(i)!==d.mall_group_id){t.next=25;break}return t.abrupt("continue",16);case 25:d.GroupName=l,d.mall_group_id="".concat(i),e.$appConfig.updateInfoMall(p,JSON.stringify(d)),t.next=16;break;case 30:case"end":return t.stop()}}),t)})))()},deleteGroup:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.buttonStatus.delGroup){t.next=2;break}return t.abrupt("return");case 2:if(e.buttonStatus.delGroup=!0,0!==e.multipleSelection.length){t.next=6;break}return e.$message.error("请选择需要删除的分组"),t.abrupt("return");case 6:return a=e.multipleSelection.map((function(e){return e.id})),n={groupId:a.join(",")},t.next=10,e.$api.deleteGroup(n);case 10:if(r=t.sent,200===r.data.code){t.next=15;break}return e.$message.error("删除店铺分组失败: ".concat(r.data.message)),e.buttonStatus.delGroup=!1,t.abrupt("return");case 15:e.getGroup(),e.buttonStatus.delGroup=!1;case 17:case"end":return t.stop()}}),t)})))()},getMallList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={country:""},t.next=3,e.$api.getMallList(a);case 3:if(n=t.sent,200===n.data.code){t.next=7;break}return e.$message.error("获取店铺列表失败"),t.abrupt("return");case 7:e.mallList=n.data.data.map((function(e){return e.isSelected=!1,e})),e.mallListTemp=e.mallList;case 9:case"end":return t.stop()}}),t)})))()},writeLog:function(e,t,a){if(e){var n=t?"green":"red";a&&(n=a);var r=this.dateFormat(new Date(Date.now()),"hh:mm:ss");this.consoleMsg='<p style="color:'.concat(n,'">').concat(r,":").concat(e,"</p>")+this.consoleMsg}},dateFormat:function(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return t}}},u=c,p=(a("f1f1"),a("2877")),d=Object(p["a"])(u,n,r,!1,null,"0ee28e99",null);t["default"]=d.exports},a96a:function(e,t,a){},f1f1:function(e,t,a){"use strict";a("a96a")}}]);