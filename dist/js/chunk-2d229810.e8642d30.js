(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d229810"],{de70:function(t,e,a){"use strict";a.d(e,"a",(function(){return d}));var r=a("1da1"),i=a("d4ec"),n=a("bee2"),s=a("ade3"),o=(a("96cf"),a("99af"),a("fb6a"),a("4de4"),a("159b"),a("ac1f"),a("5319"),a("7db0"),a("b0c0"),a("d3b7"),a("25f0"),a("30d0")),c=a("bda5"),l=a("b5e1"),u=a("5f91"),h=(a("0098"),a("bcd0")),d=function(){function t(e,a,r,n){Object(i["a"])(this,t),Object(s["a"])(this,"tbNetworkService",c["a"].tbRequest),Object(s["a"])(this,"$api",c["a"]),Object(s["a"])(this,"$commodityService",new l["a"]),Object(s["a"])(this,"$shopeemanService",new u["a"]),Object(s["a"])(this,"jdNetworkService",c["a"].jdRequest),Object(s["a"])(this,"jszNetworkService",c["a"].jxRequest),Object(s["a"])(this,"isStop",!1),Object(s["a"])(this,"mall",void 0),Object(s["a"])(this,"_this",null),Object(s["a"])(this,"pageSize",40),Object(s["a"])(this,"orderService",new o["a"]),Object(s["a"])(this,"skuImageCache",{}),Object(s["a"])(this,"syncStatus",void 0),Object(s["a"])(this,"mallNo",""),Object(s["a"])(this,"upLoadType",""),Object(s["a"])(this,"writeLog",void 0),Object(s["a"])(this,"timeRange",60),this.mall=e,this._this=r,this.syncStatus=a,this.writeLog=n}return Object(n["a"])(t,[{key:"startSingel",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var r,i,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.writeLog=a,this.mall=e.mall_info,r={order_id:e.order_id,shop_id:e.mall_info.platform_mall_id},t.next=5,this.$shopeemanService.getDetailsSinger(e.country,r);case 5:if(i=t.sent,200!==i.code){t.next=16;break}return n=[i.data],t.next=10,this.getOrderOtherInfo(n);case 10:return t.next=12,this.upLoadOrders(n);case 12:s=t.sent,s?this.writeLog("【".concat(e.order_id,"】订单同步成功，上报成功"),!0):this.writeLog("【".concat(e.order_id,"】订单同步失败，上报失败"),!1),t.next=17;break;case 16:this.writeLog("【".concat(e.order_id,"】订单同步失败").concat(i.data),!1);case 17:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"start",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a,r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.timeRange=r,"refund"!==this.syncStatus.value){t.next=6;break}return t.next=4,this.refund(e,a);case 4:t.next=13;break;case 6:if("toship"!==this.syncStatus.value){t.next=11;break}return t.next=9,this.toShip(e,a);case 9:t.next=13;break;case 11:return t.next=13,this.otherStatus(e,a);case 13:case"end":return t.stop()}}),t,this)})));function e(e,a,r){return t.apply(this,arguments)}return e}()},{key:"toShip",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var r,i,n,s,o,c,l,u,h,d,_,m,p,g,y,f,b,k=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.mallNo=e,this.upLoadType=a,t.prev=2,r={page_size:this.pageSize,page_number:1,total:0,sort_by:"confirmed_date_desc",shop_id:this.mall.platform_mall_id},t.next=6,this.$shopeemanService.getToShipOrderIdList(this.mall.country,r);case 6:if(i=t.sent,200!==i.code){t.next=56;break}n=i.data,s=n.package_list,o=n.total,c=0,l=[];case 11:if(!s.length){t.next=53;break}u=[],h=0;case 14:if(!(h<s.length)){t.next=34;break}return d=s.slice(h,h+5),t.next=18,this.$shopeemanService.getDetailsByOrderIds(this.mall.country,{from_seller_data:!1,orders:this.changeParams(d),shop_id:this.mall.platform_mall_id});case 18:if(_=t.sent,200!==_.code){t.next=31;break}if(m=_.data&&_.data.orders||[],l=l.concat(_.data.orders),!m||!m.length){t.next=31;break}return p=m.filter((function(t){return(new Date).getTime()-1e3*t.create_time<24*k.timeRange*60*60*1e3})),t.next=26,this.getOrderOtherInfo(p);case 26:return g=[],t.next=29,this.checkOrderSnStatus(p);case 29:g=t.sent,u=u.concat(g);case 31:h+=5,t.next=14;break;case 34:if(!u.length){t.next=39;break}return t.next=37,this.upLoadOrders(u);case 37:y=t.sent,y&&(c+=u.length);case 39:if(f="",f=l[l.length-1].create_time,!(s.length<40||f&&(new Date).getTime()-1e3*f>24*this.timeRange*60*60*1e3)){t.next=45;break}s=[],t.next=51;break;case 45:return r.page_number++,r.total=o,t.next=49,this.$shopeemanService.getToShipOrderIdList(this.mall.country,r);case 49:b=t.sent,s=b&&b.data&&b.data.package_list||[];case 51:t.next=11;break;case 53:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(c,"】条"),!0),t.next=61;break;case 56:if(403!==i.code){t.next=60;break}return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 60:return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 61:t.next=66;break;case 63:return t.prev=63,t.t0=t["catch"](2),t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 66:case"end":return t.stop()}}),t,this,[[2,63]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"refund",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var r,i,n,s,o,c,l,u,h,d,_,m,p,g;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.mallNo=e,this.upLoadType=a,t.prev=2,r={page_size:this.pageSize,page_number:1,keyword:"",from_page_number:1,shop_id:this.mall.platform_mall_id},t.next=6,this.$shopeemanService.getRefundOrderIdList(this.mall.country,r);case 6:if(i=t.sent,200!==i.code){t.next=52;break}n=i.data,s=n.list,n.page_info,o=0;case 10:if(!s.length){t.next=49;break}c=[],l=0;case 13:if(!(l<s.length)){t.next=32;break}if(u=s[l],h={return_sn:u.return_sn,shop_id:this.mall.platform_mall_id},!((new Date).getTime()-1e3*u.create_time>24*this.timeRange*60*60*1e3)){t.next=18;break}return t.abrupt("continue",29);case 18:return t.next=20,this.$shopeemanService.getRefundOrderDetail(this.mall.country,h);case 20:if(d=t.sent,200!==d.code){t.next=29;break}return u.refundDetail=d.data,t.next=25,this.getOrderOtherInfoRefund(u);case 25:return t.next=27,this.checkAfterOrderSnStatus(u);case 27:_=t.sent,_&&c.push(u);case 29:l++,t.next=13;break;case 32:return t.next=34,this.afterUpLoadOrders(c);case 34:if(m=t.sent,m&&(o+=c.length),p="",p=s[s.length-1].create_time,!(s.length<40||p&&(new Date).getTime()-1e3*p>24*this.timeRange*60*60*1e3)){t.next=42;break}s=[],t.next=47;break;case 42:return r.page_number++,t.next=45,this.$shopeemanService.getRefundOrderIdList(this.mall.country,r);case 45:g=t.sent,s=g&&g.data&&g.data.list||[];case 47:t.next=10;break;case 49:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(o,"】条"),!0),t.next=57;break;case 52:if(403!==i.code){t.next=56;break}return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 56:return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 57:t.next=62;break;case 59:return t.prev=59,t.t0=t["catch"](2),t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 62:case"end":return t.stop()}}),t,this,[[2,59]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"otherStatus",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var r,i,n,s,o,c,l,u,h,d,_,m,p,g,y,f,b,k=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.mallNo=e,this.upLoadType=a,t.prev=2,r={from_page_number:1,source:this.syncStatus.value,page_size:this.pageSize,page_number:1,total:0,is_massship:!1,shop_id:this.mall.platform_mall_id},t.next=6,this.$shopeemanService.getOrderIdList(this.mall.country,r);case 6:if(i=t.sent,200!==i.code){t.next=56;break}n=i.data,s=n.orders,o=n.page_info,c=0,l=[];case 11:if(!s.length){t.next=53;break}u=[],h=0;case 14:if(!(h<s.length)){t.next=34;break}return d=s.slice(h,h+5),t.next=18,this.$shopeemanService.getDetailsByOrderIds(this.mall.country,{from_seller_data:!1,orders:d,shop_id:this.mall.platform_mall_id});case 18:if(_=t.sent,200!==_.code){t.next=31;break}if(m=_.data&&_.data.orders||[],l=l.concat(_.data.orders),!m||!m.length){t.next=31;break}return p=m.filter((function(t){return(new Date).getTime()-1e3*t.create_time<24*k.timeRange*60*60*1e3})),t.next=26,this.getOrderOtherInfo(p);case 26:return g=[],t.next=29,this.checkOrderSnStatus(p);case 29:g=t.sent,u=u.concat(g);case 31:h+=5,t.next=14;break;case 34:if(!u.length){t.next=39;break}return t.next=37,this.upLoadOrders(u);case 37:y=t.sent,y&&(c+=u.length);case 39:if(f="",f=l[l.length-1].create_time,!(s.length<40||f&&(new Date).getTime()-1e3*f>24*this.timeRange*60*60*1e3)){t.next=45;break}s=[],t.next=51;break;case 45:return r.page_number++,r.total=o.total,t.next=49,this.$shopeemanService.getOrderIdList(this.mall.country,r);case 49:b=t.sent,s=b&&b.data&&b.data.orders||[];case 51:t.next=11;break;case 53:this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】成功-【").concat(c,"】条"),!0),t.next=61;break;case 56:if(403!==i.code){t.next=60;break}return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】未登录"),!1));case 60:return t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】").concat(i.code,"-").concat(i.data),!1));case 61:t.next=66;break;case 63:return t.prev=63,t.t0=t["catch"](2),t.abrupt("return",this.writeLog("".concat("manual"!==this.upLoadType?"【"+this.upLoadType+"】":"").concat(this.mallNo," 店铺【").concat(this.mall.mall_alias_name||this.mall.platform_mall_name,"】【").concat(this.syncStatus.label,"】同步失败"),!1));case 66:case"end":return t.stop()}}),t,this,[[2,63]])})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"changeParams",value:function(t){var e=[];return t.forEach((function(t){var a={order_id:t.order_id,region_id:t.region_id||t.region,shop_id:t.shop_id};e.push(a)})),e}},{key:"getOrderOtherInfo",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<e.length)){t.next=23;break}return r=e[a],i={order_id:r.order_id,shop_id:this.mall.platform_mall_id},t.next=6,this.$shopeemanService.getIncomeTransactionHistoryDetail(this.mall.country,i);case 6:return n=t.sent,200===n.code&&(r["transactionHistoryDetail"]=n.data),t.next=10,this.$shopeemanService.getOrdeTrackingHistory(this.mall.country,i);case 10:return s=t.sent,200===s.code&&(r["ordeTrackingHistory"]=s.data),t.next=14,this.$shopeemanService.getLogisticsTrackingHistory(this.mall.country,i);case 14:return o=t.sent,200===o.code&&(r["logisticsTrackingHistory"]=o.data),t.next=18,this.$shopeemanService.getForderLogistics(this.mall.country,i);case 18:c=t.sent,200===c.code&&(r["forderLogistics"]=c.data);case 20:a++,t.next=1;break;case 23:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getOrderOtherInfoRefund",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={order_id:e.order_id,shop_id:this.mall.platform_mall_id},t.next=3,this.$shopeemanService.getIncomeTransactionHistoryDetail(this.mall.country,a);case 3:return r=t.sent,200===r.code&&(e["transactionHistoryDetail"]=r.data),i={return_id:e.return_id,shop_id:this.mall.platform_mall_id},t.next=8,this.$shopeemanService.getRefundOrdeTrackingHistory(this.mall.country,i);case 8:return n=t.sent,200===n.code&&(e["ordeTrackingHistory"]=n.data),s={order_id:e.order_id,shop_id:this.mall.platform_mall_id,log_id:1},t.next=13,this.$shopeemanService.getLogisticsTrackingHistoryRefund(this.mall.country,s);case 13:return o=t.sent,200===o.code&&(e["logisticsTrackingHistory"]=o.data),t.next=17,this.$shopeemanService.getForderLogistics(this.mall.country,a);case 17:c=t.sent,200===c.code&&(e["forderLogistics"]=c.data);case 19:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"checkOrderSnStatus",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=[],r=0;case 2:if(!(r<e.length)){t.next=14;break}return i=e[r],n=i&&i.ordeTrackingHistory&&i.ordeTrackingHistory.history&&i.ordeTrackingHistory.history[0]&&i.ordeTrackingHistory.history[0].new_status||"",s=i&&i.transactionHistoryDetail&&i.transactionHistoryDetail.payment_info&&i.transactionHistoryDetail.payment_info.shipping_subtotal&&i.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf||0,o=i.order_sn+"_"+i.status+"_"+i.status_ext+"_"+i.logistics_status+"_"+n+"_"+s,t.next=9,this.$api.checkOrderSnStatus({orderKey:o});case 9:c=t.sent,c.data.orderKey||a.push(i);case 11:r++,t.next=2;break;case 14:return t.abrupt("return",a);case 15:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"checkAfterOrderSnStatus",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=!1,r="".concat(e.return_id,"_").concat(e.status,"_").concat(e.mtime?e.mtime:0),t.next=4,this.$api.checkOrderSnStatus({orderKey:r});case 4:return i=t.sent,i.data.orderKey||(a=!0),t.abrupt("return",a);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"upLoadOrders",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i,n,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(t.prev=0,a=[],r=[],i=0;i<e.length;i++)n=e[i],s={order_id:n.order_id,ordersn:n.order_sn,currency:n.order_items[0].product.currency,shipping_carrier:n.fulfillment_carrier_name,days_to_ship:n.days_to_ship||7,auto_cancel_date:n.auto_cancel_3pl_ack_date,note:n.note,note_update_time:n.note_mtime,payment_method:n.payment_method,create_time:n.create_time,update_time:n.ordeTrackingHistory&&n.ordeTrackingHistory.history&&n.ordeTrackingHistory.history[0]&&n.ordeTrackingHistory.history[0].ctime||0,pay_time:n.shipping_confirm_time,ship_by_date:n.ship_by_date,delivery_time:this.getDeliveryTime(n),tracking_no:n.shipping_traceno||this.getTrackingNo(n),buyer_cancel_reason:n.buyer_cancel_reason,message_to_seller:n.remark,goods_to_declare:0,recipient_address:{phone:n.buyer_address_phone,name:n.buyer_address_name,full_address:n.shipping_address},logistics_status:n.logistics_status,status:n.status,status_ext:n.status_ext,return_id:n.return_id,income_detail:JSON.stringify(n.transactionHistoryDetail),total_amount:this.getTotalAmount(n),goods_price:Math.abs(n.transactionHistoryDetail.payment_info.merchant_subtotal.product_price),actual_shipping_cost:Math.abs(n.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf),shipping_fee:Math.abs(n.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_buyer),estimated_shipping_fee:Math.abs(n.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_buyer),shipping_rebate:Math.abs(n.transactionHistoryDetail.buyer_payment_info.shopee_coins_redeemed),voucher_price:Math.abs(n.transactionHistoryDetail.buyer_payment_info.seller_voucher),card_txn_fee:Math.abs(n.transactionHistoryDetail.payment_info.fees_and_charges.transaction_fee),comm_fee:Math.abs(n.transactionHistoryDetail.payment_info.fees_and_charges.transaction_fee),tax_amount:Math.abs(n.transactionHistoryDetail.buyer_payment_info.tax_amount)||0,seller_service_fee:Math.abs(n.transactionHistoryDetail.payment_info.fees_and_charges.service_fee),shopee_rebate:Math.abs(n.transactionHistoryDetail.payment_info.rebate_and_voucher.product_discount_rebate_from_shopee),escrow_amount:Math.abs(n.transactionHistoryDetail.amount),needCheckactualShippingCost:Math.abs(n.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf),items:this.getItems(n),apply_time:this.getApplyTime(n),log_current_status:n.ordeTrackingHistory.history[0].new_status,order_logistics_info:"",checkOrderSnKeyNew:this.getCheckKeyNew(n),fulfillment_shipping_method:n.fulfillment_shipping_method},a.push(s),s.return_id&&r.push(s);return t.next=6,this.$api.uploadOrderSaveTest({orderData:a,sysMallId:this.mall.id,mallId:this.mall.platform_mall_id});case 6:return o=t.sent,c=!0,c=200===o.data.code,r.length&&this.syncRefundContinue(r,this.mall.platform_mall_id),t.abrupt("return",c);case 13:t.prev=13,t.t0=t["catch"](0);case 15:case"end":return t.stop()}}),t,this,[[0,13]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"syncRefundContinue",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,a){var r,i,n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=[],i=0;case 2:if(!(i<e.length)){t.next=18;break}return n=e[i],s={return_id:n.return_id,shop_id:a},t.next=7,this.$shopeemanService.getRefundOrderDetail(this.mall.country,s);case 7:if(o=t.sent,200!==o.code){t.next=15;break}return n["refundDetail"]=o.data,t.next=12,this.getOrderOtherInfoRefund(n);case 12:r.push(n),t.next=15;break;case 15:i++,t.next=2;break;case 18:if(!(r.length>0)){t.next=22;break}return t.next=21,this.afterUpLoadOrders(r);case 21:t.sent;case 22:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"afterUpLoadOrders",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,r,i,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(t.prev=0,a=[],r=0;r<e.length;r++)i=e[r],n={return_detail_info:{buyer_images:i.refundDetail.buyer_images,return_pickup_address:i.refundDetail.return_pickup_address?i.refundDetail.return_pickup_address:"",return_address:i.refundDetail.return_address.address.replace("\n","")||"",requested_time:"",tracking_number:i.refundDetail.tracking_number||"",return_delivery_time:i.logisticsTrackingHistory&&i.logisticsTrackingHistory.history&&i.logisticsTrackingHistory.history.length&&i.logisticsTrackingHistory.history[0].ctime||0},return_id:i.return_id,return_sn:i.return_sn||i.ordersn,order_id:i.order_id,return_channel_id:i.return_channel_id?i.return_channel_id:0,text_reason:i.refundDetail.text_reason,reason_id:i.refundDetail.reason,ctime:i.ordeTrackingHistory&&i.ordeTrackingHistory.history&&i.ordeTrackingHistory.history.length&&i.ordeTrackingHistory.history[0].ctime||0,mtime:i.ordeTrackingHistory&&i.ordeTrackingHistory.history&&i.ordeTrackingHistory.history.length&&i.ordeTrackingHistory.history[i.ordeTrackingHistory.history.length-1].ctime||0,refund_amount:i.refund_amount||i.refundDetail.refund_amount,refund_total_price:i.amount_before_discount||i.refundDetail.amount_before_discount,status:i.refundDetail.status,return_item:this.dealWithReturnTime(i),ckeckAfterOrderSnKey:this.getCheckRefundKey(i)},a.push(n);return t.next=5,this.$api.uploadOrderAfterSale({afterOrderData:a,sysMallId:this.mall.id,mallId:this.mall.platform_mall_id});case 5:if(s=t.sent,200!==s.data.code){t.next=10;break}return t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:t.next=15;break;case 13:t.prev=13,t.t0=t["catch"](0);case 15:case"end":return t.stop()}}),t,this,[[0,13]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"dealWithCtime",value:function(t){var e=0;if(t.return_header&&t.return_header.attribute_list&&t.return_header.attribute_list.return_attributes){var a=t.return_header.attribute_list.return_attributes.find((function(t){return"heimao_contact_by"===t.key}));e=a&&a.value||0}return e}},{key:"getCheckRefundKey",value:function(t){var e="";return e="".concat(t.return_id,"_").concat(t.status,"_").concat(t.mtime?t.mtime:0),e}},{key:"dealWithReturnTime",value:function(t){var e=[],a=t.order_product_list||t.refundDetail.order_product_list;return a.forEach((function(t){var a={price:t.model.price,modelid:t.model.id,sku:t.model.sku,itemid:t.product.id,id:t.product.id,price_before_discount:t.product.price};e.push(a)})),e}},{key:"getDeliveryTime",value:function(t){var e=0,a=h["u"].find((function(e){return e.ShipId==t.logistics_channel}));return a?(t.logistics_status>1&&(e=a.IsDeafult?t.logisticsTrackingHistory&&t.logisticsTrackingHistory.list[0]&&t.logisticsTrackingHistory.list[0].tracking_info&&t.logisticsTrackingHistory.list[0].tracking_info.length&&t.logisticsTrackingHistory.list[0].tracking_info[t.logisticsTrackingHistory.list[0].tracking_info.length-1].ctime||0:t.logisticsTrackingHistory&&t.logisticsTrackingHistory.list[0]&&t.logisticsTrackingHistory.list[0].tracking_info&&t.logisticsTrackingHistory.list[0].tracking_info.length>1&&t.logisticsTrackingHistory.list[0].tracking_info[t.logisticsTrackingHistory.list[0].tracking_info.length-1-1].ctime||0),e):e}},{key:"getTrackingNo",value:function(t){var e="",a=t.forderLogistics&&t.forderLogistics.list&&t.forderLogistics.list[0]&&t.forderLogistics.list[0].forders&&t.forderLogistics.list[0].forders[0].third_party_tn||"";return e=a||t.forderLogistics&&t.forderLogistics.list&&t.forderLogistics.list[0].consignment_no,e}},{key:"getTotalAmount",value:function(t){var e=0,a=t.transactionHistoryDetail.buyer_payment_info.merchant_subtotal||0,r=t.transactionHistoryDetail.buyer_payment_info.shipping_fee||0,i=t.transactionHistoryDetail.buyer_payment_info.import_tax||0,n=t.transactionHistoryDetail.buyer_payment_info.seller_voucher||0,s=t.transactionHistoryDetail.buyer_payment_info.shopee_coins_redeemed||0,o=t.transactionHistoryDetail.buyer_payment_info.shopee_voucher||0,c=t.transactionHistoryDetail.buyer_payment_info.credit_card_promotion||0;return e=Math.abs(a+r+i+n+s+o+c)||0,e}},{key:"getCheckKey",value:function(t){var e="",a=t.ordeTrackingHistory&&t.ordeTrackingHistory.history&&t.ordeTrackingHistory.history[0]&&t.ordeTrackingHistory.history[0].ctime||0,r=t.shipping_traceno||this.getTrackingNo(t),i=Math.abs(t.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf)||0,n=t&&t.ordeTrackingHistory&&t.ordeTrackingHistory.history&&t.ordeTrackingHistory.history[0]&&t.ordeTrackingHistory.history[0].new_status||"";return e=t.order_sn+"_"+t.status+"_"+t.status_ext+"_"+t.logistics_status+"_"+n+"_"+a+"_"+r+"_"+i,e}},{key:"getCheckKeyNew",value:function(t){var e="",a=t&&t.ordeTrackingHistory&&t.ordeTrackingHistory.history&&t.ordeTrackingHistory.history[0]&&t.ordeTrackingHistory.history[0].new_status||"",r=t&&t.transactionHistoryDetail&&t.transactionHistoryDetail.payment_info&&t.transactionHistoryDetail.payment_info.shipping_subtotal&&t.transactionHistoryDetail.payment_info.shipping_subtotal.shipping_fee_paid_by_shopee_on_your_behalf||0;return e=t.order_sn+"_"+t.status+"_"+t.status_ext+"_"+t.logistics_status+"_"+a+"_"+r,e}},{key:"getApplyTime",value:function(t){var e="";return 16===t.ordeTrackingHistory.history[0].new_status&&2===t.ordeTrackingHistory.history[0].old_status&&(e=t.ordeTrackingHistory.history[0].ctime),e}},{key:"getItems",value:function(t){var e=[];return t.order_items.forEach((function(t){var a=t.product,r=t.item_model,i=t.bundle_deal_product,n=t.bundle_deal_model,s=!0===t.is_wholesale?"1":"0",o=t.status,c=t.item_list||[],l=[],u=0,h=0;if(c.length)c.forEach((function(t){u+=t.item_price})),h=t.order_price/u,c.forEach((function(t){var e={actual_item_price:t.item_price*h,amount:t.amount,snapshotid:t.snapshot_id,modelid:t.model_id};l.push(e)}));else{var d={actual_item_price:t.order_price,amount:t.amount,snapshotid:t.snapshot_id,modelid:t.model_id};l.push(d)}l.forEach((function(t,c){var l=t["actual_item_price"],u=t["amount"],h=(t["snapshotid"],t["modelid"],""),d="",_="",m=[],p="0",g="0",y="0",f="",b="",k="";i.length>0?(h=i[c]["sku"],d=i[c]["name"],_=i[c]["cat_id"],m=i[c]["images"],p=i[c]["price_before_discount"],g=i[c]["item_id"],l=i[c]["price"],y=n[c]&&n[c]["model_id"]||"",f=n[c]&&n[c]["name"]||"",b=n[c]&&n[c]["sku"]||"",k=n[c]&&n[c]["ctime"]||""):(h=a["sku"],d=a["name"],_=a["cat_id"],m=a["images"],p=a["price_before_discount"],g=a["item_id"],y=r["model_id"],f=r["name"],b=r["sku"],k=r["ctime"]);var v={};v["is_wholesale"]=s.toString(),v["variation_quantity_purchased"]=u.toString(),v["item_sku"]=h.toString(),v["item_name"]=d.toString(),v["variation_id"]=y.toString(),v["variation_name"]=f.toString(),v["variation_sku"]=b.toString(),v["variation_discounted_price"]=l.toString(),v["variation_original_price"]=p.toString(),v["item_id"]=g.toString(),v["item_cat_id"]=_.toString(),v["item_images"]=m,v["weight"]=0,v["item_status"]=o.toString(),v["item_ctime"]=k.toString(),e.push(v)}))})),e}},{key:"delay",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var a=setTimeout((function(){clearTimeout(a),t(!0)}),e)})));case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()}]),t}()}}]);